###############################################################################
#
# IAR C/C++ Compiler V10.10.1.4655 for 8051               04/Feb/2026  18:19:26
# Copyright 2004-2017 IAR Systems AB.
# Standalone license - IAR Embedded Workbench for 8051
#
#    Core               =  plain
#    Code model         =  banked
#    Data model         =  large
#    Calling convention =  xdata reentrant
#    Constant location  =  data_rom
#    Dptr setup         =  1,16
#                          
#    Source file        =  
#        D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\Source\zcl_ZEM.c
#    Command line       =  
#        -f C:\Users\KLF\AppData\Local\Temp\EWC3CB.tmp ("D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\Source\zcl_ZEM.c" -D
#        BDB_REPORTING -D SECURE=1 -D TC_LINKKEY_JOIN -D NV_INIT -D NV_RESTORE
#        -D xZTOOL_P1 -D xMT_TASK -D xMT_APP_FUNC -D xMT_SYS_FUNC -D
#        xMT_ZDO_FUNC -D xMT_APP_CNF_FUNC -D LCD_SUPPORTED=DEBUG -D
#        MULTICAST_ENABLED=FALSE -D ZCL_READ -D ZCL_DISCOVER -D ZCL_WRITE -D
#        ZCL_BASIC -D ZCL_IDENTIFY -D ZCL_TEMPERATURE_MEASUREMENT -D ZCL_GROUPS
#        -D HAL_LED=TRUE -D HAL_UART=TRUE -D INT_HEAP_LEN=2048 -lC
#        "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\CoordinatorEB\List"
#        -lA "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\CoordinatorEB\List"
#        --diag_suppress Pe001,Pa010 -o "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\CoordinatorEB\Obj"
#        -e --debug --core=plain --dptr=16,1 --data_model=large
#        --code_model=banked --calling_convention=xdata_reentrant
#        --place_constants=data_rom --nr_virtual_regs 16 -f "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\Tools\CC2530DB\f8wCoord.cfg"
#        (-DCPU32MHZ -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRUE
#        -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8 -DMAC_CFG_RX_MAX=5
#        -DZDO_COORDINATOR -DRTR_NWK) -f "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\Tools\CC2530DB\f8wConfig.cfg"
#        (-DZIGBEEPRO -DSECURE=1 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR
#        -DDEFAULT_CHANLIST=0x00100000 -DZDAPP_CONFIG_PAN_ID=0x1234
#        -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MASK=0x007F
#        -DBEACON_REQUEST_DELAY=100 -DBEACON_REQ_DELAY_MASK=0x00FF
#        -DLINK_STATUS_JITTER_MASK=0x007F -DROUTE_EXPIRY_TIME=30
#        -DAPSC_ACK_WAIT_DURATION_POLLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7
#        -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3
#        -DNWK_MAX_DATA_RETRIES=2 -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9
#        -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40 -DNWK_MAX_BINDING_ENTRIES=4
#        -DMAX_BINDING_CLUSTER_IDS=4 -DDEFAULT_KEY={0} -DMAC_MAX_FRAME_SIZE=116
#        -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const __code"
#        -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000
#        -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100 -DREJOIN_POLL_RATE=440
#        -DREJOIN_BACKOFF=900000 -DREJOIN_SCAN=900000 -DENABLE_LED4_DISABLE_S1)
#        -f "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\Tools\CC2530DB\f8wZCL.cfg"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\" -I
#        "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\Source\" -I
#        "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\Source\" -I
#        "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\ZMain\TI2530DB\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\hal\include\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\hal\target\CC2530EB\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\mac\include\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\mac\high_level\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\mac\low_level\srf04\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\mac\low_level\srf04\single_chip\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\mt\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\osal\include\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\services\saddr\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\services\sdata\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\af\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\bdb\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\gp\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\nwk\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\sapi\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\sec\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\sys\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\zcl\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\zdo\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\zmac\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\zmac\f8w\"
#        -Ohz --require_prototypes)
#    Locale             =  Chinese (Simplified)_China.936
#    List file          =  
#        D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\CoordinatorEB\List\zcl_ZEM.lst
#    Object file        =  
#        D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\CoordinatorEB\Obj\zcl_ZEM.r51
#
###############################################################################

D:\project\Z-Stack 3.0.2\Projects\zstack\HomeAutomation\ZEM\Source\zcl_ZEM.c
      1          /*********************************************************************
      2           * INCLUDES
      3           */
      4          #include "ZComDef.h"
      5          #include "OSAL.h"
      6          #include "AF.h"
      7          #include "ZDApp.h"
      8          #include "ZDObject.h"
      9          #include "ZDProfile.h"
     10          #include "MT_SYS.h"
     11          
     12          #include "zcl.h"
     13          #include "zcl_general.h"
     14          #include "zcl_ha.h"
     15          #include "zcl_ms.h"
     16          
     17          #include "zcl_ZEM.h"
     18          
     19          #include "onboard.h"

   \                                 In  segment SFR_AN, at 0xf1
   \   unsigned char volatile __sfr PERCFG
   \                     PERCFG:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xf4
   \   unsigned char volatile __sfr P1SEL
   \                     P1SEL:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xfe
   \   unsigned char volatile __sfr P1DIR
   \                     P1DIR:
   \   000000                DS 1
     20          
     21          /* HAL */
     22          #include "hal_lcd.h"
     23          #include "hal_led.h"
     24          #include "hal_key.h"
     25          #include "hal_uart.h"
     26          
     27          #include "bdb_interface.h"
     28          #include "bdb_Reporting.h"
     29             
     30          /*********************************************************************
     31           * MACROS
     32           */
     33          
     34          // how often to report temperature
     35          #define ZEM_REPORT_INTERVAL   10000
     36          
     37          #define GUI_LOCAL_TEMP    1
     38          
     39          #define APP_TITLE "   Temp Sensor  "
     40          
     41          /*********************************************************************
     42           * CONSTANTS
     43           */
     44          
     45          /*********************************************************************
     46           * TYPEDEFS
     47           */
     48          
     49          /*********************************************************************
     50           * GLOBAL VARIABLES
     51           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     52          byte zclZEM_TaskID;
   \                     zclZEM_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     53          
     54          extern int16 zdpExternalStateTaskID;
     55          
     56          // UART Buffer

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     57          static uint8 zclZEM_UartBuf[ZCLZEM_UART_BUF_LEN];
   \                     zclZEM_UartBuf:
   \   000000                DS 64
   \   000040                REQUIRE __INIT_XDATA_Z
     58          
     59          /*********************************************************************
     60           * GLOBAL FUNCTIONS
     61           */
     62          
     63          /*********************************************************************
     64           * LOCAL VARIABLES
     65           */
     66          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     67          uint8 zclZEM_NwkState = 0; // DEV_INIT
   \                     zclZEM_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     68          
     69          //static uint8 aProcessCmd[] = { 1, 0, 0, 0 }; // used for reset command, { length + cmd0 + cmd1 + data }
     70          
     71          // Application Endpoint for data communication

   \                                 In  segment XDATA_I, align 1, keep-with-next
     72          static endPointDesc_t ZEM_AppEp =
   \                     ZEM_AppEp:
   \   000000                DS 7
   \   000007                REQUIRE `?<Initializer for ZEM_AppEp>`
   \   000007                REQUIRE __INIT_XDATA_I
     73          {
     74            ZEM_ENDPOINT,                       // Application endpoint
     75            0,
     76            &zclZEM_TaskID,
     77            &zclZEM_SimpleDesc,                 // Simple description for this application
     78            (afNetworkLatencyReq_t)0            // No Network Latency req
     79          };
     80          #ifdef BDB_REPORTING
     81          #if BDBREPORTING_MAX_ANALOG_ATTR_SIZE == 8
     82            uint8 reportableChange[] = {0x2C, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}; // 0x2C01 is 300 in int16
     83          #endif
     84          #if BDBREPORTING_MAX_ANALOG_ATTR_SIZE == 4

   \                                 In  segment XDATA_I, align 1, keep-with-next
     85            uint8 reportableChange[] = {0x2C, 0x01, 0x00, 0x00}; // 0x2C01 is 300 in int16
   \                     reportableChange:
   \   000000                DS 4
   \   000004                REQUIRE `?<Initializer for reportableChange>`
   \   000004                REQUIRE __INIT_XDATA_I
     86          #endif 
     87          #if BDBREPORTING_MAX_ANALOG_ATTR_SIZE == 2
     88            uint8 reportableChange[] = {0x2C, 0x01}; // 0x2C01 is 300 in int16
     89          #endif 
     90          #endif
     91          
     92          /*********************************************************************
     93           * LOCAL FUNCTIONS
     94           */
     95          static void zclZEM_HandleKeys( byte shift, byte keys );
     96          static void zclZEM_BasicResetCB( void );
     97          
     98          static void zclZEM_ProcessCommissioningStatus(bdbCommissioningModeMsg_t* bdbCommissioningModeMsg);
     99          
    100          // Functions to process ZCL Foundation incoming Command/Response messages
    101          static void zclZEM_ProcessIncomingMsg( zclIncomingMsg_t *msg );
    102          #ifdef ZCL_READ
    103          static uint8 zclZEM_ProcessInReadRspCmd( zclIncomingMsg_t *pInMsg );
    104          #endif
    105          #ifdef ZCL_WRITE
    106          static uint8 zclZEM_ProcessInWriteRspCmd( zclIncomingMsg_t *pInMsg );
    107          #endif
    108          static uint8 zclZEM_ProcessInDefaultRspCmd( zclIncomingMsg_t *pInMsg );
    109          #ifdef ZCL_DISCOVER
    110          static uint8 zclZEM_ProcessInDiscCmdsRspCmd( zclIncomingMsg_t *pInMsg );
    111          static uint8 zclZEM_ProcessInDiscAttrsRspCmd( zclIncomingMsg_t *pInMsg );
    112          static uint8 zclZEM_ProcessInDiscAttrsExtRspCmd( zclIncomingMsg_t *pInMsg );
    113          #endif // ZCL_DISCOVER
    114          
    115          static void zclSampleApp_BatteryWarningCB( uint8 voltLevel);
    116          
    117          /*********************************************************************
    118           * STATUS STRINGS
    119           */
    120          
    121          /*********************************************************************
    122           * CONSTANTS
    123           */
    124          
    125          
    126          /*********************************************************************
    127           * ZCL General Profile Callback table
    128           */

   \                                 In  segment XDATA_I, align 1, keep-with-next
    129          static zclGeneral_AppCallbacks_t zclZEM_CmdCallbacks =
   \                     zclZEM_CmdCallbacks:
   \   000000                DS 18
   \   000012                REQUIRE `?<Initializer for zclZEM_CmdCallbacks>`
   \   000012                REQUIRE __INIT_XDATA_I
    130          {
    131            zclZEM_BasicResetCB,        // Basic Cluster Reset command
    132            NULL,                                           // Identify Trigger Effect command
    133            NULL,             				                      // On/Off cluster command
    134            NULL,                                           // On/Off cluster enhanced command Off with Effect
    135            NULL,                                           // On/Off cluster enhanced command On with Recall Global Scene
    136            NULL,                                           // On/Off cluster enhanced command On with Timed Off
    137          #ifdef ZCL_LEVEL_CTRL
    138            NULL,                                           // Level Control Move to Level command
    139            NULL,                                           // Level Control Move command
    140            NULL,                                           // Level Control Step command
    141            NULL,                                           // Level Control Stop command
    142          #endif
    143          #ifdef ZCL_GROUPS
    144            NULL,                                           // Group Response commands
    145          #endif
    146          #ifdef ZCL_SCENES
    147            NULL,                                           // Scene Store Request command
    148            NULL,                                           // Scene Recall Request command
    149            NULL,                                           // Scene Response command
    150          #endif
    151          #ifdef ZCL_ALARMS
    152            NULL,                                           // Alarm (Response) commands
    153          #endif
    154          #ifdef SE_UK_EXT
    155            NULL,                                           // Get Event Log command
    156            NULL,                                           // Publish Event Log command
    157          #endif
    158            NULL,                                           // RSSI Location command
    159            NULL                                            // RSSI Location Response command
    160          };
    161          
    162          /*********************************************************************
    163           * @fn          zclZEM_Init
    164           *
    165           * @brief       Initialization function for the zclGeneral layer.
    166           *
    167           * @param       none
    168           *
    169           * @return      none
    170           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    171          void zclZEM_Init( byte task_id )
   \                     zclZEM_Init:
    172          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV       A,#-0xa
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 29
   \   000005   74E3         MOV       A,#-0x1d
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   \   00000A   E9           MOV       A,R1
    173            zclZEM_TaskID = task_id;
   \   00000B   90....       MOV       DPTR,#zclZEM_TaskID
   \   00000E   F0           MOVX      @DPTR,A
    174          
    175            // Register the Simple Descriptor for this application
    176            bdb_RegisterSimpleDescriptor( &zclZEM_SimpleDesc ); 
   \   00000F                ; Setup parameters for call to function bdb_RegisterSimpleDescriptor
   \   00000F   7A..         MOV       R2,#zclZEM_SimpleDesc & 0xff
   \   000011   7B..         MOV       R3,#(zclZEM_SimpleDesc >> 8) & 0xff
   \   000013   12....       LCALL     `??bdb_RegisterSimpleDescriptor::?relay`; Banked call to: bdb_RegisterSimpleDescriptor
    177            
    178            // Register the ZCL General Cluster Library callback functions
    179            zclGeneral_RegisterCmdCallbacks( ZEM_ENDPOINT, &zclZEM_CmdCallbacks );
   \   000016                ; Setup parameters for call to function zclGeneral_RegisterCmdCallbacks
   \   000016   7A..         MOV       R2,#zclZEM_CmdCallbacks & 0xff
   \   000018   7B..         MOV       R3,#(zclZEM_CmdCallbacks >> 8) & 0xff
   \   00001A   7908         MOV       R1,#0x8
   \   00001C   12....       LCALL     `??zclGeneral_RegisterCmdCallbacks::?relay`; Banked call to: zclGeneral_RegisterCmdCallbacks
    180          
    181            // Register the application's attribute list
    182            zclZEM_ResetAttributesToDefaultValues();
   \   00001F                ; Setup parameters for call to function zclZEM_ResetAttributesToDefaultValues
   \   00001F   12....       LCALL     `??zclZEM_ResetAttributesToDefaultValues::?relay`; Banked call to: zclZEM_ResetAttributesToDefaultValues
    183            zcl_registerAttrList( ZEM_ENDPOINT, zclZEM_NumAttributes, zclZEM_Attrs );
   \   000022                ; Setup parameters for call to function zcl_registerAttrList
   \   000022   7C..         MOV       R4,#zclZEM_Attrs & 0xff
   \   000024   7D..         MOV       R5,#(zclZEM_Attrs >> 8) & 0xff
   \   000026   90....       MOV       DPTR,#zclZEM_NumAttributes
   \   000029   E4           CLR       A
   \   00002A   93           MOVC      A,@A+DPTR
   \   00002B   FA           MOV       R2,A
   \   00002C   7908         MOV       R1,#0x8
   \   00002E   12....       LCALL     `??zcl_registerAttrList::?relay`; Banked call to: zcl_registerAttrList
    184          
    185            // Register the Application to receive the unprocessed Foundation command/response messages
    186            zcl_registerForMsg( zclZEM_TaskID );
   \   000031                ; Setup parameters for call to function zcl_registerForMsg
   \   000031   90....       MOV       DPTR,#zclZEM_TaskID
   \   000034   E0           MOVX      A,@DPTR
   \   000035   F9           MOV       R1,A
   \   000036   12....       LCALL     `??zcl_registerForMsg::?relay`; Banked call to: zcl_registerForMsg
    187          
    188            // Register low voltage NV memory protection application callback
    189            RegisterVoltageWarningCB( zclSampleApp_BatteryWarningCB );
   \   000039                ; Setup parameters for call to function RegisterVoltageWarningCB
   \   000039   7A..         MOV       R2,#`??zclSampleApp_BatteryWarningCB::?relay` & 0xff
   \   00003B   7B..         MOV       R3,#(`??zclSampleApp_BatteryWarningCB::?relay` >> 8) & 0xff
   \   00003D   12....       LCALL     `??RegisterVoltageWarningCB::?relay`; Banked call to: RegisterVoltageWarningCB
    190          
    191            // Register for all key events - This app will handle all key events
    192            RegisterForKeys( zclZEM_TaskID );
   \   000040                ; Setup parameters for call to function RegisterForKeys
   \   000040   90....       MOV       DPTR,#zclZEM_TaskID
   \   000043   E0           MOVX      A,@DPTR
   \   000044   F9           MOV       R1,A
   \   000045   12....       LCALL     `??RegisterForKeys::?relay`; Banked call to: RegisterForKeys
    193          
    194            bdb_RegisterCommissioningStatusCB( zclZEM_ProcessCommissioningStatus );
   \   000048                ; Setup parameters for call to function bdb_RegisterCommissioningStatusCB
   \   000048   7A..         MOV       R2,#`??zclZEM_ProcessCommissioningStatus::?relay` & 0xff
   \   00004A   7B..         MOV       R3,#(`??zclZEM_ProcessCommissioningStatus::?relay` >> 8) & 0xff
   \   00004C   12....       LCALL     `??bdb_RegisterCommissioningStatusCB::?relay`; Banked call to: bdb_RegisterCommissioningStatusCB
    195          
    196          #ifdef ZDO_COORDINATOR
    197            // 重置网络状态，强制每次都重新初始化网络
    198            // 设置ZCD_STARTOPT_DEFAULT_NETWORK_STATE位，使设备每次都重新组网
    199            extern uint8 zgWriteStartupOptions( uint8 action, uint8 bitOptions );
    200            
    201            // 设置默认网络状态选项
    202            zgWriteStartupOptions( 1, 0x01 );
   \   00004F                ; Setup parameters for call to function zgWriteStartupOptions
   \   00004F   7A01         MOV       R2,#0x1
   \   000051   7901         MOV       R1,#0x1
   \   000053   12....       LCALL     `??zgWriteStartupOptions::?relay`; Banked call to: zgWriteStartupOptions
    203            
    204            // 执行网络形成
    205            bdb_StartCommissioning( BDB_COMMISSIONING_MODE_NWK_FORMATION |
    206                                    BDB_COMMISSIONING_MODE_FINDING_BINDING );
   \   000056                ; Setup parameters for call to function bdb_StartCommissioning
   \   000056   790C         MOV       R1,#0xc
   \   000058   12....       LCALL     `??bdb_StartCommissioning::?relay`; Banked call to: bdb_StartCommissioning
    207            NLME_PermitJoiningRequest(255);
   \   00005B                ; Setup parameters for call to function NLME_PermitJoiningRequest
   \   00005B   79FF         MOV       R1,#-0x1
   \   00005D   12....       LCALL     `??NLME_PermitJoiningRequest::?relay`; Banked call to: NLME_PermitJoiningRequest
    208            // Broadcast
    209            osal_start_timerEx(zclZEM_TaskID,
    210                               ZEM_BROADCAST_EVT,
    211                               ZEM_BROADCAST_PERIOD);
   \   000060                ; Setup parameters for call to function osal_start_timerEx
   \   000060   90....       MOV       DPTR,#__Constant_3e8
   \   000063   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   000066   7A80         MOV       R2,#-0x80
   \   000068   7B00         MOV       R3,#0x0
   \   00006A   90....       MOV       DPTR,#zclZEM_TaskID
   \   00006D   E0           MOVX      A,@DPTR
   \   00006E   F9           MOV       R1,A
   \   00006F   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   000072   7404         MOV       A,#0x4
   \   000074   12....       LCALL     ?DEALLOC_XSTACK8
    212            // groupcast
    213            osal_start_timerEx(zclZEM_TaskID,
    214                               ZEM_GROUPCAST_EVT,
    215                               ZEM_GROUPCAST_PERIOD);
   \   000077                ; Setup parameters for call to function osal_start_timerEx
   \   000077   90....       MOV       DPTR,#__Constant_3e8
   \   00007A   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   00007D   7A00         MOV       R2,#0x0
   \   00007F   7B01         MOV       R3,#0x1
   \   000081   90....       MOV       DPTR,#zclZEM_TaskID
   \   000084   E0           MOVX      A,@DPTR
   \   000085   F9           MOV       R1,A
   \   000086   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   000089   7404         MOV       A,#0x4
   \   00008B   12....       LCALL     ?DEALLOC_XSTACK8
    216          #else
    217            bdb_StartCommissioning( BDB_COMMISSIONING_MODE_NWK_STEERING |
    218                                    BDB_COMMISSIONING_MODE_FINDING_BINDING );
    219            // Add group
    220            aps_Group_t group = {
    221              .ID = GROUP_ID,
    222              .name = "",
    223            };
    224            aps_AddGroup(ZEM_ENDPOINT, &group);
    225            // P2P
    226            osal_start_timerEx(zclZEM_TaskID,
    227                               ZEM_P2P_EVT,
    228                               ZEM_P2P_PERIOD);
    229          #endif
    230          
    231            // Initialize UART communication
    232            zclZEM_InitUart();
   \   00008E   43F101       ORL       0xf1,#0x1
   \   000091   43F430       ORL       0xf4,#0x30
   \   000094   43FE10       ORL       0xfe,#0x10
   \   000097   53FEDF       ANL       0xfe,#0xdf
   \   00009A   85..82       MOV       DPL,?XSP + 0
   \   00009D   85..83       MOV       DPH,?XSP + 1
   \   0000A0   7401         MOV       A,#0x1
   \   0000A2   F0           MOVX      @DPTR,A
   \   0000A3   12....       LCALL     ?XSTACK_DISP0_8
   \   0000A6   7404         MOV       A,#0x4
   \   0000A8   F0           MOVX      @DPTR,A
   \   0000A9   7402         MOV       A,#0x2
   \   0000AB   12....       LCALL     ?XSTACK_DISP0_8
   \   0000AE   E4           CLR       A
   \   0000AF   F0           MOVX      @DPTR,A
   \   0000B0   7403         MOV       A,#0x3
   \   0000B2   12....       LCALL     ?XSTACK_DISP0_8
   \   0000B5   E4           CLR       A
   \   0000B6   F0           MOVX      @DPTR,A
   \   0000B7   A3           INC       DPTR
   \   0000B8   F0           MOVX      @DPTR,A
   \   0000B9   740A         MOV       A,#0xa
   \   0000BB   12....       LCALL     ?XSTACK_DISP0_8
   \   0000BE   7440         MOV       A,#0x40
   \   0000C0   F0           MOVX      @DPTR,A
   \   0000C1   A3           INC       DPTR
   \   0000C2   E4           CLR       A
   \   0000C3   F0           MOVX      @DPTR,A
   \   0000C4   7412         MOV       A,#0x12
   \   0000C6   12....       LCALL     ?XSTACK_DISP0_8
   \   0000C9   E4           CLR       A
   \   0000CA   F0           MOVX      @DPTR,A
   \   0000CB   A3           INC       DPTR
   \   0000CC   F0           MOVX      @DPTR,A
   \   0000CD   7405         MOV       A,#0x5
   \   0000CF   12....       LCALL     ?XSTACK_DISP0_8
   \   0000D2   7406         MOV       A,#0x6
   \   0000D4   F0           MOVX      @DPTR,A
   \   0000D5   7416         MOV       A,#0x16
   \   0000D7   12....       LCALL     ?XSTACK_DISP0_8
   \   0000DA   7401         MOV       A,#0x1
   \   0000DC   F0           MOVX      @DPTR,A
   \   0000DD   741B         MOV       A,#0x1b
   \   0000DF   12....       LCALL     ?XSTACK_DISP0_8
   \   0000E2   74..         MOV       A,#`??zclZEM_UartCB::?relay` & 0xff
   \   0000E4   F0           MOVX      @DPTR,A
   \   0000E5   A3           INC       DPTR
   \   0000E6   74..         MOV       A,#(`??zclZEM_UartCB::?relay` >> 8) & 0xff
   \   0000E8   F0           MOVX      @DPTR,A
   \   0000E9                ; Setup parameters for call to function HalUARTOpen
   \   0000E9   AA..         MOV       R2,?XSP + 0
   \   0000EB   AB..         MOV       R3,?XSP + 1
   \   0000ED   7900         MOV       R1,#0x0
   \   0000EF   12....       LCALL     `??HalUARTOpen::?relay`; Banked call to: HalUARTOpen
    233            
    234            // Read and send MAC address
    235            zclZEM_ReadAndSendMAC();
   \   0000F2                ; Setup parameters for call to function zclZEM_ReadAndSendMAC
   \   0000F2   12....       LCALL     `??zclZEM_ReadAndSendMAC::?relay`; Banked call to: zclZEM_ReadAndSendMAC
    236          
    237          #ifdef BDB_REPORTING
    238            //Adds the default configuration values for the temperature attribute of the ZCL_CLUSTER_ID_MS_TEMPERATURE_MEASUREMENT cluster, for endpoint ZEM_ENDPOINT
    239            //Default maxReportingInterval value is 10 seconds
    240            //Default minReportingInterval value is 3 seconds
    241            //Default reportChange value is 300 (3 degrees)
    242            bdb_RepAddAttrCfgRecordDefaultToList(ZEM_ENDPOINT, ZCL_CLUSTER_ID_MS_TEMPERATURE_MEASUREMENT, ATTRID_MS_TEMPERATURE_MEASURED_VALUE, 0, 10, reportableChange);
   \   0000F5                ; Setup parameters for call to function bdb_RepAddAttrCfgRecordDefaultToList
   \   0000F5   75....       MOV       ?V0,#reportableChange & 0xff
   \   0000F8   75....       MOV       ?V1,#(reportableChange >> 8) & 0xff
   \   0000FB   78..         MOV       R0,#?V0
   \   0000FD   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000100   75..0A       MOV       ?V0,#0xa
   \   000103   75..00       MOV       ?V1,#0x0
   \   000106   78..         MOV       R0,#?V0
   \   000108   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00010B   E4           CLR       A
   \   00010C   F5..         MOV       ?V0,A
   \   00010E   78..         MOV       R0,#?V0
   \   000110   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000113   7C00         MOV       R4,#0x0
   \   000115   7D00         MOV       R5,#0x0
   \   000117   7A02         MOV       R2,#0x2
   \   000119   7B04         MOV       R3,#0x4
   \   00011B   7908         MOV       R1,#0x8
   \   00011D   12....       LCALL     `??bdb_RepAddAttrCfgRecordDefaultToList::?relay`; Banked call to: bdb_RepAddAttrCfgRecordDefaultToList
   \   000120   7406         MOV       A,#0x6
   \   000122   12....       LCALL     ?DEALLOC_XSTACK8
    243          #endif
    244            
    245            zdpExternalStateTaskID = zclZEM_TaskID;
   \   000125   90....       MOV       DPTR,#zclZEM_TaskID
   \   000128   E0           MOVX      A,@DPTR
   \   000129   90....       MOV       DPTR,#zdpExternalStateTaskID
   \   00012C   F0           MOVX      @DPTR,A
   \   00012D   A3           INC       DPTR
   \   00012E   E4           CLR       A
   \   00012F   F0           MOVX      @DPTR,A
    246             osal_start_timerEx(
    247                zclZEM_TaskID,
    248                ZEMAPP_EVT,
    249                3000);
   \   000130                ; Setup parameters for call to function osal_start_timerEx
   \   000130   90....       MOV       DPTR,#__Constant_bb8
   \   000133   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   000136   7A80         MOV       R2,#-0x80
   \   000138   7B00         MOV       R3,#0x0
   \   00013A   90....       MOV       DPTR,#zclZEM_TaskID
   \   00013D   E0           MOVX      A,@DPTR
   \   00013E   F9           MOV       R1,A
   \   00013F   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   000142   7404         MOV       A,#0x4
   \   000144   12....       LCALL     ?DEALLOC_XSTACK8
    250          }
   \   000147   741D         MOV       A,#0x1d
   \   000149   12....       LCALL     ?DEALLOC_XSTACK8
   \   00014C   7F02         MOV       R7,#0x2
   \   00014E   02....       LJMP      ?BANKED_LEAVE_XDATA
   \   000151                REQUIRE PERCFG
   \   000151                REQUIRE P1SEL
   \   000151                REQUIRE P1DIR
    251          
    252          /*********************************************************************
    253           * @fn          zclSample_event_loop
    254           *
    255           * @brief       Event Loop Processor for zclGeneral.
    256           *
    257           * @param       none
    258           *
    259           * @return      none
    260           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    261          uint16 zclZEM_event_loop( uint8 task_id, uint16 events )
   \                     zclZEM_event_loop:
    262          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000   74F4         MOV       A,#-0xc
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 26
   \   000005   74E6         MOV       A,#-0x1a
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   \   00000A   EA           MOV       A,R2
   \   00000B   FE           MOV       R6,A
   \   00000C   EB           MOV       A,R3
   \   00000D   FF           MOV       R7,A
    263            afIncomingMSGPacket_t *MSGpkt;
    264          
    265            (void)task_id;  // Intentionally unreferenced parameter
    266          
    267            if ( events & SYS_EVENT_MSG )
   \   00000E   5480         ANL       A,#0x80
   \   000010   703E         JNZ       ??zclZEM_event_loop_0
    268            {
    269              while ( (MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( zclZEM_TaskID )) )
    270              {
    271                switch ( MSGpkt->hdr.event )
    272                {
    273                  case ZCL_INCOMING_MSG:
    274                    // Incoming ZCL Foundation command/response messages
    275                    zclZEM_ProcessIncomingMsg( (zclIncomingMsg_t *)MSGpkt );
    276                    break;
    277          
    278                  case AF_INCOMING_MSG_CMD:
    279                    // Incoming AF data messages
    280                    zclZEM_AF_RxProc( MSGpkt );
    281                    break;
    282          
    283                  case KEY_CHANGE:
    284                    zclZEM_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    285                    break;
    286          
    287                  case ZDO_STATE_CHANGE:
    288                    // 处理网络状态变化
    289                    {
    290                      uint8 newState = ((uint8*)MSGpkt)[0];
    291                      zclZEM_NwkState = newState; // 更新网络状态
    292                      
    293                      if (newState == 5) // DEV_END_DEVICE
    294                      {
    295                        // 终端设备已加入网络
    296                        uint8 successMsg[] = "Network joined successfully!\r\n";
    297                        HalUARTWrite(HAL_UART_PORT_0, successMsg, sizeof(successMsg)-1);
    298                        
    299                        // 联网成功后向协调器发送MAC地址
    300                        #ifndef ZDO_COORDINATOR
    301                        zclZEM_SendMACToCoordinator();
    302                        #endif
    303                      }
    304                      else if (newState == 9) // DEV_NWK_ORPHAN
    305                      {
    306                        // 设备成为孤立设备
    307                        #ifndef ZDO_COORDINATOR
    308                        {
    309                          static uint8 retryCount = 0;
    310                          if (retryCount < 3)
    311                          {
    312                            retryCount++;
    313                            osal_start_timerEx(zclZEM_TaskID, ZEM_REJOIN_EVT, 2000);
    314                          }
    315                        }
    316                        #endif
    317                      }
    318                    }
    319                    break;
    320          
    321                  default:
    322                    break;
    323                }
    324          
    325                // Release the memory
    326                osal_msg_deallocate( (uint8 *)MSGpkt );
    327              }
    328          
    329              // return unprocessed events
    330              return (events ^ SYS_EVENT_MSG);
    331            }
    332          
    333            // 先处理LED闪烁事件，确保不会被SYS_EVENT_MSG阻塞
    334            if(events & ZEMAPP_EVT)
   \   000012   EE           MOV       A,R6
   \   000013   5480         ANL       A,#0x80
   \   000015   606F         JZ        ??zclZEM_event_loop_1
    335            { 
    336              HalLedBlink(
    337                  HAL_LED_1, // 指定使用LED1
    338                  10, // 指定闪烁次数为10次
    339                  50, // 指定50%的时间LED处于点亮状态
    340                  1000); // 指定每次闪烁周期为1000ms
   \   000017                ; Setup parameters for call to function HalLedBlink
   \   000017   7CE8         MOV       R4,#-0x18
   \   000019   7D03         MOV       R5,#0x3
   \   00001B   7B32         MOV       R3,#0x32
   \   00001D   7A0A         MOV       R2,#0xa
   \   00001F   7901         MOV       R1,#0x1
   \   000021   12....       LCALL     `??HalLedBlink::?relay`; Banked call to: HalLedBlink
    341              
    342              // 设置下一次LED闪烁定时器
    343              osal_start_timerEx(zclZEM_TaskID, ZEMAPP_EVT, 10000);
   \   000024                ; Setup parameters for call to function osal_start_timerEx
   \   000024   90....       MOV       DPTR,#__Constant_2710
   \   000027   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   00002A   7A80         MOV       R2,#-0x80
   \   00002C   7B00         MOV       R3,#0x0
   \   00002E   90....       MOV       DPTR,#zclZEM_TaskID
   \   000031   E0           MOVX      A,@DPTR
   \   000032   F9           MOV       R1,A
   \   000033   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   000036   7404         MOV       A,#0x4
   \   000038   12....       LCALL     ?DEALLOC_XSTACK8
    344              
    345              return (events ^ ZEMAPP_EVT);
   \   00003B   EE           MOV       A,R6
   \   00003C   6480         XRL       A,#0x80
   \   00003E   FA           MOV       R2,A
   \   00003F   EF           MOV       A,R7
   \   000040   02....       LJMP      ??zclZEM_event_loop_2 & 0xFFFF
    346            }
   \                     ??zclZEM_event_loop_3:
   \   000043   90....       MOV       DPTR,#zclZEM_NwkState
   \   000046   74D1         MOV       A,#-0x2f
   \   000048   F0           MOVX      @DPTR,A
   \                     ??zclZEM_event_loop_4:
   \   000049                ; Setup parameters for call to function osal_msg_deallocate
   \   000049   AA..         MOV       R2,?V0
   \   00004B   AB..         MOV       R3,?V1
   \   00004D   12....       LCALL     `??osal_msg_deallocate::?relay`; Banked call to: osal_msg_deallocate
   \                     ??zclZEM_event_loop_0:
   \   000050                ; Setup parameters for call to function osal_msg_receive
   \   000050   90....       MOV       DPTR,#zclZEM_TaskID
   \   000053   E0           MOVX      A,@DPTR
   \   000054   F9           MOV       R1,A
   \   000055   12....       LCALL     `??osal_msg_receive::?relay`; Banked call to: osal_msg_receive
   \   000058   8A..         MOV       ?V0,R2
   \   00005A   8B..         MOV       ?V1,R3
   \   00005C   EA           MOV       A,R2
   \   00005D   45..         ORL       A,?V1
   \   00005F   601D         JZ        ??zclZEM_event_loop_5
   \   000061   8A82         MOV       DPL,R2
   \   000063   8B83         MOV       DPH,R3
   \   000065   E0           MOVX      A,@DPTR
   \   000066   24E6         ADD       A,#-0x1a
   \   000068   600F         JZ        ??zclZEM_event_loop_6
   \   00006A   24E6         ADD       A,#-0x1a
   \   00006C   6006         JZ        ??zclZEM_event_loop_7
   \   00006E   2463         ADD       A,#0x63
   \   000070   60D1         JZ        ??zclZEM_event_loop_3
   \   000072   80D5         SJMP      ??zclZEM_event_loop_4
   \                     ??zclZEM_event_loop_7:
   \   000074                ; Setup parameters for call to function zclZEM_ProcessIncomingMsg
   \   000074   12....       LCALL     `??zclZEM_ProcessIncomingMsg::?relay`; Banked call to: zclZEM_ProcessIncomingMsg
   \   000077   80D0         SJMP      ??zclZEM_event_loop_4
   \                     ??zclZEM_event_loop_6:
   \   000079                ; Setup parameters for call to function zclZEM_AF_RxProc
   \   000079   12....       LCALL     `??zclZEM_AF_RxProc::?relay`; Banked call to: zclZEM_AF_RxProc
   \   00007C   80CB         SJMP      ??zclZEM_event_loop_4
   \                     ??zclZEM_event_loop_5:
   \   00007E   EE           MOV       A,R6
   \   00007F   FA           MOV       R2,A
   \   000080   EF           MOV       A,R7
   \   000081   6480         XRL       A,#0x80
   \   000083   02....       LJMP      ??zclZEM_event_loop_2 & 0xFFFF
    347            
    348          #if ZG_BUILD_ENDDEVICE_TYPE    
    349            if ( events & ZEM_END_DEVICE_REJOIN_EVT )
    350            {
    351              bdb_ZedAttemptRecoverNwk();
    352              return ( events ^ ZEM_END_DEVICE_REJOIN_EVT );
    353            }
    354          #endif
    355          
    356            if ( events & ZEM_LCD_AUTO_UPDATE_EVT )
   \                     ??zclZEM_event_loop_1:
   \   000086   EE           MOV       A,R6
   \   000087   5410         ANL       A,#0x10
   \   000089   6005         JZ        ??zclZEM_event_loop_8
    357            {
    358              return ( events ^ ZEM_LCD_AUTO_UPDATE_EVT );
   \   00008B   EE           MOV       A,R6
   \   00008C   6410         XRL       A,#0x10
   \   00008E   8008         SJMP      ??zclZEM_event_loop_9
    359            }
    360          
    361            if ( events & ZEM_KEY_AUTO_REPEAT_EVT )
   \                     ??zclZEM_event_loop_8:
   \   000090   EE           MOV       A,R6
   \   000091   5420         ANL       A,#0x20
   \   000093   6007         JZ        ??zclZEM_event_loop_10
    362            {
    363              return ( events ^ ZEM_KEY_AUTO_REPEAT_EVT );
   \   000095   EE           MOV       A,R6
   \   000096   6420         XRL       A,#0x20
   \                     ??zclZEM_event_loop_9:
   \   000098   FA           MOV       R2,A
   \   000099   02....       LJMP      ??zclZEM_event_loop_11 & 0xFFFF
    364            }
    365            
    366            // Broadcast event
    367            if ( events & ZEM_BROADCAST_EVT )
    368            {
    369              uint8 broadcastData[] = "Broadcast";
    370              zclZEM_AF_Broadcast(CLUSTER_BROADCAST, 
    371                                  sizeof(broadcastData)-1, 
    372                                  broadcastData);
    373              osal_start_timerEx(zclZEM_TaskID,
    374                                ZEM_BROADCAST_EVT,
    375                                ZEM_BROADCAST_PERIOD);
    376              return ( events ^ ZEM_BROADCAST_EVT );
    377            }
    378            
    379            // Groupcast event
    380            if ( events & ZEM_GROUPCAST_EVT )
   \                     ??zclZEM_event_loop_10:
   \   00009C   EF           MOV       A,R7
   \   00009D   5401         ANL       A,#0x1
   \   00009F   7003         JNZ       $+5
   \   0000A1   02....       LJMP      ??zclZEM_event_loop_12 & 0xFFFF
    381            {
    382              uint8 groupcastData[] = "Groupcast";
   \   0000A4   90....       MOV       DPTR,#`?<Constant "Groupcast">`
   \   0000A7   7410         MOV       A,#0x10
   \   0000A9   12....       LCALL     ?XSTACK_DISP102_8
   \   0000AC   740A         MOV       A,#0xa
   \   0000AE   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    383              zclZEM_AF_Groupcast(GROUP_ID,
    384                                  CLUSTER_GROUPCAST,
    385                                  sizeof(groupcastData)-1, 
    386                                  groupcastData);
   \   0000B1   7408         MOV       A,#0x8
   \   0000B3   12....       LCALL     ?XSTACK_DISP0_8
   \   0000B6   7401         MOV       A,#0x1
   \   0000B8   F0           MOVX      @DPTR,A
   \   0000B9   85..82       MOV       DPL,?XSP + 0
   \   0000BC   85..83       MOV       DPH,?XSP + 1
   \   0000BF   7415         MOV       A,#0x15
   \   0000C1   F0           MOVX      @DPTR,A
   \   0000C2   A3           INC       DPTR
   \   0000C3   E4           CLR       A
   \   0000C4   F0           MOVX      @DPTR,A
   \   0000C5   7409         MOV       A,#0x9
   \   0000C7   12....       LCALL     ?XSTACK_DISP0_8
   \   0000CA   7408         MOV       A,#0x8
   \   0000CC   F0           MOVX      @DPTR,A
   \   0000CD   90....       MOV       DPTR,#??transferId_2
   \   0000D0   12....       LCALL     ?Subroutine9 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   0000D3   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   0000D6   75....       MOV       ?V0,#??transferId_2 & 0xff
   \   0000D9   75....       MOV       ?V1,#(??transferId_2 >> 8) & 0xff
   \   0000DC   78..         MOV       R0,#?V0
   \   0000DE   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000E1   7413         MOV       A,#0x13
   \   0000E3   12....       LCALL     ?XSTACK_DISP100_8
   \   0000E6   88..         MOV       ?V0,R0
   \   0000E8   89..         MOV       ?V1,R1
   \   0000EA   78..         MOV       R0,#?V0
   \   0000EC   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000EF   75..09       MOV       ?V0,#0x9
   \   0000F2   75..00       MOV       ?V1,#0x0
   \   0000F5   78..         MOV       R0,#?V0
   \   0000F7   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000FA   75..02       MOV       ?V0,#0x2
   \   0000FD   78..         MOV       R0,#?V0
   \   0000FF   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000102   7900         MOV       R1,#0x0
   \   000104   7C..         MOV       R4,#ZEM_AppEp & 0xff
   \   000106   7D..         MOV       R5,#(ZEM_AppEp >> 8) & 0xff
   \   000108   7409         MOV       A,#0x9
   \   00010A   12....       LCALL     ?XSTACK_DISP101_8
   \   00010D   12....       LCALL     `??AF_DataRequest::?relay`; Banked call to: AF_DataRequest
   \   000110   7409         MOV       A,#0x9
   \   000112   12....       LCALL     ?DEALLOC_XSTACK8
    387              osal_start_timerEx(zclZEM_TaskID,
    388                                ZEM_GROUPCAST_EVT,
    389                                ZEM_GROUPCAST_PERIOD);
   \   000115                ; Setup parameters for call to function osal_start_timerEx
   \   000115   90....       MOV       DPTR,#__Constant_3e8
   \   000118   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   00011B   7A00         MOV       R2,#0x0
   \   00011D   7B01         MOV       R3,#0x1
   \   00011F   90....       MOV       DPTR,#zclZEM_TaskID
   \   000122   E0           MOVX      A,@DPTR
   \   000123   F9           MOV       R1,A
   \   000124   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   000127   7404         MOV       A,#0x4
   \   000129   12....       LCALL     ?DEALLOC_XSTACK8
    390              return ( events ^ ZEM_GROUPCAST_EVT );
   \   00012C   EE           MOV       A,R6
   \   00012D   FA           MOV       R2,A
   \   00012E   EF           MOV       A,R7
   \   00012F   6401         XRL       A,#0x1
   \   000131   02....       LJMP      ??zclZEM_event_loop_2 & 0xFFFF
    391            }
    392            
    393            // P2P event
    394            if ( events & ZEM_P2P_EVT )
   \                     ??zclZEM_event_loop_12:
   \   000134   EF           MOV       A,R7
   \   000135   5402         ANL       A,#0x2
   \   000137   7003         JNZ       $+5
   \   000139   02....       LJMP      ??zclZEM_event_loop_13 & 0xFFFF
    395            {
    396              uint8 p2pData[] = "P2P";
   \   00013C   90....       MOV       DPTR,#`?<Constant "P2P">`
   \   00013F   740C         MOV       A,#0xc
   \   000141   12....       LCALL     ?XSTACK_DISP102_8
   \   000144   7404         MOV       A,#0x4
   \   000146   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    397              zclZEM_AF_P2P(0x0000, // 目标设备网络地址（这里使用0x0000作为示例）
    398                            CLUSTER_P2P,
    399                            sizeof(p2pData)-1, 
    400                            p2pData);
   \   000149   7408         MOV       A,#0x8
   \   00014B   12....       LCALL     ?XSTACK_DISP0_8
   \   00014E   7402         MOV       A,#0x2
   \   000150   F0           MOVX      @DPTR,A
   \   000151   85..82       MOV       DPL,?XSP + 0
   \   000154   85..83       MOV       DPH,?XSP + 1
   \   000157   E4           CLR       A
   \   000158   F0           MOVX      @DPTR,A
   \   000159   A3           INC       DPTR
   \   00015A   F0           MOVX      @DPTR,A
   \   00015B   7409         MOV       A,#0x9
   \   00015D   12....       LCALL     ?XSTACK_DISP0_8
   \   000160   7408         MOV       A,#0x8
   \   000162   F0           MOVX      @DPTR,A
   \   000163   90....       MOV       DPTR,#??transferId
   \   000166   12....       LCALL     ?Subroutine9 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   000169   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   00016C   75....       MOV       ?V0,#??transferId & 0xff
   \   00016F   75....       MOV       ?V1,#(??transferId >> 8) & 0xff
   \   000172   78..         MOV       R0,#?V0
   \   000174   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000177   740F         MOV       A,#0xf
   \   000179   12....       LCALL     ?XSTACK_DISP100_8
   \   00017C   88..         MOV       ?V0,R0
   \   00017E   89..         MOV       ?V1,R1
   \   000180   78..         MOV       R0,#?V0
   \   000182   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000185   75..03       MOV       ?V0,#0x3
   \   000188   75..00       MOV       ?V1,#0x0
   \   00018B   78..         MOV       R0,#?V0
   \   00018D   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000190   E4           CLR       A
   \   000191   F5..         MOV       ?V0,A
   \   000193   78..         MOV       R0,#?V0
   \   000195   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000198   7900         MOV       R1,#0x0
   \   00019A   7C..         MOV       R4,#ZEM_AppEp & 0xff
   \   00019C   7D..         MOV       R5,#(ZEM_AppEp >> 8) & 0xff
   \   00019E   7409         MOV       A,#0x9
   \   0001A0   12....       LCALL     ?XSTACK_DISP101_8
   \   0001A3   12....       LCALL     `??AF_DataRequest::?relay`; Banked call to: AF_DataRequest
   \   0001A6   7409         MOV       A,#0x9
   \   0001A8   12....       LCALL     ?DEALLOC_XSTACK8
    401              osal_start_timerEx(zclZEM_TaskID,
    402                                ZEM_P2P_EVT,
    403                                ZEM_P2P_PERIOD);
   \   0001AB                ; Setup parameters for call to function osal_start_timerEx
   \   0001AB   90....       MOV       DPTR,#__Constant_3e8
   \   0001AE   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   0001B1   7A00         MOV       R2,#0x0
   \   0001B3   7B02         MOV       R3,#0x2
   \   0001B5   90....       MOV       DPTR,#zclZEM_TaskID
   \   0001B8   E0           MOVX      A,@DPTR
   \   0001B9   F9           MOV       R1,A
   \   0001BA   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   0001BD   7404         MOV       A,#0x4
   \   0001BF   12....       LCALL     ?DEALLOC_XSTACK8
    404              return ( events ^ ZEM_P2P_EVT );
   \   0001C2   EE           MOV       A,R6
   \   0001C3   FA           MOV       R2,A
   \   0001C4   EF           MOV       A,R7
   \   0001C5   6402         XRL       A,#0x2
   \                     ??zclZEM_event_loop_2:
   \   0001C7   FB           MOV       R3,A
   \   0001C8   8004         SJMP      ??zclZEM_event_loop_11
    405            }
    406            #ifndef ZDO_COORDINATOR
    407              if ( events & ZEM_REJOIN_EVT )//如果事件类型为重新加入网络事件
    408              {
    409                  // 重新加入网络
    410                  
    411                  /* 重新加入网络 */
    412                  bdb_StartCommissioning(BDB_COMMISSIONING_MODE_NWK_STEERING |
    413                                              BDB_COMMISSIONING_MODE_FINDING_BINDING );
    414                return ( events ^ ZEM_REJOIN_EVT );
    415              }
    416            #endif
    417          
    418            // Discard unknown events
    419            return 0;
   \                     ??zclZEM_event_loop_13:
   \   0001CA   7A00         MOV       R2,#0x0
   \   0001CC   7B00         MOV       R3,#0x0
   \                     ??zclZEM_event_loop_11:
   \   0001CE   741A         MOV       A,#0x1a
   \   0001D0                REQUIRE ?Subroutine0
   \   0001D0                ; // Fall through to label ?Subroutine0
    420          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   12....       LCALL     ?DEALLOC_XSTACK8
   \   000003   7F04         MOV       R7,#0x4
   \   000005   02....       LJMP      ?BANKED_LEAVE_XDATA
    421          
    422          /*********************************************************************
    423           * @fn      zclZEM_InitUart
    424           *
    425           * @brief   Initialize UART for communication
    426           *
    427           * @param   none
    428           *
    429           * @return  none
    430           */
    431          static void zclZEM_InitUart(void)
    432          {
    433            // 统一使用协调器的UART引脚配置（P1.4/P1.5）
    434            /********** 1. 配置UART0的P1.4/P1.5和PERCFG寄存器 **********/
    435            // PERCFG的bit0(U0CFG)设置为1：UART0映射到Alternative 2位置(P1.4/P1.5)
    436            PERCFG |= (1 << 0);  // 配置PERCFG |= 0x01来设置相应的bit0
    437          
    438            /********** 2. 配置P1.4/P1.5为UART0功能和P1端口寄存器 **********/
    439            // P1SEL的bit4(P1.4)和bit5(P1.5)设置为1：配置为外设功能(UART)
    440            P1SEL |= (1 << 4) | (1 << 5);  // 配置P1SEL |= 0x30(00110000)
    441            // P1DIR的bit4(P1.4=TX)设置为1：输出；bit5(P1.5=RX)设置为0：输入
    442            P1DIR |= (1 << 4);   // P1.4(TX)作为输出
    443            P1DIR &= ~(1 << 5);  // P1.5(RX)作为输入
    444          
    445            halUARTCfg_t uartConfig;
    446            /* UART Configuration */
    447            uartConfig.configured          = TRUE;      // Enable configuration
    448            uartConfig.baudRate            = HAL_UART_BR_115200;  // Baud rate
    449            uartConfig.flowControl         = FALSE;     // Disable hardware flow control
    450            uartConfig.flowControlThreshold= 0;         // Flow control threshold
    451            uartConfig.rx.maxBufSize       = ZCLZEM_UART_BUF_LEN;  // Receive buffer size
    452            uartConfig.tx.maxBufSize       = 0;         // Transmit buffer size
    453            uartConfig.idleTimeout         = 6;         // Default timeout
    454            uartConfig.intEnable           = TRUE;      // Enable interrupt
    455            uartConfig.callBackFunc        = zclZEM_UartCB;  // Set callback function
    456            /* Start UART */
    457            // 统一使用UART0端口（协调器配置）
    458            HalUARTOpen(HAL_UART_PORT_0, &uartConfig);  // Open UART0 with configuration
    459          }
    460          
    461          
    462          void zclZEM_SendMACToCoordinator(void)
                      ^
Warning[Pe177]: function "zclZEM_SendMACToCoordinator" was declared but never
          referenced
    463          {
    464            uint8* macAddr;
    465            uint8 macData[10]; // MAC地址数据包：1字节类型标识 + 8字节MAC地址 + 1字节结束符
    466            
    467            // 读取MAC地址
    468            macAddr = NLME_GetExtAddr();
    469            
    470            // 构建数据包
    471            macData[0] = 0x01; // 类型标识：MAC地址数据
    472            osal_memcpy(&macData[1], macAddr, 8); // 复制MAC地址
    473            macData[9] = 0x00; // 结束符
    474            
    475            // 向协调器发送数据（协调器网络地址通常为0x0000）
    476            zclZEM_AF_P2P(0x0000, // 协调器网络地址
    477                          CLUSTER_P2P, // 使用点对点集群
    478                          10, // 数据长度
    479                          macData); // 数据内容
    480            
    481            // 同时通过串口显示发送信息
    482            uint8 sendMsg[] = "MAC address sent to coordinator!\r\n";
    483            HalUARTWrite(HAL_UART_PORT_0, sendMsg, sizeof(sendMsg)-1);
    484          }
    485          
    486          /*********************************************************************
    487           * @fn      zclZEM_ReadAndSendMAC
    488           *
    489           * @brief   Read MAC address and send it via UART
    490           *
    491           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    492          void zclZEM_ReadAndSendMAC(void)
   \                     zclZEM_ReadAndSendMAC:
    493          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000   74F4         MOV       A,#-0xc
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 56
   \   000005   74C8         MOV       A,#-0x38
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
    494            uint8* macAddr;
    495            uint8 macStr[50]; // 足够存储MAC地址字符串
    496            uint8 i, pos = 0;
    497            
    498            // Read MAC address from system
    499            macAddr = NLME_GetExtAddr();
   \   00000A                ; Setup parameters for call to function NLME_GetExtAddr
   \   00000A   12....       LCALL     `??NLME_GetExtAddr::?relay`; Banked call to: NLME_GetExtAddr
   \   00000D   8A..         MOV       ?V0,R2
   \   00000F   8B..         MOV       ?V1,R3
   \   000011   AE..         MOV       R6,?V0
   \   000013   AF..         MOV       R7,?V1
    500            
    501            // 手动构建MAC地址字符串
    502            const uint8 header[] = "MAC: ";
   \   000015   90....       MOV       DPTR,#`?<Constant "MAC: ">`
   \   000018   AC..         MOV       R4,?XSP + 0
   \   00001A   AD..         MOV       R5,?XSP + 1
   \   00001C   7406         MOV       A,#0x6
   \   00001E   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    503            osal_memcpy(macStr, header, 4);
   \   000021                ; Setup parameters for call to function osal_memcpy
   \   000021   A8..         MOV       R0,?XSP + 0
   \   000023   A9..         MOV       R1,?XSP + 1
   \   000025   88..         MOV       ?V0,R0
   \   000027   89..         MOV       ?V1,R1
   \   000029   F5..         MOV       ?V2,A
   \   00002B   78..         MOV       R0,#?V0
   \   00002D   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   000030   7C04         MOV       R4,#0x4
   \   000032   7D00         MOV       R5,#0x0
   \   000034   7409         MOV       A,#0x9
   \   000036   12....       LCALL     ?XSTACK_DISP101_8
   \   000039   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   00003C   7403         MOV       A,#0x3
   \   00003E   12....       LCALL     ?DEALLOC_XSTACK8
    504            pos = 4;
   \   000041   7804         MOV       R0,#0x4
    505            
    506            // 添加MAC地址字节，格式化为十六进制
    507            for (i = 0; i < 8; i++) {
   \   000043   7C00         MOV       R4,#0x0
    508              // 转换高4位
    509              uint8 highNibble = (macAddr[i] >> 4) & 0x0F;
   \                     ??zclZEM_ReadAndSendMAC_0:
   \   000045   EC           MOV       A,R4
   \   000046   FA           MOV       R2,A
   \   000047   EE           MOV       A,R6
   \   000048   2A           ADD       A,R2
   \   000049   FA           MOV       R2,A
   \   00004A   E4           CLR       A
   \   00004B   3F           ADDC      A,R7
   \   00004C   FB           MOV       R3,A
   \   00004D   8A82         MOV       DPL,R2
   \   00004F   8B83         MOV       DPH,R3
   \   000051   E0           MOVX      A,@DPTR
   \   000052   C4           SWAP      A
   \   000053   540F         ANL       A,#0xf
   \   000055   F9           MOV       R1,A
    510              macStr[pos++] = (highNibble < 10) ? ('0' + highNibble) : ('A' + highNibble - 10);
   \   000056   88..         MOV       ?V0,R0
   \   000058   7401         MOV       A,#0x1
   \   00005A   28           ADD       A,R0
   \   00005B   F8           MOV       R0,A
   \   00005C   E9           MOV       A,R1
   \   00005D   C3           CLR       C
   \   00005E   940A         SUBB      A,#0xa
   \   000060   5004         JNC       ??zclZEM_ReadAndSendMAC_1
   \   000062   7430         MOV       A,#0x30
   \   000064   8002         SJMP      ??zclZEM_ReadAndSendMAC_2
   \                     ??zclZEM_ReadAndSendMAC_1:
   \   000066   7437         MOV       A,#0x37
   \                     ??zclZEM_ReadAndSendMAC_2:
   \   000068   29           ADD       A,R1
   \   000069   C0E0         PUSH      A
   \   00006B   E5..         MOV       A,?V0
   \   00006D   F5..         MOV       ?V2,A
   \   00006F   7406         MOV       A,#0x6
   \   000071   12....       LCALL     ?XSTACK_DISP0_8
   \   000074   E582         MOV       A,DPL
   \   000076   25..         ADD       A,?V2
   \   000078   F582         MOV       DPL,A
   \   00007A   E4           CLR       A
   \   00007B   3583         ADDC      A,DPH
   \   00007D   F583         MOV       DPH,A
   \   00007F   D0E0         POP       A
   \   000081   F0           MOVX      @DPTR,A
    511              
    512              // 转换低4位
    513              uint8 lowNibble = macAddr[i] & 0x0F;
   \   000082   8A82         MOV       DPL,R2
   \   000084   8B83         MOV       DPH,R3
   \   000086   E0           MOVX      A,@DPTR
   \   000087   540F         ANL       A,#0xf
   \   000089   F9           MOV       R1,A
    514              macStr[pos++] = (lowNibble < 10) ? ('0' + lowNibble) : ('A' + lowNibble - 10);
   \   00008A   88..         MOV       ?V1,R0
   \   00008C   7401         MOV       A,#0x1
   \   00008E   28           ADD       A,R0
   \   00008F   F8           MOV       R0,A
   \   000090   E9           MOV       A,R1
   \   000091   C3           CLR       C
   \   000092   940A         SUBB      A,#0xa
   \   000094   5004         JNC       ??zclZEM_ReadAndSendMAC_3
   \   000096   7430         MOV       A,#0x30
   \   000098   8002         SJMP      ??zclZEM_ReadAndSendMAC_4
   \                     ??zclZEM_ReadAndSendMAC_3:
   \   00009A   7437         MOV       A,#0x37
   \                     ??zclZEM_ReadAndSendMAC_4:
   \   00009C   29           ADD       A,R1
   \   00009D   F9           MOV       R1,A
   \   00009E   AA..         MOV       R2,?V1
   \   0000A0   7406         MOV       A,#0x6
   \   0000A2   12....       LCALL     ?XSTACK_DISP0_8
   \   0000A5   12....       LCALL     ?Subroutine10 & 0xFFFF
   \                     ??CrossCallReturnLabel_9:
   \   0000A8   E9           MOV       A,R1
   \   0000A9   F0           MOVX      @DPTR,A
    515              
    516              // 添加冒号分隔符（最后一个字节后不加）
    517              if (i < 7) {
   \   0000AA   EC           MOV       A,R4
   \   0000AB   C3           CLR       C
   \   0000AC   9407         SUBB      A,#0x7
   \   0000AE   500C         JNC       ??zclZEM_ReadAndSendMAC_5
    518                macStr[pos++] = ':';
   \   0000B0   7406         MOV       A,#0x6
   \   0000B2   12....       LCALL     ?XSTACK_DISP0_8
   \   0000B5   12....       LCALL     ?Subroutine11 & 0xFFFF
    519              }
    520            }
   \                     ??CrossCallReturnLabel_11:
   \   0000B8   743A         MOV       A,#0x3a
   \   0000BA   F0           MOVX      @DPTR,A
   \   0000BB   08           INC       R0
   \                     ??zclZEM_ReadAndSendMAC_5:
   \   0000BC   0C           INC       R4
   \   0000BD   EC           MOV       A,R4
   \   0000BE   C3           CLR       C
   \   0000BF   9408         SUBB      A,#0x8
   \   0000C1   4082         JC        ??zclZEM_ReadAndSendMAC_0
    521            
    522            // 添加换行符
    523            macStr[pos++] = '\r';
   \   0000C3   E8           MOV       A,R0
   \   0000C4   FA           MOV       R2,A
   \   0000C5   7406         MOV       A,#0x6
   \   0000C7   12....       LCALL     ?XSTACK_DISP0_8
   \   0000CA   12....       LCALL     ?Subroutine10 & 0xFFFF
   \                     ??CrossCallReturnLabel_10:
   \   0000CD   740D         MOV       A,#0xd
   \   0000CF   F0           MOVX      @DPTR,A
   \   0000D0   08           INC       R0
    524            macStr[pos++] = '\n';
   \   0000D1   7406         MOV       A,#0x6
   \   0000D3   12....       LCALL     ?XSTACK_DISP0_8
   \   0000D6   12....       LCALL     ?Subroutine11 & 0xFFFF
   \                     ??CrossCallReturnLabel_12:
   \   0000D9   740A         MOV       A,#0xa
   \   0000DB   F0           MOVX      @DPTR,A
    525            
    526            // Send MAC address via UART
    527            // 统一使用UART0端口（协调器配置）
    528            HalUARTWrite(HAL_UART_PORT_0, macStr, pos);
   \   0000DC                ; Setup parameters for call to function HalUARTWrite
   \   0000DC   7401         MOV       A,#0x1
   \   0000DE   28           ADD       A,R0
   \   0000DF   FC           MOV       R4,A
   \   0000E0   7D00         MOV       R5,#0x0
   \   0000E2   7406         MOV       A,#0x6
   \   0000E4   12....       LCALL     ?XSTACK_DISP101_8
   \   0000E7   7900         MOV       R1,#0x0
   \   0000E9   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    529          }
   \   0000EC   7438         MOV       A,#0x38
   \   0000EE   02....       LJMP      ?Subroutine0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine11:
   \   000000   E582         MOV       A,DPL
   \   000002   28           ADD       A,R0
   \   000003   F582         MOV       DPL,A
   \   000005   E4           CLR       A
   \   000006   3583         ADDC      A,DPH
   \   000008   F583         MOV       DPH,A
   \   00000A   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine10:
   \   000000   E582         MOV       A,DPL
   \   000002   2A           ADD       A,R2
   \   000003   F582         MOV       DPL,A
   \   000005   E4           CLR       A
   \   000006   3583         ADDC      A,DPH
   \   000008   F583         MOV       DPH,A
   \   00000A   22           RET
    530          
    531          /*********************************************************************
    532           * @fn      zclZEM_UartCB
    533           *
    534           * @brief   UART callback function
    535           *
    536           * @param   port - UART port
    537           * @param   event - UART event
    538           *
    539           * @return  none
    540           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    541          static void zclZEM_UartCB(uint8 port, uint8 event)
   \                     zclZEM_UartCB:
    542          {
   \   000000   74F7         MOV       A,#-0x9
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    543            // 获取当前串口接收缓冲区有多少字节的数据
    544            uint8 rxLen = Hal_UART_RxBufLen(HAL_UART_PORT_0); 
   \   000005                ; Setup parameters for call to function Hal_UART_RxBufLen
   \   000005   7900         MOV       R1,#0x0
   \   000007   12....       LCALL     `??Hal_UART_RxBufLen::?relay`; Banked call to: Hal_UART_RxBufLen
   \   00000A   EA           MOV       A,R2
    545            if(rxLen != 0) // 如果字节数数量不等于0 
   \   00000B   601A         JZ        ??zclZEM_UartCB_0
    546            {
    547              // 从串口缓冲区中读取数据
    548              HalUARTRead(HAL_UART_PORT_0, zclZEM_UartBuf, rxLen);
   \   00000D   FE           MOV       R6,A
   \   00000E                ; Setup parameters for call to function HalUARTRead
   \   00000E   FC           MOV       R4,A
   \   00000F   7D00         MOV       R5,#0x0
   \   000011   7A..         MOV       R2,#zclZEM_UartBuf & 0xff
   \   000013   7B..         MOV       R3,#(zclZEM_UartBuf >> 8) & 0xff
   \   000015   7900         MOV       R1,#0x0
   \   000017   12....       LCALL     `??HalUARTRead::?relay`; Banked call to: HalUARTRead
    549              // 通过串口发送数据，例如把数据发送到串口助手
    550              HalUARTWrite(HAL_UART_PORT_0, zclZEM_UartBuf, rxLen);  
   \   00001A                ; Setup parameters for call to function HalUARTWrite
   \   00001A   EE           MOV       A,R6
   \   00001B   FC           MOV       R4,A
   \   00001C   7D00         MOV       R5,#0x0
   \   00001E   7A..         MOV       R2,#zclZEM_UartBuf & 0xff
   \   000020   7B..         MOV       R3,#(zclZEM_UartBuf >> 8) & 0xff
   \   000022   7900         MOV       R1,#0x0
   \   000024   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    551            }
    552          }
   \                     ??zclZEM_UartCB_0:
   \   000027                REQUIRE ?Subroutine1
   \   000027                ; // Fall through to label ?Subroutine1

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7F01         MOV       R7,#0x1
   \   000002   02....       LJMP      ?BANKED_LEAVE_XDATA
    553          
    554          /*********************************************************************
    555           * @fn      zclZEM_HandleKeys
    556           *
    557           * @brief   Handles all key events for this device.
    558           *
    559           * @param   shift - true if in shift/alt.
    560           * @param   keys - bit field for key events. Valid entries:
    561           *                 HAL_KEY_SW_5
    562           *                 HAL_KEY_SW_4
    563           *                 HAL_KEY_SW_3
    564           *                 HAL_KEY_SW_2
    565           *                 HAL_KEY_SW_1
    566           *
    567           * @return  none
    568           */
    569          static void zclZEM_HandleKeys( byte shift, byte keys )
    570          {
    571          }
    572          
    573          /*********************************************************************
    574           * @fn      zclZEM_LcdDisplayMainMode
    575           *
    576           * @brief   Called to display the main screen on the LCD.
    577           *
    578           * @param   none
    579           *
    580           * @return  none
    581           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    582          static void zclZEM_ProcessCommissioningStatus(bdbCommissioningModeMsg_t* bdbCommissioningModeMsg)
   \                     zclZEM_ProcessCommissioningStatus:
    583          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000   74F5         MOV       A,#-0xb
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 165
   \   000005   745B         MOV       A,#0x5b
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   \   00000A   EA           MOV       A,R2
   \   00000B   FE           MOV       R6,A
   \   00000C   EB           MOV       A,R3
   \   00000D   FF           MOV       R7,A
    584              switch(bdbCommissioningModeMsg->bdbCommissioningMode)
   \   00000E   8E82         MOV       DPL,R6
   \   000010   8F83         MOV       DPH,R7
   \   000012   A3           INC       DPTR
   \   000013   E0           MOVX      A,@DPTR
   \   000014   14           DEC       A
   \   000015   7003         JNZ       $+5
   \   000017   02....       LJMP      ??zclZEM_ProcessCommissioningStatus_0 & 0xFFFF
   \   00001A   14           DEC       A
   \   00001B   6003         JZ        $+5
   \   00001D   02....       LJMP      ??zclZEM_ProcessCommissioningStatus_1 & 0xFFFF
    585              {
    586                case BDB_COMMISSIONING_FORMATION:
    587                  if(bdbCommissioningModeMsg->bdbCommissioningStatus == BDB_COMMISSIONING_SUCCESS)
   \   000020   8E82         MOV       DPL,R6
   \   000022   8F83         MOV       DPH,R7
   \   000024   E0           MOVX      A,@DPTR
   \   000025   701E         JNZ       ??zclZEM_ProcessCommissioningStatus_2
    588                  {
    589                    //After formation, perform nwk steering again plus the remaining commissioning modes that has not been process yet
    590                    bdb_StartCommissioning(BDB_COMMISSIONING_MODE_NWK_STEERING | bdbCommissioningModeMsg->bdbRemainingCommissioningModes);
   \   000027                ; Setup parameters for call to function bdb_StartCommissioning
   \   000027   A3           INC       DPTR
   \   000028   A3           INC       DPTR
   \   000029   E0           MOVX      A,@DPTR
   \   00002A   4402         ORL       A,#0x2
   \   00002C   F9           MOV       R1,A
   \   00002D   12....       LCALL     `??bdb_StartCommissioning::?relay`; Banked call to: bdb_StartCommissioning
    591                    // 网络形成成功
    592                    #ifdef ZDO_COORDINATOR
    593                    uint8 successMsg[] = "Network formation successful!\r\n";
   \   000030   90....       MOV       DPTR,#`?<Constant "Network formation suc...">`
   \   000033   7485         MOV       A,#-0x7b
   \   000035   12....       LCALL     ?XSTACK_DISP102_8
   \   000038   7420         MOV       A,#0x20
   \   00003A   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    594                    HalUARTWrite(HAL_UART_PORT_0, successMsg, sizeof(successMsg)-1);
   \   00003D                ; Setup parameters for call to function HalUARTWrite
   \   00003D   7C1F         MOV       R4,#0x1f
   \   00003F   FD           MOV       R5,A
   \   000040   7485         MOV       A,#-0x7b
   \   000042   02....       LJMP      ??zclZEM_ProcessCommissioningStatus_3 & 0xFFFF
    595                    #endif
    596                  }
    597                  else
    598                  {
    599                    //Want to try other channels?
    600                    //try with bdb_setChannelAttribute
    601                    // 网络形成失败
    602                    #ifdef ZDO_COORDINATOR
    603                    uint8 failMsg[] = "Network formation failed! Retrying...\r\n";
   \                     ??zclZEM_ProcessCommissioningStatus_2:
   \   000045   90....       MOV       DPTR,#`?<Constant "Network formation fai...">`
   \   000048   745D         MOV       A,#0x5d
   \   00004A   12....       LCALL     ?XSTACK_DISP102_8
   \   00004D   7428         MOV       A,#0x28
   \   00004F   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    604                    HalUARTWrite(HAL_UART_PORT_0, failMsg, sizeof(failMsg)-1);
   \   000052                ; Setup parameters for call to function HalUARTWrite
   \   000052   7C27         MOV       R4,#0x27
   \   000054   FD           MOV       R5,A
   \   000055   745D         MOV       A,#0x5d
   \   000057   12....       LCALL     ?XSTACK_DISP101_8
   \   00005A   7900         MOV       R1,#0x0
   \   00005C   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    605                    
    606                    // 打印具体的失败原因
    607                    uint8 statusMsg[64];
    608                    osal_memcpy(statusMsg, "Failure reason: ", 15);
   \   00005F                ; Setup parameters for call to function osal_memcpy
   \   00005F   75....       MOV       ?V0,#`?<Constant "Failure reason: ">` & 0xff
   \   000062   75....       MOV       ?V1,#(`?<Constant "Failure reason: ">` >> 8) & 0xff
   \   000065   75..00       MOV       ?V2,#0x0
   \   000068   78..         MOV       R0,#?V0
   \   00006A   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   00006D   7C0F         MOV       R4,#0xf
   \   00006F   7D00         MOV       R5,#0x0
   \   000071   7403         MOV       A,#0x3
   \   000073   12....       LCALL     ?XSTACK_DISP101_8
   \   000076   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   000079   7403         MOV       A,#0x3
   \   00007B   12....       LCALL     ?DEALLOC_XSTACK8
    609                    
    610                    switch(bdbCommissioningModeMsg->bdbCommissioningStatus) {
   \   00007E   8E82         MOV       DPL,R6
   \   000080   8F83         MOV       DPH,R7
   \   000082   E0           MOVX      A,@DPTR
   \   000083   24FE         ADD       A,#-0x2
   \   000085   600D         JZ        ??zclZEM_ProcessCommissioningStatus_4
   \   000087   24FB         ADD       A,#-0x5
   \   000089   6027         JZ        ??zclZEM_ProcessCommissioningStatus_5
   \   00008B   14           DEC       A
   \   00008C   6015         JZ        ??zclZEM_ProcessCommissioningStatus_6
   \   00008E   24FA         ADD       A,#-0x6
   \   000090   602F         JZ        ??zclZEM_ProcessCommissioningStatus_7
   \   000092   803C         SJMP      ??zclZEM_ProcessCommissioningStatus_8
    611                      case BDB_COMMISSIONING_NO_NETWORK:
    612                        osal_memcpy(&statusMsg[15], "No network found", 15);
   \                     ??zclZEM_ProcessCommissioningStatus_4:
   \   000094                ; Setup parameters for call to function osal_memcpy
   \   000094   75....       MOV       ?V0,#`?<Constant "No network found">` & 0xff
   \   000097   75....       MOV       ?V1,#(`?<Constant "No network found">` >> 8) & 0xff
   \   00009A   78..         MOV       R0,#?V0
   \   00009C   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   00009F   7C0F         MOV       R4,#0xf
   \   0000A1   803A         SJMP      ??zclZEM_ProcessCommissioningStatus_9
    613                        break;
    614                      case BDB_COMMISSIONING_FORMATION_FAILURE:
    615                        osal_memcpy(&statusMsg[15], "Formation failure", 17);
   \                     ??zclZEM_ProcessCommissioningStatus_6:
   \   0000A3                ; Setup parameters for call to function osal_memcpy
   \   0000A3   75....       MOV       ?V0,#`?<Constant "Formation failure">` & 0xff
   \   0000A6   75....       MOV       ?V1,#(`?<Constant "Formation failure">` >> 8) & 0xff
   \   0000A9   78..         MOV       R0,#?V0
   \   0000AB   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   0000AE   7C11         MOV       R4,#0x11
   \   0000B0   802B         SJMP      ??zclZEM_ProcessCommissioningStatus_9
    616                        break;
    617                      case BDB_COMMISSIONING_TCLK_EX_FAILURE:
    618                        osal_memcpy(&statusMsg[15], "TCLK exchange failure", 20);
   \                     ??zclZEM_ProcessCommissioningStatus_5:
   \   0000B2                ; Setup parameters for call to function osal_memcpy
   \   0000B2   75....       MOV       ?V0,#`?<Constant "TCLK exchange failure">` & 0xff
   \   0000B5   75....       MOV       ?V1,#(`?<Constant "TCLK exchange failure">` >> 8) & 0xff
   \   0000B8   78..         MOV       R0,#?V0
   \   0000BA   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   0000BD   7C14         MOV       R4,#0x14
   \   0000BF   801C         SJMP      ??zclZEM_ProcessCommissioningStatus_9
    619                        break;
    620                      case BDB_COMMISSIONING_FAILURE:
    621                        osal_memcpy(&statusMsg[15], "General failure", 14);
   \                     ??zclZEM_ProcessCommissioningStatus_7:
   \   0000C1                ; Setup parameters for call to function osal_memcpy
   \   0000C1   75....       MOV       ?V0,#`?<Constant "General failure">` & 0xff
   \   0000C4   75....       MOV       ?V1,#(`?<Constant "General failure">` >> 8) & 0xff
   \   0000C7   78..         MOV       R0,#?V0
   \   0000C9   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   0000CC   7C0E         MOV       R4,#0xe
   \   0000CE   800D         SJMP      ??zclZEM_ProcessCommissioningStatus_9
    622                        break;
    623                      default:
    624                        osal_memcpy(&statusMsg[15], "Unknown error", 13);
   \                     ??zclZEM_ProcessCommissioningStatus_8:
   \   0000D0                ; Setup parameters for call to function osal_memcpy
   \   0000D0   75....       MOV       ?V0,#`?<Constant "Unknown error">` & 0xff
   \   0000D3   75....       MOV       ?V1,#(`?<Constant "Unknown error">` >> 8) & 0xff
   \   0000D6   78..         MOV       R0,#?V0
   \   0000D8   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   0000DB   7C0D         MOV       R4,#0xd
   \                     ??zclZEM_ProcessCommissioningStatus_9:
   \   0000DD   7D00         MOV       R5,#0x0
   \   0000DF   7412         MOV       A,#0x12
   \   0000E1   12....       LCALL     ?XSTACK_DISP0_8
   \   0000E4   AA82         MOV       R2,DPL
   \   0000E6   AB83         MOV       R3,DPH
   \   0000E8   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   0000EB   7403         MOV       A,#0x3
   \   0000ED   12....       LCALL     ?DEALLOC_XSTACK8
    625                        break;
    626                    }
    627                    osal_memcpy(&statusMsg[30], "\r\n", 2);
   \   0000F0                ; Setup parameters for call to function osal_memcpy
   \   0000F0   75....       MOV       ?V0,#`?<Constant "\\r\\n">` & 0xff
   \   0000F3   75....       MOV       ?V1,#(`?<Constant "\\r\\n">` >> 8) & 0xff
   \   0000F6   78..         MOV       R0,#?V0
   \   0000F8   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   0000FB   7C02         MOV       R4,#0x2
   \   0000FD   7D00         MOV       R5,#0x0
   \   0000FF   7421         MOV       A,#0x21
   \   000101   12....       LCALL     ?XSTACK_DISP0_8
   \   000104   AA82         MOV       R2,DPL
   \   000106   AB83         MOV       R3,DPH
   \   000108   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   00010B   7403         MOV       A,#0x3
   \   00010D   12....       LCALL     ?DEALLOC_XSTACK8
    628                    HalUARTWrite(HAL_UART_PORT_0, statusMsg, 32);
   \   000110                ; Setup parameters for call to function HalUARTWrite
   \   000110   7C20         MOV       R4,#0x20
   \   000112   7D00         MOV       R5,#0x0
   \   000114   AA..         MOV       R2,?XSP + 0
   \   000116   AB..         MOV       R3,?XSP + 1
   \   000118   7900         MOV       R1,#0x0
   \   00011A   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    629                    
    630                    // 直接重新调用组网函数，不需要通过定时器
    631                    bdb_StartCommissioning(BDB_COMMISSIONING_MODE_NWK_FORMATION |
    632                                                BDB_COMMISSIONING_MODE_FINDING_BINDING );
   \   00011D                ; Setup parameters for call to function bdb_StartCommissioning
   \   00011D   790C         MOV       R1,#0xc
   \   00011F   12....       LCALL     `??bdb_StartCommissioning::?relay`; Banked call to: bdb_StartCommissioning
   \   000122   8021         SJMP      ??zclZEM_ProcessCommissioningStatus_1
    633                    #endif
    634                  }
    635                break;
    636                case BDB_COMMISSIONING_NWK_STEERING:
    637                  if(bdbCommissioningModeMsg->bdbCommissioningStatus == BDB_COMMISSIONING_SUCCESS)
   \                     ??zclZEM_ProcessCommissioningStatus_0:
   \   000124   8E82         MOV       DPL,R6
   \   000126   8F83         MOV       DPH,R7
   \   000128   E0           MOVX      A,@DPTR
   \   000129   701A         JNZ       ??zclZEM_ProcessCommissioningStatus_1
    638                  {
    639                    //YOUR JOB:
    640                    //We are on the nwk, what now?
    641                    // 网络引导成功
    642                    #ifdef ZDO_COORDINATOR
    643                    uint8 deviceJoinedMsg[] = "Device joined the network!\r\n";
   \   00012B   90....       MOV       DPTR,#`?<Constant "Device joined the net...">`
   \   00012E   7440         MOV       A,#0x40
   \   000130   12....       LCALL     ?XSTACK_DISP102_8
   \   000133   741D         MOV       A,#0x1d
   \   000135   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    644                    HalUARTWrite(HAL_UART_PORT_0, deviceJoinedMsg, sizeof(deviceJoinedMsg)-1);
   \   000138                ; Setup parameters for call to function HalUARTWrite
   \   000138   7C1C         MOV       R4,#0x1c
   \   00013A   FD           MOV       R5,A
   \   00013B   7440         MOV       A,#0x40
   \                     ??zclZEM_ProcessCommissioningStatus_3:
   \   00013D   12....       LCALL     ?XSTACK_DISP101_8
   \   000140   7900         MOV       R1,#0x0
   \   000142   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    645                    #endif
    646                  }
    647                  else
    648                  {
    649                    // 网络引导失败
    650                    #ifdef ZDO_COORDINATOR
    651                    /* 协调器 */
    652                    #else
    653                    /* 路由器或者终端 */
    654                    uint8 failMsg[] = "Network steering failed! Retrying in 1 second...\r\n";
    655                    HalUARTWrite(HAL_UART_PORT_0, failMsg, sizeof(failMsg)-1);
    656                    
    657                    /* 无限重试网络引导 */
    658                    osal_start_timerEx(zclZEM_TaskID, 
    659                                              ZEM_REJOIN_EVT, 
    660                                              ZEM_REJOIN_PERIOD);
    661                    #endif
    662                  }
    663                  break;
    664                case BDB_COMMISSIONING_FINDING_BINDING:
    665                  if(bdbCommissioningModeMsg->bdbCommissioningStatus == BDB_COMMISSIONING_SUCCESS)
    666                  {
    667                    //YOUR JOB:
    668                  }
    669                  else
    670                  {
    671                    //YOUR JOB:
    672                    //retry?, wait for user interaction?
    673                  }
    674                break;
    675                case BDB_COMMISSIONING_INITIALIZATION:
    676                  //Initialization notification can only be successful. Failure on initialization 
    677                  //only happens for ZED and is notified as BDB_COMMISSIONING_PARENT_LOST notification
    678                  
    679                  //YOUR JOB:
    680                  //We are on a network, what now?
    681                  
    682                break;
    683          #if ZG_BUILD_ENDDEVICE_TYPE    
    684              case BDB_COMMISSIONING_PARENT_LOST:
    685                if(bdbCommissioningModeMsg->bdbCommissioningStatus == BDB_COMMISSIONING_NETWORK_RESTORED)
    686                {
    687                  //We did recover from losing parent
    688                }
    689                else
    690                {
    691                  //Parent not found, attempt to rejoin again after a fixed delay
    692                  //osal_start_timerEx(zclZEM_TaskID, SAMPLEAPP_END_DEVICE_REJOIN_EVT, SAMPLEAPP_END_DEVICE_REJOIN_DELAY);
    693                  
    694                  /* 协调器 */
    695          #ifdef ZDO_COORDINATOR
    696                  /* 路由器或者终端 */
    697          #else
    698                /* 启动重新加入事件 */
    699                osal_start_timerEx(zclZEM_TaskID, 
    700                                  ZEM_REJOIN_EVT, 
    701                                  ZEM_REJOIN_PERIOD);
    702          #endif
    703                }
    704              break;
    705          #endif 
    706              }
    707          
    708          }
   \                     ??zclZEM_ProcessCommissioningStatus_1:
   \   000145   74A5         MOV       A,#-0x5b
   \   000147   12....       LCALL     ?DEALLOC_XSTACK8
   \   00014A   7F03         MOV       R7,#0x3
   \   00014C   02....       LJMP      ?BANKED_LEAVE_XDATA
    709          
    710          /*********************************************************************
    711           * @fn      zclZEM_BasicResetCB
    712           *
    713           * @brief   Callback from the ZCL General Cluster Library
    714           *          to set all the Basic Cluster attributes to default values.
    715           *
    716           * @param   none
    717           *
    718           * @return  none
    719           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    720          static void zclZEM_BasicResetCB( void )
   \                     zclZEM_BasicResetCB:
    721          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    722            zclZEM_ResetAttributesToDefaultValues();
   \   000004                ; Setup parameters for call to function zclZEM_ResetAttributesToDefaultValues
   \   000004   12....       LCALL     `??zclZEM_ResetAttributesToDefaultValues::?relay`; Banked call to: zclZEM_ResetAttributesToDefaultValues
    723            
    724          }
   \   000007                REQUIRE ?Subroutine2
   \   000007                ; // Fall through to label ?Subroutine2

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   D083         POP       DPH
   \   000002   D082         POP       DPL
   \   000004   02....       LJMP      ?BRET
    725          
    726          /*********************************************************************
    727           * @fn      zclSampleApp_BatteryWarningCB
    728           *
    729           * @brief   Called to handle battery-low situation.
    730           *
    731           * @param   voltLevel - level of severity
    732           *
    733           * @return  none
    734           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    735          void zclSampleApp_BatteryWarningCB( uint8 voltLevel )
   \                     zclSampleApp_BatteryWarningCB:
    736          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    737            if ( voltLevel == VOLT_LEVEL_CAUTIOUS )
    738            {
    739              // Send warning message to the gateway and blink LED
    740            }
    741            else if ( voltLevel == VOLT_LEVEL_BAD )
    742            {
    743              // Shut down the system
    744            }
    745          }
   \   000000   02....       LJMP      ?BRET
    746          
    747          /******************************************************************************
    748           *
    749           *  Functions for processing ZCL Foundation incoming Command/Response messages
    750           *
    751           *****************************************************************************/
    752          
    753          /*********************************************************************
    754           * @fn      zclZEM_ProcessIncomingMsg
    755           *
    756           * @brief   Process ZCL Foundation incoming message
    757           *
    758           * @param   pInMsg - pointer to the received message
    759           *
    760           * @return  none
    761           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    762          static void zclZEM_ProcessIncomingMsg( zclIncomingMsg_t *pInMsg)
   \                     zclZEM_ProcessIncomingMsg:
    763          {
   \   000000   74F7         MOV       A,#-0x9
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    764            switch ( pInMsg->zclHdr.commandID )
   \   000005   EA           MOV       A,R2
   \   000006   2417         ADD       A,#0x17
   \   000008   12....       LCALL     ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_13:
   \   00000B   A3           INC       DPTR
   \   00000C   A3           INC       DPTR
   \   00000D   A3           INC       DPTR
   \   00000E   E0           MOVX      A,@DPTR
   \   00000F   14           DEC       A
   \   000010   6016         JZ        ??zclZEM_ProcessIncomingMsg_0
   \   000012   24FD         ADD       A,#-0x3
   \   000014   601F         JZ        ??zclZEM_ProcessIncomingMsg_1
   \   000016   24F7         ADD       A,#-0x9
   \   000018   602D         JZ        ??zclZEM_ProcessIncomingMsg_2
   \   00001A   24FB         ADD       A,#-0x5
   \   00001C   6024         JZ        ??zclZEM_ProcessIncomingMsg_3
   \   00001E   24FE         ADD       A,#-0x2
   \   000020   6020         JZ        ??zclZEM_ProcessIncomingMsg_3
   \   000022   24FE         ADD       A,#-0x2
   \   000024   6033         JZ        ??zclZEM_ProcessIncomingMsg_4
   \   000026   8043         SJMP      ??zclZEM_ProcessIncomingMsg_5
    765            {
    766          #ifdef ZCL_READ
    767              case ZCL_CMD_READ_RSP:
    768                zclZEM_ProcessInReadRspCmd( pInMsg );
   \                     ??zclZEM_ProcessIncomingMsg_0:
   \   000028   12....       LCALL     ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   00002B   E0           MOVX      A,@DPTR
   \   00002C   F9           MOV       R1,A
   \   00002D   E8           MOV       A,R0
   \   00002E   C3           CLR       C
   \   00002F   99           SUBB      A,R1
   \   000030   5039         JNC       ??zclZEM_ProcessIncomingMsg_5
   \   000032   08           INC       R0
   \   000033   80F6         SJMP      ??CrossCallReturnLabel_5
    769                break;
    770          #endif
    771          #ifdef ZCL_WRITE
    772              case ZCL_CMD_WRITE_RSP:
    773                zclZEM_ProcessInWriteRspCmd( pInMsg );
   \                     ??zclZEM_ProcessIncomingMsg_1:
   \   000035   12....       LCALL     ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_6:
   \   000038   E0           MOVX      A,@DPTR
   \   000039   F9           MOV       R1,A
   \   00003A   E8           MOV       A,R0
   \   00003B   C3           CLR       C
   \   00003C   99           SUBB      A,R1
   \   00003D   502C         JNC       ??zclZEM_ProcessIncomingMsg_5
   \   00003F   08           INC       R0
   \   000040   80F6         SJMP      ??CrossCallReturnLabel_6
    774                break;
    775          #endif
    776          #ifdef ZCL_REPORT
    777              // See ZCL Test Applicaiton (zcl_testapp.c) for sample code on Attribute Reporting
    778              case ZCL_CMD_CONFIG_REPORT:
    779                //zclZEM_ProcessInConfigReportCmd( pInMsg );
    780                break;
    781                case ZCL_CMD_READ_REPORT_CFG:
    782                //zclZEM_ProcessInReadReportCfgCmd( pInMsg );
    783                break;
    784              case ZCL_CMD_CONFIG_REPORT_RSP:
    785                //zclZEM_ProcessInConfigReportRspCmd( pInMsg );
    786                break;
    787              case ZCL_CMD_READ_REPORT_CFG_RSP:
    788                //zclZEM_ProcessInReadReportCfgRspCmd( pInMsg );
    789                break;
    790          
    791              case ZCL_CMD_REPORT:
    792                //zclZEM_ProcessInReportCmd( pInMsg );
    793                break;
    794          #endif
    795              case ZCL_CMD_DEFAULT_RSP:
    796                zclZEM_ProcessInDefaultRspCmd( pInMsg );
    797                break;
    798          #ifdef ZCL_DISCOVER
    799              case ZCL_CMD_DISCOVER_CMDS_RECEIVED_RSP:
    800                zclZEM_ProcessInDiscCmdsRspCmd( pInMsg );
   \                     ??zclZEM_ProcessIncomingMsg_3:
   \   000042                ; Setup parameters for call to function zclZEM_ProcessInDiscCmdsRspCmd
    801                break;
    802          
    803              case ZCL_CMD_DISCOVER_CMDS_GEN_RSP:
    804                zclZEM_ProcessInDiscCmdsRspCmd( pInMsg );
   \   000042                ; Setup parameters for call to function zclZEM_ProcessInDiscCmdsRspCmd
   \   000042   12....       LCALL     `??zclZEM_ProcessInDiscCmdsRspCmd::?relay`; Banked call to: zclZEM_ProcessInDiscCmdsRspCmd
    805                break;
   \   000045   8024         SJMP      ??zclZEM_ProcessIncomingMsg_5
    806          
    807              case ZCL_CMD_DISCOVER_ATTRS_RSP:
    808                zclZEM_ProcessInDiscAttrsRspCmd( pInMsg );
   \                     ??zclZEM_ProcessIncomingMsg_2:
   \   000047   12....       LCALL     ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_18:
   \   00004A   8882         MOV       DPL,R0
   \   00004C   8983         MOV       DPH,R1
   \   00004E   A3           INC       DPTR
   \   00004F   E0           MOVX      A,@DPTR
   \   000050   FB           MOV       R3,A
   \   000051   EA           MOV       A,R2
   \   000052   C3           CLR       C
   \   000053   9B           SUBB      A,R3
   \   000054   5015         JNC       ??zclZEM_ProcessIncomingMsg_5
   \   000056   0A           INC       R2
   \   000057   80F1         SJMP      ??CrossCallReturnLabel_18
    809                break;
    810          
    811              case ZCL_CMD_DISCOVER_ATTRS_EXT_RSP:
    812                zclZEM_ProcessInDiscAttrsExtRspCmd( pInMsg );
   \                     ??zclZEM_ProcessIncomingMsg_4:
   \   000059   12....       LCALL     ?Subroutine8 & 0xFFFF
    813                break;
    814          #endif
    815              default:
    816                break;
    817            }
   \                     ??CrossCallReturnLabel_19:
   \   00005C   8001         SJMP      ??zclZEM_ProcessIncomingMsg_6
   \                     ??zclZEM_ProcessIncomingMsg_7:
   \   00005E   0A           INC       R2
   \                     ??zclZEM_ProcessIncomingMsg_6:
   \   00005F   8882         MOV       DPL,R0
   \   000061   8983         MOV       DPH,R1
   \   000063   A3           INC       DPTR
   \   000064   E0           MOVX      A,@DPTR
   \   000065   FB           MOV       R3,A
   \   000066   EA           MOV       A,R2
   \   000067   C3           CLR       C
   \   000068   9B           SUBB      A,R3
   \   000069   40F3         JC        ??zclZEM_ProcessIncomingMsg_7
    818          
    819            if ( pInMsg->attrCmd )
   \                     ??zclZEM_ProcessIncomingMsg_5:
   \   00006B   8E82         MOV       DPL,R6
   \   00006D   8F83         MOV       DPH,R7
   \   00006F   E0           MOVX      A,@DPTR
   \   000070   FA           MOV       R2,A
   \   000071   A3           INC       DPTR
   \   000072   E0           MOVX      A,@DPTR
   \   000073   FB           MOV       R3,A
   \   000074   EA           MOV       A,R2
   \   000075   4B           ORL       A,R3
   \   000076   6003         JZ        ??zclZEM_ProcessIncomingMsg_8
    820            {
    821              osal_mem_free( pInMsg->attrCmd );
   \   000078                ; Setup parameters for call to function osal_mem_free
   \   000078   12....       LCALL     `??osal_mem_free::?relay`; Banked call to: osal_mem_free
    822            }
    823          }
   \                     ??zclZEM_ProcessIncomingMsg_8:
   \   00007B   02....       LJMP      ?Subroutine1 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine8:
   \   000000   8E82         MOV       DPL,R6
   \   000002   8F83         MOV       DPH,R7
   \   000004                REQUIRE ??Subroutine15_0
   \   000004                ; // Fall through to label ??Subroutine15_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine15_0:
   \   000000   E0           MOVX      A,@DPTR
   \   000001   F8           MOV       R0,A
   \   000002   A3           INC       DPTR
   \   000003   E0           MOVX      A,@DPTR
   \   000004   F9           MOV       R1,A
   \   000005   7A00         MOV       R2,#0x0
   \   000007   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   8E82         MOV       DPL,R6
   \   000002   8F83         MOV       DPH,R7
   \   000004   E0           MOVX      A,@DPTR
   \   000005   F8           MOV       R0,A
   \   000006   A3           INC       DPTR
   \   000007   E0           MOVX      A,@DPTR
   \   000008   F9           MOV       R1,A
   \   000009   8882         MOV       DPL,R0
   \   00000B   8983         MOV       DPH,R1
   \   00000D   7800         MOV       R0,#0x0
   \   00000F   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine12:
   \   000000   F8           MOV       R0,A
   \   000001   E4           CLR       A
   \   000002   3B           ADDC      A,R3
   \   000003   F9           MOV       R1,A
   \   000004   E8           MOV       A,R0
   \   000005   FE           MOV       R6,A
   \   000006   E9           MOV       A,R1
   \   000007   FF           MOV       R7,A
   \   000008   8A82         MOV       DPL,R2
   \   00000A   8B83         MOV       DPH,R3
   \   00000C   A3           INC       DPTR
   \   00000D   A3           INC       DPTR
   \   00000E   A3           INC       DPTR
   \   00000F   A3           INC       DPTR
   \   000010   22           RET
    824          
    825          #ifdef ZCL_READ
    826          /*********************************************************************
    827           * @fn      zclZEM_ProcessInReadRspCmd
    828           *
    829           * @brief   Process the "Profile" Read Response Command
    830           *
    831           * @param   pInMsg - incoming message to process
    832           *
    833           * @return  none
    834           */
    835          static uint8 zclZEM_ProcessInReadRspCmd( zclIncomingMsg_t *pInMsg )
    836          {
    837            zclReadRspCmd_t *readRspCmd;
    838            uint8 i;
    839          
    840            readRspCmd = (zclReadRspCmd_t *)pInMsg->attrCmd;
    841            for ( i = 0; i < readRspCmd->numAttr; i++ )
    842            {
    843              // Notify the originator of the results of the original read attributes
    844              // attempt and, for each successfull request, the value of the requested
    845              // attribute
    846            }
    847          
    848            return ( TRUE );
    849          }
    850          #endif // ZCL_READ
    851          
    852          #ifdef ZCL_WRITE
    853          /*********************************************************************
    854           * @fn      zclZEM_ProcessInWriteRspCmd
    855           *
    856           * @brief   Process the "Profile" Write Response Command
    857           *
    858           * @param   pInMsg - incoming message to process
    859           *
    860           * @return  none
    861           */
    862          static uint8 zclZEM_ProcessInWriteRspCmd( zclIncomingMsg_t *pInMsg )
    863          {
    864            zclWriteRspCmd_t *writeRspCmd;
    865            uint8 i;
    866          
    867            writeRspCmd = (zclWriteRspCmd_t *)pInMsg->attrCmd;
    868            for ( i = 0; i < writeRspCmd->numAttr; i++ )
    869            {
    870              // Notify the device of the results of the its original write attributes
    871              // command.
    872            }
    873          
    874            return ( TRUE );
    875          }
    876          #endif // ZCL_WRITE
    877          
    878          /*********************************************************************
    879           * @fn      zclZEM_ProcessInDefaultRspCmd
    880           *
    881           * @brief   Process the "Profile" Default Response Command
    882           *
    883           * @param   pInMsg - incoming message to process
    884           *
    885           * @return  none
    886           */
    887          static uint8 zclZEM_ProcessInDefaultRspCmd( zclIncomingMsg_t *pInMsg )
    888          {
    889            // zclDefaultRspCmd_t *defaultRspCmd = (zclDefaultRspCmd_t *)pInMsg->attrCmd;
    890          
    891            // Device is notified of the Default Response command.
    892            (void)pInMsg;
    893          
    894            return ( TRUE );
    895          }
    896          
    897          #ifdef ZCL_DISCOVER
    898          /*********************************************************************
    899           * @fn      zclZEM_ProcessInDiscCmdsRspCmd
    900           *
    901           * @brief   Process the Discover Commands Response Command
    902           *
    903           * @param   pInMsg - incoming message to process
    904           *
    905           * @return  none
    906           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    907          static uint8 zclZEM_ProcessInDiscCmdsRspCmd( zclIncomingMsg_t *pInMsg )
   \                     zclZEM_ProcessInDiscCmdsRspCmd:
    908          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    909            zclDiscoverCmdsCmdRsp_t *discoverRspCmd;
    910            uint8 i;
    911          
    912            discoverRspCmd = (zclDiscoverCmdsCmdRsp_t *)pInMsg->attrCmd;
   \   000004   EA           MOV       A,R2
   \   000005   2417         ADD       A,#0x17
   \   000007   F582         MOV       DPL,A
   \   000009   E4           CLR       A
   \   00000A   3B           ADDC      A,R3
   \   00000B   F583         MOV       DPH,A
   \   00000D   12....       LCALL     ??Subroutine15_0 & 0xFFFF
    913            for ( i = 0; i < discoverRspCmd->numCmd; i++ )
   \                     ??CrossCallReturnLabel_17:
   \   000010   8001         SJMP      ??zclZEM_ProcessInDiscCmdsRspCmd_0
   \                     ??zclZEM_ProcessInDiscCmdsRspCmd_1:
   \   000012   0A           INC       R2
   \                     ??zclZEM_ProcessInDiscCmdsRspCmd_0:
   \   000013   8882         MOV       DPL,R0
   \   000015   8983         MOV       DPH,R1
   \   000017   A3           INC       DPTR
   \   000018   A3           INC       DPTR
   \   000019   E0           MOVX      A,@DPTR
   \   00001A   FB           MOV       R3,A
   \   00001B   EA           MOV       A,R2
   \   00001C   C3           CLR       C
   \   00001D   9B           SUBB      A,R3
   \   00001E   40F2         JC        ??zclZEM_ProcessInDiscCmdsRspCmd_1
    914            {
    915              // Device is notified of the result of its attribute discovery command.
    916            }
    917          
    918            return ( TRUE );
   \   000020   7901         MOV       R1,#0x1
   \   000022   02....       LJMP      ?Subroutine2 & 0xFFFF
    919          }
    920          
    921          /*********************************************************************
    922           * @fn      zclZEM_ProcessInDiscAttrsRspCmd
    923           *
    924           * @brief   Process the "Profile" Discover Attributes Response Command
    925           *
    926           * @param   pInMsg - incoming message to process
    927           *
    928           * @return  none
    929           */
    930          static uint8 zclZEM_ProcessInDiscAttrsRspCmd( zclIncomingMsg_t *pInMsg )
    931          {
    932            zclDiscoverAttrsRspCmd_t *discoverRspCmd;
    933            uint8 i;
    934          
    935            discoverRspCmd = (zclDiscoverAttrsRspCmd_t *)pInMsg->attrCmd;
    936            for ( i = 0; i < discoverRspCmd->numAttr; i++ )
    937            {
    938              // Device is notified of the result of its attribute discovery command.
    939            }
    940          
    941            return ( TRUE );
    942          }
    943          
    944          /*********************************************************************
    945           * @fn      zclZEM_ProcessInDiscAttrsExtRspCmd
    946           *
    947           * @brief   Process the "Profile" Discover Attributes Extended Response Command
    948           *
    949           * @param   pInMsg - incoming message to process
    950           *
    951           * @return  none
    952           */
    953          static uint8 zclZEM_ProcessInDiscAttrsExtRspCmd( zclIncomingMsg_t *pInMsg )
    954          {
    955            zclDiscoverAttrsExtRsp_t *discoverRspCmd;
    956            uint8 i;
    957          
    958            discoverRspCmd = (zclDiscoverAttrsExtRsp_t *)pInMsg->attrCmd;
    959            for ( i = 0; i < discoverRspCmd->numAttr; i++ )
    960            {
    961              // Device is notified of the result of its attribute discovery command.
    962            }
    963          
    964            return ( TRUE );
    965          }
    966          #endif // ZCL_DISCOVER
    967          
    968          
    969          
    970          
    971          /*********************************************************************
    972           * @fn      zclZEM_AF_P2P
    973           *
    974           * @brief   点对点发送函数
    975           *
    976           * @param   destNwkAddr - 目标设备的网络地址
    977           * @param   cid - Cluster ID，后续课程将会详细讲解
    978           * @param   len - 数据长度
    979           * @param   data - 数据内容
    980           *
    981           * @return  none
    982           */
    983          static void zclZEM_AF_P2P(
    984              uint16 destNwkAddr,
    985              uint16 cid,
    986              uint8 len,
    987              uint8 *data)
    988          {
    989              afAddrType_t dstAddr; //寻址信息配置

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    990              static uint8 transferId = 0;//传输ID，是数据包的标识符
   \                     ??transferId:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    991              
    992              /* Destination */
    993              dstAddr.addrMode = afAddr16Bit;// 设置目标地址模式为16位网络地址，表示使用P2P的通信方式
    994              dstAddr.addr.shortAddr = destNwkAddr;//目标设备的网络地址
    995              dstAddr.endPoint = ZEM_ENDPOINT;//目标设备的端点号
    996              
    997              transferId++;
    998              
    999              AF_DataRequest(&dstAddr,
   1000                  &ZEM_AppEp,//应用程序端点描述符
   1001                  cid,
   1002                  len,
   1003                  data,
   1004                  &transferId,
   1005                  AF_DISCV_ROUTE,//进行路由扫描操作，用于建立发送数据报文的通信路径。关于这个参数，暂时保持例程默认的代码就可以了
   1006                  AF_DEFAULT_RADIUS);//指定最大的路由跳转级数
   1007          }
   1008          
   1009          /*********************************************************************
   1010           * @fn      zclZEM_AF_Broadcast
   1011           *
   1012           * @brief   广播发送函数
   1013           *
   1014           * @param   cid - Cluster ID
   1015           * @param   len - 待发送数据的长度
   1016           * @param   data - 待发送数据的内容
   1017           *
   1018           * @return  none
   1019           */
   1020          static void zclZEM_AF_Broadcast(
   1021              uint16 cid,
   1022              uint8 len,
   1023              uint8 *data)
   1024          {
   1025              afAddrType_t dstAddr;

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
   1026              static uint8 transferId = 0;
   1027              
   1028              /* Destination */
   1029              dstAddr.addrMode = afAddrBroadcast;   // 使用广播模式
   1030              dstAddr.addr.shortAddr = 0xFFFF; // 广播地址
   1031              dstAddr.endPoint = ZEM_ENDPOINT; // 目标设备的端点号
   1032              
   1033              /* Transfer id */
   1034              transferId++;
   1035              
   1036              /* Send */
   1037              AF_DataRequest(&dstAddr,
   1038                  &ZEM_AppEp,//应用程序端点描述符
   1039                  cid,
   1040                  len,
   1041                  data,
   1042                  &transferId,
   1043                  AF_TX_OPTIONS_NONE,
   1044                  AF_DEFAULT_RADIUS );//指定了最大的路由跳转级数
   1045          }
   1046          
   1047          /*********************************************************************
   1048           * @fn      zclZEM_AF_Groupcast
   1049           *
   1050           * @brief   组播发送函数
   1051           *
   1052           * @param   groupId - 组ID
   1053           * @param   cid - ClusterID，后续章节将会详细讲解
   1054           * @param   len - 待发送数据的长度
   1055           * @param   data - 待发送数据的内容
   1056           *
   1057           * @return  none
   1058           */
   1059          static void zclZEM_AF_Groupcast(
   1060              uint16 groupId,
   1061              uint16 cid,
   1062              uint8 len,
   1063              uint8 *data)
   1064          {
   1065              afAddrType_t dstAddr;

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   1066              static uint8 transferId = 0;
   \                     ??transferId_2:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
   1067              
   1068              /* Destination */
   1069              dstAddr.addrMode = afAddrGroup;//使用组播通信模式
   1070              dstAddr.addr.shortAddr = groupId;
   1071              dstAddr.endPoint = ZEM_ENDPOINT;//组中的设备的端点号
   1072              
   1073              /* Transfer id */
   1074              transferId++;
   1075              
   1076              /* Send */
   1077              AF_DataRequest(&dstAddr,
   1078                  &ZEM_AppEp,//应用程序端点描述符
   1079                  cid,
   1080                  len,
   1081                  data,
   1082                  &transferId,
   1083                  AF_TX_OPTIONS_NONE,
   1084                  AF_DEFAULT_RADIUS );//指定最大的路由跳转级数，暂时可忽略
   1085          }
   1086          
   1087          /*********************************************************************
   1088           * @fn      zclZEM_AF_RxProc
   1089           *
   1090           * @brief   接收数据处理函数
   1091           *
   1092           * @param   MSGpkt - 接收到数据
   1093           *
   1094           * @return  none
   1095           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1096          static void zclZEM_AF_RxProc(afIncomingMSGPacket_t *MSGpkt)
   \                     zclZEM_AF_RxProc:
   1097          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000                REQUIRE ?V4
   \   000000                REQUIRE ?V5
   \   000000                REQUIRE ?V6
   \   000000                REQUIRE ?V8
   \   000000                REQUIRE ?V9
   \   000000                REQUIRE ?V10
   \   000000   74ED         MOV       A,#-0x13
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 19
   \   000005                ; Auto size: 64
   \   000005   74C0         MOV       A,#-0x40
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   1098              /*计数器，记录接收到的点对点通信数据包个数*/
   1099              static uint8 p2pCnt = 0;
   1100              /*计数器，记录接收到的广播通信数据包个数*/
   1101              static uint8 bcCnt = 0;
   1102              /*计数器，记录接收到的组播通信数据包个数*/
   1103              static uint8 gcCnt = 0;
   1104              
   1105              switch( MSGpkt->clusterId )  // 判断接收到的数据包的Cluster ID
   \   00000A   75....       MOV       ?V4,#`?<Constant " Count: ">` & 0xff
   \   00000D   75....       MOV       ?V5,#(`?<Constant " Count: ">` >> 8) & 0xff
   \   000010   75..00       MOV       ?V6,#0x0
   \   000013   EA           MOV       A,R2
   \   000014   2422         ADD       A,#0x22
   \   000016   F5..         MOV       ?V0,A
   \   000018   E4           CLR       A
   \   000019   3B           ADDC      A,R3
   \   00001A   F5..         MOV       ?V1,A
   \   00001C   EA           MOV       A,R2
   \   00001D   2420         ADD       A,#0x20
   \   00001F   12....       LCALL     ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_14:
   \   000022   E0           MOVX      A,@DPTR
   \   000023   F5..         MOV       ?V2,A
   \   000025   A3           INC       DPTR
   \   000026   E0           MOVX      A,@DPTR
   \   000027   F5..         MOV       ?V3,A
   \   000029   78..         MOV       R0,#?V2
   \   00002B   12....       LCALL     ?US_SWITCH_DENSE
   \                     `?<Jumptable for zclZEM_AF_RxProc>_0`:
   \   00002E   0000         DW        0
   \   000030   02           DB        2
   \   000031   ....         DW        ??zclZEM_AF_RxProc_0
   \   000033   ....         DW        ??zclZEM_AF_RxProc_1
   \   000035   ....         DW        ??zclZEM_AF_RxProc_2
   \   000037   ....         DW        ??zclZEM_AF_RxProc_3
   1106              {
   1107                  case CLUSTER_P2P:
   1108                      p2pCnt++;  // 接收到P2P数据包，进行计数
   \                     ??zclZEM_AF_RxProc_1:
   \   000039   90....       MOV       DPTR,#??p2pCnt
   \   00003C   E0           MOVX      A,@DPTR
   \   00003D   04           INC       A
   \   00003E   F0           MOVX      @DPTR,A
   1109                      // 通过串口输出接收到的数据和计数器值
   1110                      {
   1111                          uint8 p2pMsg[64];
   1112                          osal_memcpy(p2pMsg, "P2P Data: ", 10);
   \   00003F                ; Setup parameters for call to function osal_memcpy
   \   00003F   75....       MOV       ?V8,#`?<Constant "P2P Data: ">` & 0xff
   \   000042   75....       MOV       ?V9,#(`?<Constant "P2P Data: ">` >> 8) & 0xff
   \   000045   75..00       MOV       ?V10,#0x0
   \   000048   78..         MOV       R0,#?V8
   \   00004A   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   00004D   7C0A         MOV       R4,#0xa
   \   00004F   7D00         MOV       R5,#0x0
   \   000051   7403         MOV       A,#0x3
   \   000053   12....       LCALL     ?XSTACK_DISP101_8
   \   000056   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   000059   7403         MOV       A,#0x3
   \   00005B   12....       LCALL     ?DEALLOC_XSTACK8
   1113                          osal_memcpy(p2pMsg + 10, MSGpkt->cmd.Data, MSGpkt->cmd.DataLength);
   \   00005E                ; Setup parameters for call to function osal_memcpy
   \   00005E   12....       LCALL     ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_0:
   \   000061   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   000064   8E82         MOV       DPL,R6
   \   000066   8F83         MOV       DPH,R7
   \   000068   E0           MOVX      A,@DPTR
   \   000069   FC           MOV       R4,A
   \   00006A   A3           INC       DPTR
   \   00006B   E0           MOVX      A,@DPTR
   \   00006C   FD           MOV       R5,A
   \   00006D   740D         MOV       A,#0xd
   \   00006F   12....       LCALL     ?XSTACK_DISP0_8
   \   000072   AA82         MOV       R2,DPL
   \   000074   AB83         MOV       R3,DPH
   \   000076   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   000079   7403         MOV       A,#0x3
   \   00007B   12....       LCALL     ?DEALLOC_XSTACK8
   1114                          osal_memcpy(p2pMsg + 10 + MSGpkt->cmd.DataLength, " Count: ", 8);
   \   00007E                ; Setup parameters for call to function osal_memcpy
   \   00007E   78..         MOV       R0,#?V4
   \   000080   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   000083   7C08         MOV       R4,#0x8
   \   000085   7D00         MOV       R5,#0x0
   \   000087   8E82         MOV       DPL,R6
   \   000089   8F83         MOV       DPH,R7
   \   00008B   7403         MOV       A,#0x3
   \   00008D   12....       LCALL     ?XSTACK_DISP100_8
   \   000090   89..         MOV       ?V1,R1
   \   000092   12....       LCALL     ??Subroutine16_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_20:
   \   000095   240A         ADD       A,#0xa
   \   000097   FA           MOV       R2,A
   \   000098   E4           CLR       A
   \   000099   39           ADDC      A,R1
   \   00009A   FB           MOV       R3,A
   \   00009B   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   00009E   7403         MOV       A,#0x3
   \   0000A0   12....       LCALL     ?DEALLOC_XSTACK8
   1115                          p2pMsg[18 + MSGpkt->cmd.DataLength] = '0' + p2pCnt;
   \   0000A3   90....       MOV       DPTR,#??p2pCnt
   \   0000A6   E0           MOVX      A,@DPTR
   \   0000A7   2430         ADD       A,#0x30
   \   0000A9   C0E0         PUSH      A
   \   0000AB   12....       LCALL     ?Subroutine6 & 0xFFFF
   1116                          p2pMsg[19 + MSGpkt->cmd.DataLength] = '\r';
   1117                          p2pMsg[20 + MSGpkt->cmd.DataLength] = '\n';
   1118                          HalUARTWrite(HAL_UART_PORT_0, p2pMsg, 21 + MSGpkt->cmd.DataLength);
   1119                      }
   \                     ??CrossCallReturnLabel_21:
   \   0000AE   2412         ADD       A,#0x12
   \   0000B0   F582         MOV       DPL,A
   \   0000B2   E4           CLR       A
   \   0000B3   39           ADDC      A,R1
   \   0000B4   F583         MOV       DPH,A
   \   0000B6   D0E0         POP       A
   \   0000B8   12....       LCALL     ??Subroutine17_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_27:
   \   0000BB   2413         ADD       A,#0x13
   \   0000BD   12....       LCALL     ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_25:
   \   0000C0   2414         ADD       A,#0x14
   \   0000C2   12....       LCALL     ?Subroutine13 & 0xFFFF
   \                     ??CrossCallReturnLabel_15:
   \   0000C5   2415         ADD       A,#0x15
   \   0000C7   02....       LJMP      ??zclZEM_AF_RxProc_4 & 0xFFFF
   1120                      break;
   1121                  case CLUSTER_BROADCAST:
   1122                      bcCnt++;  // 接收到广播数据包，进行计数
   \                     ??zclZEM_AF_RxProc_2:
   \   0000CA   90....       MOV       DPTR,#??bcCnt
   \   0000CD   E0           MOVX      A,@DPTR
   \   0000CE   04           INC       A
   \   0000CF   F0           MOVX      @DPTR,A
   1123                      // 通过串口输出接收到的数据和计数器值
   1124                      {
   1125                          uint8 bcMsg[64];
   1126                          osal_memcpy(bcMsg, "Broadcast Data: ", 16);
   \   0000D0                ; Setup parameters for call to function osal_memcpy
   \   0000D0   75....       MOV       ?V8,#`?<Constant "Broadcast Data: ">` & 0xff
   \   0000D3   75....       MOV       ?V9,#(`?<Constant "Broadcast Data: ">` >> 8) & 0xff
   \   0000D6   75..00       MOV       ?V10,#0x0
   \   0000D9   78..         MOV       R0,#?V8
   \   0000DB   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   0000DE   7C10         MOV       R4,#0x10
   \   0000E0   7D00         MOV       R5,#0x0
   \   0000E2   7403         MOV       A,#0x3
   \   0000E4   12....       LCALL     ?XSTACK_DISP101_8
   \   0000E7   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   0000EA   7403         MOV       A,#0x3
   \   0000EC   12....       LCALL     ?DEALLOC_XSTACK8
   1127                          osal_memcpy(bcMsg + 16, MSGpkt->cmd.Data, MSGpkt->cmd.DataLength);
   \   0000EF                ; Setup parameters for call to function osal_memcpy
   \   0000EF   12....       LCALL     ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   0000F2   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   0000F5   8E82         MOV       DPL,R6
   \   0000F7   8F83         MOV       DPH,R7
   \   0000F9   E0           MOVX      A,@DPTR
   \   0000FA   FC           MOV       R4,A
   \   0000FB   A3           INC       DPTR
   \   0000FC   E0           MOVX      A,@DPTR
   \   0000FD   FD           MOV       R5,A
   \   0000FE   7413         MOV       A,#0x13
   \   000100   12....       LCALL     ?XSTACK_DISP0_8
   \   000103   AA82         MOV       R2,DPL
   \   000105   AB83         MOV       R3,DPH
   \   000107   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   00010A   7403         MOV       A,#0x3
   \   00010C   12....       LCALL     ?DEALLOC_XSTACK8
   1128                          osal_memcpy(bcMsg + 16 + MSGpkt->cmd.DataLength, " Count: ", 8);
   \   00010F                ; Setup parameters for call to function osal_memcpy
   \   00010F   78..         MOV       R0,#?V4
   \   000111   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   000114   7C08         MOV       R4,#0x8
   \   000116   7D00         MOV       R5,#0x0
   \   000118   8E82         MOV       DPL,R6
   \   00011A   8F83         MOV       DPH,R7
   \   00011C   7403         MOV       A,#0x3
   \   00011E   12....       LCALL     ?XSTACK_DISP100_8
   \   000121   12....       LCALL     ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_3:
   \   000124   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   000127   7403         MOV       A,#0x3
   \   000129   12....       LCALL     ?DEALLOC_XSTACK8
   1129                          bcMsg[24 + MSGpkt->cmd.DataLength] = '0' + bcCnt;
   \   00012C   90....       MOV       DPTR,#??bcCnt
   \   00012F   8065         SJMP      ??zclZEM_AF_RxProc_5
   1130                          bcMsg[25 + MSGpkt->cmd.DataLength] = '\r';
   1131                          bcMsg[26 + MSGpkt->cmd.DataLength] = '\n';
   1132                          HalUARTWrite(HAL_UART_PORT_0, bcMsg, 27 + MSGpkt->cmd.DataLength);
   1133                      }
   1134                      break;
   1135                  case CLUSTER_GROUPCAST:
   1136                      gcCnt++;  // 接收到组播数据包，进行计数
   \                     ??zclZEM_AF_RxProc_3:
   \   000131   90....       MOV       DPTR,#??gcCnt
   \   000134   E0           MOVX      A,@DPTR
   \   000135   04           INC       A
   \   000136   F0           MOVX      @DPTR,A
   1137                      // 通过串口输出接收到的数据和计数器值
   1138                      {
   1139                          uint8 gcMsg[64];
   1140                          osal_memcpy(gcMsg, "Groupcast Data: ", 16);
   \   000137                ; Setup parameters for call to function osal_memcpy
   \   000137   75....       MOV       ?V8,#`?<Constant "Groupcast Data: ">` & 0xff
   \   00013A   75....       MOV       ?V9,#(`?<Constant "Groupcast Data: ">` >> 8) & 0xff
   \   00013D   75..00       MOV       ?V10,#0x0
   \   000140   78..         MOV       R0,#?V8
   \   000142   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   000145   7C10         MOV       R4,#0x10
   \   000147   7D00         MOV       R5,#0x0
   \   000149   7403         MOV       A,#0x3
   \   00014B   12....       LCALL     ?XSTACK_DISP101_8
   \   00014E   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   000151   7403         MOV       A,#0x3
   \   000153   12....       LCALL     ?DEALLOC_XSTACK8
   1141                          osal_memcpy(gcMsg + 16, MSGpkt->cmd.Data, MSGpkt->cmd.DataLength);
   \   000156                ; Setup parameters for call to function osal_memcpy
   \   000156   12....       LCALL     ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_2:
   \   000159   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   00015C   8E82         MOV       DPL,R6
   \   00015E   8F83         MOV       DPH,R7
   \   000160   E0           MOVX      A,@DPTR
   \   000161   FC           MOV       R4,A
   \   000162   A3           INC       DPTR
   \   000163   E0           MOVX      A,@DPTR
   \   000164   FD           MOV       R5,A
   \   000165   7413         MOV       A,#0x13
   \   000167   12....       LCALL     ?XSTACK_DISP0_8
   \   00016A   AA82         MOV       R2,DPL
   \   00016C   AB83         MOV       R3,DPH
   \   00016E   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   000171   7403         MOV       A,#0x3
   \   000173   12....       LCALL     ?DEALLOC_XSTACK8
   1142                          osal_memcpy(gcMsg + 16 + MSGpkt->cmd.DataLength, " Count: ", 8);
   \   000176                ; Setup parameters for call to function osal_memcpy
   \   000176   78..         MOV       R0,#?V4
   \   000178   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   00017B   7C08         MOV       R4,#0x8
   \   00017D   7D00         MOV       R5,#0x0
   \   00017F   8E82         MOV       DPL,R6
   \   000181   8F83         MOV       DPH,R7
   \   000183   7403         MOV       A,#0x3
   \   000185   12....       LCALL     ?XSTACK_DISP100_8
   \   000188   12....       LCALL     ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   00018B   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   00018E   7403         MOV       A,#0x3
   \   000190   12....       LCALL     ?DEALLOC_XSTACK8
   1143                          gcMsg[24 + MSGpkt->cmd.DataLength] = '0' + gcCnt;
   \   000193   90....       MOV       DPTR,#??gcCnt
   \                     ??zclZEM_AF_RxProc_5:
   \   000196   E0           MOVX      A,@DPTR
   \   000197   2430         ADD       A,#0x30
   \   000199   C0E0         PUSH      A
   1144                          gcMsg[25 + MSGpkt->cmd.DataLength] = '\r';
   1145                          gcMsg[26 + MSGpkt->cmd.DataLength] = '\n';
   1146                          HalUARTWrite(HAL_UART_PORT_0, gcMsg, 27 + MSGpkt->cmd.DataLength);
   1147                      }
   \   00019B   12....       LCALL     ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_22:
   \   00019E   2418         ADD       A,#0x18
   \   0001A0   F582         MOV       DPL,A
   \   0001A2   E4           CLR       A
   \   0001A3   39           ADDC      A,R1
   \   0001A4   F583         MOV       DPH,A
   \   0001A6   D0E0         POP       A
   \   0001A8   12....       LCALL     ??Subroutine17_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_28:
   \   0001AB   2419         ADD       A,#0x19
   \   0001AD   12....       LCALL     ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_26:
   \   0001B0   241A         ADD       A,#0x1a
   \   0001B2   12....       LCALL     ?Subroutine13 & 0xFFFF
   \                     ??CrossCallReturnLabel_16:
   \   0001B5   241B         ADD       A,#0x1b
   \                     ??zclZEM_AF_RxProc_4:
   \   0001B7   FC           MOV       R4,A
   \   0001B8   A3           INC       DPTR
   \   0001B9   E0           MOVX      A,@DPTR
   \   0001BA   3400         ADDC      A,#0x0
   \   0001BC   FD           MOV       R5,A
   \   0001BD   AA..         MOV       R2,?XSP + 0
   \   0001BF   AB..         MOV       R3,?XSP + 1
   \   0001C1   7900         MOV       R1,#0x0
   \   0001C3   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
   1148                      break;
   1149                  default:
   1150                      break;
   1151              }
   1152          }
   \                     ??zclZEM_AF_RxProc_0:
   \   0001C6   7440         MOV       A,#0x40
   \   0001C8   12....       LCALL     ?DEALLOC_XSTACK8
   \   0001CB   7F0B         MOV       R7,#0xb
   \   0001CD   02....       LJMP      ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine13:
   \   000000   F582         MOV       DPL,A
   \   000002   E4           CLR       A
   \   000003   39           ADDC      A,R1
   \   000004   F583         MOV       DPH,A
   \   000006   740A         MOV       A,#0xa
   \   000008   F0           MOVX      @DPTR,A
   \   000009                ; Setup parameters for call to function HalUARTWrite
   \   000009                ; Setup parameters for call to function HalUARTWrite
   \   000009   8E82         MOV       DPL,R6
   \   00000B   8F83         MOV       DPH,R7
   \   00000D   E0           MOVX      A,@DPTR
   \   00000E   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   8E82         MOV       DPL,R6
   \   000002   8F83         MOV       DPH,R7
   \   000004   A8..         MOV       R0,?XSP + 0
   \   000006   88..         MOV       ?V0,R0
   \   000008                REQUIRE ??Subroutine16_0
   \   000008                ; // Fall through to label ??Subroutine16_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine16_0:
   \   000000   12....       LCALL     ?Subroutine14 & 0xFFFF
   \                     ??CrossCallReturnLabel_24:
   \   000003   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine14:
   \   000000   E0           MOVX      A,@DPTR
   \   000001   28           ADD       A,R0
   \   000002   F8           MOV       R0,A
   \   000003   A3           INC       DPTR
   \   000004   E0           MOVX      A,@DPTR
   \   000005   35..         ADDC      A,?V1
   \   000007   F9           MOV       R1,A
   \   000008   E8           MOV       A,R0
   \   000009   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   89..         MOV       ?V1,R1
   \   000002   12....       LCALL     ?Subroutine14 & 0xFFFF
   \                     ??CrossCallReturnLabel_23:
   \   000005   2410         ADD       A,#0x10
   \   000007   FA           MOV       R2,A
   \   000008   E4           CLR       A
   \   000009   39           ADDC      A,R1
   \   00000A   FB           MOV       R3,A
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   85..82       MOV       DPL,?V0
   \   000003   85..83       MOV       DPH,?V1
   \   000006   E0           MOVX      A,@DPTR
   \   000007   F5..         MOV       ?V0,A
   \   000009   A3           INC       DPTR
   \   00000A   E0           MOVX      A,@DPTR
   \   00000B   F5..         MOV       ?V1,A
   \   00000D   75..00       MOV       ?V2,#0x0
   \   000010   78..         MOV       R0,#?V0
   \   000012   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   F582         MOV       DPL,A
   \   000002   E4           CLR       A
   \   000003   39           ADDC      A,R1
   \   000004   F583         MOV       DPH,A
   \   000006   740D         MOV       A,#0xd
   \   000008                REQUIRE ??Subroutine17_0
   \   000008                ; // Fall through to label ??Subroutine17_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine17_0:
   \   000000   F0           MOVX      @DPTR,A
   \   000001   8E82         MOV       DPL,R6
   \   000003   8F83         MOV       DPH,R7
   \   000005   E0           MOVX      A,@DPTR
   \   000006   25..         ADD       A,?V0
   \   000008   F8           MOV       R0,A
   \   000009   A3           INC       DPTR
   \   00000A   E0           MOVX      A,@DPTR
   \   00000B   35..         ADDC      A,?V1
   \   00000D   F9           MOV       R1,A
   \   00000E   E8           MOV       A,R0
   \   00000F   22           RET

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   \                     ??p2pCnt:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   \                     ??bcCnt:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   \                     ??gcCnt:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine9:
   \   000000   E0           MOVX      A,@DPTR
   \   000001   04           INC       A
   \   000002   F0           MOVX      @DPTR,A
   \   000003                ; Setup parameters for call to function AF_DataRequest
   \   000003                ; Setup parameters for call to function AF_DataRequest
   \   000003   75..1E       MOV       ?V0,#0x1e
   \   000006   78..         MOV       R0,#?V0
   \   000008   22           RET

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZEM_AppEp>`:
   \   000000   08           DB 8
   \   000001   00           DB 0
   \   000002   ....         DW zclZEM_TaskID
   \   000004   ....         DW zclZEM_SimpleDesc
   \   000006   00           DB 0

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for reportableChange>`:
   \   000000   2C           DB 44
   \   000001   01           DB 1
   \   000002   00           DB 0
   \   000003   00           DB 0

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zclZEM_CmdCallbacks>`:
   \   000000   ....         DW `??zclZEM_BasicResetCB::?relay`
   \   000002   0000         DW 0H
   \   000004   0000         DW 0H
   \   000006   0000         DW 0H
   \   000008   0000         DW 0H
   \   00000A   0000         DW 0H
   \   00000C   0000         DW 0H
   \   00000E   0000         DW 0H
   \   000010   0000         DW 0H

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_Init::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_event_loop::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_event_loop

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_ReadAndSendMAC::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_ReadAndSendMAC

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_UartCB::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_UartCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_ProcessCommissioningStatus::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_ProcessCommissioningStatus

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_BasicResetCB::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_BasicResetCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleApp_BatteryWarningCB::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleApp_BatteryWarningCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_ProcessIncomingMsg::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_ProcessIncomingMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_ProcessInDiscCmdsRspCmd::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_ProcessInDiscCmdsRspCmd

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_AF_RxProc::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_AF_RxProc

   \                                 In  segment XDATA_ROM_C, align 1
   \   000000   42726F61     DB "Broadcast"
   \            64636173
   \            7400    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Groupcast">`:
   \   000000   47726F75     DB "Groupcast"
   \            70636173
   \            7400    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "P2P">`:
   \   000000   50325000     DB "P2P"

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "MAC: ">`:
   \   000000   4D41433A     DB "MAC: "
   \            2000    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Network formation suc...">`:
   \   000000   4E657477     DB "Network formation successful!\015\012"
   \            6F726B20
   \            666F726D
   \            6174696F
   \            6E207375
   \            63636573
   \            7366756C
   \            210D0A00

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Network formation fai...">`:
   \   000000   4E657477     DB "Network formation failed! Retrying...\015\012"
   \            6F726B20
   \            666F726D
   \            6174696F
   \            6E206661
   \            696C6564
   \            21205265
   \            74727969
   \            6E672E2E
   \            2E0D0A00

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Failure reason: ">`:
   \   000000   4661696C     DB "Failure reason: "
   \            75726520
   \            72656173
   \            6F6E3A20
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "No network found">`:
   \   000000   4E6F206E     DB "No network found"
   \            6574776F
   \            726B2066
   \            6F756E64
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Formation failure">`:
   \   000000   466F726D     DB "Formation failure"
   \            6174696F
   \            6E206661
   \            696C7572
   \            6500    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "TCLK exchange failure">`:
   \   000000   54434C4B     DB "TCLK exchange failure"
   \            20657863
   \            68616E67
   \            65206661
   \            696C7572
   \            6500    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "General failure">`:
   \   000000   47656E65     DB "General failure"
   \            72616C20
   \            6661696C
   \            75726500

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Unknown error">`:
   \   000000   556E6B6E     DB "Unknown error"
   \            6F776E20
   \            6572726F
   \            7200    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "\\r\\n">`:
   \   000000   0D0A00       DB "\015\012"

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Device joined the net...">`:
   \   000000   44657669     DB "Device joined the network!\015\012"
   \            6365206A
   \            6F696E65
   \            64207468
   \            65206E65
   \            74776F72
   \            6B210D0A
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "P2P Data: ">`:
   \   000000   50325020     DB "P2P Data: "
   \            44617461
   \            3A2000  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant " Count: ">`:
   \   000000   20436F75     DB " Count: "
   \            6E743A20
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Broadcast Data: ">`:
   \   000000   42726F61     DB "Broadcast Data: "
   \            64636173
   \            74204461
   \            74613A20
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Groupcast Data: ">`:
   \   000000   47726F75     DB "Groupcast Data: "
   \            70636173
   \            74204461
   \            74613A20
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3e8:
   \   000000   E8030000     DD 1000

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_bb8:
   \   000000   B80B0000     DD 3000

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_2710:
   \   000000   10270000     DD 10000
   1153          
   1154          /****************************************************************************
   1155          ****************************************************************************/
   1156          
   1157          

   Maximum stack usage in bytes:

   ISTACK XSTACK Function
   ------ ------ --------
      0      0   zclSampleApp_BatteryWarningCB
      1    124   zclZEM_AF_RxProc
        0     83   -> HalUARTWrite
        0     86   -> osal_memcpy
      2      0   zclZEM_BasicResetCB
        2      0   -> zclZEM_ResetAttributesToDefaultValues
      0     45   zclZEM_Init
        0     39   -> HalUARTOpen
        0     39   -> NLME_PermitJoiningRequest
        0     39   -> RegisterForKeys
        0     39   -> RegisterVoltageWarningCB
        0     39   -> bdb_RegisterCommissioningStatusCB
        0     39   -> bdb_RegisterSimpleDescriptor
        0     45   -> bdb_RepAddAttrCfgRecordDefaultToList
        0     39   -> bdb_StartCommissioning
        0     43   -> osal_start_timerEx
        0     39   -> zclGeneral_RegisterCmdCallbacks
        0     39   -> zclZEM_ReadAndSendMAC
        0     39   -> zclZEM_ResetAttributesToDefaultValues
        0     39   -> zcl_registerAttrList
        0     39   -> zcl_registerForMsg
        0     39   -> zgWriteStartupOptions
      0    179   zclZEM_ProcessCommissioningStatus
        0    176   -> HalUARTWrite
        0    176   -> bdb_StartCommissioning
        0    179   -> osal_memcpy
      2      9   zclZEM_ProcessInDiscCmdsRspCmd
      0     47   zclZEM_ProcessIncomingMsg
        0      9   -> osal_mem_free
        0      9   -> zclZEM_ProcessInDiscCmdsRspCmd
      1    110   zclZEM_ReadAndSendMAC
        0     68   -> HalUARTWrite
        0     68   -> NLME_GetExtAddr
        0     71   -> osal_memcpy
      0      9   zclZEM_UartCB
        0      9   -> HalUARTRead
        0      9   -> HalUARTWrite
        0      9   -> Hal_UART_RxBufLen
      0     47   zclZEM_event_loop
        0     47   -> AF_DataRequest
        0     38   -> HalLedBlink
        0     38   -> osal_msg_deallocate
        0     38   -> osal_msg_receive
        0     42   -> osal_start_timerEx
        0     38   -> zclZEM_AF_RxProc
        0     38   -> zclZEM_ProcessIncomingMsg


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
       9  ?<Constant " Count: ">
      17  ?<Constant "Broadcast Data: ">
      10  ?<Constant "Broadcast">
      29  ?<Constant "Device joined the net...">
      17  ?<Constant "Failure reason: ">
      18  ?<Constant "Formation failure">
      16  ?<Constant "General failure">
      17  ?<Constant "Groupcast Data: ">
      10  ?<Constant "Groupcast">
       6  ?<Constant "MAC: ">
      40  ?<Constant "Network formation fai...">
      32  ?<Constant "Network formation suc...">
      17  ?<Constant "No network found">
      11  ?<Constant "P2P Data: ">
       4  ?<Constant "P2P">
      22  ?<Constant "TCLK exchange failure">
      14  ?<Constant "Unknown error">
       3  ?<Constant "\r\n">
       7  ?<Initializer for ZEM_AppEp>
       4  ?<Initializer for reportableChange>
      18  ?<Initializer for zclZEM_CmdCallbacks>
       8  ??Subroutine15_0
       4  ??Subroutine16_0
      16  ??Subroutine17_0
       8  ?Subroutine0
       5  ?Subroutine1
      11  ?Subroutine10
      11  ?Subroutine11
      17  ?Subroutine12
      15  ?Subroutine13
      10  ?Subroutine14
       7  ?Subroutine2
       8  ?Subroutine3
      19  ?Subroutine4
      12  ?Subroutine5
       8  ?Subroutine6
      16  ?Subroutine7
       4  ?Subroutine8
       9  ?Subroutine9
       1  P1DIR
       1  P1SEL
       1  PERCFG
       7  ZEM_AppEp
       4  __Constant_2710
       4  __Constant_3e8
       4  __Constant_bb8
       1  bcCnt
       1  gcCnt
       1  p2pCnt
       4  reportableChange
       1  transferId
       1  transferId
       1  transferId
       3  zclSampleApp_BatteryWarningCB
       6  zclSampleApp_BatteryWarningCB::?relay
     464  zclZEM_AF_RxProc
       6  zclZEM_AF_RxProc::?relay
       7  zclZEM_BasicResetCB
       6  zclZEM_BasicResetCB::?relay
      18  zclZEM_CmdCallbacks
     337  zclZEM_Init
       6  zclZEM_Init::?relay
       1  zclZEM_NwkState
     335  zclZEM_ProcessCommissioningStatus
       6  zclZEM_ProcessCommissioningStatus::?relay
      37  zclZEM_ProcessInDiscCmdsRspCmd
       6  zclZEM_ProcessInDiscCmdsRspCmd::?relay
     126  zclZEM_ProcessIncomingMsg
       6  zclZEM_ProcessIncomingMsg::?relay
     241  zclZEM_ReadAndSendMAC
       6  zclZEM_ReadAndSendMAC::?relay
       1  zclZEM_TaskID
      64  zclZEM_UartBuf
      39  zclZEM_UartCB
       6  zclZEM_UartCB::?relay
     464  zclZEM_event_loop
       6  zclZEM_event_loop::?relay

 
 2 241 bytes in segment BANKED_CODE
    60 bytes in segment BANK_RELAYS
     3 bytes in segment SFR_AN
    29 bytes in segment XDATA_I
    29 bytes in segment XDATA_ID
   304 bytes in segment XDATA_ROM_C
    72 bytes in segment XDATA_Z
 
    89 bytes of CODE     memory
   292 bytes of CONST    memory (+ 12 bytes shared)
     0 bytes of DATA     memory (+  3 bytes shared)
 2 241 bytes of HUGECODE memory
   101 bytes of XDATA    memory

Errors: none
Warnings: 1

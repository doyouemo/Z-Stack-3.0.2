###############################################################################
#
# IAR C/C++ Compiler V10.10.1.4655 for 8051               06/Feb/2026  15:02:58
# Copyright 2004-2017 IAR Systems AB.
# Standalone license - IAR Embedded Workbench for 8051
#
#    Core               =  plain
#    Code model         =  banked
#    Data model         =  large
#    Calling convention =  xdata reentrant
#    Constant location  =  data_rom
#    Dptr setup         =  1,16
#                          
#    Source file        =  
#        D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\Source\zcl_ZEM.c
#    Command line       =  
#        -f C:\Users\KLF\AppData\Local\Temp\EWA208.tmp ("D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\Source\zcl_ZEM.c" -D
#        BDB_REPORTING -D xZTOOL_P1 -D xMT_TASK -D xMT_APP_FUNC -D xMT_SYS_FUNC
#        -D xMT_ZDO_FUNC -D xMT_APP_CNF_FUNC -D LCD_SUPPORTED=DEBUG -D
#        MULTICAST_ENABLED=FALSE -D ZCL_READ -D ZCL_DISCOVER -D ZCL_WRITE -D
#        ZCL_BASIC -D ZCL_IDENTIFY -D ZCL_TEMPERATURE_MEASUREMENT -D ZCL_GROUPS
#        -D HAL_LED=TRUE -D HAL_UART=TRUE -D INT_HEAP_LEN=2048 -lC
#        "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\CoordinatorEB\List"
#        -lA "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\CoordinatorEB\List"
#        --diag_suppress Pe001,Pa010 -o "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\CoordinatorEB\Obj"
#        -e --debug --core=plain --dptr=16,1 --data_model=large
#        --code_model=banked --calling_convention=xdata_reentrant
#        --place_constants=data_rom --nr_virtual_regs 16 -f "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\Tools\CC2530DB\f8wCoord.cfg"
#        (-DCPU32MHZ -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRUE
#        -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8 -DMAC_CFG_RX_MAX=5
#        -DZDO_COORDINATOR -DRTR_NWK) -f "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\Tools\CC2530DB\f8wConfig.cfg"
#        (-DZIGBEEPRO -DSECURE=1 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR
#        -DDEFAULT_CHANLIST=0x00100000 -DZDAPP_CONFIG_PAN_ID=0x1234
#        -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MASK=0x007F
#        -DBEACON_REQUEST_DELAY=100 -DBEACON_REQ_DELAY_MASK=0x00FF
#        -DLINK_STATUS_JITTER_MASK=0x007F -DROUTE_EXPIRY_TIME=30
#        -DAPSC_ACK_WAIT_DURATION_POLLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7
#        -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3
#        -DNWK_MAX_DATA_RETRIES=2 -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9
#        -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40 -DNWK_MAX_BINDING_ENTRIES=4
#        -DMAX_BINDING_CLUSTER_IDS=4 -DDEFAULT_KEY={0} -DMAC_MAX_FRAME_SIZE=116
#        -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const __code"
#        -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000
#        -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100 -DREJOIN_POLL_RATE=440
#        -DREJOIN_BACKOFF=900000 -DREJOIN_SCAN=900000 -DENABLE_LED4_DISABLE_S1)
#        -f "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\Tools\CC2530DB\f8wZCL.cfg"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\" -I
#        "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\Source\" -I
#        "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\Source\" -I
#        "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\ZMain\TI2530DB\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\hal\include\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\hal\target\CC2530EB\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\mac\include\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\mac\high_level\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\mac\low_level\srf04\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\mac\low_level\srf04\single_chip\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\mt\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\osal\include\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\services\saddr\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\services\sdata\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\af\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\bdb\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\gp\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\nwk\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\sapi\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\sec\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\sys\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\zcl\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\zdo\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\zmac\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\zmac\f8w\"
#        -Ohz --require_prototypes)
#    Locale             =  Chinese (Simplified)_China.936
#    List file          =  
#        D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\CoordinatorEB\List\zcl_ZEM.lst
#    Object file        =  
#        D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\CoordinatorEB\Obj\zcl_ZEM.r51
#
###############################################################################

D:\project\Z-Stack 3.0.2\Projects\zstack\HomeAutomation\ZEM\Source\zcl_ZEM.c
      1          /*********************************************************************
      2           * INCLUDES
      3           */
      4          #include "ZComDef.h"
      5          #include "OSAL.h"
      6          #include "AF.h"
      7          #include "ZDApp.h"
      8          #include "ZDObject.h"
      9          #include "ZDProfile.h"
     10          #include "MT_SYS.h"
     11          
     12          #include "zcl.h"
     13          #include "zcl_general.h"
     14          #include "zcl_ha.h"
     15          #include "zcl_ms.h"
     16          
     17          #include "zcl_ZEM.h"
     18          
     19          #include "onboard.h"

   \                                 In  segment SFR_AN, at 0xf1
   \   unsigned char volatile __sfr PERCFG
   \                     PERCFG:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xf4
   \   unsigned char volatile __sfr P1SEL
   \                     P1SEL:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xfe
   \   unsigned char volatile __sfr P1DIR
   \                     P1DIR:
   \   000000                DS 1
     20          
     21          /* HAL */
     22          #include "hal_lcd.h"
     23          #include "hal_led.h"
     24          #include "hal_key.h"
     25          #include "hal_uart.h"
     26          
     27          #include "bdb_interface.h"
     28          #include "bdb_Reporting.h"
     29             
     30          /*********************************************************************
     31           * MACROS
     32           */
     33          
     34          // how often to report temperature
     35          #define ZEM_REPORT_INTERVAL   10000
     36          
     37          #define GUI_LOCAL_TEMP    1
     38          
     39          #define APP_TITLE "   Temp Sensor  "
     40          
     41          /*********************************************************************
     42           * CONSTANTS
     43           */
     44          
     45          /*********************************************************************
     46           * TYPEDEFS
     47           */
     48          
     49          /*********************************************************************
     50           * GLOBAL VARIABLES
     51           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     52          byte zclZEM_TaskID;
   \                     zclZEM_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     53          
     54          extern int16 zdpExternalStateTaskID;
     55          
     56          // UART Buffer

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     57          static uint8 zclZEM_UartBuf[ZCLZEM_UART_BUF_LEN];
   \                     zclZEM_UartBuf:
   \   000000                DS 64
   \   000040                REQUIRE __INIT_XDATA_Z
     58          
     59          /*********************************************************************
     60           * GLOBAL FUNCTIONS
     61           */
     62          
     63          /*********************************************************************
     64           * LOCAL VARIABLES
     65           */
     66          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     67          uint8 zclZEM_NwkState = 0; // DEV_INIT
   \                     zclZEM_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     68          
     69          //static uint8 aProcessCmd[] = { 1, 0, 0, 0 }; // used for reset command, { length + cmd0 + cmd1 + data }
     70          
     71          // Application Endpoint for data communication

   \                                 In  segment XDATA_I, align 1, keep-with-next
     72          static endPointDesc_t ZEM_AppEp =
   \                     ZEM_AppEp:
   \   000000                DS 7
   \   000007                REQUIRE `?<Initializer for ZEM_AppEp>`
   \   000007                REQUIRE __INIT_XDATA_I
     73          {
     74            ZEM_ENDPOINT,                       // Application endpoint
     75            0,
     76            &zclZEM_TaskID,
     77            (SimpleDescriptionFormat_t *)&zclZEM_SimpleDesc,                 // Simple description for this application
     78            (afNetworkLatencyReq_t)0            // No Network Latency req
     79          };
     80          #ifdef BDB_REPORTING
     81          #if BDBREPORTING_MAX_ANALOG_ATTR_SIZE == 8
     82            uint8 reportableChange[] = {0x2C, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}; // 0x2C01 is 300 in int16
     83          #endif
     84          #if BDBREPORTING_MAX_ANALOG_ATTR_SIZE == 4

   \                                 In  segment XDATA_I, align 1, keep-with-next
     85            uint8 reportableChange[] = {0x2C, 0x01, 0x00, 0x00}; // 0x2C01 is 300 in int16
   \                     reportableChange:
   \   000000                DS 4
   \   000004                REQUIRE `?<Initializer for reportableChange>`
   \   000004                REQUIRE __INIT_XDATA_I
     86          #endif 
     87          #if BDBREPORTING_MAX_ANALOG_ATTR_SIZE == 2
     88            uint8 reportableChange[] = {0x2C, 0x01}; // 0x2C01 is 300 in int16
     89          #endif 
     90          #endif
     91          
     92          /*********************************************************************
     93           * LOCAL FUNCTIONS
     94           */
     95          static void zclZEM_HandleKeys( byte shift, byte keys );
     96          static void zclZEM_BasicResetCB( void );
     97          
     98          static void zclZEM_ProcessCommissioningStatus(bdbCommissioningModeMsg_t* bdbCommissioningModeMsg);
     99          
    100          // Functions to process ZCL Foundation incoming Command/Response messages
    101          static void zclZEM_ProcessIncomingMsg( zclIncomingMsg_t *msg );
    102          #ifdef ZCL_READ
    103          static uint8 zclZEM_ProcessInReadRspCmd( zclIncomingMsg_t *pInMsg );
    104          #endif
    105          #ifdef ZCL_WRITE
    106          static uint8 zclZEM_ProcessInWriteRspCmd( zclIncomingMsg_t *pInMsg );
    107          #endif
    108          static uint8 zclZEM_ProcessInDefaultRspCmd( zclIncomingMsg_t *pInMsg );
    109          #ifdef ZCL_DISCOVER
    110          static uint8 zclZEM_ProcessInDiscCmdsRspCmd( zclIncomingMsg_t *pInMsg );
    111          static uint8 zclZEM_ProcessInDiscAttrsRspCmd( zclIncomingMsg_t *pInMsg );
    112          static uint8 zclZEM_ProcessInDiscAttrsExtRspCmd( zclIncomingMsg_t *pInMsg );
    113          #endif // ZCL_DISCOVER
    114          
    115          static void zclSampleApp_BatteryWarningCB( uint8 voltLevel);
    116          
    117          /*********************************************************************
    118           * STATUS STRINGS
    119           */
    120          
    121          /*********************************************************************
    122           * CONSTANTS
    123           */
    124          
    125          
    126          /*********************************************************************
    127           * ZCL General Profile Callback table
    128           */

   \                                 In  segment XDATA_I, align 1, keep-with-next
    129          static zclGeneral_AppCallbacks_t zclZEM_CmdCallbacks =
   \                     zclZEM_CmdCallbacks:
   \   000000                DS 18
   \   000012                REQUIRE `?<Initializer for zclZEM_CmdCallbacks>`
   \   000012                REQUIRE __INIT_XDATA_I
    130          {
    131            zclZEM_BasicResetCB,        // Basic Cluster Reset command
    132            NULL,                                           // Identify Trigger Effect command
    133            NULL,             				                      // On/Off cluster command
    134            NULL,                                           // On/Off cluster enhanced command Off with Effect
    135            NULL,                                           // On/Off cluster enhanced command On with Recall Global Scene
    136            NULL,                                           // On/Off cluster enhanced command On with Timed Off
    137          #ifdef ZCL_LEVEL_CTRL
    138            NULL,                                           // Level Control Move to Level command
    139            NULL,                                           // Level Control Move command
    140            NULL,                                           // Level Control Step command
    141            NULL,                                           // Level Control Stop command
    142          #endif
    143          #ifdef ZCL_GROUPS
    144            NULL,                                           // Group Response commands
    145          #endif
    146          #ifdef ZCL_SCENES
    147            NULL,                                           // Scene Store Request command
    148            NULL,                                           // Scene Recall Request command
    149            NULL,                                           // Scene Response command
    150          #endif
    151          #ifdef ZCL_ALARMS
    152            NULL,                                           // Alarm (Response) commands
    153          #endif
    154          #ifdef SE_UK_EXT
    155            NULL,                                           // Get Event Log command
    156            NULL,                                           // Publish Event Log command
    157          #endif
    158            NULL,                                           // RSSI Location command
    159            NULL                                            // RSSI Location Response command
    160          };
    161          
    162          /*********************************************************************
    163           * @fn          zclZEM_Init
    164           *
    165           * @brief       Initialization function for the zclGeneral layer.
    166           *
    167           * @param       none
    168           *
    169           * @return      none
    170           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    171          void zclZEM_Init( byte task_id )
   \                     zclZEM_Init:
    172          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV       A,#-0xa
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 29
   \   000005   74E3         MOV       A,#-0x1d
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   \   00000A   E9           MOV       A,R1
    173            zclZEM_TaskID = task_id;
   \   00000B   90....       MOV       DPTR,#zclZEM_TaskID
   \   00000E   F0           MOVX      @DPTR,A
    174          
    175            // Register the Simple Descriptor for this application
    176            bdb_RegisterSimpleDescriptor( &zclZEM_SimpleDesc ); 
   \   00000F                ; Setup parameters for call to function bdb_RegisterSimpleDescriptor
   \   00000F   7A..         MOV       R2,#zclZEM_SimpleDesc & 0xff
   \   000011   7B..         MOV       R3,#(zclZEM_SimpleDesc >> 8) & 0xff
   \   000013   12....       LCALL     `??bdb_RegisterSimpleDescriptor::?relay`; Banked call to: bdb_RegisterSimpleDescriptor
    177            
    178            // Register the ZCL General Cluster Library callback functions
    179            zclGeneral_RegisterCmdCallbacks( ZEM_ENDPOINT, &zclZEM_CmdCallbacks );
   \   000016                ; Setup parameters for call to function zclGeneral_RegisterCmdCallbacks
   \   000016   7A..         MOV       R2,#zclZEM_CmdCallbacks & 0xff
   \   000018   7B..         MOV       R3,#(zclZEM_CmdCallbacks >> 8) & 0xff
   \   00001A   7908         MOV       R1,#0x8
   \   00001C   12....       LCALL     `??zclGeneral_RegisterCmdCallbacks::?relay`; Banked call to: zclGeneral_RegisterCmdCallbacks
    180          
    181            // Register the application's attribute list
    182            zclZEM_ResetAttributesToDefaultValues();
   \   00001F                ; Setup parameters for call to function zclZEM_ResetAttributesToDefaultValues
   \   00001F   12....       LCALL     `??zclZEM_ResetAttributesToDefaultValues::?relay`; Banked call to: zclZEM_ResetAttributesToDefaultValues
    183            zcl_registerAttrList( ZEM_ENDPOINT, zclZEM_NumAttributes, zclZEM_Attrs );
   \   000022                ; Setup parameters for call to function zcl_registerAttrList
   \   000022   7C..         MOV       R4,#zclZEM_Attrs & 0xff
   \   000024   7D..         MOV       R5,#(zclZEM_Attrs >> 8) & 0xff
   \   000026   90....       MOV       DPTR,#zclZEM_NumAttributes
   \   000029   E4           CLR       A
   \   00002A   93           MOVC      A,@A+DPTR
   \   00002B   FA           MOV       R2,A
   \   00002C   7908         MOV       R1,#0x8
   \   00002E   12....       LCALL     `??zcl_registerAttrList::?relay`; Banked call to: zcl_registerAttrList
    184          
    185            // Register the Application to receive the unprocessed Foundation command/response messages
    186            zcl_registerForMsg( zclZEM_TaskID );
   \   000031                ; Setup parameters for call to function zcl_registerForMsg
   \   000031   90....       MOV       DPTR,#zclZEM_TaskID
   \   000034   E0           MOVX      A,@DPTR
   \   000035   F9           MOV       R1,A
   \   000036   12....       LCALL     `??zcl_registerForMsg::?relay`; Banked call to: zcl_registerForMsg
    187          
    188            // Register low voltage NV memory protection application callback
    189            RegisterVoltageWarningCB( zclSampleApp_BatteryWarningCB );
   \   000039                ; Setup parameters for call to function RegisterVoltageWarningCB
   \   000039   7A..         MOV       R2,#`??zclSampleApp_BatteryWarningCB::?relay` & 0xff
   \   00003B   7B..         MOV       R3,#(`??zclSampleApp_BatteryWarningCB::?relay` >> 8) & 0xff
   \   00003D   12....       LCALL     `??RegisterVoltageWarningCB::?relay`; Banked call to: RegisterVoltageWarningCB
    190          
    191            // Register for all key events - This app will handle all key events
    192            RegisterForKeys( zclZEM_TaskID );
   \   000040                ; Setup parameters for call to function RegisterForKeys
   \   000040   90....       MOV       DPTR,#zclZEM_TaskID
   \   000043   E0           MOVX      A,@DPTR
   \   000044   F9           MOV       R1,A
   \   000045   12....       LCALL     `??RegisterForKeys::?relay`; Banked call to: RegisterForKeys
    193          
    194            bdb_RegisterCommissioningStatusCB( zclZEM_ProcessCommissioningStatus );
   \   000048                ; Setup parameters for call to function bdb_RegisterCommissioningStatusCB
   \   000048   7A..         MOV       R2,#`??zclZEM_ProcessCommissioningStatus::?relay` & 0xff
   \   00004A   7B..         MOV       R3,#(`??zclZEM_ProcessCommissioningStatus::?relay` >> 8) & 0xff
   \   00004C   12....       LCALL     `??bdb_RegisterCommissioningStatusCB::?relay`; Banked call to: bdb_RegisterCommissioningStatusCB
    195          
    196            // Register the endpoint with AF (Application Framework)
    197            afRegister( &ZEM_AppEp  );
   \   00004F                ; Setup parameters for call to function afRegister
   \   00004F   7A..         MOV       R2,#ZEM_AppEp & 0xff
   \   000051   7B..         MOV       R3,#(ZEM_AppEp >> 8) & 0xff
   \   000053   12....       LCALL     `??afRegister::?relay`; Banked call to: afRegister
    198            
    199            // 清除之前保存的网络信息，确保每次启动都重新组网
    200            NLME_SetDefaultNV();
   \   000056                ; Setup parameters for call to function NLME_SetDefaultNV
   \   000056   12....       LCALL     `??NLME_SetDefaultNV::?relay`; Banked call to: NLME_SetDefaultNV
    201            
    202            // Initialize UART communication
    203            zclZEM_InitUart();
   \   000059   43F101       ORL       0xf1,#0x1
   \   00005C   43F430       ORL       0xf4,#0x30
   \   00005F   43FE10       ORL       0xfe,#0x10
   \   000062   53FEDF       ANL       0xfe,#0xdf
   \   000065   85..82       MOV       DPL,?XSP + 0
   \   000068   85..83       MOV       DPH,?XSP + 1
   \   00006B   7401         MOV       A,#0x1
   \   00006D   F0           MOVX      @DPTR,A
   \   00006E   12....       LCALL     ?XSTACK_DISP0_8
   \   000071   7404         MOV       A,#0x4
   \   000073   F0           MOVX      @DPTR,A
   \   000074   7402         MOV       A,#0x2
   \   000076   12....       LCALL     ?XSTACK_DISP0_8
   \   000079   E4           CLR       A
   \   00007A   F0           MOVX      @DPTR,A
   \   00007B   7403         MOV       A,#0x3
   \   00007D   12....       LCALL     ?XSTACK_DISP0_8
   \   000080   E4           CLR       A
   \   000081   F0           MOVX      @DPTR,A
   \   000082   A3           INC       DPTR
   \   000083   F0           MOVX      @DPTR,A
   \   000084   740A         MOV       A,#0xa
   \   000086   12....       LCALL     ?XSTACK_DISP0_8
   \   000089   7440         MOV       A,#0x40
   \   00008B   F0           MOVX      @DPTR,A
   \   00008C   A3           INC       DPTR
   \   00008D   E4           CLR       A
   \   00008E   F0           MOVX      @DPTR,A
   \   00008F   7412         MOV       A,#0x12
   \   000091   12....       LCALL     ?XSTACK_DISP0_8
   \   000094   E4           CLR       A
   \   000095   F0           MOVX      @DPTR,A
   \   000096   A3           INC       DPTR
   \   000097   F0           MOVX      @DPTR,A
   \   000098   7405         MOV       A,#0x5
   \   00009A   12....       LCALL     ?XSTACK_DISP0_8
   \   00009D   7406         MOV       A,#0x6
   \   00009F   F0           MOVX      @DPTR,A
   \   0000A0   7416         MOV       A,#0x16
   \   0000A2   12....       LCALL     ?XSTACK_DISP0_8
   \   0000A5   7401         MOV       A,#0x1
   \   0000A7   F0           MOVX      @DPTR,A
   \   0000A8   741B         MOV       A,#0x1b
   \   0000AA   12....       LCALL     ?XSTACK_DISP0_8
   \   0000AD   74..         MOV       A,#`??zclZEM_UartCB::?relay` & 0xff
   \   0000AF   F0           MOVX      @DPTR,A
   \   0000B0   A3           INC       DPTR
   \   0000B1   74..         MOV       A,#(`??zclZEM_UartCB::?relay` >> 8) & 0xff
   \   0000B3   F0           MOVX      @DPTR,A
   \   0000B4                ; Setup parameters for call to function HalUARTOpen
   \   0000B4   AA..         MOV       R2,?XSP + 0
   \   0000B6   AB..         MOV       R3,?XSP + 1
   \   0000B8   7900         MOV       R1,#0x0
   \   0000BA   12....       LCALL     `??HalUARTOpen::?relay`; Banked call to: HalUARTOpen
    204          
    205          #ifdef ZDO_COORDINATOR
    206            bdb_StartCommissioning( BDB_COMMISSIONING_MODE_NWK_FORMATION |
    207                                    BDB_COMMISSIONING_MODE_FINDING_BINDING );
   \   0000BD                ; Setup parameters for call to function bdb_StartCommissioning
   \   0000BD   790C         MOV       R1,#0xc
   \   0000BF   12....       LCALL     `??bdb_StartCommissioning::?relay`; Banked call to: bdb_StartCommissioning
    208            NLME_PermitJoiningRequest(255);
   \   0000C2                ; Setup parameters for call to function NLME_PermitJoiningRequest
   \   0000C2   79FF         MOV       R1,#-0x1
   \   0000C4   12....       LCALL     `??NLME_PermitJoiningRequest::?relay`; Banked call to: NLME_PermitJoiningRequest
    209          
    210          #else
    211            bdb_StartCommissioning( BDB_COMMISSIONING_MODE_NWK_STEERING |
    212                                    BDB_COMMISSIONING_MODE_FINDING_BINDING );
    213          #endif
    214            
    215            // Read and send MAC address
    216            zclZEM_ReadAndSendMAC();
   \   0000C7                ; Setup parameters for call to function zclZEM_ReadAndSendMAC
   \   0000C7   12....       LCALL     `??zclZEM_ReadAndSendMAC::?relay`; Banked call to: zclZEM_ReadAndSendMAC
    217          
    218          #ifdef BDB_REPORTING
    219            //Adds the default configuration values for the temperature attribute of the ZCL_CLUSTER_ID_MS_TEMPERATURE_MEASUREMENT cluster, for endpoint ZEM_ENDPOINT
    220            //Default maxReportingInterval value is 10 seconds
    221            //Default minReportingInterval value is 3 seconds
    222            //Default reportChange value is 300 (3 degrees)
    223            bdb_RepAddAttrCfgRecordDefaultToList(ZEM_ENDPOINT, ZCL_CLUSTER_ID_MS_TEMPERATURE_MEASUREMENT, ATTRID_MS_TEMPERATURE_MEASURED_VALUE, 0, 10, reportableChange);
   \   0000CA                ; Setup parameters for call to function bdb_RepAddAttrCfgRecordDefaultToList
   \   0000CA   75....       MOV       ?V0,#reportableChange & 0xff
   \   0000CD   75....       MOV       ?V1,#(reportableChange >> 8) & 0xff
   \   0000D0   78..         MOV       R0,#?V0
   \   0000D2   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000D5   75..0A       MOV       ?V0,#0xa
   \   0000D8   75..00       MOV       ?V1,#0x0
   \   0000DB   78..         MOV       R0,#?V0
   \   0000DD   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000E0   E4           CLR       A
   \   0000E1   F5..         MOV       ?V0,A
   \   0000E3   78..         MOV       R0,#?V0
   \   0000E5   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000E8   7C00         MOV       R4,#0x0
   \   0000EA   7D00         MOV       R5,#0x0
   \   0000EC   7A02         MOV       R2,#0x2
   \   0000EE   7B04         MOV       R3,#0x4
   \   0000F0   7908         MOV       R1,#0x8
   \   0000F2   12....       LCALL     `??bdb_RepAddAttrCfgRecordDefaultToList::?relay`; Banked call to: bdb_RepAddAttrCfgRecordDefaultToList
   \   0000F5   7406         MOV       A,#0x6
   \   0000F7   12....       LCALL     ?DEALLOC_XSTACK8
    224          #endif
    225            
    226            zdpExternalStateTaskID = zclZEM_TaskID;
   \   0000FA   90....       MOV       DPTR,#zclZEM_TaskID
   \   0000FD   E0           MOVX      A,@DPTR
   \   0000FE   90....       MOV       DPTR,#zdpExternalStateTaskID
   \   000101   F0           MOVX      @DPTR,A
   \   000102   A3           INC       DPTR
   \   000103   E4           CLR       A
   \   000104   F0           MOVX      @DPTR,A
    227             osal_start_timerEx(
    228                zclZEM_TaskID,
    229                ZEMAPP_EVT,
    230                2000);
   \   000105                ; Setup parameters for call to function osal_start_timerEx
   \   000105   90....       MOV       DPTR,#__Constant_7d0
   \   000108   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   00010B   7A80         MOV       R2,#-0x80
   \   00010D   7B00         MOV       R3,#0x0
   \   00010F   90....       MOV       DPTR,#zclZEM_TaskID
   \   000112   E0           MOVX      A,@DPTR
   \   000113   F9           MOV       R1,A
   \   000114   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   000117   7404         MOV       A,#0x4
   \   000119   12....       LCALL     ?DEALLOC_XSTACK8
    231          }
   \   00011C   741D         MOV       A,#0x1d
   \   00011E                REQUIRE ?Subroutine0
   \   00011E                REQUIRE PERCFG
   \   00011E                REQUIRE P1SEL
   \   00011E                REQUIRE P1DIR
   \   00011E                ; // Fall through to label ?Subroutine0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   12....       LCALL     ?DEALLOC_XSTACK8
   \   000003   7F02         MOV       R7,#0x2
   \   000005   02....       LJMP      ?BANKED_LEAVE_XDATA
    232          
    233          /*********************************************************************
    234           * @fn          zclSample_event_loop
    235           *
    236           * @brief       Event Loop Processor for zclGeneral.
    237           *
    238           * @param       none
    239           *
    240           * @return      none
    241           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    242          uint16 zclZEM_event_loop( uint8 task_id, uint16 events )
   \                     zclZEM_event_loop:
    243          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000                REQUIRE ?V4
   \   000000                REQUIRE ?V5
   \   000000                REQUIRE ?V6
   \   000000   74F1         MOV       A,#-0xf
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 15
   \   000005                ; Auto size: 254
   \   000005   7402         MOV       A,#0x2
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   \   00000A   EA           MOV       A,R2
   \   00000B   FE           MOV       R6,A
   \   00000C   EB           MOV       A,R3
   \   00000D   FF           MOV       R7,A
    244            afIncomingMSGPacket_t *MSGpkt;
    245          
    246            (void)task_id;  // Intentionally unreferenced parameter
    247          
    248            if ( events & SYS_EVENT_MSG )
   \   00000E   5480         ANL       A,#0x80
   \   000010   7041         JNZ       ??zclZEM_event_loop_0
    249            {
    250              while ( (MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( zclZEM_TaskID )) )
    251              {
    252                
    253                switch ( MSGpkt->hdr.event )
    254                {
    255                  case ZCL_INCOMING_MSG:
    256                    // Incoming ZCL Foundation command/response messages
    257                    zclZEM_ProcessIncomingMsg( (zclIncomingMsg_t *)MSGpkt );
    258                    break;
    259          
    260                  case AF_INCOMING_MSG_CMD:
    261                    // Incoming AF data messages
    262                    zclZEM_AF_RxProc( MSGpkt );
    263                    break;
    264          
    265                  case KEY_CHANGE:
    266                    zclZEM_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    267                    break;
    268          
    269                  case ZDO_STATE_CHANGE:
    270                    break;
    271          
    272                  default:
    273                    break;
    274                }
    275          
    276                // Release the memory
    277                osal_msg_deallocate( (uint8 *)MSGpkt );
    278              }
    279          
    280              // return unprocessed events
    281              return (events ^ SYS_EVENT_MSG);
    282            }
    283          
    284            // 先处理LED闪烁事件，确保不会被SYS_EVENT_MSG阻塞
    285            if(events & ZEMAPP_EVT)
   \   000012   EE           MOV       A,R6
   \   000013   5480         ANL       A,#0x80
   \   000015   7003         JNZ       $+5
   \   000017   02....       LJMP      ??zclZEM_event_loop_1 & 0xFFFF
    286            { 
    287              static uint8 sendType = 0; // 0: 发送格式1, 1: 发送格式2, 2: 发送格式3
    288              uint8* macAddr = NLME_GetExtAddr();
   \   00001A                ; Setup parameters for call to function NLME_GetExtAddr
   \   00001A   12....       LCALL     `??NLME_GetExtAddr::?relay`; Banked call to: NLME_GetExtAddr
   \   00001D   8A..         MOV       ?V2,R2
   \   00001F   8B..         MOV       ?V3,R3
    289              uint8 macStr[100]; // 足够存储MAC地址字符串
    290              uint8 i, pos = 0;
    291              
    292              // 添加起始分隔符
    293              macStr[pos++] = '/';
   \   000021   749A         MOV       A,#-0x66
   \   000023   12....       LCALL     ?XSTACK_DISP0_8
   \   000026   742F         MOV       A,#0x2f
   \   000028   F0           MOVX      @DPTR,A
   \   000029   7801         MOV       R0,#0x1
    294              
    295              // 添加设备自身MAC地址（16个十六进制字符）- 小端序
    296              for (int i = 7; i >= 0; i--) {
   \   00002B   7C07         MOV       R4,#0x7
   \   00002D   7D00         MOV       R5,#0x0
    297                // 转换高4位
    298                uint8 highNibble = (macAddr[i] >> 4) & 0x0F;
   \                     ??zclZEM_event_loop_2:
   \   00002F   E5..         MOV       A,?V2
   \   000031   2C           ADD       A,R4
   \   000032   FA           MOV       R2,A
   \   000033   E5..         MOV       A,?V3
   \   000035   3D           ADDC      A,R5
   \   000036   FB           MOV       R3,A
   \   000037   8A82         MOV       DPL,R2
   \   000039   8B83         MOV       DPH,R3
   \   00003B   E0           MOVX      A,@DPTR
   \   00003C   C4           SWAP      A
   \   00003D   540F         ANL       A,#0xf
   \   00003F   F9           MOV       R1,A
    299                macStr[pos++] = (highNibble < 10) ? ('0' + highNibble) : ('A' + highNibble - 10);
   \   000040   12....       LCALL     ?Subroutine16 & 0xFFFF
   \                     ??CrossCallReturnLabel_45:
   \   000043   5039         JNC       ??zclZEM_event_loop_3
   \   000045   7430         MOV       A,#0x30
   \   000047   8037         SJMP      ??zclZEM_event_loop_4
   \                     ??zclZEM_event_loop_5:
   \   000049                ; Setup parameters for call to function zclZEM_AF_RxProc
   \   000049   12....       LCALL     `??zclZEM_AF_RxProc::?relay`; Banked call to: zclZEM_AF_RxProc
   \                     ??zclZEM_event_loop_6:
   \   00004C                ; Setup parameters for call to function osal_msg_deallocate
   \   00004C   AA..         MOV       R2,?V2
   \   00004E   AB..         MOV       R3,?V3
   \   000050   12....       LCALL     `??osal_msg_deallocate::?relay`; Banked call to: osal_msg_deallocate
   \                     ??zclZEM_event_loop_0:
   \   000053                ; Setup parameters for call to function osal_msg_receive
   \   000053   90....       MOV       DPTR,#zclZEM_TaskID
   \   000056   E0           MOVX      A,@DPTR
   \   000057   F9           MOV       R1,A
   \   000058   12....       LCALL     `??osal_msg_receive::?relay`; Banked call to: osal_msg_receive
   \   00005B   8A..         MOV       ?V2,R2
   \   00005D   8B..         MOV       ?V3,R3
   \   00005F   EA           MOV       A,R2
   \   000060   45..         ORL       A,?V3
   \   000062   6012         JZ        ??zclZEM_event_loop_7
   \   000064   8A82         MOV       DPL,R2
   \   000066   8B83         MOV       DPH,R3
   \   000068   E0           MOVX      A,@DPTR
   \   000069   24E6         ADD       A,#-0x1a
   \   00006B   60DC         JZ        ??zclZEM_event_loop_5
   \   00006D   24E6         ADD       A,#-0x1a
   \   00006F   70DB         JNZ       ??zclZEM_event_loop_6
   \   000071                ; Setup parameters for call to function zclZEM_ProcessIncomingMsg
   \   000071   12....       LCALL     `??zclZEM_ProcessIncomingMsg::?relay`; Banked call to: zclZEM_ProcessIncomingMsg
   \   000074   80D6         SJMP      ??zclZEM_event_loop_6
   \                     ??zclZEM_event_loop_7:
   \   000076   EE           MOV       A,R6
   \   000077   FA           MOV       R2,A
   \   000078   EF           MOV       A,R7
   \   000079   6480         XRL       A,#0x80
   \   00007B   02....       LJMP      ??zclZEM_event_loop_8 & 0xFFFF
   \                     ??zclZEM_event_loop_3:
   \   00007E   7437         MOV       A,#0x37
   \                     ??zclZEM_event_loop_4:
   \   000080   29           ADD       A,R1
   \   000081   C0E0         PUSH      A
   \   000083   E5..         MOV       A,?V1
   \   000085   F5..         MOV       ?V4,A
   \   000087   749A         MOV       A,#-0x66
   \   000089   12....       LCALL     ?XSTACK_DISP0_8
   \   00008C   E582         MOV       A,DPL
   \   00008E   25..         ADD       A,?V4
   \   000090   12....       LCALL     ??Subroutine24_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_35:
   \   000093   D0E0         POP       A
   \   000095   12....       LCALL     ?Subroutine6 & 0xFFFF
    300                
    301                // 转换低4位
    302                uint8 lowNibble = macAddr[i] & 0x0F;
    303                macStr[pos++] = (lowNibble < 10) ? ('0' + lowNibble) : ('A' + lowNibble - 10);
   \                     ??CrossCallReturnLabel_5:
   \   000098   88..         MOV       ?V0,R0
   \   00009A   12....       LCALL     ??Subroutine25_0 & 0xFFFF
    304              }
   \                     ??CrossCallReturnLabel_43:
   \   00009D   5004         JNC       ??zclZEM_event_loop_9
   \   00009F   7430         MOV       A,#0x30
   \   0000A1   8002         SJMP      ??zclZEM_event_loop_10
   \                     ??zclZEM_event_loop_9:
   \   0000A3   7437         MOV       A,#0x37
   \                     ??zclZEM_event_loop_10:
   \   0000A5   29           ADD       A,R1
   \   0000A6   F9           MOV       R1,A
   \   0000A7   AA..         MOV       R2,?V0
   \   0000A9   749A         MOV       A,#-0x66
   \   0000AB   12....       LCALL     ?XSTACK_DISP0_8
   \   0000AE   12....       LCALL     ?Subroutine18 & 0xFFFF
   \                     ??CrossCallReturnLabel_26:
   \   0000B1   24FF         ADD       A,#-0x1
   \   0000B3   1C           DEC       R4
   \   0000B4   ED           MOV       A,R5
   \   0000B5   34FF         ADDC      A,#-0x1
   \   0000B7   FD           MOV       R5,A
   \   0000B8   C3           CLR       C
   \   0000B9   9400         SUBB      A,#0x0
   \   0000BB   A2D2         MOV       C,0xD0 /* PSW */.2
   \   0000BD   65D0         XRL       A,PSW
   \   0000BF   33           RLC       A
   \   0000C0   4003         JC        $+5
   \   0000C2   02....       LJMP      ??zclZEM_event_loop_2 & 0xFFFF
    305              
    306              // 根据发送类型添加不同的固定MAC地址和格式
    307              if (sendType == 0) {
   \   0000C5   90....       MOV       DPTR,#??sendType
   \   0000C8   E0           MOVX      A,@DPTR
   \   0000C9   7037         JNZ       ??zclZEM_event_loop_11
    308                // 格式1：/设备MAC地址/0123456789abcdef/1/2/2
    309                const uint8 fixedMac1[] = "/0123456789abcdef/1/2/2";
   \   0000CB   90....       MOV       DPTR,#`?<Constant "/0123456789abcdef/1/2/2">`
   \   0000CE   741E         MOV       A,#0x1e
   \   0000D0   12....       LCALL     ?XSTACK_DISP102_8
   \   0000D3   7418         MOV       A,#0x18
   \   0000D5   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    310                for (i = 0; i < 23; i++) {
   \   0000D8   7900         MOV       R1,#0x0
    311                  macStr[pos++] = fixedMac1[i];
   \                     ??zclZEM_event_loop_12:
   \   0000DA   E9           MOV       A,R1
   \   0000DB   FA           MOV       R2,A
   \   0000DC   741E         MOV       A,#0x1e
   \   0000DE   12....       LCALL     ?XSTACK_DISP0_8
   \   0000E1   12....       LCALL     ?Subroutine15 & 0xFFFF
    312                }
   \                     ??CrossCallReturnLabel_21:
   \   0000E4   C0E0         PUSH      A
   \   0000E6   E8           MOV       A,R0
   \   0000E7   FA           MOV       R2,A
   \   0000E8   749A         MOV       A,#-0x66
   \   0000EA   12....       LCALL     ?XSTACK_DISP0_8
   \   0000ED   12....       LCALL     ?Subroutine19 & 0xFFFF
   \                     ??CrossCallReturnLabel_28:
   \   0000F0   D0E0         POP       A
   \   0000F2   F0           MOVX      @DPTR,A
   \   0000F3   08           INC       R0
   \   0000F4   09           INC       R1
   \   0000F5   E9           MOV       A,R1
   \   0000F6   C3           CLR       C
   \   0000F7   9417         SUBB      A,#0x17
   \   0000F9   40DF         JC        ??zclZEM_event_loop_12
    313                sendType = 1; // 下次发送格式2
   \   0000FB   90....       MOV       DPTR,#??sendType
   \   0000FE   7401         MOV       A,#0x1
   \   000100   806F         SJMP      ??zclZEM_event_loop_13
    314              } else if (sendType == 1) {
   \                     ??zclZEM_event_loop_11:
   \   000102   6401         XRL       A,#0x1
   \   000104   7037         JNZ       ??zclZEM_event_loop_14
    315                // 格式2：/设备MAC地址/123456789abcdef0/2/3/6
    316                const uint8 fixedMac2[] = "/123456789abcdef0/2/3/6";
   \   000106   90....       MOV       DPTR,#`?<Constant "/123456789abcdef0/2/3/6">`
   \   000109   741E         MOV       A,#0x1e
   \   00010B   12....       LCALL     ?XSTACK_DISP102_8
   \   00010E   7418         MOV       A,#0x18
   \   000110   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    317                for (i = 0; i < 23; i++) {
   \   000113   7900         MOV       R1,#0x0
    318                  macStr[pos++] = fixedMac2[i];
   \                     ??zclZEM_event_loop_15:
   \   000115   E9           MOV       A,R1
   \   000116   FA           MOV       R2,A
   \   000117   741E         MOV       A,#0x1e
   \   000119   12....       LCALL     ?XSTACK_DISP0_8
   \   00011C   12....       LCALL     ?Subroutine15 & 0xFFFF
    319                }
   \                     ??CrossCallReturnLabel_22:
   \   00011F   C0E0         PUSH      A
   \   000121   E8           MOV       A,R0
   \   000122   FA           MOV       R2,A
   \   000123   749A         MOV       A,#-0x66
   \   000125   12....       LCALL     ?XSTACK_DISP0_8
   \   000128   12....       LCALL     ?Subroutine19 & 0xFFFF
   \                     ??CrossCallReturnLabel_29:
   \   00012B   D0E0         POP       A
   \   00012D   F0           MOVX      @DPTR,A
   \   00012E   08           INC       R0
   \   00012F   09           INC       R1
   \   000130   E9           MOV       A,R1
   \   000131   C3           CLR       C
   \   000132   9417         SUBB      A,#0x17
   \   000134   40DF         JC        ??zclZEM_event_loop_15
    320                sendType = 2; // 下次发送格式3
   \   000136   90....       MOV       DPTR,#??sendType
   \   000139   7402         MOV       A,#0x2
   \   00013B   8034         SJMP      ??zclZEM_event_loop_13
    321              } else {
    322                // 格式3：/设备MAC地址/23456789abcdef01/0/220/0
    323                const uint8 fixedMac3[] = "/23456789abcdef01/0/220/0";
   \                     ??zclZEM_event_loop_14:
   \   00013D   90....       MOV       DPTR,#`?<Constant "/23456789abcdef01/0/2...">`
   \   000140   7480         MOV       A,#-0x80
   \   000142   12....       LCALL     ?XSTACK_DISP102_8
   \   000145   741A         MOV       A,#0x1a
   \   000147   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    324                for (i = 0; i < 25; i++) {
   \   00014A   7900         MOV       R1,#0x0
    325                  macStr[pos++] = fixedMac3[i];
   \                     ??zclZEM_event_loop_16:
   \   00014C   E9           MOV       A,R1
   \   00014D   FA           MOV       R2,A
   \   00014E   7480         MOV       A,#-0x80
   \   000150   12....       LCALL     ?XSTACK_DISP0_8
   \   000153   12....       LCALL     ?Subroutine15 & 0xFFFF
    326                }
   \                     ??CrossCallReturnLabel_23:
   \   000156   C0E0         PUSH      A
   \   000158   E8           MOV       A,R0
   \   000159   FA           MOV       R2,A
   \   00015A   749A         MOV       A,#-0x66
   \   00015C   12....       LCALL     ?XSTACK_DISP0_8
   \   00015F   12....       LCALL     ?Subroutine19 & 0xFFFF
   \                     ??CrossCallReturnLabel_30:
   \   000162   D0E0         POP       A
   \   000164   F0           MOVX      @DPTR,A
   \   000165   08           INC       R0
   \   000166   09           INC       R1
   \   000167   E9           MOV       A,R1
   \   000168   C3           CLR       C
   \   000169   9419         SUBB      A,#0x19
   \   00016B   40DF         JC        ??zclZEM_event_loop_16
    327                sendType = 0; // 下次发送格式1
   \   00016D   90....       MOV       DPTR,#??sendType
   \   000170   E4           CLR       A
   \                     ??zclZEM_event_loop_13:
   \   000171   F0           MOVX      @DPTR,A
    328              }
    329              
    330              // 添加换行符
    331              macStr[pos++] = '\r';
   \   000172   E8           MOV       A,R0
   \   000173   FA           MOV       R2,A
   \   000174   749A         MOV       A,#-0x66
   \   000176   12....       LCALL     ?XSTACK_DISP0_8
   \   000179   12....       LCALL     ?Subroutine17 & 0xFFFF
    332              macStr[pos++] = '\n';
   \                     ??CrossCallReturnLabel_24:
   \   00017C   749A         MOV       A,#-0x66
   \   00017E   12....       LCALL     ?XSTACK_DISP0_8
   \   000181   12....       LCALL     ?Subroutine14 & 0xFFFF
    333              
    334              // 发送到串口
    335              HalUARTWrite(HAL_UART_PORT_0, macStr, pos);
   \                     ??CrossCallReturnLabel_19:
   \   000184   749A         MOV       A,#-0x66
   \   000186   12....       LCALL     ?XSTACK_DISP101_8
   \   000189   7900         MOV       R1,#0x0
   \   00018B   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    336              
    337              // 设置下一次定时器（3秒间隔）
    338              osal_start_timerEx(zclZEM_TaskID, ZEMAPP_EVT, 2000);
   \   00018E                ; Setup parameters for call to function osal_start_timerEx
   \   00018E   90....       MOV       DPTR,#__Constant_7d0
   \   000191   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   000194   7A80         MOV       R2,#-0x80
   \   000196   7B00         MOV       R3,#0x0
   \   000198   90....       MOV       DPTR,#zclZEM_TaskID
   \   00019B   E0           MOVX      A,@DPTR
   \   00019C   F9           MOV       R1,A
   \   00019D   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   0001A0   7404         MOV       A,#0x4
   \   0001A2   12....       LCALL     ?DEALLOC_XSTACK8
    339              
    340              return (events ^ ZEMAPP_EVT);
   \   0001A5   EE           MOV       A,R6
   \   0001A6   6480         XRL       A,#0x80
   \   0001A8   FA           MOV       R2,A
   \   0001A9   EF           MOV       A,R7
   \   0001AA   02....       LJMP      ??zclZEM_event_loop_8 & 0xFFFF
    341            }
    342            
    343          #if ZG_BUILD_ENDDEVICE_TYPE    
    344            if ( events & ZEM_END_DEVICE_REJOIN_EVT )
    345            {
    346              bdb_ZedAttemptRecoverNwk();
    347              return ( events ^ ZEM_END_DEVICE_REJOIN_EVT );
    348            }
    349          #endif
    350          
    351            if ( events & ZEM_LCD_AUTO_UPDATE_EVT )
   \                     ??zclZEM_event_loop_1:
   \   0001AD   EE           MOV       A,R6
   \   0001AE   5410         ANL       A,#0x10
   \   0001B0   6005         JZ        ??zclZEM_event_loop_17
    352            {
    353              return ( events ^ ZEM_LCD_AUTO_UPDATE_EVT );
   \   0001B2   EE           MOV       A,R6
   \   0001B3   6410         XRL       A,#0x10
   \   0001B5   8008         SJMP      ??zclZEM_event_loop_18
    354            }
    355          
    356            if ( events & ZEM_KEY_AUTO_REPEAT_EVT )
   \                     ??zclZEM_event_loop_17:
   \   0001B7   EE           MOV       A,R6
   \   0001B8   5420         ANL       A,#0x20
   \   0001BA   6007         JZ        ??zclZEM_event_loop_19
    357            {
    358              return ( events ^ ZEM_KEY_AUTO_REPEAT_EVT );
   \   0001BC   EE           MOV       A,R6
   \   0001BD   6420         XRL       A,#0x20
   \                     ??zclZEM_event_loop_18:
   \   0001BF   FA           MOV       R2,A
   \   0001C0   02....       LJMP      ??zclZEM_event_loop_20 & 0xFFFF
    359            }
    360            
    361            // Broadcast event
    362            if ( events & ZEM_BROADCAST_EVT )
   \                     ??zclZEM_event_loop_19:
   \   0001C3   EF           MOV       A,R7
   \   0001C4   5410         ANL       A,#0x10
   \   0001C6   7003         JNZ       $+5
   \   0001C8   02....       LJMP      ??zclZEM_event_loop_21 & 0xFFFF
    363            {
    364              uint8 broadcastData[] = "Broadcast";
   \   0001CB   90....       MOV       DPTR,#`?<Constant "Broadcast">`
   \   0001CE   740C         MOV       A,#0xc
   \   0001D0   12....       LCALL     ?XSTACK_DISP102_8
   \   0001D3   740A         MOV       A,#0xa
   \   0001D5   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    365              zclZEM_AF_Broadcast(CLUSTER_BROADCAST, 
    366                                  sizeof(broadcastData)-1, 
    367                                  broadcastData);
   \   0001D8   7408         MOV       A,#0x8
   \   0001DA   12....       LCALL     ?XSTACK_DISP0_8
   \   0001DD   740F         MOV       A,#0xf
   \   0001DF   12....       LCALL     ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_2:
   \   0001E2   74FF         MOV       A,#-0x1
   \   0001E4   F0           MOVX      @DPTR,A
   \   0001E5   A3           INC       DPTR
   \   0001E6   F0           MOVX      @DPTR,A
   \   0001E7   7409         MOV       A,#0x9
   \   0001E9   12....       LCALL     ?XSTACK_DISP0_8
   \   0001EC   7408         MOV       A,#0x8
   \   0001EE   F0           MOVX      @DPTR,A
   \   0001EF   90....       MOV       DPTR,#??transferId_1
   \   0001F2   12....       LCALL     ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   0001F5   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   0001F8   75....       MOV       ?V2,#??transferId_1 & 0xff
   \   0001FB   75....       MOV       ?V3,#(??transferId_1 >> 8) & 0xff
   \   0001FE   78..         MOV       R0,#?V2
   \   000200   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000203   740F         MOV       A,#0xf
   \   000205   12....       LCALL     ?XSTACK_DISP100_8
   \   000208   88..         MOV       ?V2,R0
   \   00020A   89..         MOV       ?V3,R1
   \   00020C   78..         MOV       R0,#?V2
   \   00020E   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000211   75..09       MOV       ?V2,#0x9
   \   000214   75..00       MOV       ?V3,#0x0
   \   000217   78..         MOV       R0,#?V2
   \   000219   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00021C   75..01       MOV       ?V2,#0x1
   \   00021F   78..         MOV       R0,#?V2
   \   000221   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000224   7900         MOV       R1,#0x0
   \   000226   7C..         MOV       R4,#ZEM_AppEp & 0xff
   \   000228   7D..         MOV       R5,#(ZEM_AppEp >> 8) & 0xff
   \   00022A   7409         MOV       A,#0x9
   \   00022C   12....       LCALL     ?XSTACK_DISP101_8
   \   00022F   12....       LCALL     `??AF_DataRequest::?relay`; Banked call to: AF_DataRequest
   \   000232   7409         MOV       A,#0x9
   \   000234   12....       LCALL     ?DEALLOC_XSTACK8
    368              osal_start_timerEx(zclZEM_TaskID,
    369                                ZEM_BROADCAST_EVT,
    370                                ZEM_BROADCAST_PERIOD);
   \   000237                ; Setup parameters for call to function osal_start_timerEx
   \   000237   90....       MOV       DPTR,#__Constant_3e8
   \   00023A   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   00023D   7A00         MOV       R2,#0x0
   \   00023F   7B10         MOV       R3,#0x10
   \   000241   90....       MOV       DPTR,#zclZEM_TaskID
   \   000244   E0           MOVX      A,@DPTR
   \   000245   F9           MOV       R1,A
   \   000246   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   000249   7404         MOV       A,#0x4
   \   00024B   12....       LCALL     ?DEALLOC_XSTACK8
    371              return ( events ^ ZEM_BROADCAST_EVT );
   \   00024E   EE           MOV       A,R6
   \   00024F   FA           MOV       R2,A
   \   000250   EF           MOV       A,R7
   \   000251   6410         XRL       A,#0x10
   \   000253   02....       LJMP      ??zclZEM_event_loop_8 & 0xFFFF
    372            }
    373            
    374            // Groupcast event
    375            if ( events & ZEM_GROUPCAST_EVT )
   \                     ??zclZEM_event_loop_21:
   \   000256   EF           MOV       A,R7
   \   000257   5408         ANL       A,#0x8
   \   000259   7003         JNZ       $+5
   \   00025B   02....       LJMP      ??zclZEM_event_loop_22 & 0xFFFF
    376            {
    377              uint8 groupcastData[] = "Groupcast";
   \   00025E   90....       MOV       DPTR,#`?<Constant "Groupcast">`
   \   000261   740C         MOV       A,#0xc
   \   000263   12....       LCALL     ?XSTACK_DISP102_8
   \   000266   740A         MOV       A,#0xa
   \   000268   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    378              zclZEM_AF_Groupcast(GROUP_ID,
    379                                  CLUSTER_GROUPCAST,
    380                                  sizeof(groupcastData)-1, 
    381                                  groupcastData);
   \   00026B   7408         MOV       A,#0x8
   \   00026D   12....       LCALL     ?XSTACK_DISP0_8
   \   000270   7401         MOV       A,#0x1
   \   000272   12....       LCALL     ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_3:
   \   000275   7415         MOV       A,#0x15
   \   000277   F0           MOVX      @DPTR,A
   \   000278   A3           INC       DPTR
   \   000279   E4           CLR       A
   \   00027A   F0           MOVX      @DPTR,A
   \   00027B   7409         MOV       A,#0x9
   \   00027D   12....       LCALL     ?XSTACK_DISP0_8
   \   000280   7408         MOV       A,#0x8
   \   000282   F0           MOVX      @DPTR,A
   \   000283   90....       MOV       DPTR,#??transferId_2
   \   000286   12....       LCALL     ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   000289   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   00028C   75....       MOV       ?V2,#??transferId_2 & 0xff
   \   00028F   75....       MOV       ?V3,#(??transferId_2 >> 8) & 0xff
   \   000292   78..         MOV       R0,#?V2
   \   000294   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000297   740F         MOV       A,#0xf
   \   000299   12....       LCALL     ?XSTACK_DISP100_8
   \   00029C   88..         MOV       ?V2,R0
   \   00029E   89..         MOV       ?V3,R1
   \   0002A0   78..         MOV       R0,#?V2
   \   0002A2   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0002A5   75..09       MOV       ?V2,#0x9
   \   0002A8   75..00       MOV       ?V3,#0x0
   \   0002AB   78..         MOV       R0,#?V2
   \   0002AD   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0002B0   75..02       MOV       ?V2,#0x2
   \   0002B3   78..         MOV       R0,#?V2
   \   0002B5   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0002B8   7900         MOV       R1,#0x0
   \   0002BA   7C..         MOV       R4,#ZEM_AppEp & 0xff
   \   0002BC   7D..         MOV       R5,#(ZEM_AppEp >> 8) & 0xff
   \   0002BE   7409         MOV       A,#0x9
   \   0002C0   12....       LCALL     ?XSTACK_DISP101_8
   \   0002C3   12....       LCALL     `??AF_DataRequest::?relay`; Banked call to: AF_DataRequest
   \   0002C6   7409         MOV       A,#0x9
   \   0002C8   12....       LCALL     ?DEALLOC_XSTACK8
    382              osal_start_timerEx(zclZEM_TaskID,
    383                                ZEM_GROUPCAST_EVT,
    384                                ZEM_GROUPCAST_PERIOD);
   \   0002CB                ; Setup parameters for call to function osal_start_timerEx
   \   0002CB   90....       MOV       DPTR,#__Constant_3e8
   \   0002CE   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   0002D1   7A00         MOV       R2,#0x0
   \   0002D3   7B08         MOV       R3,#0x8
   \   0002D5   90....       MOV       DPTR,#zclZEM_TaskID
   \   0002D8   E0           MOVX      A,@DPTR
   \   0002D9   F9           MOV       R1,A
   \   0002DA   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   0002DD   7404         MOV       A,#0x4
   \   0002DF   12....       LCALL     ?DEALLOC_XSTACK8
    385              return ( events ^ ZEM_GROUPCAST_EVT );
   \   0002E2   EE           MOV       A,R6
   \   0002E3   FA           MOV       R2,A
   \   0002E4   EF           MOV       A,R7
   \   0002E5   6408         XRL       A,#0x8
   \   0002E7   02....       LJMP      ??zclZEM_event_loop_8 & 0xFFFF
    386            }
    387            
    388            // P2P event
    389            if ( events & ZEM_P2P_EVT )
   \                     ??zclZEM_event_loop_22:
   \   0002EA   EF           MOV       A,R7
   \   0002EB   5402         ANL       A,#0x2
   \   0002ED   7003         JNZ       $+5
   \   0002EF   02....       LJMP      ??zclZEM_event_loop_23 & 0xFFFF
    390            {
    391              // 添加调试信息，检查网络状态
    392              uint8 p2pDebugMsg[] = "ZEM_P2P_EVT processed! Network state: ";
   \   0002F2   90....       MOV       DPTR,#`?<Constant "ZEM_P2P_EVT processed...">`
   \   0002F5   7459         MOV       A,#0x59
   \   0002F7   12....       LCALL     ?XSTACK_DISP102_8
   \   0002FA   7427         MOV       A,#0x27
   \   0002FC   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    393              HalUARTWrite(HAL_UART_PORT_0, p2pDebugMsg, sizeof(p2pDebugMsg)-1);
   \   0002FF                ; Setup parameters for call to function HalUARTWrite
   \   0002FF   7C26         MOV       R4,#0x26
   \   000301   FD           MOV       R5,A
   \   000302   7459         MOV       A,#0x59
   \   000304   12....       LCALL     ?XSTACK_DISP101_8
   \   000307   7900         MOV       R1,#0x0
   \   000309   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    394              
    395              uint8 stateStr[8];
    396              // 转换网络状态为十六进制显示
    397              uint8 stateByte = devState;
   \   00030C   90....       MOV       DPTR,#devState
   \   00030F   E0           MOVX      A,@DPTR
   \   000310   12....       LCALL     ?Subroutine13 & 0xFFFF
    398              uint8 highNibble = (stateByte >> 4) & 0x0F;
    399              uint8 lowNibble = stateByte & 0x0F;
    400              stateStr[0] = (highNibble < 10) ? ('0' + highNibble) : ('A' + highNibble - 10);
   \                     ??CrossCallReturnLabel_17:
   \   000313   5004         JNC       ??zclZEM_event_loop_24
   \   000315   7430         MOV       A,#0x30
   \   000317   8002         SJMP      ??zclZEM_event_loop_25
   \                     ??zclZEM_event_loop_24:
   \   000319   7437         MOV       A,#0x37
   \                     ??zclZEM_event_loop_25:
   \   00031B   28           ADD       A,R0
   \   00031C   F8           MOV       R0,A
   \   00031D   7416         MOV       A,#0x16
   \   00031F   12....       LCALL     ?XSTACK_DISP0_8
   \   000322   E8           MOV       A,R0
   \   000323   F0           MOVX      @DPTR,A
    401              stateStr[1] = (lowNibble < 10) ? ('0' + lowNibble) : ('A' + lowNibble - 10);
   \   000324   E9           MOV       A,R1
   \   000325   C3           CLR       C
   \   000326   940A         SUBB      A,#0xa
   \   000328   5004         JNC       ??zclZEM_event_loop_26
   \   00032A   7430         MOV       A,#0x30
   \   00032C   8002         SJMP      ??zclZEM_event_loop_27
   \                     ??zclZEM_event_loop_26:
   \   00032E   7437         MOV       A,#0x37
   \                     ??zclZEM_event_loop_27:
   \   000330   29           ADD       A,R1
   \   000331   F8           MOV       R0,A
   \   000332   7417         MOV       A,#0x17
   \   000334   12....       LCALL     ?XSTACK_DISP0_8
   \   000337   E8           MOV       A,R0
   \   000338   F0           MOVX      @DPTR,A
    402              stateStr[2] = '\r';
   \   000339   7418         MOV       A,#0x18
   \   00033B   12....       LCALL     ?XSTACK_DISP0_8
   \   00033E   740D         MOV       A,#0xd
   \   000340   F0           MOVX      @DPTR,A
    403              stateStr[3] = '\n';
   \   000341   7419         MOV       A,#0x19
   \   000343   12....       LCALL     ?XSTACK_DISP0_8
   \   000346   740A         MOV       A,#0xa
   \   000348   F0           MOVX      @DPTR,A
    404              HalUARTWrite(0, stateStr, 4);
   \   000349                ; Setup parameters for call to function HalUARTWrite
   \   000349   7C04         MOV       R4,#0x4
   \   00034B   7D00         MOV       R5,#0x0
   \   00034D   7416         MOV       A,#0x16
   \   00034F   12....       LCALL     ?XSTACK_DISP101_8
   \   000352   7900         MOV       R1,#0x0
   \   000354   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    405              
    406              // 使用P2P事件发送MAC地址
    407              zclZEM_SendMACToCoordinator();
   \   000357                ; Setup parameters for call to function NLME_GetExtAddr
   \   000357   12....       LCALL     `??NLME_GetExtAddr::?relay`; Banked call to: NLME_GetExtAddr
   \   00035A   8A..         MOV       ?V4,R2
   \   00035C   8B..         MOV       ?V5,R3
   \   00035E   740C         MOV       A,#0xc
   \   000360   12....       LCALL     ?XSTACK_DISP0_8
   \   000363   7401         MOV       A,#0x1
   \   000365   F0           MOVX      @DPTR,A
   \   000366                ; Setup parameters for call to function osal_memcpy
   \   000366   75..00       MOV       ?V6,#0x0
   \   000369   78..         MOV       R0,#?V4
   \   00036B   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   00036E   7C08         MOV       R4,#0x8
   \   000370   7D00         MOV       R5,#0x0
   \   000372   7410         MOV       A,#0x10
   \   000374   12....       LCALL     ?XSTACK_DISP0_8
   \   000377   AA82         MOV       R2,DPL
   \   000379   AB83         MOV       R3,DPH
   \   00037B   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   00037E   7403         MOV       A,#0x3
   \   000380   12....       LCALL     ?DEALLOC_XSTACK8
   \   000383   7415         MOV       A,#0x15
   \   000385   12....       LCALL     ?XSTACK_DISP0_8
   \   000388   E4           CLR       A
   \   000389   F0           MOVX      @DPTR,A
   \   00038A   7408         MOV       A,#0x8
   \   00038C   12....       LCALL     ?XSTACK_DISP0_8
   \   00038F   7402         MOV       A,#0x2
   \   000391   12....       LCALL     ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   000394   E4           CLR       A
   \   000395   F0           MOVX      @DPTR,A
   \   000396   A3           INC       DPTR
   \   000397   F0           MOVX      @DPTR,A
   \   000398   7409         MOV       A,#0x9
   \   00039A   12....       LCALL     ?XSTACK_DISP0_8
   \   00039D   7408         MOV       A,#0x8
   \   00039F   F0           MOVX      @DPTR,A
   \   0003A0   90....       MOV       DPTR,#??transferId
   \   0003A3   12....       LCALL     ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_9:
   \   0003A6   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   0003A9   75....       MOV       ?V2,#??transferId & 0xff
   \   0003AC   75....       MOV       ?V3,#(??transferId >> 8) & 0xff
   \   0003AF   78..         MOV       R0,#?V2
   \   0003B1   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0003B4   740F         MOV       A,#0xf
   \   0003B6   12....       LCALL     ?XSTACK_DISP100_8
   \   0003B9   88..         MOV       ?V2,R0
   \   0003BB   89..         MOV       ?V3,R1
   \   0003BD   78..         MOV       R0,#?V2
   \   0003BF   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0003C2   75..0A       MOV       ?V2,#0xa
   \   0003C5   75..00       MOV       ?V3,#0x0
   \   0003C8   78..         MOV       R0,#?V2
   \   0003CA   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0003CD   E4           CLR       A
   \   0003CE   F5..         MOV       ?V2,A
   \   0003D0   78..         MOV       R0,#?V2
   \   0003D2   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0003D5   7900         MOV       R1,#0x0
   \   0003D7   7C..         MOV       R4,#ZEM_AppEp & 0xff
   \   0003D9   7D..         MOV       R5,#(ZEM_AppEp >> 8) & 0xff
   \   0003DB   7409         MOV       A,#0x9
   \   0003DD   12....       LCALL     ?XSTACK_DISP101_8
   \   0003E0   12....       LCALL     `??AF_DataRequest::?relay`; Banked call to: AF_DataRequest
   \   0003E3   7409         MOV       A,#0x9
   \   0003E5   12....       LCALL     ?DEALLOC_XSTACK8
   \   0003E8   90....       MOV       DPTR,#`?<Constant "MAC address sent to c...">`
   \   0003EB   7436         MOV       A,#0x36
   \   0003ED   12....       LCALL     ?XSTACK_DISP102_8
   \   0003F0   7423         MOV       A,#0x23
   \   0003F2   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
   \   0003F5                ; Setup parameters for call to function HalUARTWrite
   \   0003F5   7C22         MOV       R4,#0x22
   \   0003F7   FD           MOV       R5,A
   \   0003F8   7436         MOV       A,#0x36
   \   0003FA   12....       LCALL     ?XSTACK_DISP101_8
   \   0003FD   7900         MOV       R1,#0x0
   \   0003FF   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    408              
    409              osal_start_timerEx(zclZEM_TaskID,
    410                                ZEM_P2P_EVT,
    411                                ZEM_P2P_PERIOD);
   \   000402                ; Setup parameters for call to function osal_start_timerEx
   \   000402   90....       MOV       DPTR,#__Constant_3e8
   \   000405   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   000408   7A00         MOV       R2,#0x0
   \   00040A   7B02         MOV       R3,#0x2
   \   00040C   90....       MOV       DPTR,#zclZEM_TaskID
   \   00040F   E0           MOVX      A,@DPTR
   \   000410   F9           MOV       R1,A
   \   000411   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   000414   7404         MOV       A,#0x4
   \   000416   12....       LCALL     ?DEALLOC_XSTACK8
    412              return ( events ^ ZEM_P2P_EVT );
   \   000419   EE           MOV       A,R6
   \   00041A   FA           MOV       R2,A
   \   00041B   EF           MOV       A,R7
   \   00041C   6402         XRL       A,#0x2
   \   00041E   800F         SJMP      ??zclZEM_event_loop_8
    413            }
    414            
    415            // 网络形成重试事件
    416            if ( events & ZEM_RETRY_FORMATION_EVT )
   \                     ??zclZEM_event_loop_23:
   \   000420   EF           MOV       A,R7
   \   000421   5404         ANL       A,#0x4
   \   000423   600D         JZ        ??zclZEM_event_loop_28
    417            {
    418              
    419              // 重新调用组网函数
    420              bdb_StartCommissioning(BDB_COMMISSIONING_MODE_NWK_FORMATION |
    421                                          BDB_COMMISSIONING_MODE_FINDING_BINDING );
   \   000425                ; Setup parameters for call to function bdb_StartCommissioning
   \   000425   790C         MOV       R1,#0xc
   \   000427   12....       LCALL     `??bdb_StartCommissioning::?relay`; Banked call to: bdb_StartCommissioning
    422              return ( events ^ ZEM_RETRY_FORMATION_EVT );
   \   00042A   EE           MOV       A,R6
   \   00042B   FA           MOV       R2,A
   \   00042C   EF           MOV       A,R7
   \   00042D   6404         XRL       A,#0x4
   \                     ??zclZEM_event_loop_8:
   \   00042F   FB           MOV       R3,A
   \   000430   8004         SJMP      ??zclZEM_event_loop_20
    423            }
    424            #ifndef ZDO_COORDINATOR
    425              if ( events & ZEM_REJOIN_EVT )//如果事件类型为重新加入网络事件
    426              {
    427                  // 添加调试信息
    428                  uint8 rejoinMsg[] = "ZEM_REJOIN_EVT processed! Starting network steering...\r\n";
    429                  HalUARTWrite(HAL_UART_PORT_0, rejoinMsg, sizeof(rejoinMsg)-1);
    430                  
    431                  // 重新加入网络
    432                  bdb_StartCommissioning(BDB_COMMISSIONING_MODE_NWK_STEERING |
    433                                              BDB_COMMISSIONING_MODE_FINDING_BINDING );
    434                return ( events ^ ZEM_REJOIN_EVT );
    435              }
    436            #endif
    437          
    438            // Discard unknown events
    439            return 0;
   \                     ??zclZEM_event_loop_28:
   \   000432   7A00         MOV       R2,#0x0
   \   000434   7B00         MOV       R3,#0x0
   \                     ??zclZEM_event_loop_20:
   \   000436   74FE         MOV       A,#-0x2
   \   000438   12....       LCALL     ?DEALLOC_XSTACK8
   \   00043B   7F07         MOV       R7,#0x7
   \   00043D   02....       LJMP      ?BANKED_LEAVE_XDATA
    440          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine19:
   \   000000   12....       LCALL     ?Subroutine22 & 0xFFFF
   \                     ??CrossCallReturnLabel_42:
   \   000003   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine22:
   \   000000   E582         MOV       A,DPL
   \   000002   2A           ADD       A,R2
   \   000003                REQUIRE ??Subroutine24_0
   \   000003                ; // Fall through to label ??Subroutine24_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine24_0:
   \   000000   F582         MOV       DPL,A
   \   000002   E4           CLR       A
   \   000003   3583         ADDC      A,DPH
   \   000005   F583         MOV       DPH,A
   \   000007   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine15:
   \   000000   12....       LCALL     ?Subroutine22 & 0xFFFF
   \                     ??CrossCallReturnLabel_39:
   \   000003   E0           MOVX      A,@DPTR
   \   000004   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine18:
   \   000000   12....       LCALL     ?Subroutine22 & 0xFFFF
   \                     ??CrossCallReturnLabel_41:
   \   000003   E9           MOV       A,R1
   \   000004   F0           MOVX      @DPTR,A
   \   000005   EC           MOV       A,R4
   \   000006   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine17:
   \   000000   12....       LCALL     ?Subroutine22 & 0xFFFF
   \                     ??CrossCallReturnLabel_40:
   \   000003   740D         MOV       A,#0xd
   \   000005   F0           MOVX      @DPTR,A
   \   000006   08           INC       R0
   \   000007   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine16:
   \   000000   88..         MOV       ?V1,R0
   \   000002                REQUIRE ??Subroutine25_0
   \   000002                ; // Fall through to label ??Subroutine25_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine25_0:
   \   000000   7401         MOV       A,#0x1
   \   000002   28           ADD       A,R0
   \   000003   F8           MOV       R0,A
   \   000004   E9           MOV       A,R1
   \   000005   C3           CLR       C
   \   000006   940A         SUBB      A,#0xa
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine14:
   \   000000   E582         MOV       A,DPL
   \   000002   28           ADD       A,R0
   \   000003   12....       LCALL     ??Subroutine24_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_38:
   \   000006   740A         MOV       A,#0xa
   \   000008   F0           MOVX      @DPTR,A
   \   000009                ; Setup parameters for call to function HalUARTWrite
   \   000009                ; Setup parameters for call to function HalUARTWrite
   \   000009   7401         MOV       A,#0x1
   \   00000B   28           ADD       A,R0
   \   00000C   FC           MOV       R4,A
   \   00000D   7D00         MOV       R5,#0x0
   \   00000F   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   F0           MOVX      @DPTR,A
   \   000001   8A82         MOV       DPL,R2
   \   000003   8B83         MOV       DPH,R3
   \   000005   E0           MOVX      A,@DPTR
   \   000006   540F         ANL       A,#0xf
   \   000008   F9           MOV       R1,A
   \   000009   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine13:
   \   000000   12....       LCALL     ?Subroutine21 & 0xFFFF
   \                     ??CrossCallReturnLabel_33:
   \   000003   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine21:
   \   000000   F9           MOV       R1,A
   \   000001   C4           SWAP      A
   \   000002   540F         ANL       A,#0xf
   \   000004   F8           MOV       R0,A
   \   000005   740F         MOV       A,#0xf
   \   000007   59           ANL       A,R1
   \   000008   F9           MOV       R1,A
   \   000009   E8           MOV       A,R0
   \   00000A   C3           CLR       C
   \   00000B   940A         SUBB      A,#0xa
   \   00000D   22           RET

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   \                     ??sendType:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    441          
    442          /*********************************************************************
    443           * @fn      zclZEM_InitUart
    444           *
    445           * @brief   Initialize UART for communication
    446           *
    447           * @param   none
    448           *
    449           * @return  none
    450           */
    451          static void zclZEM_InitUart(void)
    452          {
    453            // 统一使用协调器的UART引脚配置（P1.4/P1.5）
    454            /********** 1. 配置UART0的P1.4/P1.5和PERCFG寄存器 **********/
    455            // PERCFG的bit0(U0CFG)设置为1：UART0映射到Alternative 2位置(P1.4/P1.5)
    456            PERCFG |= (1 << 0);  // 配置PERCFG |= 0x01来设置相应的bit0
    457          
    458            /********** 2. 配置P1.4/P1.5为UART0功能和P1端口寄存器 **********/
    459            // P1SEL的bit4(P1.4)和bit5(P1.5)设置为1：配置为外设功能(UART)
    460            P1SEL |= (1 << 4) | (1 << 5);  // 配置P1SEL |= 0x30(00110000)
    461            // P1DIR的bit4(P1.4=TX)设置为1：输出；bit5(P1.5=RX)设置为0：输入
    462            P1DIR |= (1 << 4);   // P1.4(TX)作为输出
    463            P1DIR &= ~(1 << 5);  // P1.5(RX)作为输入
    464          
    465            halUARTCfg_t uartConfig;
    466            /* UART Configuration */
    467            uartConfig.configured          = TRUE;      // Enable configuration
    468            uartConfig.baudRate            = HAL_UART_BR_115200;  // Baud rate
    469            uartConfig.flowControl         = FALSE;     // Disable hardware flow control
    470            uartConfig.flowControlThreshold= 0;         // Flow control threshold
    471            uartConfig.rx.maxBufSize       = ZCLZEM_UART_BUF_LEN;  // Receive buffer size
    472            uartConfig.tx.maxBufSize       = 0;         // Transmit buffer size
    473            uartConfig.idleTimeout         = 6;         // Default timeout
    474            uartConfig.intEnable           = TRUE;      // Enable interrupt
    475            uartConfig.callBackFunc        = zclZEM_UartCB;  // Set callback function
    476            /* Start UART */
    477            // 统一使用UART0端口（协调器配置）
    478            HalUARTOpen(HAL_UART_PORT_0, &uartConfig);  // Open UART0 with configuration
    479          }
    480          
    481          
    482          void zclZEM_SendMACToCoordinator(void)
    483          {
    484            uint8* macAddr;
    485            uint8 macData[10]; // MAC地址数据包：1字节类型标识 + 8字节MAC地址 + 1字节结束符
    486            
    487            // 读取MAC地址
    488            macAddr = NLME_GetExtAddr();
    489            
    490            // 构建数据包
    491            macData[0] = 0x01; // 类型标识：MAC地址数据
    492            osal_memcpy(&macData[1], macAddr, 8); // 复制MAC地址
    493            macData[9] = 0x00; // 结束符
    494            
    495            // 向协调器发送数据（协调器网络地址通常为0x0000）
    496            zclZEM_AF_P2P(0x0000, // 协调器网络地址
    497                          CLUSTER_P2P, // 使用点对点集群
    498                          10, // 数据长度
    499                          macData); // 数据内容
    500            
    501            // 同时通过串口显示发送信息
    502            uint8 sendMsg[] = "MAC address sent to coordinator!\r\n";
    503            HalUARTWrite(HAL_UART_PORT_0, sendMsg, sizeof(sendMsg)-1);
    504          }
    505          
    506          /*********************************************************************
    507           * @fn      zclZEM_ReadAndSendMAC
    508           *
    509           * @brief   Read MAC address and send it via UART
    510           *
    511           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    512          void zclZEM_ReadAndSendMAC(void)
   \                     zclZEM_ReadAndSendMAC:
    513          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000   74F4         MOV       A,#-0xc
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 56
   \   000005   74C8         MOV       A,#-0x38
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
    514            uint8* macAddr;
    515            uint8 macStr[50]; // 足够存储MAC地址字符串
    516            uint8 i, pos = 0;
    517            
    518            // Read MAC address from system
    519            macAddr = NLME_GetExtAddr();
   \   00000A                ; Setup parameters for call to function NLME_GetExtAddr
   \   00000A   12....       LCALL     `??NLME_GetExtAddr::?relay`; Banked call to: NLME_GetExtAddr
   \   00000D   8A..         MOV       ?V0,R2
   \   00000F   8B..         MOV       ?V1,R3
   \   000011   AE..         MOV       R6,?V0
   \   000013   AF..         MOV       R7,?V1
    520            
    521            // 手动构建MAC地址字符串
    522            const uint8 header[] = "MAC: ";
   \   000015   90....       MOV       DPTR,#`?<Constant "MAC: ">`
   \   000018   AC..         MOV       R4,?XSP + 0
   \   00001A   AD..         MOV       R5,?XSP + 1
   \   00001C   7406         MOV       A,#0x6
   \   00001E   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    523            osal_memcpy(macStr, header, 4);
   \   000021                ; Setup parameters for call to function osal_memcpy
   \   000021   A8..         MOV       R0,?XSP + 0
   \   000023   A9..         MOV       R1,?XSP + 1
   \   000025   88..         MOV       ?V0,R0
   \   000027   89..         MOV       ?V1,R1
   \   000029   F5..         MOV       ?V2,A
   \   00002B   78..         MOV       R0,#?V0
   \   00002D   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   000030   7C04         MOV       R4,#0x4
   \   000032   7D00         MOV       R5,#0x0
   \   000034   7409         MOV       A,#0x9
   \   000036   12....       LCALL     ?XSTACK_DISP101_8
   \   000039   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   00003C   7403         MOV       A,#0x3
   \   00003E   12....       LCALL     ?DEALLOC_XSTACK8
    524            pos = 4;
   \   000041   7804         MOV       R0,#0x4
    525            
    526            // 添加MAC地址字节，格式化为十六进制
    527            for (i = 0; i < 8; i++) {
   \   000043   7C00         MOV       R4,#0x0
    528              // 转换高4位
    529              uint8 highNibble = (macAddr[i] >> 4) & 0x0F;
   \                     ??zclZEM_ReadAndSendMAC_0:
   \   000045   EC           MOV       A,R4
   \   000046   FA           MOV       R2,A
   \   000047   EE           MOV       A,R6
   \   000048   2A           ADD       A,R2
   \   000049   FA           MOV       R2,A
   \   00004A   E4           CLR       A
   \   00004B   3F           ADDC      A,R7
   \   00004C   FB           MOV       R3,A
   \   00004D   8A82         MOV       DPL,R2
   \   00004F   8B83         MOV       DPH,R3
   \   000051   E0           MOVX      A,@DPTR
   \   000052   C4           SWAP      A
   \   000053   540F         ANL       A,#0xf
   \   000055   F9           MOV       R1,A
    530              macStr[pos++] = (highNibble < 10) ? ('0' + highNibble) : ('A' + highNibble - 10);
   \   000056   88..         MOV       ?V0,R0
   \   000058   12....       LCALL     ??Subroutine25_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_44:
   \   00005B   5004         JNC       ??zclZEM_ReadAndSendMAC_1
   \   00005D   7430         MOV       A,#0x30
   \   00005F   8002         SJMP      ??zclZEM_ReadAndSendMAC_2
   \                     ??zclZEM_ReadAndSendMAC_1:
   \   000061   7437         MOV       A,#0x37
   \                     ??zclZEM_ReadAndSendMAC_2:
   \   000063   29           ADD       A,R1
   \   000064   C0E0         PUSH      A
   \   000066   E5..         MOV       A,?V0
   \   000068   F5..         MOV       ?V2,A
   \   00006A   7406         MOV       A,#0x6
   \   00006C   12....       LCALL     ?XSTACK_DISP0_8
   \   00006F   E582         MOV       A,DPL
   \   000071   25..         ADD       A,?V2
   \   000073   12....       LCALL     ??Subroutine24_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_36:
   \   000076   D0E0         POP       A
   \   000078   12....       LCALL     ?Subroutine6 & 0xFFFF
    531              
    532              // 转换低4位
    533              uint8 lowNibble = macAddr[i] & 0x0F;
    534              macStr[pos++] = (lowNibble < 10) ? ('0' + lowNibble) : ('A' + lowNibble - 10);
   \                     ??CrossCallReturnLabel_6:
   \   00007B   12....       LCALL     ?Subroutine16 & 0xFFFF
   \                     ??CrossCallReturnLabel_46:
   \   00007E   5004         JNC       ??zclZEM_ReadAndSendMAC_3
   \   000080   7430         MOV       A,#0x30
   \   000082   8002         SJMP      ??zclZEM_ReadAndSendMAC_4
   \                     ??zclZEM_ReadAndSendMAC_3:
   \   000084   7437         MOV       A,#0x37
   \                     ??zclZEM_ReadAndSendMAC_4:
   \   000086   29           ADD       A,R1
   \   000087   F9           MOV       R1,A
   \   000088   AA..         MOV       R2,?V1
   \   00008A   7406         MOV       A,#0x6
   \   00008C   12....       LCALL     ?XSTACK_DISP0_8
   \   00008F   12....       LCALL     ?Subroutine18 & 0xFFFF
    535              
    536              // 添加冒号分隔符（最后一个字节后不加）
    537              if (i < 7) {
   \                     ??CrossCallReturnLabel_27:
   \   000092   C3           CLR       C
   \   000093   9407         SUBB      A,#0x7
   \   000095   500F         JNC       ??zclZEM_ReadAndSendMAC_5
    538                macStr[pos++] = ':';
   \   000097   7406         MOV       A,#0x6
   \   000099   12....       LCALL     ?XSTACK_DISP0_8
   \   00009C   E582         MOV       A,DPL
   \   00009E   28           ADD       A,R0
   \   00009F   12....       LCALL     ??Subroutine24_0 & 0xFFFF
    539              }
    540            }
   \                     ??CrossCallReturnLabel_37:
   \   0000A2   743A         MOV       A,#0x3a
   \   0000A4   F0           MOVX      @DPTR,A
   \   0000A5   08           INC       R0
   \                     ??zclZEM_ReadAndSendMAC_5:
   \   0000A6   0C           INC       R4
   \   0000A7   EC           MOV       A,R4
   \   0000A8   C3           CLR       C
   \   0000A9   9408         SUBB      A,#0x8
   \   0000AB   4098         JC        ??zclZEM_ReadAndSendMAC_0
    541            
    542            // 添加换行符
    543            macStr[pos++] = '\r';
   \   0000AD   E8           MOV       A,R0
   \   0000AE   FA           MOV       R2,A
   \   0000AF   7406         MOV       A,#0x6
   \   0000B1   12....       LCALL     ?XSTACK_DISP0_8
   \   0000B4   12....       LCALL     ?Subroutine17 & 0xFFFF
    544            macStr[pos++] = '\n';
   \                     ??CrossCallReturnLabel_25:
   \   0000B7   7406         MOV       A,#0x6
   \   0000B9   12....       LCALL     ?XSTACK_DISP0_8
   \   0000BC   12....       LCALL     ?Subroutine14 & 0xFFFF
    545            
    546            // Send MAC address via UART
    547            // 统一使用UART0端口（协调器配置）
    548            HalUARTWrite(HAL_UART_PORT_0, macStr, pos);
   \                     ??CrossCallReturnLabel_20:
   \   0000BF   7406         MOV       A,#0x6
   \   0000C1   12....       LCALL     ?XSTACK_DISP101_8
   \   0000C4   7900         MOV       R1,#0x0
   \   0000C6   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    549          }
   \   0000C9   7438         MOV       A,#0x38
   \   0000CB   12....       LCALL     ?DEALLOC_XSTACK8
   \   0000CE   7F04         MOV       R7,#0x4
   \   0000D0   02....       LJMP      ?BANKED_LEAVE_XDATA
    550          
    551          /*********************************************************************
    552           * @fn      zclZEM_UartCB
    553           *
    554           * @brief   UART callback function
    555           *
    556           * @param   port - UART port
    557           * @param   event - UART event
    558           *
    559           * @return  none
    560           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    561          static void zclZEM_UartCB(uint8 port, uint8 event)
   \                     zclZEM_UartCB:
    562          {
   \   000000   74F7         MOV       A,#-0x9
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    563            // 获取当前串口接收缓冲区有多少字节的数据
    564            uint8 rxLen = Hal_UART_RxBufLen(HAL_UART_PORT_0); 
   \   000005                ; Setup parameters for call to function Hal_UART_RxBufLen
   \   000005   7900         MOV       R1,#0x0
   \   000007   12....       LCALL     `??Hal_UART_RxBufLen::?relay`; Banked call to: Hal_UART_RxBufLen
   \   00000A   EA           MOV       A,R2
    565            if(rxLen != 0) // 如果字节数数量不等于0 
   \   00000B   601A         JZ        ??zclZEM_UartCB_0
    566            {
    567              // 从串口缓冲区中读取数据
    568              HalUARTRead(HAL_UART_PORT_0, zclZEM_UartBuf, rxLen);
   \   00000D   FE           MOV       R6,A
   \   00000E                ; Setup parameters for call to function HalUARTRead
   \   00000E   FC           MOV       R4,A
   \   00000F   7D00         MOV       R5,#0x0
   \   000011   7A..         MOV       R2,#zclZEM_UartBuf & 0xff
   \   000013   7B..         MOV       R3,#(zclZEM_UartBuf >> 8) & 0xff
   \   000015   7900         MOV       R1,#0x0
   \   000017   12....       LCALL     `??HalUARTRead::?relay`; Banked call to: HalUARTRead
    569              // 通过串口发送数据，例如把数据发送到串口助手
    570              HalUARTWrite(HAL_UART_PORT_0, zclZEM_UartBuf, rxLen);  
   \   00001A                ; Setup parameters for call to function HalUARTWrite
   \   00001A   EE           MOV       A,R6
   \   00001B   FC           MOV       R4,A
   \   00001C   7D00         MOV       R5,#0x0
   \   00001E   7A..         MOV       R2,#zclZEM_UartBuf & 0xff
   \   000020   7B..         MOV       R3,#(zclZEM_UartBuf >> 8) & 0xff
   \   000022   7900         MOV       R1,#0x0
   \   000024   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    571            }
    572          }
   \                     ??zclZEM_UartCB_0:
   \   000027                REQUIRE ?Subroutine1
   \   000027                ; // Fall through to label ?Subroutine1

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7F01         MOV       R7,#0x1
   \   000002   02....       LJMP      ?BANKED_LEAVE_XDATA
    573          
    574          /*********************************************************************
    575           * @fn      zclZEM_HandleKeys
    576           *
    577           * @brief   Handles all key events for this device.
    578           *
    579           * @param   shift - true if in shift/alt.
    580           * @param   keys - bit field for key events. Valid entries:
    581           *                 HAL_KEY_SW_5
    582           *                 HAL_KEY_SW_4
    583           *                 HAL_KEY_SW_3
    584           *                 HAL_KEY_SW_2
    585           *                 HAL_KEY_SW_1
    586           *
    587           * @return  none
    588           */
    589          static void zclZEM_HandleKeys( byte shift, byte keys )
    590          {
    591          }
    592          
    593          /*********************************************************************
    594           * @fn      zclZEM_LcdDisplayMainMode
    595           *
    596           * @brief   Called to display the main screen on the LCD.
    597           *
    598           * @param   none
    599           *
    600           * @return  none
    601           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    602          static void zclZEM_ProcessCommissioningStatus(bdbCommissioningModeMsg_t* bdbCommissioningModeMsg)
   \                     zclZEM_ProcessCommissioningStatus:
    603          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV       A,#-0xa
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 112
   \   000005   7490         MOV       A,#-0x70
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
    604              switch(bdbCommissioningModeMsg->bdbCommissioningMode)
   \   00000A   8A82         MOV       DPL,R2
   \   00000C   8B83         MOV       DPH,R3
   \   00000E   A3           INC       DPTR
   \   00000F   E0           MOVX      A,@DPTR
   \   000010   6402         XRL       A,#0x2
   \   000012   6003         JZ        $+5
   \   000014   02....       LJMP      ??zclZEM_ProcessCommissioningStatus_0 & 0xFFFF
    605              {
    606                case BDB_COMMISSIONING_FORMATION:
    607                  if(bdbCommissioningModeMsg->bdbCommissioningStatus == BDB_COMMISSIONING_SUCCESS)
   \   000017   8A82         MOV       DPL,R2
   \   000019   8B83         MOV       DPH,R3
   \   00001B   E0           MOVX      A,@DPTR
   \   00001C   6003         JZ        $+5
   \   00001E   02....       LJMP      ??zclZEM_ProcessCommissioningStatus_1 & 0xFFFF
    608                  {
    609                    //After formation, perform nwk steering again plus the remaining commissioning modes that has not been process yet
    610                    bdb_StartCommissioning(BDB_COMMISSIONING_MODE_NWK_STEERING | bdbCommissioningModeMsg->bdbRemainingCommissioningModes);
   \   000021                ; Setup parameters for call to function bdb_StartCommissioning
   \   000021   A3           INC       DPTR
   \   000022   A3           INC       DPTR
   \   000023   E0           MOVX      A,@DPTR
   \   000024   4402         ORL       A,#0x2
   \   000026   F9           MOV       R1,A
   \   000027   12....       LCALL     `??bdb_StartCommissioning::?relay`; Banked call to: bdb_StartCommissioning
    611                    // 网络形成成功
    612                    #ifdef ZDO_COORDINATOR
    613                    uint8 successMsg[] = "Network formation successful! PANID: ";
   \   00002A   90....       MOV       DPTR,#`?<Constant "Network formation suc...">`
   \   00002D   744A         MOV       A,#0x4a
   \   00002F   12....       LCALL     ?XSTACK_DISP102_8
   \   000032   7426         MOV       A,#0x26
   \   000034   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    614                    HalUARTWrite(HAL_UART_PORT_0, successMsg, sizeof(successMsg)-1);
   \   000037                ; Setup parameters for call to function HalUARTWrite
   \   000037   7C25         MOV       R4,#0x25
   \   000039   FD           MOV       R5,A
   \   00003A   744A         MOV       A,#0x4a
   \   00003C   12....       LCALL     ?XSTACK_DISP101_8
   \   00003F   7900         MOV       R1,#0x0
   \   000041   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    615                    
    616                    // 打印PANID（十六进制格式）
    617                    uint8 panidStr[8];
    618                    uint16 panId = _NIB.nwkPanId;
   \   000044   90....       MOV       DPTR,#_NIB + 33
   \   000047   E0           MOVX      A,@DPTR
   \   000048   FA           MOV       R2,A
   \   000049   A3           INC       DPTR
   \   00004A   E0           MOVX      A,@DPTR
    619                    
    620                    // 转换高字节
    621                    uint8 highByte = (panId >> 8) & 0xFF;
   \   00004B   F8           MOV       R0,A
    622                    uint8 highNibbleH = (highByte >> 4) & 0x0F;
   \   00004C   C4           SWAP      A
   \   00004D   540F         ANL       A,#0xf
   \   00004F   F9           MOV       R1,A
    623                    uint8 lowNibbleH = highByte & 0x0F;
   \   000050   740F         MOV       A,#0xf
   \   000052   58           ANL       A,R0
   \   000053   F8           MOV       R0,A
    624                    panidStr[0] = (highNibbleH < 10) ? ('0' + highNibbleH) : ('A' + highNibbleH - 10);
   \   000054   E9           MOV       A,R1
   \   000055   C3           CLR       C
   \   000056   940A         SUBB      A,#0xa
   \   000058   5004         JNC       ??zclZEM_ProcessCommissioningStatus_2
   \   00005A   7430         MOV       A,#0x30
   \   00005C   8002         SJMP      ??zclZEM_ProcessCommissioningStatus_3
   \                     ??zclZEM_ProcessCommissioningStatus_2:
   \   00005E   7437         MOV       A,#0x37
   \                     ??zclZEM_ProcessCommissioningStatus_3:
   \   000060   29           ADD       A,R1
   \   000061   C0E0         PUSH      A
   \   000063   7406         MOV       A,#0x6
   \   000065   12....       LCALL     ?XSTACK_DISP0_8
   \   000068   D0E0         POP       A
   \   00006A   F0           MOVX      @DPTR,A
    625                    panidStr[1] = (lowNibbleH < 10) ? ('0' + lowNibbleH) : ('A' + lowNibbleH - 10);
   \   00006B   E8           MOV       A,R0
   \   00006C   C3           CLR       C
   \   00006D   940A         SUBB      A,#0xa
   \   00006F   5004         JNC       ??zclZEM_ProcessCommissioningStatus_4
   \   000071   7430         MOV       A,#0x30
   \   000073   8002         SJMP      ??zclZEM_ProcessCommissioningStatus_5
   \                     ??zclZEM_ProcessCommissioningStatus_4:
   \   000075   7437         MOV       A,#0x37
   \                     ??zclZEM_ProcessCommissioningStatus_5:
   \   000077   28           ADD       A,R0
   \   000078   F8           MOV       R0,A
   \   000079   7407         MOV       A,#0x7
   \   00007B   12....       LCALL     ?XSTACK_DISP0_8
   \   00007E   12....       LCALL     ?Subroutine4 & 0xFFFF
    626                    
    627                    // 转换低字节
    628                    uint8 lowByte = panId & 0xFF;
    629                    uint8 highNibbleL = (lowByte >> 4) & 0x0F;
    630                    uint8 lowNibbleL = lowByte & 0x0F;
    631                    panidStr[2] = (highNibbleL < 10) ? ('0' + highNibbleL) : ('A' + highNibbleL - 10);
   \                     ??CrossCallReturnLabel_0:
   \   000081   5004         JNC       ??zclZEM_ProcessCommissioningStatus_6
   \   000083   7430         MOV       A,#0x30
   \   000085   8002         SJMP      ??zclZEM_ProcessCommissioningStatus_7
   \                     ??zclZEM_ProcessCommissioningStatus_6:
   \   000087   7437         MOV       A,#0x37
   \                     ??zclZEM_ProcessCommissioningStatus_7:
   \   000089   28           ADD       A,R0
   \   00008A   F8           MOV       R0,A
   \   00008B   7408         MOV       A,#0x8
   \   00008D   12....       LCALL     ?XSTACK_DISP0_8
   \   000090   E8           MOV       A,R0
   \   000091   F0           MOVX      @DPTR,A
    632                    panidStr[3] = (lowNibbleL < 10) ? ('0' + lowNibbleL) : ('A' + lowNibbleL - 10);
   \   000092   E9           MOV       A,R1
   \   000093   C3           CLR       C
   \   000094   940A         SUBB      A,#0xa
   \   000096   5004         JNC       ??zclZEM_ProcessCommissioningStatus_8
   \   000098   7430         MOV       A,#0x30
   \   00009A   8002         SJMP      ??zclZEM_ProcessCommissioningStatus_9
   \                     ??zclZEM_ProcessCommissioningStatus_8:
   \   00009C   7437         MOV       A,#0x37
   \                     ??zclZEM_ProcessCommissioningStatus_9:
   \   00009E   29           ADD       A,R1
   \   00009F   F8           MOV       R0,A
   \   0000A0   7409         MOV       A,#0x9
   \   0000A2   12....       LCALL     ?XSTACK_DISP0_8
   \   0000A5   E8           MOV       A,R0
   \   0000A6   F0           MOVX      @DPTR,A
    633                    
    634                    panidStr[4] = '\r';
   \   0000A7   740A         MOV       A,#0xa
   \   0000A9   12....       LCALL     ?XSTACK_DISP0_8
   \   0000AC   740D         MOV       A,#0xd
   \   0000AE   F0           MOVX      @DPTR,A
    635                    panidStr[5] = '\n';
   \   0000AF   740B         MOV       A,#0xb
   \   0000B1   12....       LCALL     ?XSTACK_DISP0_8
   \   0000B4   740A         MOV       A,#0xa
   \   0000B6   F0           MOVX      @DPTR,A
    636                    HalUARTWrite(0, panidStr, 6);
   \   0000B7                ; Setup parameters for call to function HalUARTWrite
   \   0000B7   7C06         MOV       R4,#0x6
   \   0000B9   7D00         MOV       R5,#0x0
   \   0000BB   EC           MOV       A,R4
   \   0000BC   12....       LCALL     ?XSTACK_DISP101_8
   \   0000BF   7900         MOV       R1,#0x0
   \   0000C1   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    637                    
    638                    // 打印网络地址（十六进制格式）
    639                    uint8 nwkAddrMsg[] = "Network Address: 0x";
   \   0000C4   90....       MOV       DPTR,#`?<Constant "Network Address: 0x">`
   \   0000C7   7436         MOV       A,#0x36
   \   0000C9   12....       LCALL     ?XSTACK_DISP102_8
   \   0000CC   7414         MOV       A,#0x14
   \   0000CE   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    640                    HalUARTWrite(HAL_UART_PORT_0, nwkAddrMsg, sizeof(nwkAddrMsg)-1);
   \   0000D1                ; Setup parameters for call to function HalUARTWrite
   \   0000D1   7C13         MOV       R4,#0x13
   \   0000D3   FD           MOV       R5,A
   \   0000D4   7436         MOV       A,#0x36
   \   0000D6   12....       LCALL     ?XSTACK_DISP101_8
   \   0000D9   7900         MOV       R1,#0x0
   \   0000DB   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    641                    
    642                    uint16 nwkAddr = NLME_GetShortAddr(); // 获取协调器的网络地址
   \   0000DE                ; Setup parameters for call to function NLME_GetShortAddr
   \   0000DE   12....       LCALL     `??NLME_GetShortAddr::?relay`; Banked call to: NLME_GetShortAddr
    643                    uint8 nwkAddrStr[6];
    644                    
    645                    // 转换高字节
    646                    uint8 nwkHighByte = (nwkAddr >> 8) & 0xFF;
   \   0000E1   EB           MOV       A,R3
   \   0000E2   12....       LCALL     ?Subroutine13 & 0xFFFF
    647                    uint8 nwkHighNibbleH = (nwkHighByte >> 4) & 0x0F;
    648                    uint8 nwkLowNibbleH = nwkHighByte & 0x0F;
    649                    nwkAddrStr[0] = (nwkHighNibbleH < 10) ? ('0' + nwkHighNibbleH) : ('A' + nwkHighNibbleH - 10);
   \                     ??CrossCallReturnLabel_18:
   \   0000E5   5004         JNC       ??zclZEM_ProcessCommissioningStatus_10
   \   0000E7   7430         MOV       A,#0x30
   \   0000E9   8002         SJMP      ??zclZEM_ProcessCommissioningStatus_11
   \                     ??zclZEM_ProcessCommissioningStatus_10:
   \   0000EB   7437         MOV       A,#0x37
   \                     ??zclZEM_ProcessCommissioningStatus_11:
   \   0000ED   28           ADD       A,R0
   \   0000EE   F8           MOV       R0,A
   \   0000EF   E8           MOV       A,R0
   \   0000F0   85..82       MOV       DPL,?XSP + 0
   \   0000F3   85..83       MOV       DPH,?XSP + 1
   \   0000F6   F0           MOVX      @DPTR,A
    650                    nwkAddrStr[1] = (nwkLowNibbleH < 10) ? ('0' + nwkLowNibbleH) : ('A' + nwkLowNibbleH - 10);
   \   0000F7   E9           MOV       A,R1
   \   0000F8   940A         SUBB      A,#0xa
   \   0000FA   5004         JNC       ??zclZEM_ProcessCommissioningStatus_12
   \   0000FC   7430         MOV       A,#0x30
   \   0000FE   8002         SJMP      ??zclZEM_ProcessCommissioningStatus_13
   \                     ??zclZEM_ProcessCommissioningStatus_12:
   \   000100   7437         MOV       A,#0x37
   \                     ??zclZEM_ProcessCommissioningStatus_13:
   \   000102   29           ADD       A,R1
   \   000103   F8           MOV       R0,A
   \   000104   7401         MOV       A,#0x1
   \   000106   12....       LCALL     ?XSTACK_DISP0_8
   \   000109   12....       LCALL     ?Subroutine4 & 0xFFFF
    651                    
    652                    // 转换低字节
    653                    uint8 nwkLowByte = nwkAddr & 0xFF;
    654                    uint8 nwkHighNibbleL = (nwkLowByte >> 4) & 0x0F;
    655                    uint8 nwkLowNibbleL = nwkLowByte & 0x0F;
    656                    nwkAddrStr[2] = (nwkHighNibbleL < 10) ? ('0' + nwkHighNibbleL) : ('A' + nwkHighNibbleL - 10);
   \                     ??CrossCallReturnLabel_1:
   \   00010C   5004         JNC       ??zclZEM_ProcessCommissioningStatus_14
   \   00010E   7430         MOV       A,#0x30
   \   000110   8002         SJMP      ??zclZEM_ProcessCommissioningStatus_15
   \                     ??zclZEM_ProcessCommissioningStatus_14:
   \   000112   7437         MOV       A,#0x37
   \                     ??zclZEM_ProcessCommissioningStatus_15:
   \   000114   28           ADD       A,R0
   \   000115   F8           MOV       R0,A
   \   000116   7402         MOV       A,#0x2
   \   000118   12....       LCALL     ?XSTACK_DISP0_8
   \   00011B   E8           MOV       A,R0
   \   00011C   F0           MOVX      @DPTR,A
    657                    nwkAddrStr[3] = (nwkLowNibbleL < 10) ? ('0' + nwkLowNibbleL) : ('A' + nwkLowNibbleL - 10);
   \   00011D   E9           MOV       A,R1
   \   00011E   C3           CLR       C
   \   00011F   940A         SUBB      A,#0xa
   \   000121   5004         JNC       ??zclZEM_ProcessCommissioningStatus_16
   \   000123   7430         MOV       A,#0x30
   \   000125   8002         SJMP      ??zclZEM_ProcessCommissioningStatus_17
   \                     ??zclZEM_ProcessCommissioningStatus_16:
   \   000127   7437         MOV       A,#0x37
   \                     ??zclZEM_ProcessCommissioningStatus_17:
   \   000129   29           ADD       A,R1
   \   00012A   F8           MOV       R0,A
   \   00012B   7403         MOV       A,#0x3
   \   00012D   12....       LCALL     ?XSTACK_DISP0_8
   \   000130   E8           MOV       A,R0
   \   000131   F0           MOVX      @DPTR,A
    658                    
    659                    nwkAddrStr[4] = '\r';
   \   000132   7404         MOV       A,#0x4
   \   000134   12....       LCALL     ?XSTACK_DISP0_8
   \   000137   740D         MOV       A,#0xd
   \   000139   F0           MOVX      @DPTR,A
    660                    nwkAddrStr[5] = '\n';
   \   00013A   7405         MOV       A,#0x5
   \   00013C   12....       LCALL     ?XSTACK_DISP0_8
   \   00013F   740A         MOV       A,#0xa
   \   000141   F0           MOVX      @DPTR,A
    661                    HalUARTWrite(0, nwkAddrStr, 6);
   \   000142                ; Setup parameters for call to function HalUARTWrite
   \   000142   7C06         MOV       R4,#0x6
   \   000144   7D00         MOV       R5,#0x0
   \   000146   AA..         MOV       R2,?XSP + 0
   \   000148   AB..         MOV       R3,?XSP + 1
   \   00014A   7900         MOV       R1,#0x0
   \   00014C   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    662                    
    663                    // 协调器组网成功后LED常亮
    664                    HalLedSet(HAL_LED_1, HAL_LED_MODE_ON);
   \   00014F                ; Setup parameters for call to function HalLedSet
   \   00014F   7A01         MOV       R2,#0x1
   \   000151   7901         MOV       R1,#0x1
   \   000153   12....       LCALL     `??HalLedSet::?relay`; Banked call to: HalLedSet
    665                    
    666                    // 组网成功后允许设备加入网络
    667                    NLME_PermitJoiningRequest(255);
   \   000156                ; Setup parameters for call to function NLME_PermitJoiningRequest
   \   000156   79FF         MOV       R1,#-0x1
   \   000158   12....       LCALL     `??NLME_PermitJoiningRequest::?relay`; Banked call to: NLME_PermitJoiningRequest
    668                    
    669                    // 组网成功后启动广播和组播定时器
    670                    // Broadcast
    671                    osal_start_timerEx(zclZEM_TaskID,
    672                                       ZEM_BROADCAST_EVT,
    673                                       ZEM_BROADCAST_PERIOD);
   \   00015B                ; Setup parameters for call to function osal_start_timerEx
   \   00015B   90....       MOV       DPTR,#__Constant_3e8
   \   00015E   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   000161   7A00         MOV       R2,#0x0
   \   000163   7B10         MOV       R3,#0x10
   \   000165   90....       MOV       DPTR,#zclZEM_TaskID
   \   000168   E0           MOVX      A,@DPTR
   \   000169   F9           MOV       R1,A
   \   00016A   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   00016D   7404         MOV       A,#0x4
   \   00016F   12....       LCALL     ?DEALLOC_XSTACK8
   \   000172   801F         SJMP      ??zclZEM_ProcessCommissioningStatus_0
    674                    #endif
    675                  }
    676                  else
    677                  {
    678                    //Want to try other channels?
    679                    //try with bdb_setChannelAttribute
    680                    // 网络形成失败
    681                    #ifdef ZDO_COORDINATOR
    682                    uint8 failMsg[] = "Network formation failed! Retrying...\r\n";
   \                     ??zclZEM_ProcessCommissioningStatus_1:
   \   000174   90....       MOV       DPTR,#`?<Constant "Network formation fai...">`
   \   000177   740E         MOV       A,#0xe
   \   000179   12....       LCALL     ?XSTACK_DISP102_8
   \   00017C   7428         MOV       A,#0x28
   \   00017E   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    683                    HalUARTWrite(HAL_UART_PORT_0, failMsg, sizeof(failMsg)-1);
   \   000181                ; Setup parameters for call to function HalUARTWrite
   \   000181   7C27         MOV       R4,#0x27
   \   000183   FD           MOV       R5,A
   \   000184   740E         MOV       A,#0xe
   \   000186   12....       LCALL     ?XSTACK_DISP101_8
   \   000189   7900         MOV       R1,#0x0
   \   00018B   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    684                    
    685                    // 直接重新调用组网函数
    686                    bdb_StartCommissioning(BDB_COMMISSIONING_MODE_NWK_FORMATION |
    687                                          BDB_COMMISSIONING_MODE_FINDING_BINDING);
   \   00018E                ; Setup parameters for call to function bdb_StartCommissioning
   \   00018E   790C         MOV       R1,#0xc
   \   000190   12....       LCALL     `??bdb_StartCommissioning::?relay`; Banked call to: bdb_StartCommissioning
    688                    #endif
    689                  }
    690                break;
    691                case BDB_COMMISSIONING_NWK_STEERING:
    692                  if(bdbCommissioningModeMsg->bdbCommissioningStatus == BDB_COMMISSIONING_SUCCESS)
    693                  {
    694                    //YOUR JOB:
    695                    //We are on the nwk, what now?
    696                    // 网络引导成功
    697                    #ifdef ZDO_COORDINATOR
    698                    #else
    699                    uint8 steeringSuccessMsg[] = "Network steering successful! PANID: ";
    700                    HalUARTWrite(HAL_UART_PORT_0, steeringSuccessMsg, sizeof(steeringSuccessMsg)-1);
    701                    
    702                    // 打印PANID（十六进制格式）
    703                    uint8 panidStr[8];
    704                    uint16 panId = _NIB.nwkPanId;
    705                    
    706                    // 转换高字节
    707                    uint8 highByte = (panId >> 8) & 0xFF;
    708                    uint8 highNibbleH = (highByte >> 4) & 0x0F;
    709                    uint8 lowNibbleH = highByte & 0x0F;
    710                    panidStr[0] = (highNibbleH < 10) ? ('0' + highNibbleH) : ('A' + highNibbleH - 10);
    711                    panidStr[1] = (lowNibbleH < 10) ? ('0' + lowNibbleH) : ('A' + lowNibbleH - 10);
    712                    
    713                    // 转换低字节
    714                    uint8 lowByte = panId & 0xFF;
    715                    uint8 highNibbleL = (lowByte >> 4) & 0x0F;
    716                    uint8 lowNibbleL = lowByte & 0x0F;
    717                    panidStr[2] = (highNibbleL < 10) ? ('0' + highNibbleL) : ('A' + highNibbleL - 10);
    718                    panidStr[3] = (lowNibbleL < 10) ? ('0' + lowNibbleL) : ('A' + lowNibbleL - 10);
    719                    
    720                    panidStr[4] = '\r';
    721                    panidStr[5] = '\n';
    722                    HalUARTWrite(0, panidStr, 6);
    723                    
    724                    // 打印网络地址（十六进制格式）
    725                    uint8 nwkAddrMsg[] = "Network Address: 0x";
    726                    HalUARTWrite(HAL_UART_PORT_0, nwkAddrMsg, sizeof(nwkAddrMsg)-1);
    727                    
    728                    uint16 nwkAddr = NLME_GetShortAddr(); // 获取终端的网络地址
    729                    uint8 nwkAddrStr[6];
    730                    
    731                    // 转换高字节
    732                    uint8 nwkHighByte = (nwkAddr >> 8) & 0xFF;
    733                    uint8 nwkHighNibbleH = (nwkHighByte >> 4) & 0x0F;
    734                    uint8 nwkLowNibbleH = nwkHighByte & 0x0F;
    735                    nwkAddrStr[0] = (nwkHighNibbleH < 10) ? ('0' + nwkHighNibbleH) : ('A' + nwkHighNibbleH - 10);
    736                    nwkAddrStr[1] = (nwkLowNibbleH < 10) ? ('0' + nwkLowNibbleH) : ('A' + nwkLowNibbleH - 10);
    737                    
    738                    // 转换低字节
    739                    uint8 nwkLowByte = nwkAddr & 0xFF;
    740                    uint8 nwkHighNibbleL = (nwkLowByte >> 4) & 0x0F;
    741                    uint8 nwkLowNibbleL = nwkLowByte & 0x0F;
    742                    nwkAddrStr[2] = (nwkHighNibbleL < 10) ? ('0' + nwkHighNibbleL) : ('A' + nwkHighNibbleL - 10);
    743                    nwkAddrStr[3] = (nwkLowNibbleL < 10) ? ('0' + nwkLowNibbleL) : ('A' + nwkLowNibbleL - 10);
    744                    
    745                    nwkAddrStr[4] = '\r';
    746                    nwkAddrStr[5] = '\n';
    747                    HalUARTWrite(0, nwkAddrStr, 6);
    748                    
    749                    // 入网成功后使用P2P向协调器发送MAC地址
    750                    zclZEM_SendMACToCoordinator();
    751                    
    752                    // 入网成功后启动P2P定时器，定期向协调器发送MAC地址
    753                    osal_start_timerEx(zclZEM_TaskID,
    754                                       ZEM_P2P_EVT,
    755                                       ZEM_P2P_PERIOD);
    756                    
    757                    // 终端入网成功后LED常亮
    758                    HalLedSet(HAL_LED_1, HAL_LED_MODE_ON);
    759                    #endif
    760                  }
    761                  else
    762                  {
    763                    // 网络引导失败
    764                    #ifdef ZDO_COORDINATOR
    765                    /* 协调器 */
    766                    #else
    767                    /* 路由器或者终端 */
    768                    uint8 failMsg[] = "Network steering failed! Retrying in 1 second...\r\n";
    769                    HalUARTWrite(HAL_UART_PORT_0, failMsg, sizeof(failMsg)-1);
    770                    
    771                    /* 无限重试网络引导 */
    772                    osal_start_timerEx(zclZEM_TaskID, 
    773                                              ZEM_REJOIN_EVT, 
    774                                              ZEM_REJOIN_PERIOD);
    775                    #endif
    776                  }
    777                  break;
    778                case BDB_COMMISSIONING_FINDING_BINDING:
    779                  if(bdbCommissioningModeMsg->bdbCommissioningStatus == BDB_COMMISSIONING_SUCCESS)
    780                  {
    781                    //YOUR JOB:
    782                  }
    783                  else
    784                  {
    785                    //YOUR JOB:
    786                    //retry?, wait for user interaction?
    787                  }
    788                break;
    789                case BDB_COMMISSIONING_INITIALIZATION:
    790                  //Initialization notification can only be successful. Failure on initialization 
    791                  //only happens for ZED and is notified as BDB_COMMISSIONING_PARENT_LOST notification
    792                  
    793                  //YOUR JOB:
    794                  //We are on a network, what now?
    795                  
    796                break;
    797          #if ZG_BUILD_ENDDEVICE_TYPE    
    798              case BDB_COMMISSIONING_PARENT_LOST:
    799                if(bdbCommissioningModeMsg->bdbCommissioningStatus == BDB_COMMISSIONING_NETWORK_RESTORED)
    800                {
    801                  //We did recover from losing parent
    802                }
    803                else
    804                {
    805                  //Parent not found, attempt to rejoin again after a fixed delay
    806                  //osal_start_timerEx(zclZEM_TaskID, SAMPLEAPP_END_DEVICE_REJOIN_EVT, SAMPLEAPP_END_DEVICE_REJOIN_DELAY);
    807                  
    808                  /* 协调器 */
    809          #ifdef ZDO_COORDINATOR
    810                  /* 路由器或者终端 */
    811          #else
    812                /* 启动重新加入事件 */
    813                osal_start_timerEx(zclZEM_TaskID, 
    814                                  ZEM_REJOIN_EVT, 
    815                                  ZEM_REJOIN_PERIOD);
    816          #endif
    817                }
    818              break;
    819          #endif 
    820              }
    821          
    822          }
   \                     ??zclZEM_ProcessCommissioningStatus_0:
   \   000193   7470         MOV       A,#0x70
   \   000195   02....       LJMP      ?Subroutine0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   E8           MOV       A,R0
   \   000001   F0           MOVX      @DPTR,A
   \   000002   EA           MOV       A,R2
   \   000003   12....       LCALL     ?Subroutine21 & 0xFFFF
   \                     ??CrossCallReturnLabel_34:
   \   000006   22           RET
    823          
    824          /*********************************************************************
    825           * @fn      zclZEM_BasicResetCB
    826           *
    827           * @brief   Callback from the ZCL General Cluster Library
    828           *          to set all the Basic Cluster attributes to default values.
    829           *
    830           * @param   none
    831           *
    832           * @return  none
    833           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    834          static void zclZEM_BasicResetCB( void )
   \                     zclZEM_BasicResetCB:
    835          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    836            zclZEM_ResetAttributesToDefaultValues();
   \   000004                ; Setup parameters for call to function zclZEM_ResetAttributesToDefaultValues
   \   000004   12....       LCALL     `??zclZEM_ResetAttributesToDefaultValues::?relay`; Banked call to: zclZEM_ResetAttributesToDefaultValues
    837            
    838          }
   \   000007                REQUIRE ?Subroutine2
   \   000007                ; // Fall through to label ?Subroutine2

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   D083         POP       DPH
   \   000002   D082         POP       DPL
   \   000004   02....       LJMP      ?BRET
    839          
    840          /*********************************************************************
    841           * @fn      zclSampleApp_BatteryWarningCB
    842           *
    843           * @brief   Called to handle battery-low situation.
    844           *
    845           * @param   voltLevel - level of severity
    846           *
    847           * @return  none
    848           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    849          void zclSampleApp_BatteryWarningCB( uint8 voltLevel )
   \                     zclSampleApp_BatteryWarningCB:
    850          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    851            if ( voltLevel == VOLT_LEVEL_CAUTIOUS )
    852            {
    853              // Send warning message to the gateway and blink LED
    854            }
    855            else if ( voltLevel == VOLT_LEVEL_BAD )
    856            {
    857              // Shut down the system
    858            }
    859          }
   \   000000   02....       LJMP      ?BRET
    860          
    861          /******************************************************************************
    862           *
    863           *  Functions for processing ZCL Foundation incoming Command/Response messages
    864           *
    865           *****************************************************************************/
    866          
    867          /*********************************************************************
    868           * @fn      zclZEM_ProcessIncomingMsg
    869           *
    870           * @brief   Process ZCL Foundation incoming message
    871           *
    872           * @param   pInMsg - pointer to the received message
    873           *
    874           * @return  none
    875           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    876          static void zclZEM_ProcessIncomingMsg( zclIncomingMsg_t *pInMsg)
   \                     zclZEM_ProcessIncomingMsg:
    877          {
   \   000000   74F7         MOV       A,#-0x9
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    878            switch ( pInMsg->zclHdr.commandID )
   \   000005   EA           MOV       A,R2
   \   000006   2417         ADD       A,#0x17
   \   000008   F8           MOV       R0,A
   \   000009   E4           CLR       A
   \   00000A   3B           ADDC      A,R3
   \   00000B   F9           MOV       R1,A
   \   00000C   E8           MOV       A,R0
   \   00000D   FE           MOV       R6,A
   \   00000E   E9           MOV       A,R1
   \   00000F   FF           MOV       R7,A
   \   000010   8A82         MOV       DPL,R2
   \   000012   8B83         MOV       DPH,R3
   \   000014   A3           INC       DPTR
   \   000015   A3           INC       DPTR
   \   000016   A3           INC       DPTR
   \   000017   A3           INC       DPTR
   \   000018   A3           INC       DPTR
   \   000019   A3           INC       DPTR
   \   00001A   A3           INC       DPTR
   \   00001B   E0           MOVX      A,@DPTR
   \   00001C   14           DEC       A
   \   00001D   6016         JZ        ??zclZEM_ProcessIncomingMsg_0
   \   00001F   24FD         ADD       A,#-0x3
   \   000021   601F         JZ        ??zclZEM_ProcessIncomingMsg_1
   \   000023   24F7         ADD       A,#-0x9
   \   000025   602D         JZ        ??zclZEM_ProcessIncomingMsg_2
   \   000027   24FB         ADD       A,#-0x5
   \   000029   6024         JZ        ??zclZEM_ProcessIncomingMsg_3
   \   00002B   24FE         ADD       A,#-0x2
   \   00002D   6020         JZ        ??zclZEM_ProcessIncomingMsg_3
   \   00002F   24FE         ADD       A,#-0x2
   \   000031   6033         JZ        ??zclZEM_ProcessIncomingMsg_4
   \   000033   8043         SJMP      ??zclZEM_ProcessIncomingMsg_5
    879            {
    880          #ifdef ZCL_READ
    881              case ZCL_CMD_READ_RSP:
    882                zclZEM_ProcessInReadRspCmd( pInMsg );
   \                     ??zclZEM_ProcessIncomingMsg_0:
   \   000035   12....       LCALL     ?Subroutine11 & 0xFFFF
   \                     ??CrossCallReturnLabel_15:
   \   000038   E0           MOVX      A,@DPTR
   \   000039   F9           MOV       R1,A
   \   00003A   E8           MOV       A,R0
   \   00003B   C3           CLR       C
   \   00003C   99           SUBB      A,R1
   \   00003D   5039         JNC       ??zclZEM_ProcessIncomingMsg_5
   \   00003F   08           INC       R0
   \   000040   80F6         SJMP      ??CrossCallReturnLabel_15
    883                break;
    884          #endif
    885          #ifdef ZCL_WRITE
    886              case ZCL_CMD_WRITE_RSP:
    887                zclZEM_ProcessInWriteRspCmd( pInMsg );
   \                     ??zclZEM_ProcessIncomingMsg_1:
   \   000042   12....       LCALL     ?Subroutine11 & 0xFFFF
   \                     ??CrossCallReturnLabel_16:
   \   000045   E0           MOVX      A,@DPTR
   \   000046   F9           MOV       R1,A
   \   000047   E8           MOV       A,R0
   \   000048   C3           CLR       C
   \   000049   99           SUBB      A,R1
   \   00004A   502C         JNC       ??zclZEM_ProcessIncomingMsg_5
   \   00004C   08           INC       R0
   \   00004D   80F6         SJMP      ??CrossCallReturnLabel_16
    888                break;
    889          #endif
    890          #ifdef ZCL_REPORT
    891              // See ZCL Test Applicaiton (zcl_testapp.c) for sample code on Attribute Reporting
    892              case ZCL_CMD_CONFIG_REPORT:
    893                //zclZEM_ProcessInConfigReportCmd( pInMsg );
    894                break;
    895                case ZCL_CMD_READ_REPORT_CFG:
    896                //zclZEM_ProcessInReadReportCfgCmd( pInMsg );
    897                break;
    898              case ZCL_CMD_CONFIG_REPORT_RSP:
    899                //zclZEM_ProcessInConfigReportRspCmd( pInMsg );
    900                break;
    901              case ZCL_CMD_READ_REPORT_CFG_RSP:
    902                //zclZEM_ProcessInReadReportCfgRspCmd( pInMsg );
    903                break;
    904          
    905              case ZCL_CMD_REPORT:
    906                //zclZEM_ProcessInReportCmd( pInMsg );
    907                break;
    908          #endif
    909              case ZCL_CMD_DEFAULT_RSP:
    910                zclZEM_ProcessInDefaultRspCmd( pInMsg );
    911                break;
    912          #ifdef ZCL_DISCOVER
    913              case ZCL_CMD_DISCOVER_CMDS_RECEIVED_RSP:
    914                zclZEM_ProcessInDiscCmdsRspCmd( pInMsg );
   \                     ??zclZEM_ProcessIncomingMsg_3:
   \   00004F                ; Setup parameters for call to function zclZEM_ProcessInDiscCmdsRspCmd
    915                break;
    916          
    917              case ZCL_CMD_DISCOVER_CMDS_GEN_RSP:
    918                zclZEM_ProcessInDiscCmdsRspCmd( pInMsg );
   \   00004F                ; Setup parameters for call to function zclZEM_ProcessInDiscCmdsRspCmd
   \   00004F   12....       LCALL     `??zclZEM_ProcessInDiscCmdsRspCmd::?relay`; Banked call to: zclZEM_ProcessInDiscCmdsRspCmd
    919                break;
   \   000052   8024         SJMP      ??zclZEM_ProcessIncomingMsg_5
    920          
    921              case ZCL_CMD_DISCOVER_ATTRS_RSP:
    922                zclZEM_ProcessInDiscAttrsRspCmd( pInMsg );
   \                     ??zclZEM_ProcessIncomingMsg_2:
   \   000054   12....       LCALL     ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_48:
   \   000057   8882         MOV       DPL,R0
   \   000059   8983         MOV       DPH,R1
   \   00005B   A3           INC       DPTR
   \   00005C   E0           MOVX      A,@DPTR
   \   00005D   FB           MOV       R3,A
   \   00005E   EA           MOV       A,R2
   \   00005F   C3           CLR       C
   \   000060   9B           SUBB      A,R3
   \   000061   5015         JNC       ??zclZEM_ProcessIncomingMsg_5
   \   000063   0A           INC       R2
   \   000064   80F1         SJMP      ??CrossCallReturnLabel_48
    923                break;
    924          
    925              case ZCL_CMD_DISCOVER_ATTRS_EXT_RSP:
    926                zclZEM_ProcessInDiscAttrsExtRspCmd( pInMsg );
   \                     ??zclZEM_ProcessIncomingMsg_4:
   \   000066   12....       LCALL     ?Subroutine12 & 0xFFFF
    927                break;
    928          #endif
    929              default:
    930                break;
    931            }
   \                     ??CrossCallReturnLabel_49:
   \   000069   8001         SJMP      ??zclZEM_ProcessIncomingMsg_6
   \                     ??zclZEM_ProcessIncomingMsg_7:
   \   00006B   0A           INC       R2
   \                     ??zclZEM_ProcessIncomingMsg_6:
   \   00006C   8882         MOV       DPL,R0
   \   00006E   8983         MOV       DPH,R1
   \   000070   A3           INC       DPTR
   \   000071   E0           MOVX      A,@DPTR
   \   000072   FB           MOV       R3,A
   \   000073   EA           MOV       A,R2
   \   000074   C3           CLR       C
   \   000075   9B           SUBB      A,R3
   \   000076   40F3         JC        ??zclZEM_ProcessIncomingMsg_7
    932          
    933            if ( pInMsg->attrCmd )
   \                     ??zclZEM_ProcessIncomingMsg_5:
   \   000078   8E82         MOV       DPL,R6
   \   00007A   8F83         MOV       DPH,R7
   \   00007C   E0           MOVX      A,@DPTR
   \   00007D   FA           MOV       R2,A
   \   00007E   A3           INC       DPTR
   \   00007F   E0           MOVX      A,@DPTR
   \   000080   FB           MOV       R3,A
   \   000081   EA           MOV       A,R2
   \   000082   4B           ORL       A,R3
   \   000083   6003         JZ        ??zclZEM_ProcessIncomingMsg_8
    934            {
    935              osal_mem_free( pInMsg->attrCmd );
   \   000085                ; Setup parameters for call to function osal_mem_free
   \   000085   12....       LCALL     `??osal_mem_free::?relay`; Banked call to: osal_mem_free
    936            }
    937          }
   \                     ??zclZEM_ProcessIncomingMsg_8:
   \   000088   02....       LJMP      ?Subroutine1 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine12:
   \   000000   8E82         MOV       DPL,R6
   \   000002   8F83         MOV       DPH,R7
   \   000004                REQUIRE ??Subroutine26_0
   \   000004                ; // Fall through to label ??Subroutine26_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine26_0:
   \   000000   E0           MOVX      A,@DPTR
   \   000001   F8           MOV       R0,A
   \   000002   A3           INC       DPTR
   \   000003   E0           MOVX      A,@DPTR
   \   000004   F9           MOV       R1,A
   \   000005   7A00         MOV       R2,#0x0
   \   000007   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine11:
   \   000000   8E82         MOV       DPL,R6
   \   000002   8F83         MOV       DPH,R7
   \   000004   E0           MOVX      A,@DPTR
   \   000005   F8           MOV       R0,A
   \   000006   A3           INC       DPTR
   \   000007   E0           MOVX      A,@DPTR
   \   000008   F9           MOV       R1,A
   \   000009   8882         MOV       DPL,R0
   \   00000B   8983         MOV       DPH,R1
   \   00000D   7800         MOV       R0,#0x0
   \   00000F   22           RET
    938          
    939          #ifdef ZCL_READ
    940          /*********************************************************************
    941           * @fn      zclZEM_ProcessInReadRspCmd
    942           *
    943           * @brief   Process the "Profile" Read Response Command
    944           *
    945           * @param   pInMsg - incoming message to process
    946           *
    947           * @return  none
    948           */
    949          static uint8 zclZEM_ProcessInReadRspCmd( zclIncomingMsg_t *pInMsg )
    950          {
    951            zclReadRspCmd_t *readRspCmd;
    952            uint8 i;
    953          
    954            readRspCmd = (zclReadRspCmd_t *)pInMsg->attrCmd;
    955            for ( i = 0; i < readRspCmd->numAttr; i++ )
    956            {
    957              // Notify the originator of the results of the original read attributes
    958              // attempt and, for each successfull request, the value of the requested
    959              // attribute
    960            }
    961          
    962            return ( TRUE );
    963          }
    964          #endif // ZCL_READ
    965          
    966          #ifdef ZCL_WRITE
    967          /*********************************************************************
    968           * @fn      zclZEM_ProcessInWriteRspCmd
    969           *
    970           * @brief   Process the "Profile" Write Response Command
    971           *
    972           * @param   pInMsg - incoming message to process
    973           *
    974           * @return  none
    975           */
    976          static uint8 zclZEM_ProcessInWriteRspCmd( zclIncomingMsg_t *pInMsg )
    977          {
    978            zclWriteRspCmd_t *writeRspCmd;
    979            uint8 i;
    980          
    981            writeRspCmd = (zclWriteRspCmd_t *)pInMsg->attrCmd;
    982            for ( i = 0; i < writeRspCmd->numAttr; i++ )
    983            {
    984              // Notify the device of the results of the its original write attributes
    985              // command.
    986            }
    987          
    988            return ( TRUE );
    989          }
    990          #endif // ZCL_WRITE
    991          
    992          /*********************************************************************
    993           * @fn      zclZEM_ProcessInDefaultRspCmd
    994           *
    995           * @brief   Process the "Profile" Default Response Command
    996           *
    997           * @param   pInMsg - incoming message to process
    998           *
    999           * @return  none
   1000           */
   1001          static uint8 zclZEM_ProcessInDefaultRspCmd( zclIncomingMsg_t *pInMsg )
   1002          {
   1003            // zclDefaultRspCmd_t *defaultRspCmd = (zclDefaultRspCmd_t *)pInMsg->attrCmd;
   1004          
   1005            // Device is notified of the Default Response command.
   1006            (void)pInMsg;
   1007          
   1008            return ( TRUE );
   1009          }
   1010          
   1011          #ifdef ZCL_DISCOVER
   1012          /*********************************************************************
   1013           * @fn      zclZEM_ProcessInDiscCmdsRspCmd
   1014           *
   1015           * @brief   Process the Discover Commands Response Command
   1016           *
   1017           * @param   pInMsg - incoming message to process
   1018           *
   1019           * @return  none
   1020           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1021          static uint8 zclZEM_ProcessInDiscCmdsRspCmd( zclIncomingMsg_t *pInMsg )
   \                     zclZEM_ProcessInDiscCmdsRspCmd:
   1022          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1023            zclDiscoverCmdsCmdRsp_t *discoverRspCmd;
   1024            uint8 i;
   1025          
   1026            discoverRspCmd = (zclDiscoverCmdsCmdRsp_t *)pInMsg->attrCmd;
   \   000004   EA           MOV       A,R2
   \   000005   2417         ADD       A,#0x17
   \   000007   F582         MOV       DPL,A
   \   000009   E4           CLR       A
   \   00000A   3B           ADDC      A,R3
   \   00000B   F583         MOV       DPH,A
   \   00000D   12....       LCALL     ??Subroutine26_0 & 0xFFFF
   1027            for ( i = 0; i < discoverRspCmd->numCmd; i++ )
   \                     ??CrossCallReturnLabel_47:
   \   000010   8001         SJMP      ??zclZEM_ProcessInDiscCmdsRspCmd_0
   \                     ??zclZEM_ProcessInDiscCmdsRspCmd_1:
   \   000012   0A           INC       R2
   \                     ??zclZEM_ProcessInDiscCmdsRspCmd_0:
   \   000013   8882         MOV       DPL,R0
   \   000015   8983         MOV       DPH,R1
   \   000017   A3           INC       DPTR
   \   000018   A3           INC       DPTR
   \   000019   E0           MOVX      A,@DPTR
   \   00001A   FB           MOV       R3,A
   \   00001B   EA           MOV       A,R2
   \   00001C   C3           CLR       C
   \   00001D   9B           SUBB      A,R3
   \   00001E   40F2         JC        ??zclZEM_ProcessInDiscCmdsRspCmd_1
   1028            {
   1029              // Device is notified of the result of its attribute discovery command.
   1030            }
   1031          
   1032            return ( TRUE );
   \   000020   7901         MOV       R1,#0x1
   \   000022   02....       LJMP      ?Subroutine2 & 0xFFFF
   1033          }
   1034          
   1035          /*********************************************************************
   1036           * @fn      zclZEM_ProcessInDiscAttrsRspCmd
   1037           *
   1038           * @brief   Process the "Profile" Discover Attributes Response Command
   1039           *
   1040           * @param   pInMsg - incoming message to process
   1041           *
   1042           * @return  none
   1043           */
   1044          static uint8 zclZEM_ProcessInDiscAttrsRspCmd( zclIncomingMsg_t *pInMsg )
   1045          {
   1046            zclDiscoverAttrsRspCmd_t *discoverRspCmd;
   1047            uint8 i;
   1048          
   1049            discoverRspCmd = (zclDiscoverAttrsRspCmd_t *)pInMsg->attrCmd;
   1050            for ( i = 0; i < discoverRspCmd->numAttr; i++ )
   1051            {
   1052              // Device is notified of the result of its attribute discovery command.
   1053            }
   1054          
   1055            return ( TRUE );
   1056          }
   1057          
   1058          /*********************************************************************
   1059           * @fn      zclZEM_ProcessInDiscAttrsExtRspCmd
   1060           *
   1061           * @brief   Process the "Profile" Discover Attributes Extended Response Command
   1062           *
   1063           * @param   pInMsg - incoming message to process
   1064           *
   1065           * @return  none
   1066           */
   1067          static uint8 zclZEM_ProcessInDiscAttrsExtRspCmd( zclIncomingMsg_t *pInMsg )
   1068          {
   1069            zclDiscoverAttrsExtRsp_t *discoverRspCmd;
   1070            uint8 i;
   1071          
   1072            discoverRspCmd = (zclDiscoverAttrsExtRsp_t *)pInMsg->attrCmd;
   1073            for ( i = 0; i < discoverRspCmd->numAttr; i++ )
   1074            {
   1075              // Device is notified of the result of its attribute discovery command.
   1076            }
   1077          
   1078            return ( TRUE );
   1079          }
   1080          #endif // ZCL_DISCOVER
   1081          
   1082          
   1083          
   1084          
   1085          /*********************************************************************
   1086           * @fn      zclZEM_AF_P2P
   1087           *
   1088           * @brief   点对点发送函数
   1089           *
   1090           * @param   destNwkAddr - 目标设备的网络地址
   1091           * @param   cid - Cluster ID，后续课程将会详细讲解
   1092           * @param   len - 数据长度
   1093           * @param   data - 数据内容
   1094           *
   1095           * @return  none
   1096           */
   1097          static void zclZEM_AF_P2P(
   1098              uint16 destNwkAddr,
   1099              uint16 cid,
   1100              uint8 len,
   1101              uint8 *data)
   1102          {
   1103              afAddrType_t dstAddr; //寻址信息配置

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   1104              static uint8 transferId = 0;//传输ID，是数据包的标识符
   \                     ??transferId:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
   1105              
   1106              /* Destination */
   1107              dstAddr.addrMode = afAddr16Bit;// 设置目标地址模式为16位网络地址，表示使用P2P的通信方式
   1108              dstAddr.addr.shortAddr = destNwkAddr;//目标设备的网络地址
   1109              dstAddr.endPoint = ZEM_ENDPOINT;//目标设备的端点号
   1110              
   1111              transferId++;
   1112              
   1113              AF_DataRequest(&dstAddr,
   1114                  &ZEM_AppEp,//应用程序端点描述符
   1115                  cid,
   1116                  len,
   1117                  data,
   1118                  &transferId,
   1119                  AF_DISCV_ROUTE,//进行路由扫描操作，用于建立发送数据报文的通信路径。关于这个参数，暂时保持例程默认的代码就可以了
   1120                  AF_DEFAULT_RADIUS);//指定最大的路由跳转级数
   1121          }
   1122          
   1123          /*********************************************************************
   1124           * @fn      zclZEM_AF_Broadcast
   1125           *
   1126           * @brief   广播发送函数
   1127           *
   1128           * @param   cid - Cluster ID
   1129           * @param   len - 待发送数据的长度
   1130           * @param   data - 待发送数据的内容
   1131           *
   1132           * @return  none
   1133           */
   1134          static void zclZEM_AF_Broadcast(
   1135              uint16 cid,
   1136              uint8 len,
   1137              uint8 *data)
   1138          {
   1139              afAddrType_t dstAddr;

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   1140              static uint8 transferId = 0;
   \                     ??transferId_1:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
   1141              
   1142              /* Destination */
   1143              dstAddr.addrMode = afAddrBroadcast;   // 使用广播模式
   1144              dstAddr.addr.shortAddr = 0xFFFF; // 广播地址
   1145              dstAddr.endPoint = ZEM_ENDPOINT; // 目标设备的端点号
   1146              
   1147              /* Transfer id */
   1148              transferId++;
   1149              
   1150              /* Send */
   1151              AF_DataRequest(&dstAddr,
   1152                  &ZEM_AppEp,//应用程序端点描述符
   1153                  cid,
   1154                  len,
   1155                  data,
   1156                  &transferId,
   1157                  AF_TX_OPTIONS_NONE,
   1158                  AF_DEFAULT_RADIUS );//指定了最大的路由跳转级数
   1159          }
   1160          
   1161          /*********************************************************************
   1162           * @fn      zclZEM_AF_Groupcast
   1163           *
   1164           * @brief   组播发送函数
   1165           *
   1166           * @param   groupId - 组ID
   1167           * @param   cid - ClusterID，后续章节将会详细讲解
   1168           * @param   len - 待发送数据的长度
   1169           * @param   data - 待发送数据的内容
   1170           *
   1171           * @return  none
   1172           */
   1173          static void zclZEM_AF_Groupcast(
   1174              uint16 groupId,
   1175              uint16 cid,
   1176              uint8 len,
   1177              uint8 *data)
   1178          {
   1179              afAddrType_t dstAddr;

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   1180              static uint8 transferId = 0;
   \                     ??transferId_2:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
   1181              
   1182              /* Destination */
   1183              dstAddr.addrMode = afAddrGroup;//使用组播通信模式
   1184              dstAddr.addr.shortAddr = groupId;
   1185              dstAddr.endPoint = ZEM_ENDPOINT;//组中的设备的端点号
   1186              
   1187              /* Transfer id */
   1188              transferId++;
   1189              
   1190              /* Send */
   1191              AF_DataRequest(&dstAddr,
   1192                  &ZEM_AppEp,//应用程序端点描述符
   1193                  cid,
   1194                  len,
   1195                  data,
   1196                  &transferId,
   1197                  AF_TX_OPTIONS_NONE,
   1198                  AF_DEFAULT_RADIUS );//指定最大的路由跳转级数，暂时可忽略
   1199          }
   1200          
   1201          /*********************************************************************
   1202           * @fn      zclZEM_AF_RxProc
   1203           *
   1204           * @brief   接收数据处理函数
   1205           *
   1206           * @param   MSGpkt - 接收到数据
   1207           *
   1208           * @return  none
   1209           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1210          static void zclZEM_AF_RxProc(afIncomingMSGPacket_t *MSGpkt)
   \                     zclZEM_AF_RxProc:
   1211          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000                REQUIRE ?V4
   \   000000                REQUIRE ?V5
   \   000000                REQUIRE ?V6
   \   000000                REQUIRE ?V8
   \   000000                REQUIRE ?V9
   \   000000                REQUIRE ?V10
   \   000000   74ED         MOV       A,#-0x13
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 19
   \   000005                ; Auto size: 94
   \   000005   74A2         MOV       A,#-0x5e
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   1212              /*计数器，记录接收到的点对点通信数据包个数*/
   1213              static uint8 p2pCnt = 0;
   1214              /*计数器，记录接收到的广播通信数据包个数*/
   1215              static uint8 bcCnt = 0;
   1216              /*计数器，记录接收到的组播通信数据包个数*/
   1217              static uint8 gcCnt = 0;
   1218              
   1219              switch( MSGpkt->clusterId )  // 判断接收到的数据包的Cluster ID
                     ^
Warning[Pe546]: transfer of control bypasses initialization of:
            variable "bcRecvMsg" (declared at line 1239)
   \   00000A   75....       MOV       ?V4,#`?<Constant " Count: ">` & 0xff
   \   00000D   75....       MOV       ?V5,#(`?<Constant " Count: ">` >> 8) & 0xff
   \   000010   75..00       MOV       ?V6,#0x0
   \   000013   EA           MOV       A,R2
   \   000014   2422         ADD       A,#0x22
   \   000016   F5..         MOV       ?V0,A
   \   000018   E4           CLR       A
   \   000019   3B           ADDC      A,R3
   \   00001A   F5..         MOV       ?V1,A
   \   00001C   EA           MOV       A,R2
   \   00001D   2420         ADD       A,#0x20
   \   00001F   FE           MOV       R6,A
   \   000020   E4           CLR       A
   \   000021   3B           ADDC      A,R3
   \   000022   FF           MOV       R7,A
   \   000023   8A82         MOV       DPL,R2
   \   000025   8B83         MOV       DPH,R3
   \   000027   A3           INC       DPTR
   \   000028   A3           INC       DPTR
   \   000029   A3           INC       DPTR
   \   00002A   A3           INC       DPTR
   \   00002B   E0           MOVX      A,@DPTR
   \   00002C   F5..         MOV       ?V2,A
   \   00002E   A3           INC       DPTR
   \   00002F   E0           MOVX      A,@DPTR
   \   000030   F5..         MOV       ?V3,A
   \   000032   78..         MOV       R0,#?V2
   \   000034   12....       LCALL     ?US_SWITCH_DENSE
   \                     `?<Jumptable for zclZEM_AF_RxProc>_0`:
   \   000037   0000         DW        0
   \   000039   02           DB        2
   \   00003A   ....         DW        ??zclZEM_AF_RxProc_0
   \   00003C   ....         DW        ??zclZEM_AF_RxProc_1
   \   00003E   ....         DW        ??zclZEM_AF_RxProc_2
   \   000040   ....         DW        ??zclZEM_AF_RxProc_3
   1220              {
   1221                  case CLUSTER_P2P:
   1222                      p2pCnt++;  // 接收到P2P数据包，进行计数
   \                     ??zclZEM_AF_RxProc_1:
   \   000042   90....       MOV       DPTR,#??p2pCnt
   \   000045   E0           MOVX      A,@DPTR
   \   000046   04           INC       A
   \   000047   F0           MOVX      @DPTR,A
   1223                      // 通过串口输出接收到的数据和计数器值
   1224                      {
   1225                          uint8 p2pMsg[64];
   1226                          osal_memcpy(p2pMsg, "P2P Data: ", 10);
   \   000048                ; Setup parameters for call to function osal_memcpy
   \   000048   75....       MOV       ?V8,#`?<Constant "P2P Data: ">` & 0xff
   \   00004B   75....       MOV       ?V9,#(`?<Constant "P2P Data: ">` >> 8) & 0xff
   \   00004E   75..00       MOV       ?V10,#0x0
   \   000051   78..         MOV       R0,#?V8
   \   000053   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   000056   7C0A         MOV       R4,#0xa
   \   000058   7D00         MOV       R5,#0x0
   \   00005A   7403         MOV       A,#0x3
   \   00005C   12....       LCALL     ?XSTACK_DISP101_8
   \   00005F   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   000062   7403         MOV       A,#0x3
   \   000064   12....       LCALL     ?DEALLOC_XSTACK8
   1227                          osal_memcpy(p2pMsg + 10, MSGpkt->cmd.Data, MSGpkt->cmd.DataLength);
   \   000067                ; Setup parameters for call to function osal_memcpy
   \   000067   12....       LCALL     ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_10:
   \   00006A   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   00006D   8E82         MOV       DPL,R6
   \   00006F   8F83         MOV       DPH,R7
   \   000071   E0           MOVX      A,@DPTR
   \   000072   FC           MOV       R4,A
   \   000073   A3           INC       DPTR
   \   000074   E0           MOVX      A,@DPTR
   \   000075   FD           MOV       R5,A
   \   000076   740D         MOV       A,#0xd
   \   000078   12....       LCALL     ?XSTACK_DISP0_8
   \   00007B   AA82         MOV       R2,DPL
   \   00007D   AB83         MOV       R3,DPH
   \   00007F   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   000082   7403         MOV       A,#0x3
   \   000084   12....       LCALL     ?DEALLOC_XSTACK8
   1228                          osal_memcpy(p2pMsg + 10 + MSGpkt->cmd.DataLength, " Count: ", 8);
   \   000087                ; Setup parameters for call to function osal_memcpy
   \   000087   78..         MOV       R0,#?V4
   \   000089   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   00008C   7C08         MOV       R4,#0x8
   \   00008E   7D00         MOV       R5,#0x0
   \   000090   8E82         MOV       DPL,R6
   \   000092   8F83         MOV       DPH,R7
   \   000094   7403         MOV       A,#0x3
   \   000096   12....       LCALL     ?XSTACK_DISP100_8
   \   000099   89..         MOV       ?V1,R1
   \   00009B   12....       LCALL     ??Subroutine27_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_50:
   \   00009E   240A         ADD       A,#0xa
   \   0000A0   FA           MOV       R2,A
   \   0000A1   E4           CLR       A
   \   0000A2   39           ADDC      A,R1
   \   0000A3   FB           MOV       R3,A
   \   0000A4   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   0000A7   7403         MOV       A,#0x3
   \   0000A9   12....       LCALL     ?DEALLOC_XSTACK8
   1229                          p2pMsg[18 + MSGpkt->cmd.DataLength] = '0' + p2pCnt;
   \   0000AC   90....       MOV       DPTR,#??p2pCnt
   \   0000AF   E0           MOVX      A,@DPTR
   \   0000B0   2430         ADD       A,#0x30
   \   0000B2   C0E0         PUSH      A
   \   0000B4   12....       LCALL     ?Subroutine10 & 0xFFFF
   1230                          p2pMsg[19 + MSGpkt->cmd.DataLength] = '\r';
   1231                          p2pMsg[20 + MSGpkt->cmd.DataLength] = '\n';
   1232                          HalUARTWrite(HAL_UART_PORT_0, p2pMsg, 21 + MSGpkt->cmd.DataLength);
   1233                      }
   \                     ??CrossCallReturnLabel_51:
   \   0000B7   2412         ADD       A,#0x12
   \   0000B9   F582         MOV       DPL,A
   \   0000BB   E4           CLR       A
   \   0000BC   39           ADDC      A,R1
   \   0000BD   F583         MOV       DPH,A
   \   0000BF   D0E0         POP       A
   \   0000C1   12....       LCALL     ??Subroutine28_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_57:
   \   0000C4   2413         ADD       A,#0x13
   \   0000C6   12....       LCALL     ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_55:
   \   0000C9   2414         ADD       A,#0x14
   \   0000CB   12....       LCALL     ?Subroutine20 & 0xFFFF
   \                     ??CrossCallReturnLabel_31:
   \   0000CE   2415         ADD       A,#0x15
   \   0000D0   02....       LJMP      ??zclZEM_AF_RxProc_4 & 0xFFFF
   1234                      break;
   1235                  case CLUSTER_BROADCAST:
   1236                      bcCnt++;  // 接收到广播数据包，进行计数
   \                     ??zclZEM_AF_RxProc_2:
   \   0000D3   90....       MOV       DPTR,#??bcCnt
   \   0000D6   E0           MOVX      A,@DPTR
   \   0000D7   04           INC       A
   \   0000D8   F0           MOVX      @DPTR,A
   1237                      
   1238                      // 添加广播接收调试信息
   1239                      uint8 bcRecvMsg[] = "Broadcast message received!\r\n";
   \   0000D9   90....       MOV       DPTR,#`?<Constant "Broadcast message rec...">`
   \   0000DC   7440         MOV       A,#0x40
   \   0000DE   12....       LCALL     ?XSTACK_DISP102_8
   \   0000E1   741E         MOV       A,#0x1e
   \   0000E3   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
   1240                      HalUARTWrite(HAL_UART_PORT_0, bcRecvMsg, sizeof(bcRecvMsg)-1);
   \   0000E6                ; Setup parameters for call to function HalUARTWrite
   \   0000E6   7C1D         MOV       R4,#0x1d
   \   0000E8   FD           MOV       R5,A
   \   0000E9   7440         MOV       A,#0x40
   \   0000EB   12....       LCALL     ?XSTACK_DISP101_8
   \   0000EE   7900         MOV       R1,#0x0
   \   0000F0   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
   1241                      
   1242                      // 通过串口输出接收到的数据和计数器值
   1243                      {
   1244                          uint8 bcMsg[64];
   1245                          osal_memcpy(bcMsg, "Broadcast Data: ", 16);
   \   0000F3                ; Setup parameters for call to function osal_memcpy
   \   0000F3   75....       MOV       ?V8,#`?<Constant "Broadcast Data: ">` & 0xff
   \   0000F6   75....       MOV       ?V9,#(`?<Constant "Broadcast Data: ">` >> 8) & 0xff
   \   0000F9   75..00       MOV       ?V10,#0x0
   \   0000FC   78..         MOV       R0,#?V8
   \   0000FE   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   000101   7C10         MOV       R4,#0x10
   \   000103   7D00         MOV       R5,#0x0
   \   000105   7403         MOV       A,#0x3
   \   000107   12....       LCALL     ?XSTACK_DISP101_8
   \   00010A   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   00010D   7403         MOV       A,#0x3
   \   00010F   12....       LCALL     ?DEALLOC_XSTACK8
   1246                          osal_memcpy(bcMsg + 16, MSGpkt->cmd.Data, MSGpkt->cmd.DataLength);
   \   000112                ; Setup parameters for call to function osal_memcpy
   \   000112   12....       LCALL     ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_11:
   \   000115   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   000118   8E82         MOV       DPL,R6
   \   00011A   8F83         MOV       DPH,R7
   \   00011C   E0           MOVX      A,@DPTR
   \   00011D   FC           MOV       R4,A
   \   00011E   A3           INC       DPTR
   \   00011F   E0           MOVX      A,@DPTR
   \   000120   FD           MOV       R5,A
   \   000121   7413         MOV       A,#0x13
   \   000123   12....       LCALL     ?XSTACK_DISP0_8
   \   000126   AA82         MOV       R2,DPL
   \   000128   AB83         MOV       R3,DPH
   \   00012A   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   00012D   7403         MOV       A,#0x3
   \   00012F   12....       LCALL     ?DEALLOC_XSTACK8
   1247                          osal_memcpy(bcMsg + 16 + MSGpkt->cmd.DataLength, " Count: ", 8);
   \   000132                ; Setup parameters for call to function osal_memcpy
   \   000132   78..         MOV       R0,#?V4
   \   000134   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   000137   7C08         MOV       R4,#0x8
   \   000139   7D00         MOV       R5,#0x0
   \   00013B   8E82         MOV       DPL,R6
   \   00013D   8F83         MOV       DPH,R7
   \   00013F   7403         MOV       A,#0x3
   \   000141   12....       LCALL     ?XSTACK_DISP100_8
   \   000144   12....       LCALL     ?Subroutine9 & 0xFFFF
   \                     ??CrossCallReturnLabel_13:
   \   000147   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   00014A   7403         MOV       A,#0x3
   \   00014C   12....       LCALL     ?DEALLOC_XSTACK8
   1248                          bcMsg[24 + MSGpkt->cmd.DataLength] = '0' + bcCnt;
   \   00014F   90....       MOV       DPTR,#??bcCnt
   \   000152   8065         SJMP      ??zclZEM_AF_RxProc_5
   1249                          bcMsg[25 + MSGpkt->cmd.DataLength] = '\r';
   1250                          bcMsg[26 + MSGpkt->cmd.DataLength] = '\n';
   1251                          HalUARTWrite(HAL_UART_PORT_0, bcMsg, 27 + MSGpkt->cmd.DataLength);
   1252                      }
   1253                      break;
   1254                  case CLUSTER_GROUPCAST:
   1255                      gcCnt++;  // 接收到组播数据包，进行计数
   \                     ??zclZEM_AF_RxProc_3:
   \   000154   90....       MOV       DPTR,#??gcCnt
   \   000157   E0           MOVX      A,@DPTR
   \   000158   04           INC       A
   \   000159   F0           MOVX      @DPTR,A
   1256                      // 通过串口输出接收到的数据和计数器值
   1257                      {
   1258                          uint8 gcMsg[64];
   1259                          osal_memcpy(gcMsg, "Groupcast Data: ", 16);
   \   00015A                ; Setup parameters for call to function osal_memcpy
   \   00015A   75....       MOV       ?V8,#`?<Constant "Groupcast Data: ">` & 0xff
   \   00015D   75....       MOV       ?V9,#(`?<Constant "Groupcast Data: ">` >> 8) & 0xff
   \   000160   75..00       MOV       ?V10,#0x0
   \   000163   78..         MOV       R0,#?V8
   \   000165   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   000168   7C10         MOV       R4,#0x10
   \   00016A   7D00         MOV       R5,#0x0
   \   00016C   7403         MOV       A,#0x3
   \   00016E   12....       LCALL     ?XSTACK_DISP101_8
   \   000171   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   000174   7403         MOV       A,#0x3
   \   000176   12....       LCALL     ?DEALLOC_XSTACK8
   1260                          osal_memcpy(gcMsg + 16, MSGpkt->cmd.Data, MSGpkt->cmd.DataLength);
   \   000179                ; Setup parameters for call to function osal_memcpy
   \   000179   12....       LCALL     ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_12:
   \   00017C   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   00017F   8E82         MOV       DPL,R6
   \   000181   8F83         MOV       DPH,R7
   \   000183   E0           MOVX      A,@DPTR
   \   000184   FC           MOV       R4,A
   \   000185   A3           INC       DPTR
   \   000186   E0           MOVX      A,@DPTR
   \   000187   FD           MOV       R5,A
   \   000188   7413         MOV       A,#0x13
   \   00018A   12....       LCALL     ?XSTACK_DISP0_8
   \   00018D   AA82         MOV       R2,DPL
   \   00018F   AB83         MOV       R3,DPH
   \   000191   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   000194   7403         MOV       A,#0x3
   \   000196   12....       LCALL     ?DEALLOC_XSTACK8
   1261                          osal_memcpy(gcMsg + 16 + MSGpkt->cmd.DataLength, " Count: ", 8);
   \   000199                ; Setup parameters for call to function osal_memcpy
   \   000199   78..         MOV       R0,#?V4
   \   00019B   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   00019E   7C08         MOV       R4,#0x8
   \   0001A0   7D00         MOV       R5,#0x0
   \   0001A2   8E82         MOV       DPL,R6
   \   0001A4   8F83         MOV       DPH,R7
   \   0001A6   7403         MOV       A,#0x3
   \   0001A8   12....       LCALL     ?XSTACK_DISP100_8
   \   0001AB   12....       LCALL     ?Subroutine9 & 0xFFFF
   \                     ??CrossCallReturnLabel_14:
   \   0001AE   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   0001B1   7403         MOV       A,#0x3
   \   0001B3   12....       LCALL     ?DEALLOC_XSTACK8
   1262                          gcMsg[24 + MSGpkt->cmd.DataLength] = '0' + gcCnt;
   \   0001B6   90....       MOV       DPTR,#??gcCnt
   \                     ??zclZEM_AF_RxProc_5:
   \   0001B9   E0           MOVX      A,@DPTR
   \   0001BA   2430         ADD       A,#0x30
   \   0001BC   C0E0         PUSH      A
   1263                          gcMsg[25 + MSGpkt->cmd.DataLength] = '\r';
   1264                          gcMsg[26 + MSGpkt->cmd.DataLength] = '\n';
   1265                          HalUARTWrite(HAL_UART_PORT_0, gcMsg, 27 + MSGpkt->cmd.DataLength);
   1266                      }
   \   0001BE   12....       LCALL     ?Subroutine10 & 0xFFFF
   \                     ??CrossCallReturnLabel_52:
   \   0001C1   2418         ADD       A,#0x18
   \   0001C3   F582         MOV       DPL,A
   \   0001C5   E4           CLR       A
   \   0001C6   39           ADDC      A,R1
   \   0001C7   F583         MOV       DPH,A
   \   0001C9   D0E0         POP       A
   \   0001CB   12....       LCALL     ??Subroutine28_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_58:
   \   0001CE   2419         ADD       A,#0x19
   \   0001D0   12....       LCALL     ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_56:
   \   0001D3   241A         ADD       A,#0x1a
   \   0001D5   12....       LCALL     ?Subroutine20 & 0xFFFF
   \                     ??CrossCallReturnLabel_32:
   \   0001D8   241B         ADD       A,#0x1b
   \                     ??zclZEM_AF_RxProc_4:
   \   0001DA   FC           MOV       R4,A
   \   0001DB   A3           INC       DPTR
   \   0001DC   E0           MOVX      A,@DPTR
   \   0001DD   3400         ADDC      A,#0x0
   \   0001DF   FD           MOV       R5,A
   \   0001E0   AA..         MOV       R2,?XSP + 0
   \   0001E2   AB..         MOV       R3,?XSP + 1
   \   0001E4   7900         MOV       R1,#0x0
   \   0001E6   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
   1267                      break;
   1268                  default:
   1269                      break;
   1270              }
   1271          }
   \                     ??zclZEM_AF_RxProc_0:
   \   0001E9   745E         MOV       A,#0x5e
   \   0001EB   12....       LCALL     ?DEALLOC_XSTACK8
   \   0001EE   7F0B         MOV       R7,#0xb
   \   0001F0   02....       LJMP      ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine20:
   \   000000   F582         MOV       DPL,A
   \   000002   E4           CLR       A
   \   000003   39           ADDC      A,R1
   \   000004   F583         MOV       DPH,A
   \   000006   740A         MOV       A,#0xa
   \   000008   F0           MOVX      @DPTR,A
   \   000009                ; Setup parameters for call to function HalUARTWrite
   \   000009                ; Setup parameters for call to function HalUARTWrite
   \   000009   8E82         MOV       DPL,R6
   \   00000B   8F83         MOV       DPH,R7
   \   00000D   E0           MOVX      A,@DPTR
   \   00000E   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine10:
   \   000000   8E82         MOV       DPL,R6
   \   000002   8F83         MOV       DPH,R7
   \   000004   A8..         MOV       R0,?XSP + 0
   \   000006   88..         MOV       ?V0,R0
   \   000008                REQUIRE ??Subroutine27_0
   \   000008                ; // Fall through to label ??Subroutine27_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine27_0:
   \   000000   12....       LCALL     ?Subroutine23 & 0xFFFF
   \                     ??CrossCallReturnLabel_54:
   \   000003   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine23:
   \   000000   E0           MOVX      A,@DPTR
   \   000001   28           ADD       A,R0
   \   000002   F8           MOV       R0,A
   \   000003   A3           INC       DPTR
   \   000004   E0           MOVX      A,@DPTR
   \   000005   35..         ADDC      A,?V1
   \   000007   F9           MOV       R1,A
   \   000008   E8           MOV       A,R0
   \   000009   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine9:
   \   000000   89..         MOV       ?V1,R1
   \   000002   12....       LCALL     ?Subroutine23 & 0xFFFF
   \                     ??CrossCallReturnLabel_53:
   \   000005   2410         ADD       A,#0x10
   \   000007   FA           MOV       R2,A
   \   000008   E4           CLR       A
   \   000009   39           ADDC      A,R1
   \   00000A   FB           MOV       R3,A
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine8:
   \   000000   85..82       MOV       DPL,?V0
   \   000003   85..83       MOV       DPH,?V1
   \   000006   E0           MOVX      A,@DPTR
   \   000007   F5..         MOV       ?V0,A
   \   000009   A3           INC       DPTR
   \   00000A   E0           MOVX      A,@DPTR
   \   00000B   F5..         MOV       ?V1,A
   \   00000D   75..00       MOV       ?V2,#0x0
   \   000010   78..         MOV       R0,#?V0
   \   000012   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   F582         MOV       DPL,A
   \   000002   E4           CLR       A
   \   000003   39           ADDC      A,R1
   \   000004   F583         MOV       DPH,A
   \   000006   740D         MOV       A,#0xd
   \   000008                REQUIRE ??Subroutine28_0
   \   000008                ; // Fall through to label ??Subroutine28_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine28_0:
   \   000000   F0           MOVX      @DPTR,A
   \   000001   8E82         MOV       DPL,R6
   \   000003   8F83         MOV       DPH,R7
   \   000005   E0           MOVX      A,@DPTR
   \   000006   25..         ADD       A,?V0
   \   000008   F8           MOV       R0,A
   \   000009   A3           INC       DPTR
   \   00000A   E0           MOVX      A,@DPTR
   \   00000B   35..         ADDC      A,?V1
   \   00000D   F9           MOV       R1,A
   \   00000E   E8           MOV       A,R0
   \   00000F   22           RET

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   \                     ??p2pCnt:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   \                     ??bcCnt:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   \                     ??gcCnt:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   E0           MOVX      A,@DPTR
   \   000001   04           INC       A
   \   000002   F0           MOVX      @DPTR,A
   \   000003                ; Setup parameters for call to function AF_DataRequest
   \   000003                ; Setup parameters for call to function AF_DataRequest
   \   000003                ; Setup parameters for call to function AF_DataRequest
   \   000003   75..1E       MOV       ?V2,#0x1e
   \   000006   78..         MOV       R0,#?V2
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   F0           MOVX      @DPTR,A
   \   000001   85..82       MOV       DPL,?XSP + 0
   \   000004   85..83       MOV       DPH,?XSP + 1
   \   000007   22           RET

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZEM_AppEp>`:
   \   000000   08           DB 8
   \   000001   00           DB 0
   \   000002   ....         DW zclZEM_TaskID
   \   000004   ....         DW zclZEM_SimpleDesc
   \   000006   00           DB 0

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for reportableChange>`:
   \   000000   2C           DB 44
   \   000001   01           DB 1
   \   000002   00           DB 0
   \   000003   00           DB 0

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zclZEM_CmdCallbacks>`:
   \   000000   ....         DW `??zclZEM_BasicResetCB::?relay`
   \   000002   0000         DW 0H
   \   000004   0000         DW 0H
   \   000006   0000         DW 0H
   \   000008   0000         DW 0H
   \   00000A   0000         DW 0H
   \   00000C   0000         DW 0H
   \   00000E   0000         DW 0H
   \   000010   0000         DW 0H

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_Init::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_event_loop::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_event_loop

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_ReadAndSendMAC::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_ReadAndSendMAC

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_UartCB::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_UartCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_ProcessCommissioningStatus::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_ProcessCommissioningStatus

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_BasicResetCB::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_BasicResetCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleApp_BatteryWarningCB::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleApp_BatteryWarningCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_ProcessIncomingMsg::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_ProcessIncomingMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_ProcessInDiscCmdsRspCmd::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_ProcessInDiscCmdsRspCmd

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_AF_RxProc::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_AF_RxProc

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "/0123456789abcdef/1/2/2">`:
   \   000000   2F303132     DB "/0123456789abcdef/1/2/2"
   \            33343536
   \            37383961
   \            62636465
   \            662F312F
   \            322F3200

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "/123456789abcdef0/2/3/6">`:
   \   000000   2F313233     DB "/123456789abcdef0/2/3/6"
   \            34353637
   \            38396162
   \            63646566
   \            302F322F
   \            332F3600

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "/23456789abcdef01/0/2...">`:
   \   000000   2F323334     DB "/23456789abcdef01/0/220/0"
   \            35363738
   \            39616263
   \            64656630
   \            312F302F
   \            3232302F
   \            3000    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Broadcast">`:
   \   000000   42726F61     DB "Broadcast"
   \            64636173
   \            7400    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Groupcast">`:
   \   000000   47726F75     DB "Groupcast"
   \            70636173
   \            7400    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "ZEM_P2P_EVT processed...">`:
   \   000000   5A454D5F     DB "ZEM_P2P_EVT processed! Network state: "
   \            5032505F
   \            45565420
   \            70726F63
   \            65737365
   \            6421204E
   \            6574776F
   \            726B2073
   \            74617465
   \            3A2000  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "MAC address sent to c...">`:
   \   000000   4D414320     DB "MAC address sent to coordinator!\015\012"
   \            61646472
   \            65737320
   \            73656E74
   \            20746F20
   \            636F6F72
   \            64696E61
   \            746F7221
   \            0D0A00  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "MAC: ">`:
   \   000000   4D41433A     DB "MAC: "
   \            2000    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Network formation suc...">`:
   \   000000   4E657477     DB "Network formation successful! PANID: "
   \            6F726B20
   \            666F726D
   \            6174696F
   \            6E207375
   \            63636573
   \            7366756C
   \            21205041
   \            4E49443A
   \            2000    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Network Address: 0x">`:
   \   000000   4E657477     DB "Network Address: 0x"
   \            6F726B20
   \            41646472
   \            6573733A
   \            20307800

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Network formation fai...">`:
   \   000000   4E657477     DB "Network formation failed! Retrying...\015\012"
   \            6F726B20
   \            666F726D
   \            6174696F
   \            6E206661
   \            696C6564
   \            21205265
   \            74727969
   \            6E672E2E
   \            2E0D0A00

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "P2P Data: ">`:
   \   000000   50325020     DB "P2P Data: "
   \            44617461
   \            3A2000  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant " Count: ">`:
   \   000000   20436F75     DB " Count: "
   \            6E743A20
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Broadcast message rec...">`:
   \   000000   42726F61     DB "Broadcast message received!\015\012"
   \            64636173
   \            74206D65
   \            73736167
   \            65207265
   \            63656976
   \            6564210D
   \            0A00    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Broadcast Data: ">`:
   \   000000   42726F61     DB "Broadcast Data: "
   \            64636173
   \            74204461
   \            74613A20
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Groupcast Data: ">`:
   \   000000   47726F75     DB "Groupcast Data: "
   \            70636173
   \            74204461
   \            74613A20
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_7d0:
   \   000000   D0070000     DD 2000

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3e8:
   \   000000   E8030000     DD 1000
   1272          
   1273          /****************************************************************************
   1274          ****************************************************************************/
   1275          
   1276          

   Maximum stack usage in bytes:

   ISTACK XSTACK Function
   ------ ------ --------
      0      0   zclSampleApp_BatteryWarningCB
      1    385   zclZEM_AF_RxProc
        0    113   -> HalUARTWrite
        0    116   -> osal_memcpy
      2      0   zclZEM_BasicResetCB
        2      0   -> zclZEM_ResetAttributesToDefaultValues
      0     45   zclZEM_Init
        0     39   -> HalUARTOpen
        0     39   -> NLME_PermitJoiningRequest
        0     39   -> NLME_SetDefaultNV
        0     39   -> RegisterForKeys
        0     39   -> RegisterVoltageWarningCB
        0     39   -> afRegister
        0     39   -> bdb_RegisterCommissioningStatusCB
        0     39   -> bdb_RegisterSimpleDescriptor
        0     45   -> bdb_RepAddAttrCfgRecordDefaultToList
        0     39   -> bdb_StartCommissioning
        0     43   -> osal_start_timerEx
        0     39   -> zclGeneral_RegisterCmdCallbacks
        0     39   -> zclZEM_ReadAndSendMAC
        0     39   -> zclZEM_ResetAttributesToDefaultValues
        0     39   -> zcl_registerAttrList
        0     39   -> zcl_registerForMsg
      1    126   zclZEM_ProcessCommissioningStatus
        0    122   -> HalLedSet
        0    122   -> HalUARTWrite
        0    122   -> NLME_GetShortAddr
        0    122   -> NLME_PermitJoiningRequest
        0    122   -> bdb_StartCommissioning
        0    126   -> osal_start_timerEx
      2      9   zclZEM_ProcessInDiscCmdsRspCmd
      0    278   zclZEM_ProcessIncomingMsg
        0      9   -> osal_mem_free
        0      9   -> zclZEM_ProcessInDiscCmdsRspCmd
      1    110   zclZEM_ReadAndSendMAC
        0     68   -> HalUARTWrite
        0     68   -> NLME_GetExtAddr
        0     71   -> osal_memcpy
      0      9   zclZEM_UartCB
        0      9   -> HalUARTRead
        0      9   -> HalUARTWrite
        0      9   -> Hal_UART_RxBufLen
      1    278   zclZEM_event_loop
        0    278   -> AF_DataRequest
        0    269   -> HalUARTWrite
        0    269   -> NLME_GetExtAddr
        0    269   -> bdb_StartCommissioning
        0    272   -> osal_memcpy
        0    269   -> osal_msg_deallocate
        0    269   -> osal_msg_receive
        0    273   -> osal_start_timerEx
        0    269   -> zclZEM_AF_RxProc
        0    269   -> zclZEM_ProcessIncomingMsg


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
       9  ?<Constant " Count: ">
      24  ?<Constant "/0123456789abcdef/1/2/2">
      24  ?<Constant "/123456789abcdef0/2/3/6">
      26  ?<Constant "/23456789abcdef01/0/2...">
      17  ?<Constant "Broadcast Data: ">
      30  ?<Constant "Broadcast message rec...">
      10  ?<Constant "Broadcast">
      17  ?<Constant "Groupcast Data: ">
      10  ?<Constant "Groupcast">
      35  ?<Constant "MAC address sent to c...">
       6  ?<Constant "MAC: ">
      20  ?<Constant "Network Address: 0x">
      40  ?<Constant "Network formation fai...">
      38  ?<Constant "Network formation suc...">
      11  ?<Constant "P2P Data: ">
      39  ?<Constant "ZEM_P2P_EVT processed...">
       7  ?<Initializer for ZEM_AppEp>
       4  ?<Initializer for reportableChange>
      18  ?<Initializer for zclZEM_CmdCallbacks>
       8  ??Subroutine24_0
       9  ??Subroutine25_0
       8  ??Subroutine26_0
       4  ??Subroutine27_0
      16  ??Subroutine28_0
       8  ?Subroutine0
       5  ?Subroutine1
       8  ?Subroutine10
      16  ?Subroutine11
       4  ?Subroutine12
       4  ?Subroutine13
      16  ?Subroutine14
       5  ?Subroutine15
       2  ?Subroutine16
       8  ?Subroutine17
       7  ?Subroutine18
       4  ?Subroutine19
       7  ?Subroutine2
      15  ?Subroutine20
      14  ?Subroutine21
       3  ?Subroutine22
      10  ?Subroutine23
       8  ?Subroutine3
       7  ?Subroutine4
       8  ?Subroutine5
      10  ?Subroutine6
       9  ?Subroutine7
      19  ?Subroutine8
      12  ?Subroutine9
       1  P1DIR
       1  P1SEL
       1  PERCFG
       7  ZEM_AppEp
       4  __Constant_3e8
       4  __Constant_7d0
       1  bcCnt
       1  gcCnt
       1  p2pCnt
       4  reportableChange
       1  sendType
       1  transferId
       1  transferId
       1  transferId
       3  zclSampleApp_BatteryWarningCB
       6  zclSampleApp_BatteryWarningCB::?relay
     499  zclZEM_AF_RxProc
       6  zclZEM_AF_RxProc::?relay
       7  zclZEM_BasicResetCB
       6  zclZEM_BasicResetCB::?relay
      18  zclZEM_CmdCallbacks
     286  zclZEM_Init
       6  zclZEM_Init::?relay
       1  zclZEM_NwkState
     408  zclZEM_ProcessCommissioningStatus
       6  zclZEM_ProcessCommissioningStatus::?relay
      37  zclZEM_ProcessInDiscCmdsRspCmd
       6  zclZEM_ProcessInDiscCmdsRspCmd::?relay
     139  zclZEM_ProcessIncomingMsg
       6  zclZEM_ProcessIncomingMsg::?relay
     211  zclZEM_ReadAndSendMAC
       6  zclZEM_ReadAndSendMAC::?relay
       1  zclZEM_TaskID
      64  zclZEM_UartBuf
      39  zclZEM_UartCB
       6  zclZEM_UartCB::?relay
    1088  zclZEM_event_loop
       6  zclZEM_event_loop::?relay

 
 2 971 bytes in segment BANKED_CODE
    60 bytes in segment BANK_RELAYS
     3 bytes in segment SFR_AN
    29 bytes in segment XDATA_I
    29 bytes in segment XDATA_ID
   364 bytes in segment XDATA_ROM_C
    73 bytes in segment XDATA_Z
 
    89 bytes of CODE     memory
   356 bytes of CONST    memory (+ 8 bytes shared)
     0 bytes of DATA     memory (+ 3 bytes shared)
 2 971 bytes of HUGECODE memory
   102 bytes of XDATA    memory

Errors: none
Warnings: 1

###############################################################################
#
# IAR C/C++ Compiler V10.10.1.4655 for 8051               06/Feb/2026  13:38:05
# Copyright 2004-2017 IAR Systems AB.
# Standalone license - IAR Embedded Workbench for 8051
#
#    Core               =  plain
#    Code model         =  banked
#    Data model         =  large
#    Calling convention =  xdata reentrant
#    Constant location  =  data_rom
#    Dptr setup         =  1,16
#                          
#    Source file        =  
#        D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\Source\zcl_ZEM.c
#    Command line       =  
#        -f C:\Users\KLF\AppData\Local\Temp\EWEE32.tmp ("D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\Source\zcl_ZEM.c" -D
#        BDB_REPORTING -D xPOWER_SAVING -D NWK_AUTO_POLL -D xZTOOL_P1 -D
#        xMT_TASK -D xMT_APP_FUNC -D xMT_SYS_FUNC -D xMT_ZDO_FUNC -D
#        xMT_APP_CNF_FUNC -D LCD_SUPPORTED=DEBUG -D MULTICAST_ENABLED=FALSE -D
#        ZCL_READ -D ZCL_DISCOVER -D ZCL_WRITE -D ZCL_BASIC -D ZCL_IDENTIFY -D
#        ZCL_TEMPERATURE_MEASUREMENT -D ZCL_GROUPS -D HAL_UART=TRUE -D
#        INT_HEAP_LEN=2048 -lC "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\EndDeviceEB\List"
#        -lA "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\EndDeviceEB\List"
#        --diag_suppress Pe001,Pa010 -o "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\EndDeviceEB\Obj" -e
#        --debug --core=plain --dptr=16,1 --data_model=large
#        --code_model=banked --calling_convention=xdata_reentrant
#        --place_constants=data_rom --nr_virtual_regs 16 -f "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\Tools\CC2530DB\f8wEndev.cfg"
#        (-DCPU32MHZ -DROOT=__near_func -DMAC_CFG_TX_DATA_MAX=3
#        -DMAC_CFG_TX_MAX=6 -DMAC_CFG_RX_MAX=3) -f "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\Tools\CC2530DB\f8wConfig.cfg"
#        (-DZIGBEEPRO -DSECURE=1 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR
#        -DDEFAULT_CHANLIST=0x00100000 -DZDAPP_CONFIG_PAN_ID=0x1234
#        -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MASK=0x007F
#        -DBEACON_REQUEST_DELAY=100 -DBEACON_REQ_DELAY_MASK=0x00FF
#        -DLINK_STATUS_JITTER_MASK=0x007F -DROUTE_EXPIRY_TIME=30
#        -DAPSC_ACK_WAIT_DURATION_POLLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7
#        -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3
#        -DNWK_MAX_DATA_RETRIES=2 -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9
#        -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40 -DNWK_MAX_BINDING_ENTRIES=4
#        -DMAX_BINDING_CLUSTER_IDS=4 -DDEFAULT_KEY={0} -DMAC_MAX_FRAME_SIZE=116
#        -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const __code"
#        -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000
#        -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100 -DREJOIN_POLL_RATE=440
#        -DREJOIN_BACKOFF=900000 -DREJOIN_SCAN=900000 -DENABLE_LED4_DISABLE_S1)
#        -f "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\Tools\CC2530DB\f8wZCL.cfg"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\" -I
#        "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\Source\" -I
#        "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\Source\" -I
#        "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\ZMain\TI2530DB\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\hal\include\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\hal\target\CC2530EB\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\mac\include\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\mac\high_level\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\mac\low_level\srf04\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\mac\low_level\srf04\single_chip\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\mt\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\osal\include\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\services\saddr\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\services\sdata\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\af\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\bdb\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\gp\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\nwk\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\sapi\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\sec\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\sys\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\zcl\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\zdo\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\zmac\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\zmac\f8w\"
#        -Ohz --require_prototypes)
#    Locale             =  Chinese (Simplified)_China.936
#    List file          =  
#        D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\EndDeviceEB\List\zcl_ZEM.lst
#    Object file        =  
#        D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\EndDeviceEB\Obj\zcl_ZEM.r51
#
###############################################################################

D:\project\Z-Stack 3.0.2\Projects\zstack\HomeAutomation\ZEM\Source\zcl_ZEM.c
      1          /*********************************************************************
      2           * INCLUDES
      3           */
      4          #include "ZComDef.h"
      5          #include "OSAL.h"
      6          #include "AF.h"
      7          #include "ZDApp.h"
      8          #include "ZDObject.h"
      9          #include "ZDProfile.h"
     10          #include "MT_SYS.h"
     11          
     12          #include "zcl.h"
     13          #include "zcl_general.h"
     14          #include "zcl_ha.h"
     15          #include "zcl_ms.h"
     16          
     17          #include "zcl_ZEM.h"
     18          
     19          #include "onboard.h"

   \                                 In  segment SFR_AN, at 0xf1
   \   unsigned char volatile __sfr PERCFG
   \                     PERCFG:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xf4
   \   unsigned char volatile __sfr P1SEL
   \                     P1SEL:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xfe
   \   unsigned char volatile __sfr P1DIR
   \                     P1DIR:
   \   000000                DS 1
     20          
     21          /* HAL */
     22          #include "hal_lcd.h"
     23          #include "hal_led.h"
     24          #include "hal_key.h"
     25          #include "hal_uart.h"
     26          
     27          #include "bdb_interface.h"
     28          #include "bdb_Reporting.h"
     29             
     30          /*********************************************************************
     31           * MACROS
     32           */
     33          
     34          // how often to report temperature
     35          #define ZEM_REPORT_INTERVAL   10000
     36          
     37          #define GUI_LOCAL_TEMP    1
     38          
     39          #define APP_TITLE "   Temp Sensor  "
     40          
     41          /*********************************************************************
     42           * CONSTANTS
     43           */
     44          
     45          /*********************************************************************
     46           * TYPEDEFS
     47           */
     48          
     49          /*********************************************************************
     50           * GLOBAL VARIABLES
     51           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     52          byte zclZEM_TaskID;
   \                     zclZEM_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     53          
     54          extern int16 zdpExternalStateTaskID;
     55          
     56          // UART Buffer

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     57          static uint8 zclZEM_UartBuf[ZCLZEM_UART_BUF_LEN];
   \                     zclZEM_UartBuf:
   \   000000                DS 64
   \   000040                REQUIRE __INIT_XDATA_Z
     58          
     59          /*********************************************************************
     60           * GLOBAL FUNCTIONS
     61           */
     62          
     63          /*********************************************************************
     64           * LOCAL VARIABLES
     65           */
     66          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     67          uint8 zclZEM_NwkState = 0; // DEV_INIT
   \                     zclZEM_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     68          
     69          //static uint8 aProcessCmd[] = { 1, 0, 0, 0 }; // used for reset command, { length + cmd0 + cmd1 + data }
     70          
     71          // Application Endpoint for data communication

   \                                 In  segment XDATA_I, align 1, keep-with-next
     72          static endPointDesc_t ZEM_AppEp =
   \                     ZEM_AppEp:
   \   000000                DS 7
   \   000007                REQUIRE `?<Initializer for ZEM_AppEp>`
   \   000007                REQUIRE __INIT_XDATA_I
     73          {
     74            ZEM_ENDPOINT,                       // Application endpoint
     75            0,
     76            &zclZEM_TaskID,
     77            (SimpleDescriptionFormat_t *)&zclZEM_SimpleDesc,                 // Simple description for this application
     78            (afNetworkLatencyReq_t)0            // No Network Latency req
     79          };
     80          #ifdef BDB_REPORTING
     81          #if BDBREPORTING_MAX_ANALOG_ATTR_SIZE == 8
     82            uint8 reportableChange[] = {0x2C, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}; // 0x2C01 is 300 in int16
     83          #endif
     84          #if BDBREPORTING_MAX_ANALOG_ATTR_SIZE == 4

   \                                 In  segment XDATA_I, align 1, keep-with-next
     85            uint8 reportableChange[] = {0x2C, 0x01, 0x00, 0x00}; // 0x2C01 is 300 in int16
   \                     reportableChange:
   \   000000                DS 4
   \   000004                REQUIRE `?<Initializer for reportableChange>`
   \   000004                REQUIRE __INIT_XDATA_I
     86          #endif 
     87          #if BDBREPORTING_MAX_ANALOG_ATTR_SIZE == 2
     88            uint8 reportableChange[] = {0x2C, 0x01}; // 0x2C01 is 300 in int16
     89          #endif 
     90          #endif
     91          
     92          /*********************************************************************
     93           * LOCAL FUNCTIONS
     94           */
     95          static void zclZEM_HandleKeys( byte shift, byte keys );
     96          static void zclZEM_BasicResetCB( void );
     97          
     98          static void zclZEM_ProcessCommissioningStatus(bdbCommissioningModeMsg_t* bdbCommissioningModeMsg);
     99          
    100          // Functions to process ZCL Foundation incoming Command/Response messages
    101          static void zclZEM_ProcessIncomingMsg( zclIncomingMsg_t *msg );
    102          #ifdef ZCL_READ
    103          static uint8 zclZEM_ProcessInReadRspCmd( zclIncomingMsg_t *pInMsg );
    104          #endif
    105          #ifdef ZCL_WRITE
    106          static uint8 zclZEM_ProcessInWriteRspCmd( zclIncomingMsg_t *pInMsg );
    107          #endif
    108          static uint8 zclZEM_ProcessInDefaultRspCmd( zclIncomingMsg_t *pInMsg );
    109          #ifdef ZCL_DISCOVER
    110          static uint8 zclZEM_ProcessInDiscCmdsRspCmd( zclIncomingMsg_t *pInMsg );
    111          static uint8 zclZEM_ProcessInDiscAttrsRspCmd( zclIncomingMsg_t *pInMsg );
    112          static uint8 zclZEM_ProcessInDiscAttrsExtRspCmd( zclIncomingMsg_t *pInMsg );
    113          #endif // ZCL_DISCOVER
    114          
    115          static void zclSampleApp_BatteryWarningCB( uint8 voltLevel);
    116          
    117          /*********************************************************************
    118           * STATUS STRINGS
    119           */
    120          
    121          /*********************************************************************
    122           * CONSTANTS
    123           */
    124          
    125          
    126          /*********************************************************************
    127           * ZCL General Profile Callback table
    128           */

   \                                 In  segment XDATA_I, align 1, keep-with-next
    129          static zclGeneral_AppCallbacks_t zclZEM_CmdCallbacks =
   \                     zclZEM_CmdCallbacks:
   \   000000                DS 18
   \   000012                REQUIRE `?<Initializer for zclZEM_CmdCallbacks>`
   \   000012                REQUIRE __INIT_XDATA_I
    130          {
    131            zclZEM_BasicResetCB,        // Basic Cluster Reset command
    132            NULL,                                           // Identify Trigger Effect command
    133            NULL,             				                      // On/Off cluster command
    134            NULL,                                           // On/Off cluster enhanced command Off with Effect
    135            NULL,                                           // On/Off cluster enhanced command On with Recall Global Scene
    136            NULL,                                           // On/Off cluster enhanced command On with Timed Off
    137          #ifdef ZCL_LEVEL_CTRL
    138            NULL,                                           // Level Control Move to Level command
    139            NULL,                                           // Level Control Move command
    140            NULL,                                           // Level Control Step command
    141            NULL,                                           // Level Control Stop command
    142          #endif
    143          #ifdef ZCL_GROUPS
    144            NULL,                                           // Group Response commands
    145          #endif
    146          #ifdef ZCL_SCENES
    147            NULL,                                           // Scene Store Request command
    148            NULL,                                           // Scene Recall Request command
    149            NULL,                                           // Scene Response command
    150          #endif
    151          #ifdef ZCL_ALARMS
    152            NULL,                                           // Alarm (Response) commands
    153          #endif
    154          #ifdef SE_UK_EXT
    155            NULL,                                           // Get Event Log command
    156            NULL,                                           // Publish Event Log command
    157          #endif
    158            NULL,                                           // RSSI Location command
    159            NULL                                            // RSSI Location Response command
    160          };
    161          
    162          /*********************************************************************
    163           * @fn          zclZEM_Init
    164           *
    165           * @brief       Initialization function for the zclGeneral layer.
    166           *
    167           * @param       none
    168           *
    169           * @return      none
    170           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    171          void zclZEM_Init( byte task_id )
   \                     zclZEM_Init:
    172          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV       A,#-0xa
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 29
   \   000005   74E3         MOV       A,#-0x1d
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   \   00000A   E9           MOV       A,R1
    173            zclZEM_TaskID = task_id;
   \   00000B   90....       MOV       DPTR,#zclZEM_TaskID
   \   00000E   F0           MOVX      @DPTR,A
    174          
    175            // Register the Simple Descriptor for this application
    176            bdb_RegisterSimpleDescriptor( &zclZEM_SimpleDesc ); 
   \   00000F                ; Setup parameters for call to function bdb_RegisterSimpleDescriptor
   \   00000F   7A..         MOV       R2,#zclZEM_SimpleDesc & 0xff
   \   000011   7B..         MOV       R3,#(zclZEM_SimpleDesc >> 8) & 0xff
   \   000013   12....       LCALL     `??bdb_RegisterSimpleDescriptor::?relay`; Banked call to: bdb_RegisterSimpleDescriptor
    177            
    178            // Register the ZCL General Cluster Library callback functions
    179            zclGeneral_RegisterCmdCallbacks( ZEM_ENDPOINT, &zclZEM_CmdCallbacks );
   \   000016                ; Setup parameters for call to function zclGeneral_RegisterCmdCallbacks
   \   000016   7A..         MOV       R2,#zclZEM_CmdCallbacks & 0xff
   \   000018   7B..         MOV       R3,#(zclZEM_CmdCallbacks >> 8) & 0xff
   \   00001A   7908         MOV       R1,#0x8
   \   00001C   12....       LCALL     `??zclGeneral_RegisterCmdCallbacks::?relay`; Banked call to: zclGeneral_RegisterCmdCallbacks
    180          
    181            // Register the application's attribute list
    182            zclZEM_ResetAttributesToDefaultValues();
   \   00001F                ; Setup parameters for call to function zclZEM_ResetAttributesToDefaultValues
   \   00001F   12....       LCALL     `??zclZEM_ResetAttributesToDefaultValues::?relay`; Banked call to: zclZEM_ResetAttributesToDefaultValues
    183            zcl_registerAttrList( ZEM_ENDPOINT, zclZEM_NumAttributes, zclZEM_Attrs );
   \   000022                ; Setup parameters for call to function zcl_registerAttrList
   \   000022   7C..         MOV       R4,#zclZEM_Attrs & 0xff
   \   000024   7D..         MOV       R5,#(zclZEM_Attrs >> 8) & 0xff
   \   000026   90....       MOV       DPTR,#zclZEM_NumAttributes
   \   000029   E4           CLR       A
   \   00002A   93           MOVC      A,@A+DPTR
   \   00002B   FA           MOV       R2,A
   \   00002C   7908         MOV       R1,#0x8
   \   00002E   12....       LCALL     `??zcl_registerAttrList::?relay`; Banked call to: zcl_registerAttrList
    184          
    185            // Register the Application to receive the unprocessed Foundation command/response messages
    186            zcl_registerForMsg( zclZEM_TaskID );
   \   000031                ; Setup parameters for call to function zcl_registerForMsg
   \   000031   90....       MOV       DPTR,#zclZEM_TaskID
   \   000034   E0           MOVX      A,@DPTR
   \   000035   F9           MOV       R1,A
   \   000036   12....       LCALL     `??zcl_registerForMsg::?relay`; Banked call to: zcl_registerForMsg
    187          
    188            // Register low voltage NV memory protection application callback
    189            RegisterVoltageWarningCB( zclSampleApp_BatteryWarningCB );
   \   000039                ; Setup parameters for call to function RegisterVoltageWarningCB
   \   000039   7A..         MOV       R2,#`??zclSampleApp_BatteryWarningCB::?relay` & 0xff
   \   00003B   7B..         MOV       R3,#(`??zclSampleApp_BatteryWarningCB::?relay` >> 8) & 0xff
   \   00003D   12....       LCALL     `??RegisterVoltageWarningCB::?relay`; Banked call to: RegisterVoltageWarningCB
    190          
    191            // Register for all key events - This app will handle all key events
    192            RegisterForKeys( zclZEM_TaskID );
   \   000040                ; Setup parameters for call to function RegisterForKeys
   \   000040   90....       MOV       DPTR,#zclZEM_TaskID
   \   000043   E0           MOVX      A,@DPTR
   \   000044   F9           MOV       R1,A
   \   000045   12....       LCALL     `??RegisterForKeys::?relay`; Banked call to: RegisterForKeys
    193          
    194            bdb_RegisterCommissioningStatusCB( zclZEM_ProcessCommissioningStatus );
   \   000048                ; Setup parameters for call to function bdb_RegisterCommissioningStatusCB
   \   000048   7A..         MOV       R2,#`??zclZEM_ProcessCommissioningStatus::?relay` & 0xff
   \   00004A   7B..         MOV       R3,#(`??zclZEM_ProcessCommissioningStatus::?relay` >> 8) & 0xff
   \   00004C   12....       LCALL     `??bdb_RegisterCommissioningStatusCB::?relay`; Banked call to: bdb_RegisterCommissioningStatusCB
    195          
    196            // Register the endpoint with AF (Application Framework)
    197            afRegister( &ZEM_AppEp  );
   \   00004F                ; Setup parameters for call to function afRegister
   \   00004F   7A..         MOV       R2,#ZEM_AppEp & 0xff
   \   000051   7B..         MOV       R3,#(ZEM_AppEp >> 8) & 0xff
   \   000053   12....       LCALL     `??afRegister::?relay`; Banked call to: afRegister
    198            
    199            // Initialize UART communication
    200            zclZEM_InitUart();
   \   000056   43F101       ORL       0xf1,#0x1
   \   000059   43F430       ORL       0xf4,#0x30
   \   00005C   43FE10       ORL       0xfe,#0x10
   \   00005F   53FEDF       ANL       0xfe,#0xdf
   \   000062   85..82       MOV       DPL,?XSP + 0
   \   000065   85..83       MOV       DPH,?XSP + 1
   \   000068   7401         MOV       A,#0x1
   \   00006A   F0           MOVX      @DPTR,A
   \   00006B   12....       LCALL     ?XSTACK_DISP0_8
   \   00006E   7404         MOV       A,#0x4
   \   000070   F0           MOVX      @DPTR,A
   \   000071   7402         MOV       A,#0x2
   \   000073   12....       LCALL     ?XSTACK_DISP0_8
   \   000076   E4           CLR       A
   \   000077   F0           MOVX      @DPTR,A
   \   000078   7403         MOV       A,#0x3
   \   00007A   12....       LCALL     ?XSTACK_DISP0_8
   \   00007D   E4           CLR       A
   \   00007E   F0           MOVX      @DPTR,A
   \   00007F   A3           INC       DPTR
   \   000080   F0           MOVX      @DPTR,A
   \   000081   740A         MOV       A,#0xa
   \   000083   12....       LCALL     ?XSTACK_DISP0_8
   \   000086   7440         MOV       A,#0x40
   \   000088   F0           MOVX      @DPTR,A
   \   000089   A3           INC       DPTR
   \   00008A   E4           CLR       A
   \   00008B   F0           MOVX      @DPTR,A
   \   00008C   7412         MOV       A,#0x12
   \   00008E   12....       LCALL     ?XSTACK_DISP0_8
   \   000091   E4           CLR       A
   \   000092   F0           MOVX      @DPTR,A
   \   000093   A3           INC       DPTR
   \   000094   F0           MOVX      @DPTR,A
   \   000095   7405         MOV       A,#0x5
   \   000097   12....       LCALL     ?XSTACK_DISP0_8
   \   00009A   7406         MOV       A,#0x6
   \   00009C   F0           MOVX      @DPTR,A
   \   00009D   7416         MOV       A,#0x16
   \   00009F   12....       LCALL     ?XSTACK_DISP0_8
   \   0000A2   7401         MOV       A,#0x1
   \   0000A4   F0           MOVX      @DPTR,A
   \   0000A5   741B         MOV       A,#0x1b
   \   0000A7   12....       LCALL     ?XSTACK_DISP0_8
   \   0000AA   74..         MOV       A,#`??zclZEM_UartCB::?relay` & 0xff
   \   0000AC   F0           MOVX      @DPTR,A
   \   0000AD   A3           INC       DPTR
   \   0000AE   74..         MOV       A,#(`??zclZEM_UartCB::?relay` >> 8) & 0xff
   \   0000B0   F0           MOVX      @DPTR,A
   \   0000B1                ; Setup parameters for call to function HalUARTOpen
   \   0000B1   AA..         MOV       R2,?XSP + 0
   \   0000B3   AB..         MOV       R3,?XSP + 1
   \   0000B5   7900         MOV       R1,#0x0
   \   0000B7   12....       LCALL     `??HalUARTOpen::?relay`; Banked call to: HalUARTOpen
    201          
    202          #ifdef ZDO_COORDINATOR
    203            bdb_StartCommissioning( BDB_COMMISSIONING_MODE_NWK_FORMATION |
    204                                    BDB_COMMISSIONING_MODE_FINDING_BINDING );
    205            NLME_PermitJoiningRequest(255);
    206          
    207          #else
    208            bdb_StartCommissioning( BDB_COMMISSIONING_MODE_NWK_STEERING |
    209                                    BDB_COMMISSIONING_MODE_FINDING_BINDING );
   \   0000BA                ; Setup parameters for call to function bdb_StartCommissioning
   \   0000BA   790A         MOV       R1,#0xa
   \   0000BC   12....       LCALL     `??bdb_StartCommissioning::?relay`; Banked call to: bdb_StartCommissioning
    210          #endif
    211            
    212            // Read and send MAC address
    213            zclZEM_ReadAndSendMAC();
   \   0000BF                ; Setup parameters for call to function zclZEM_ReadAndSendMAC
   \   0000BF   12....       LCALL     `??zclZEM_ReadAndSendMAC::?relay`; Banked call to: zclZEM_ReadAndSendMAC
    214          
    215          #ifdef BDB_REPORTING
    216            //Adds the default configuration values for the temperature attribute of the ZCL_CLUSTER_ID_MS_TEMPERATURE_MEASUREMENT cluster, for endpoint ZEM_ENDPOINT
    217            //Default maxReportingInterval value is 10 seconds
    218            //Default minReportingInterval value is 3 seconds
    219            //Default reportChange value is 300 (3 degrees)
    220            bdb_RepAddAttrCfgRecordDefaultToList(ZEM_ENDPOINT, ZCL_CLUSTER_ID_MS_TEMPERATURE_MEASUREMENT, ATTRID_MS_TEMPERATURE_MEASURED_VALUE, 0, 10, reportableChange);
   \   0000C2                ; Setup parameters for call to function bdb_RepAddAttrCfgRecordDefaultToList
   \   0000C2   75....       MOV       ?V0,#reportableChange & 0xff
   \   0000C5   75....       MOV       ?V1,#(reportableChange >> 8) & 0xff
   \   0000C8   78..         MOV       R0,#?V0
   \   0000CA   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000CD   75..0A       MOV       ?V0,#0xa
   \   0000D0   75..00       MOV       ?V1,#0x0
   \   0000D3   78..         MOV       R0,#?V0
   \   0000D5   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000D8   E4           CLR       A
   \   0000D9   F5..         MOV       ?V0,A
   \   0000DB   78..         MOV       R0,#?V0
   \   0000DD   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000E0   7C00         MOV       R4,#0x0
   \   0000E2   7D00         MOV       R5,#0x0
   \   0000E4   7A02         MOV       R2,#0x2
   \   0000E6   7B04         MOV       R3,#0x4
   \   0000E8   7908         MOV       R1,#0x8
   \   0000EA   12....       LCALL     `??bdb_RepAddAttrCfgRecordDefaultToList::?relay`; Banked call to: bdb_RepAddAttrCfgRecordDefaultToList
   \   0000ED   7406         MOV       A,#0x6
   \   0000EF   12....       LCALL     ?DEALLOC_XSTACK8
    221          #endif
    222            
    223            zdpExternalStateTaskID = zclZEM_TaskID;
   \   0000F2   90....       MOV       DPTR,#zclZEM_TaskID
   \   0000F5   E0           MOVX      A,@DPTR
   \   0000F6   90....       MOV       DPTR,#zdpExternalStateTaskID
   \   0000F9   F0           MOVX      @DPTR,A
   \   0000FA   A3           INC       DPTR
   \   0000FB   E4           CLR       A
   \   0000FC   F0           MOVX      @DPTR,A
    224             osal_start_timerEx(
    225                zclZEM_TaskID,
    226                ZEMAPP_EVT,
    227                60000);
   \   0000FD                ; Setup parameters for call to function osal_start_timerEx
   \   0000FD   90....       MOV       DPTR,#__Constant_ea60
   \   000100   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   000103   7A80         MOV       R2,#-0x80
   \   000105   7B00         MOV       R3,#0x0
   \   000107   90....       MOV       DPTR,#zclZEM_TaskID
   \   00010A   E0           MOVX      A,@DPTR
   \   00010B   F9           MOV       R1,A
   \   00010C   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   00010F   7404         MOV       A,#0x4
   \   000111   12....       LCALL     ?DEALLOC_XSTACK8
    228          }
   \   000114   741D         MOV       A,#0x1d
   \   000116   12....       LCALL     ?DEALLOC_XSTACK8
   \   000119   7F02         MOV       R7,#0x2
   \   00011B   02....       LJMP      ?BANKED_LEAVE_XDATA
   \   00011E                REQUIRE PERCFG
   \   00011E                REQUIRE P1SEL
   \   00011E                REQUIRE P1DIR
    229          
    230          /*********************************************************************
    231           * @fn          zclSample_event_loop
    232           *
    233           * @brief       Event Loop Processor for zclGeneral.
    234           *
    235           * @param       none
    236           *
    237           * @return      none
    238           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    239          uint16 zclZEM_event_loop( uint8 task_id, uint16 events )
   \                     zclZEM_event_loop:
    240          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000   74F4         MOV       A,#-0xc
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 180
   \   000005   744C         MOV       A,#0x4c
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   \   00000A   EA           MOV       A,R2
   \   00000B   FE           MOV       R6,A
   \   00000C   EB           MOV       A,R3
   \   00000D   FF           MOV       R7,A
    241            afIncomingMSGPacket_t *MSGpkt;
    242          
    243            (void)task_id;  // Intentionally unreferenced parameter
    244          
    245            if ( events & SYS_EVENT_MSG )
   \   00000E   5480         ANL       A,#0x80
   \   000010   7038         JNZ       ??zclZEM_event_loop_0
    246            {
    247              while ( (MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( zclZEM_TaskID )) )
    248              {
    249                // 添加调试信息，显示接收到的事件类型（十六进制格式）
    250                  uint8 eventTypeMsg[] = "Received event type: 0x";
    251                  HalUARTWrite(HAL_UART_PORT_0, eventTypeMsg, sizeof(eventTypeMsg)-1);
    252                  
    253                  uint8 eventStr[4];
    254                  uint8 eventByte = MSGpkt->hdr.event;
    255                  uint8 highNibble = (eventByte >> 4) & 0x0F;
    256                  uint8 lowNibble = eventByte & 0x0F;
    257                  eventStr[0] = (highNibble < 10) ? ('0' + highNibble) : ('A' + highNibble - 10);
    258                  eventStr[1] = (lowNibble < 10) ? ('0' + lowNibble) : ('A' + lowNibble - 10);
    259                  eventStr[2] = '\r';
    260                  eventStr[3] = '\n';
    261                  HalUARTWrite(0, eventStr, 4);
    262                
    263                switch ( MSGpkt->hdr.event )
    264                {
    265                  case ZCL_INCOMING_MSG:
    266                    // Incoming ZCL Foundation command/response messages
    267                    zclZEM_ProcessIncomingMsg( (zclIncomingMsg_t *)MSGpkt );
    268                    break;
    269          
    270                  case AF_INCOMING_MSG_CMD:
    271                    // Incoming AF data messages
    272                    zclZEM_AF_RxProc( MSGpkt );
    273                    break;
    274          
    275                  case KEY_CHANGE:
    276                    zclZEM_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    277                    break;
    278          
    279                  case ZDO_STATE_CHANGE:
    280                    break;
    281          
    282                  default:
    283                    break;
    284                }
    285          
    286                // Release the memory
    287                osal_msg_deallocate( (uint8 *)MSGpkt );
    288              }
    289          
    290              // return unprocessed events
    291              return (events ^ SYS_EVENT_MSG);
    292            }
    293          
    294            // 先处理LED闪烁事件，确保不会被SYS_EVENT_MSG阻塞
    295            if(events & ZEMAPP_EVT)
   \   000012   EE           MOV       A,R6
   \   000013   5480         ANL       A,#0x80
   \   000015   7003         JNZ       $+5
   \   000017   02....       LJMP      ??zclZEM_event_loop_1 & 0xFFFF
    296            { 
    297              // 允许设备加入网络（254秒）
    298              NLME_PermitJoiningRequest(254);
   \   00001A                ; Setup parameters for call to function NLME_PermitJoiningRequest
   \   00001A   79FE         MOV       R1,#-0x2
   \   00001C   12....       LCALL     `??NLME_PermitJoiningRequest::?relay`; Banked call to: NLME_PermitJoiningRequest
    299              
    300              // 设置下一次LED闪烁定时器
    301              osal_start_timerEx(zclZEM_TaskID, ZEMAPP_EVT, 10000);
   \   00001F                ; Setup parameters for call to function osal_start_timerEx
   \   00001F   90....       MOV       DPTR,#__Constant_2710
   \   000022   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   000025   7A80         MOV       R2,#-0x80
   \   000027   7B00         MOV       R3,#0x0
   \   000029   90....       MOV       DPTR,#zclZEM_TaskID
   \   00002C   E0           MOVX      A,@DPTR
   \   00002D   F9           MOV       R1,A
   \   00002E   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   000031   7404         MOV       A,#0x4
   \   000033   12....       LCALL     ?DEALLOC_XSTACK8
    302              
    303              return (events ^ ZEMAPP_EVT);
   \   000036   EE           MOV       A,R6
   \   000037   6480         XRL       A,#0x80
   \   000039   02....       LJMP      ??zclZEM_event_loop_2 & 0xFFFF
    304            }
   \                     ??zclZEM_event_loop_3:
   \   00003C                ; Setup parameters for call to function zclZEM_AF_RxProc
   \   00003C   AA..         MOV       R2,?V0
   \   00003E   AB..         MOV       R3,?V1
   \   000040   12....       LCALL     `??zclZEM_AF_RxProc::?relay`; Banked call to: zclZEM_AF_RxProc
   \                     ??zclZEM_event_loop_4:
   \   000043                ; Setup parameters for call to function osal_msg_deallocate
   \   000043   AA..         MOV       R2,?V0
   \   000045   AB..         MOV       R3,?V1
   \   000047   12....       LCALL     `??osal_msg_deallocate::?relay`; Banked call to: osal_msg_deallocate
   \                     ??zclZEM_event_loop_0:
   \   00004A                ; Setup parameters for call to function osal_msg_receive
   \   00004A   90....       MOV       DPTR,#zclZEM_TaskID
   \   00004D   E0           MOVX      A,@DPTR
   \   00004E   F9           MOV       R1,A
   \   00004F   12....       LCALL     `??osal_msg_receive::?relay`; Banked call to: osal_msg_receive
   \   000052   8A..         MOV       ?V0,R2
   \   000054   8B..         MOV       ?V1,R3
   \   000056   EA           MOV       A,R2
   \   000057   45..         ORL       A,?V1
   \   000059   607B         JZ        ??zclZEM_event_loop_5
   \   00005B   90....       MOV       DPTR,#`?<Constant "Received event type: 0x">`
   \   00005E   749C         MOV       A,#-0x64
   \   000060   12....       LCALL     ?XSTACK_DISP102_8
   \   000063   7418         MOV       A,#0x18
   \   000065   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
   \   000068                ; Setup parameters for call to function HalUARTWrite
   \   000068   7C17         MOV       R4,#0x17
   \   00006A   FD           MOV       R5,A
   \   00006B   749C         MOV       A,#-0x64
   \   00006D   12....       LCALL     ?XSTACK_DISP101_8
   \   000070   7900         MOV       R1,#0x0
   \   000072   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
   \   000075   85..82       MOV       DPL,?V0
   \   000078   85..83       MOV       DPH,?V1
   \   00007B   12....       LCALL     ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   00007E   5004         JNC       ??zclZEM_event_loop_6
   \   000080   7430         MOV       A,#0x30
   \   000082   8002         SJMP      ??zclZEM_event_loop_7
   \                     ??zclZEM_event_loop_6:
   \   000084   7437         MOV       A,#0x37
   \                     ??zclZEM_event_loop_7:
   \   000086   12....       LCALL     ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_14:
   \   000089   5004         JNC       ??zclZEM_event_loop_8
   \   00008B   7430         MOV       A,#0x30
   \   00008D   8002         SJMP      ??zclZEM_event_loop_9
   \                     ??zclZEM_event_loop_8:
   \   00008F   7437         MOV       A,#0x37
   \                     ??zclZEM_event_loop_9:
   \   000091   28           ADD       A,R0
   \   000092   F8           MOV       R0,A
   \   000093   7401         MOV       A,#0x1
   \   000095   12....       LCALL     ?XSTACK_DISP0_8
   \   000098   E8           MOV       A,R0
   \   000099   F0           MOVX      @DPTR,A
   \   00009A   7402         MOV       A,#0x2
   \   00009C   12....       LCALL     ?XSTACK_DISP0_8
   \   00009F   740D         MOV       A,#0xd
   \   0000A1   F0           MOVX      @DPTR,A
   \   0000A2   7403         MOV       A,#0x3
   \   0000A4   12....       LCALL     ?XSTACK_DISP0_8
   \   0000A7   740A         MOV       A,#0xa
   \   0000A9   F0           MOVX      @DPTR,A
   \   0000AA                ; Setup parameters for call to function HalUARTWrite
   \   0000AA   7C04         MOV       R4,#0x4
   \   0000AC   7D00         MOV       R5,#0x0
   \   0000AE   AA..         MOV       R2,?XSP + 0
   \   0000B0   AB..         MOV       R3,?XSP + 1
   \   0000B2   7900         MOV       R1,#0x0
   \   0000B4   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
   \   0000B7   85..82       MOV       DPL,?V0
   \   0000BA   85..83       MOV       DPH,?V1
   \   0000BD   E0           MOVX      A,@DPTR
   \   0000BE   24E6         ADD       A,#-0x1a
   \   0000C0   7003         JNZ       $+5
   \   0000C2   02....       LJMP      ??zclZEM_event_loop_3 & 0xFFFF
   \   0000C5   24E6         ADD       A,#-0x1a
   \   0000C7   6003         JZ        $+5
   \   0000C9   02....       LJMP      ??zclZEM_event_loop_4 & 0xFFFF
   \   0000CC                ; Setup parameters for call to function zclZEM_ProcessIncomingMsg
   \   0000CC   AA..         MOV       R2,?V0
   \   0000CE   AB..         MOV       R3,?V1
   \   0000D0   12....       LCALL     `??zclZEM_ProcessIncomingMsg::?relay`; Banked call to: zclZEM_ProcessIncomingMsg
   \   0000D3   02....       LJMP      ??zclZEM_event_loop_4 & 0xFFFF
   \                     ??zclZEM_event_loop_5:
   \   0000D6   EE           MOV       A,R6
   \   0000D7   FA           MOV       R2,A
   \   0000D8   EF           MOV       A,R7
   \   0000D9   6480         XRL       A,#0x80
   \   0000DB   02....       LJMP      ??zclZEM_event_loop_10 & 0xFFFF
    305            
    306          #if ZG_BUILD_ENDDEVICE_TYPE    
    307            if ( events & ZEM_END_DEVICE_REJOIN_EVT )
   \                     ??zclZEM_event_loop_1:
   \   0000DE   EE           MOV       A,R6
   \   0000DF   5402         ANL       A,#0x2
   \   0000E1   600B         JZ        ??zclZEM_event_loop_11
    308            {
    309              bdb_ZedAttemptRecoverNwk();
   \   0000E3                ; Setup parameters for call to function bdb_ZedAttemptRecoverNwk
   \   0000E3   12....       LCALL     `??bdb_ZedAttemptRecoverNwk::?relay`; Banked call to: bdb_ZedAttemptRecoverNwk
    310              return ( events ^ ZEM_END_DEVICE_REJOIN_EVT );
   \   0000E6   EE           MOV       A,R6
   \   0000E7   6402         XRL       A,#0x2
   \                     ??zclZEM_event_loop_2:
   \   0000E9   FA           MOV       R2,A
   \   0000EA   EF           MOV       A,R7
   \   0000EB   02....       LJMP      ??zclZEM_event_loop_10 & 0xFFFF
    311            }
    312          #endif
    313          
    314            if ( events & ZEM_LCD_AUTO_UPDATE_EVT )
   \                     ??zclZEM_event_loop_11:
   \   0000EE   EE           MOV       A,R6
   \   0000EF   5410         ANL       A,#0x10
   \   0000F1   6005         JZ        ??zclZEM_event_loop_12
    315            {
    316              return ( events ^ ZEM_LCD_AUTO_UPDATE_EVT );
   \   0000F3   EE           MOV       A,R6
   \   0000F4   6410         XRL       A,#0x10
   \   0000F6   8008         SJMP      ??zclZEM_event_loop_13
    317            }
    318          
    319            if ( events & ZEM_KEY_AUTO_REPEAT_EVT )
   \                     ??zclZEM_event_loop_12:
   \   0000F8   EE           MOV       A,R6
   \   0000F9   5420         ANL       A,#0x20
   \   0000FB   6007         JZ        ??zclZEM_event_loop_14
    320            {
    321              return ( events ^ ZEM_KEY_AUTO_REPEAT_EVT );
   \   0000FD   EE           MOV       A,R6
   \   0000FE   6420         XRL       A,#0x20
   \                     ??zclZEM_event_loop_13:
   \   000100   FA           MOV       R2,A
   \   000101   02....       LJMP      ??zclZEM_event_loop_15 & 0xFFFF
    322            }
    323            
    324            // Broadcast event
    325            if ( events & ZEM_BROADCAST_EVT )
   \                     ??zclZEM_event_loop_14:
   \   000104   EF           MOV       A,R7
   \   000105   5410         ANL       A,#0x10
   \   000107   7003         JNZ       $+5
   \   000109   02....       LJMP      ??zclZEM_event_loop_16 & 0xFFFF
    326            {
    327              uint8 broadcastData[] = "Broadcast";
   \   00010C   90....       MOV       DPTR,#`?<Constant "Broadcast">`
   \   00010F   7418         MOV       A,#0x18
   \   000111   12....       LCALL     ?XSTACK_DISP102_8
   \   000114   740A         MOV       A,#0xa
   \   000116   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    328              zclZEM_AF_Broadcast(CLUSTER_BROADCAST, 
    329                                  sizeof(broadcastData)-1, 
    330                                  broadcastData);
   \   000119   7414         MOV       A,#0x14
   \   00011B   12....       LCALL     ?XSTACK_DISP0_8
   \   00011E   740F         MOV       A,#0xf
   \   000120   F0           MOVX      @DPTR,A
   \   000121   740C         MOV       A,#0xc
   \   000123   12....       LCALL     ?XSTACK_DISP0_8
   \   000126   74FF         MOV       A,#-0x1
   \   000128   F0           MOVX      @DPTR,A
   \   000129   A3           INC       DPTR
   \   00012A   F0           MOVX      @DPTR,A
   \   00012B   7415         MOV       A,#0x15
   \   00012D   12....       LCALL     ?XSTACK_DISP0_8
   \   000130   7408         MOV       A,#0x8
   \   000132   F0           MOVX      @DPTR,A
   \   000133   90....       MOV       DPTR,#??transferId_1
   \   000136   12....       LCALL     ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_0:
   \   000139   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   00013C   75....       MOV       ?V0,#??transferId_1 & 0xff
   \   00013F   75....       MOV       ?V1,#(??transferId_1 >> 8) & 0xff
   \   000142   78..         MOV       R0,#?V0
   \   000144   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000147   741B         MOV       A,#0x1b
   \   000149   12....       LCALL     ?XSTACK_DISP100_8
   \   00014C   88..         MOV       ?V0,R0
   \   00014E   89..         MOV       ?V1,R1
   \   000150   78..         MOV       R0,#?V0
   \   000152   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000155   75..09       MOV       ?V0,#0x9
   \   000158   75..00       MOV       ?V1,#0x0
   \   00015B   78..         MOV       R0,#?V0
   \   00015D   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000160   75..01       MOV       ?V0,#0x1
   \   000163   78..         MOV       R0,#?V0
   \   000165   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000168   7900         MOV       R1,#0x0
   \   00016A   7C..         MOV       R4,#ZEM_AppEp & 0xff
   \   00016C   7D..         MOV       R5,#(ZEM_AppEp >> 8) & 0xff
   \   00016E   7415         MOV       A,#0x15
   \   000170   12....       LCALL     ?XSTACK_DISP101_8
   \   000173   12....       LCALL     `??AF_DataRequest::?relay`; Banked call to: AF_DataRequest
   \   000176   7409         MOV       A,#0x9
   \   000178   12....       LCALL     ?DEALLOC_XSTACK8
    331              
    332              // 添加广播调试信息
    333              uint8 bcDebugMsg[] = "Broadcast message sent!\r\n";
   \   00017B   90....       MOV       DPTR,#`?<Constant "Broadcast message sen...">`
   \   00017E   7482         MOV       A,#-0x7e
   \   000180   12....       LCALL     ?XSTACK_DISP102_8
   \   000183   741A         MOV       A,#0x1a
   \   000185   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    334              HalUARTWrite(HAL_UART_PORT_0, bcDebugMsg, sizeof(bcDebugMsg)-1);
   \   000188                ; Setup parameters for call to function HalUARTWrite
   \   000188   7C19         MOV       R4,#0x19
   \   00018A   FD           MOV       R5,A
   \   00018B   7482         MOV       A,#-0x7e
   \   00018D   12....       LCALL     ?XSTACK_DISP101_8
   \   000190   7900         MOV       R1,#0x0
   \   000192   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    335              
    336              osal_start_timerEx(zclZEM_TaskID,
    337                                ZEM_BROADCAST_EVT,
    338                                ZEM_BROADCAST_PERIOD);
   \   000195                ; Setup parameters for call to function osal_start_timerEx
   \   000195   90....       MOV       DPTR,#__Constant_3e8
   \   000198   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   00019B   7A00         MOV       R2,#0x0
   \   00019D   7B10         MOV       R3,#0x10
   \   00019F   90....       MOV       DPTR,#zclZEM_TaskID
   \   0001A2   E0           MOVX      A,@DPTR
   \   0001A3   F9           MOV       R1,A
   \   0001A4   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   0001A7   7404         MOV       A,#0x4
   \   0001A9   12....       LCALL     ?DEALLOC_XSTACK8
    339              return ( events ^ ZEM_BROADCAST_EVT );
   \   0001AC   EE           MOV       A,R6
   \   0001AD   FA           MOV       R2,A
   \   0001AE   EF           MOV       A,R7
   \   0001AF   6410         XRL       A,#0x10
   \   0001B1   02....       LJMP      ??zclZEM_event_loop_10 & 0xFFFF
    340            }
    341            
    342            // Groupcast event
    343            if ( events & ZEM_GROUPCAST_EVT )
   \                     ??zclZEM_event_loop_16:
   \   0001B4   EF           MOV       A,R7
   \   0001B5   5408         ANL       A,#0x8
   \   0001B7   7003         JNZ       $+5
   \   0001B9   02....       LJMP      ??zclZEM_event_loop_17 & 0xFFFF
    344            {
    345              uint8 groupcastData[] = "Groupcast";
   \   0001BC   90....       MOV       DPTR,#`?<Constant "Groupcast">`
   \   0001BF   7418         MOV       A,#0x18
   \   0001C1   12....       LCALL     ?XSTACK_DISP102_8
   \   0001C4   740A         MOV       A,#0xa
   \   0001C6   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    346              zclZEM_AF_Groupcast(GROUP_ID,
    347                                  CLUSTER_GROUPCAST,
    348                                  sizeof(groupcastData)-1, 
    349                                  groupcastData);
   \   0001C9   7414         MOV       A,#0x14
   \   0001CB   12....       LCALL     ?XSTACK_DISP0_8
   \   0001CE   7401         MOV       A,#0x1
   \   0001D0   F0           MOVX      @DPTR,A
   \   0001D1   740C         MOV       A,#0xc
   \   0001D3   12....       LCALL     ?XSTACK_DISP0_8
   \   0001D6   7415         MOV       A,#0x15
   \   0001D8   F0           MOVX      @DPTR,A
   \   0001D9   A3           INC       DPTR
   \   0001DA   E4           CLR       A
   \   0001DB   F0           MOVX      @DPTR,A
   \   0001DC   7415         MOV       A,#0x15
   \   0001DE   12....       LCALL     ?XSTACK_DISP0_8
   \   0001E1   7408         MOV       A,#0x8
   \   0001E3   F0           MOVX      @DPTR,A
   \   0001E4   90....       MOV       DPTR,#??transferId_2
   \   0001E7   12....       LCALL     ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   0001EA   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   0001ED   75....       MOV       ?V0,#??transferId_2 & 0xff
   \   0001F0   75....       MOV       ?V1,#(??transferId_2 >> 8) & 0xff
   \   0001F3   78..         MOV       R0,#?V0
   \   0001F5   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0001F8   741B         MOV       A,#0x1b
   \   0001FA   12....       LCALL     ?XSTACK_DISP100_8
   \   0001FD   88..         MOV       ?V0,R0
   \   0001FF   89..         MOV       ?V1,R1
   \   000201   78..         MOV       R0,#?V0
   \   000203   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000206   75..09       MOV       ?V0,#0x9
   \   000209   75..00       MOV       ?V1,#0x0
   \   00020C   78..         MOV       R0,#?V0
   \   00020E   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000211   75..02       MOV       ?V0,#0x2
   \   000214   78..         MOV       R0,#?V0
   \   000216   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000219   7900         MOV       R1,#0x0
   \   00021B   7C..         MOV       R4,#ZEM_AppEp & 0xff
   \   00021D   7D..         MOV       R5,#(ZEM_AppEp >> 8) & 0xff
   \   00021F   7415         MOV       A,#0x15
   \   000221   12....       LCALL     ?XSTACK_DISP101_8
   \   000224   12....       LCALL     `??AF_DataRequest::?relay`; Banked call to: AF_DataRequest
   \   000227   7409         MOV       A,#0x9
   \   000229   12....       LCALL     ?DEALLOC_XSTACK8
    350              osal_start_timerEx(zclZEM_TaskID,
    351                                ZEM_GROUPCAST_EVT,
    352                                ZEM_GROUPCAST_PERIOD);
   \   00022C                ; Setup parameters for call to function osal_start_timerEx
   \   00022C   90....       MOV       DPTR,#__Constant_3e8
   \   00022F   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   000232   7A00         MOV       R2,#0x0
   \   000234   7B08         MOV       R3,#0x8
   \   000236   90....       MOV       DPTR,#zclZEM_TaskID
   \   000239   E0           MOVX      A,@DPTR
   \   00023A   F9           MOV       R1,A
   \   00023B   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   00023E   7404         MOV       A,#0x4
   \   000240   12....       LCALL     ?DEALLOC_XSTACK8
    353              return ( events ^ ZEM_GROUPCAST_EVT );
   \   000243   EE           MOV       A,R6
   \   000244   FA           MOV       R2,A
   \   000245   EF           MOV       A,R7
   \   000246   6408         XRL       A,#0x8
   \   000248   02....       LJMP      ??zclZEM_event_loop_10 & 0xFFFF
    354            }
    355            
    356            // P2P event
    357            if ( events & ZEM_P2P_EVT )
   \                     ??zclZEM_event_loop_17:
   \   00024B   EF           MOV       A,R7
   \   00024C   5402         ANL       A,#0x2
   \   00024E   7003         JNZ       $+5
   \   000250   02....       LJMP      ??zclZEM_event_loop_18 & 0xFFFF
    358            {
    359              // 添加调试信息，检查网络状态
    360              uint8 p2pDebugMsg[] = "ZEM_P2P_EVT processed! Network state: ";
   \   000253   90....       MOV       DPTR,#`?<Constant "ZEM_P2P_EVT processed...">`
   \   000256   745B         MOV       A,#0x5b
   \   000258   12....       LCALL     ?XSTACK_DISP102_8
   \   00025B   7427         MOV       A,#0x27
   \   00025D   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    361              HalUARTWrite(HAL_UART_PORT_0, p2pDebugMsg, sizeof(p2pDebugMsg)-1);
   \   000260                ; Setup parameters for call to function HalUARTWrite
   \   000260   7C26         MOV       R4,#0x26
   \   000262   FD           MOV       R5,A
   \   000263   745B         MOV       A,#0x5b
   \   000265   12....       LCALL     ?XSTACK_DISP101_8
   \   000268   7900         MOV       R1,#0x0
   \   00026A   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    362              
    363              uint8 stateStr[8];
    364              // 转换网络状态为十六进制显示
    365              uint8 stateByte = devState;
   \   00026D   90....       MOV       DPTR,#devState
   \   000270   E0           MOVX      A,@DPTR
   \   000271   12....       LCALL     ?Subroutine11 & 0xFFFF
    366              uint8 highNibble = (stateByte >> 4) & 0x0F;
    367              uint8 lowNibble = stateByte & 0x0F;
    368              stateStr[0] = (highNibble < 10) ? ('0' + highNibble) : ('A' + highNibble - 10);
   \                     ??CrossCallReturnLabel_12:
   \   000274   5004         JNC       ??zclZEM_event_loop_19
   \   000276   7430         MOV       A,#0x30
   \   000278   8002         SJMP      ??zclZEM_event_loop_20
   \                     ??zclZEM_event_loop_19:
   \   00027A   7437         MOV       A,#0x37
   \                     ??zclZEM_event_loop_20:
   \   00027C   28           ADD       A,R0
   \   00027D   F8           MOV       R0,A
   \   00027E   7404         MOV       A,#0x4
   \   000280   12....       LCALL     ?XSTACK_DISP0_8
   \   000283   E8           MOV       A,R0
   \   000284   F0           MOVX      @DPTR,A
    369              stateStr[1] = (lowNibble < 10) ? ('0' + lowNibble) : ('A' + lowNibble - 10);
   \   000285   E9           MOV       A,R1
   \   000286   C3           CLR       C
   \   000287   940A         SUBB      A,#0xa
   \   000289   5004         JNC       ??zclZEM_event_loop_21
   \   00028B   7430         MOV       A,#0x30
   \   00028D   8002         SJMP      ??zclZEM_event_loop_22
   \                     ??zclZEM_event_loop_21:
   \   00028F   7437         MOV       A,#0x37
   \                     ??zclZEM_event_loop_22:
   \   000291   29           ADD       A,R1
   \   000292   F8           MOV       R0,A
   \   000293   7405         MOV       A,#0x5
   \   000295   12....       LCALL     ?XSTACK_DISP0_8
   \   000298   E8           MOV       A,R0
   \   000299   F0           MOVX      @DPTR,A
    370              stateStr[2] = '\r';
   \   00029A   7406         MOV       A,#0x6
   \   00029C   12....       LCALL     ?XSTACK_DISP0_8
   \   00029F   740D         MOV       A,#0xd
   \   0002A1   F0           MOVX      @DPTR,A
    371              stateStr[3] = '\n';
   \   0002A2   7407         MOV       A,#0x7
   \   0002A4   12....       LCALL     ?XSTACK_DISP0_8
   \   0002A7   740A         MOV       A,#0xa
   \   0002A9   F0           MOVX      @DPTR,A
    372              HalUARTWrite(0, stateStr, 4);
   \   0002AA                ; Setup parameters for call to function HalUARTWrite
   \   0002AA   7C04         MOV       R4,#0x4
   \   0002AC   7D00         MOV       R5,#0x0
   \   0002AE   EC           MOV       A,R4
   \   0002AF   12....       LCALL     ?XSTACK_DISP101_8
   \   0002B2   7900         MOV       R1,#0x0
   \   0002B4   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    373              
    374              // 使用P2P事件发送MAC地址
    375              zclZEM_SendMACToCoordinator();
   \   0002B7                ; Setup parameters for call to function zclZEM_SendMACToCoordinator
   \   0002B7   12....       LCALL     `??zclZEM_SendMACToCoordinator::?relay`; Banked call to: zclZEM_SendMACToCoordinator
    376              
    377              osal_start_timerEx(zclZEM_TaskID,
    378                                ZEM_P2P_EVT,
    379                                ZEM_P2P_PERIOD);
   \   0002BA                ; Setup parameters for call to function osal_start_timerEx
   \   0002BA   90....       MOV       DPTR,#__Constant_3e8
   \   0002BD   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   0002C0   7A00         MOV       R2,#0x0
   \   0002C2   7B02         MOV       R3,#0x2
   \   0002C4   90....       MOV       DPTR,#zclZEM_TaskID
   \   0002C7   E0           MOVX      A,@DPTR
   \   0002C8   F9           MOV       R1,A
   \   0002C9   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   0002CC   7404         MOV       A,#0x4
   \   0002CE   12....       LCALL     ?DEALLOC_XSTACK8
    380              return ( events ^ ZEM_P2P_EVT );
   \   0002D1   EE           MOV       A,R6
   \   0002D2   FA           MOV       R2,A
   \   0002D3   EF           MOV       A,R7
   \   0002D4   6402         XRL       A,#0x2
   \   0002D6   803A         SJMP      ??zclZEM_event_loop_10
    381            }
    382            
    383            // 网络形成重试事件
    384            if ( events & ZEM_RETRY_FORMATION_EVT )
   \                     ??zclZEM_event_loop_18:
   \   0002D8   EF           MOV       A,R7
   \   0002D9   5404         ANL       A,#0x4
   \   0002DB   600C         JZ        ??zclZEM_event_loop_23
    385            {
    386              
    387              // 重新调用组网函数
    388              bdb_StartCommissioning(BDB_COMMISSIONING_MODE_NWK_FORMATION |
    389                                          BDB_COMMISSIONING_MODE_FINDING_BINDING );
   \   0002DD                ; Setup parameters for call to function bdb_StartCommissioning
   \   0002DD   790C         MOV       R1,#0xc
   \   0002DF   12....       LCALL     `??bdb_StartCommissioning::?relay`; Banked call to: bdb_StartCommissioning
    390              return ( events ^ ZEM_RETRY_FORMATION_EVT );
   \   0002E2   EE           MOV       A,R6
   \   0002E3   FA           MOV       R2,A
   \   0002E4   EF           MOV       A,R7
   \   0002E5   6404         XRL       A,#0x4
   \   0002E7   8029         SJMP      ??zclZEM_event_loop_10
    391            }
    392            #ifndef ZDO_COORDINATOR
    393              if ( events & ZEM_REJOIN_EVT )//如果事件类型为重新加入网络事件
   \                     ??zclZEM_event_loop_23:
   \   0002E9   EF           MOV       A,R7
   \   0002EA   5401         ANL       A,#0x1
   \   0002EC   6027         JZ        ??zclZEM_event_loop_24
    394              {
    395                  // 添加调试信息
    396                  uint8 rejoinMsg[] = "ZEM_REJOIN_EVT processed! Starting network steering...\r\n";
   \   0002EE   90....       MOV       DPTR,#`?<Constant "ZEM_REJOIN_EVT proces...">`
   \   0002F1   7422         MOV       A,#0x22
   \   0002F3   12....       LCALL     ?XSTACK_DISP102_8
   \   0002F6   7439         MOV       A,#0x39
   \   0002F8   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    397                  HalUARTWrite(HAL_UART_PORT_0, rejoinMsg, sizeof(rejoinMsg)-1);
   \   0002FB                ; Setup parameters for call to function HalUARTWrite
   \   0002FB   7C38         MOV       R4,#0x38
   \   0002FD   FD           MOV       R5,A
   \   0002FE   7422         MOV       A,#0x22
   \   000300   12....       LCALL     ?XSTACK_DISP101_8
   \   000303   7900         MOV       R1,#0x0
   \   000305   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    398                  
    399                  // 重新加入网络
    400                  bdb_StartCommissioning(BDB_COMMISSIONING_MODE_NWK_STEERING |
    401                                              BDB_COMMISSIONING_MODE_FINDING_BINDING );
   \   000308                ; Setup parameters for call to function bdb_StartCommissioning
   \   000308   790A         MOV       R1,#0xa
   \   00030A   12....       LCALL     `??bdb_StartCommissioning::?relay`; Banked call to: bdb_StartCommissioning
    402                return ( events ^ ZEM_REJOIN_EVT );
   \   00030D   EE           MOV       A,R6
   \   00030E   FA           MOV       R2,A
   \   00030F   EF           MOV       A,R7
   \   000310   6401         XRL       A,#0x1
   \                     ??zclZEM_event_loop_10:
   \   000312   FB           MOV       R3,A
   \   000313   8004         SJMP      ??zclZEM_event_loop_15
    403              }
    404            #endif
    405          
    406            // Discard unknown events
    407            return 0;
   \                     ??zclZEM_event_loop_24:
   \   000315   7A00         MOV       R2,#0x0
   \   000317   7B00         MOV       R3,#0x0
   \                     ??zclZEM_event_loop_15:
   \   000319   74B4         MOV       A,#-0x4c
   \   00031B                REQUIRE ?Subroutine0
   \   00031B                ; // Fall through to label ?Subroutine0
    408          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   12....       LCALL     ?DEALLOC_XSTACK8
   \   000003   7F04         MOV       R7,#0x4
   \   000005   02....       LJMP      ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine12:
   \   000000   29           ADD       A,R1
   \   000001   85..82       MOV       DPL,?XSP + 0
   \   000004   85..83       MOV       DPH,?XSP + 1
   \   000007   F0           MOVX      @DPTR,A
   \   000008   E8           MOV       A,R0
   \   000009   940A         SUBB      A,#0xa
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine11:
   \   000000   F9           MOV       R1,A
   \   000001   C4           SWAP      A
   \   000002   540F         ANL       A,#0xf
   \   000004   F8           MOV       R0,A
   \   000005   740F         MOV       A,#0xf
   \   000007   59           ANL       A,R1
   \   000008   F9           MOV       R1,A
   \   000009   E8           MOV       A,R0
   \   00000A   C3           CLR       C
   \   00000B   940A         SUBB      A,#0xa
   \   00000D   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine8:
   \   000000   E0           MOVX      A,@DPTR
   \   000001   F8           MOV       R0,A
   \   000002   C4           SWAP      A
   \   000003   540F         ANL       A,#0xf
   \   000005   F9           MOV       R1,A
   \   000006   740F         MOV       A,#0xf
   \   000008   58           ANL       A,R0
   \   000009   F8           MOV       R0,A
   \   00000A   E9           MOV       A,R1
   \   00000B   C3           CLR       C
   \   00000C   940A         SUBB      A,#0xa
   \   00000E   22           RET
    409          
    410          /*********************************************************************
    411           * @fn      zclZEM_InitUart
    412           *
    413           * @brief   Initialize UART for communication
    414           *
    415           * @param   none
    416           *
    417           * @return  none
    418           */
    419          static void zclZEM_InitUart(void)
    420          {
    421            // 统一使用协调器的UART引脚配置（P1.4/P1.5）
    422            /********** 1. 配置UART0的P1.4/P1.5和PERCFG寄存器 **********/
    423            // PERCFG的bit0(U0CFG)设置为1：UART0映射到Alternative 2位置(P1.4/P1.5)
    424            PERCFG |= (1 << 0);  // 配置PERCFG |= 0x01来设置相应的bit0
    425          
    426            /********** 2. 配置P1.4/P1.5为UART0功能和P1端口寄存器 **********/
    427            // P1SEL的bit4(P1.4)和bit5(P1.5)设置为1：配置为外设功能(UART)
    428            P1SEL |= (1 << 4) | (1 << 5);  // 配置P1SEL |= 0x30(00110000)
    429            // P1DIR的bit4(P1.4=TX)设置为1：输出；bit5(P1.5=RX)设置为0：输入
    430            P1DIR |= (1 << 4);   // P1.4(TX)作为输出
    431            P1DIR &= ~(1 << 5);  // P1.5(RX)作为输入
    432          
    433            halUARTCfg_t uartConfig;
    434            /* UART Configuration */
    435            uartConfig.configured          = TRUE;      // Enable configuration
    436            uartConfig.baudRate            = HAL_UART_BR_115200;  // Baud rate
    437            uartConfig.flowControl         = FALSE;     // Disable hardware flow control
    438            uartConfig.flowControlThreshold= 0;         // Flow control threshold
    439            uartConfig.rx.maxBufSize       = ZCLZEM_UART_BUF_LEN;  // Receive buffer size
    440            uartConfig.tx.maxBufSize       = 0;         // Transmit buffer size
    441            uartConfig.idleTimeout         = 6;         // Default timeout
    442            uartConfig.intEnable           = TRUE;      // Enable interrupt
    443            uartConfig.callBackFunc        = zclZEM_UartCB;  // Set callback function
    444            /* Start UART */
    445            // 统一使用UART0端口（协调器配置）
    446            HalUARTOpen(HAL_UART_PORT_0, &uartConfig);  // Open UART0 with configuration
    447          }
    448          
    449          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    450          void zclZEM_SendMACToCoordinator(void)
   \                     zclZEM_SendMACToCoordinator:
    451          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000   74F4         MOV       A,#-0xc
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 57
   \   000005   74C7         MOV       A,#-0x39
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
    452            uint8* macAddr;
    453            uint8 macData[10]; // MAC地址数据包：1字节类型标识 + 8字节MAC地址 + 1字节结束符
    454            
    455            // 读取MAC地址
    456            macAddr = NLME_GetExtAddr();
   \   00000A                ; Setup parameters for call to function NLME_GetExtAddr
   \   00000A   12....       LCALL     `??NLME_GetExtAddr::?relay`; Banked call to: NLME_GetExtAddr
   \   00000D   8A..         MOV       ?V0,R2
   \   00000F   8B..         MOV       ?V1,R3
    457            
    458            // 构建数据包
    459            macData[0] = 0x01; // 类型标识：MAC地址数据
   \   000011   85..82       MOV       DPL,?XSP + 0
   \   000014   85..83       MOV       DPH,?XSP + 1
   \   000017   7401         MOV       A,#0x1
   \   000019   F0           MOVX      @DPTR,A
    460            osal_memcpy(&macData[1], macAddr, 8); // 复制MAC地址
   \   00001A                ; Setup parameters for call to function osal_memcpy
   \   00001A   75..00       MOV       ?V2,#0x0
   \   00001D   78..         MOV       R0,#?V0
   \   00001F   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   000022   7C08         MOV       R4,#0x8
   \   000024   7D00         MOV       R5,#0x0
   \   000026   7404         MOV       A,#0x4
   \   000028   12....       LCALL     ?XSTACK_DISP0_8
   \   00002B   AA82         MOV       R2,DPL
   \   00002D   AB83         MOV       R3,DPH
   \   00002F   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   000032   7403         MOV       A,#0x3
   \   000034   12....       LCALL     ?DEALLOC_XSTACK8
    461            macData[9] = 0x00; // 结束符
   \   000037   7409         MOV       A,#0x9
   \   000039   12....       LCALL     ?XSTACK_DISP0_8
   \   00003C   E4           CLR       A
   \   00003D   F0           MOVX      @DPTR,A
    462            
    463            // 向协调器发送数据（协调器网络地址通常为0x0000）
    464            zclZEM_AF_P2P(0x0000, // 协调器网络地址
    465                          CLUSTER_P2P, // 使用点对点集群
    466                          10, // 数据长度
    467                          macData); // 数据内容
   \   00003E   7412         MOV       A,#0x12
   \   000040   12....       LCALL     ?XSTACK_DISP0_8
   \   000043   7402         MOV       A,#0x2
   \   000045   F0           MOVX      @DPTR,A
   \   000046   740A         MOV       A,#0xa
   \   000048   12....       LCALL     ?XSTACK_DISP0_8
   \   00004B   E4           CLR       A
   \   00004C   F0           MOVX      @DPTR,A
   \   00004D   A3           INC       DPTR
   \   00004E   F0           MOVX      @DPTR,A
   \   00004F   7413         MOV       A,#0x13
   \   000051   12....       LCALL     ?XSTACK_DISP0_8
   \   000054   7408         MOV       A,#0x8
   \   000056   F0           MOVX      @DPTR,A
   \   000057   90....       MOV       DPTR,#??transferId
   \   00005A   12....       LCALL     ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_2:
   \   00005D   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   000060   75....       MOV       ?V0,#??transferId & 0xff
   \   000063   75....       MOV       ?V1,#(??transferId >> 8) & 0xff
   \   000066   78..         MOV       R0,#?V0
   \   000068   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00006B   7403         MOV       A,#0x3
   \   00006D   12....       LCALL     ?XSTACK_DISP100_8
   \   000070   88..         MOV       ?V0,R0
   \   000072   89..         MOV       ?V1,R1
   \   000074   78..         MOV       R0,#?V0
   \   000076   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000079   75..0A       MOV       ?V0,#0xa
   \   00007C   75..00       MOV       ?V1,#0x0
   \   00007F   78..         MOV       R0,#?V0
   \   000081   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000084   E4           CLR       A
   \   000085   F5..         MOV       ?V0,A
   \   000087   78..         MOV       R0,#?V0
   \   000089   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00008C   7900         MOV       R1,#0x0
   \   00008E   7C..         MOV       R4,#ZEM_AppEp & 0xff
   \   000090   7D..         MOV       R5,#(ZEM_AppEp >> 8) & 0xff
   \   000092   7413         MOV       A,#0x13
   \   000094   12....       LCALL     ?XSTACK_DISP101_8
   \   000097   12....       LCALL     `??AF_DataRequest::?relay`; Banked call to: AF_DataRequest
   \   00009A   7409         MOV       A,#0x9
   \   00009C   12....       LCALL     ?DEALLOC_XSTACK8
    468            
    469            // 同时通过串口显示发送信息
    470            uint8 sendMsg[] = "MAC address sent to coordinator!\r\n";
   \   00009F   90....       MOV       DPTR,#`?<Constant "MAC address sent to c...">`
   \   0000A2   7416         MOV       A,#0x16
   \   0000A4   12....       LCALL     ?XSTACK_DISP102_8
   \   0000A7   7423         MOV       A,#0x23
   \   0000A9   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    471            HalUARTWrite(HAL_UART_PORT_0, sendMsg, sizeof(sendMsg)-1);
   \   0000AC                ; Setup parameters for call to function HalUARTWrite
   \   0000AC   7C22         MOV       R4,#0x22
   \   0000AE   FD           MOV       R5,A
   \   0000AF   7416         MOV       A,#0x16
   \   0000B1   12....       LCALL     ?XSTACK_DISP101_8
   \   0000B4   7900         MOV       R1,#0x0
   \   0000B6   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    472          }
   \   0000B9   7439         MOV       A,#0x39
   \   0000BB   02....       LJMP      ?Subroutine0 & 0xFFFF
    473          
    474          /*********************************************************************
    475           * @fn      zclZEM_ReadAndSendMAC
    476           *
    477           * @brief   Read MAC address and send it via UART
    478           *
    479           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    480          void zclZEM_ReadAndSendMAC(void)
   \                     zclZEM_ReadAndSendMAC:
    481          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000   74F4         MOV       A,#-0xc
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 56
   \   000005   74C8         MOV       A,#-0x38
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
    482            uint8* macAddr;
    483            uint8 macStr[50]; // 足够存储MAC地址字符串
    484            uint8 i, pos = 0;
    485            
    486            // Read MAC address from system
    487            macAddr = NLME_GetExtAddr();
   \   00000A                ; Setup parameters for call to function NLME_GetExtAddr
   \   00000A   12....       LCALL     `??NLME_GetExtAddr::?relay`; Banked call to: NLME_GetExtAddr
   \   00000D   8A..         MOV       ?V0,R2
   \   00000F   8B..         MOV       ?V1,R3
   \   000011   AE..         MOV       R6,?V0
   \   000013   AF..         MOV       R7,?V1
    488            
    489            // 手动构建MAC地址字符串
    490            const uint8 header[] = "MAC: ";
   \   000015   90....       MOV       DPTR,#`?<Constant "MAC: ">`
   \   000018   AC..         MOV       R4,?XSP + 0
   \   00001A   AD..         MOV       R5,?XSP + 1
   \   00001C   7406         MOV       A,#0x6
   \   00001E   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    491            osal_memcpy(macStr, header, 4);
   \   000021                ; Setup parameters for call to function osal_memcpy
   \   000021   A8..         MOV       R0,?XSP + 0
   \   000023   A9..         MOV       R1,?XSP + 1
   \   000025   88..         MOV       ?V0,R0
   \   000027   89..         MOV       ?V1,R1
   \   000029   F5..         MOV       ?V2,A
   \   00002B   78..         MOV       R0,#?V0
   \   00002D   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   000030   7C04         MOV       R4,#0x4
   \   000032   7D00         MOV       R5,#0x0
   \   000034   7409         MOV       A,#0x9
   \   000036   12....       LCALL     ?XSTACK_DISP101_8
   \   000039   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   00003C   7403         MOV       A,#0x3
   \   00003E   12....       LCALL     ?DEALLOC_XSTACK8
    492            pos = 4;
   \   000041   7804         MOV       R0,#0x4
    493            
    494            // 添加MAC地址字节，格式化为十六进制
    495            for (i = 0; i < 8; i++) {
   \   000043   7C00         MOV       R4,#0x0
    496              // 转换高4位
    497              uint8 highNibble = (macAddr[i] >> 4) & 0x0F;
   \                     ??zclZEM_ReadAndSendMAC_0:
   \   000045   EC           MOV       A,R4
   \   000046   FA           MOV       R2,A
   \   000047   EE           MOV       A,R6
   \   000048   2A           ADD       A,R2
   \   000049   FA           MOV       R2,A
   \   00004A   E4           CLR       A
   \   00004B   3F           ADDC      A,R7
   \   00004C   FB           MOV       R3,A
   \   00004D   8A82         MOV       DPL,R2
   \   00004F   8B83         MOV       DPH,R3
   \   000051   E0           MOVX      A,@DPTR
   \   000052   C4           SWAP      A
   \   000053   540F         ANL       A,#0xf
   \   000055   F9           MOV       R1,A
    498              macStr[pos++] = (highNibble < 10) ? ('0' + highNibble) : ('A' + highNibble - 10);
   \   000056   88..         MOV       ?V0,R0
   \   000058   7401         MOV       A,#0x1
   \   00005A   28           ADD       A,R0
   \   00005B   F8           MOV       R0,A
   \   00005C   E9           MOV       A,R1
   \   00005D   C3           CLR       C
   \   00005E   940A         SUBB      A,#0xa
   \   000060   5004         JNC       ??zclZEM_ReadAndSendMAC_1
   \   000062   7430         MOV       A,#0x30
   \   000064   8002         SJMP      ??zclZEM_ReadAndSendMAC_2
   \                     ??zclZEM_ReadAndSendMAC_1:
   \   000066   7437         MOV       A,#0x37
   \                     ??zclZEM_ReadAndSendMAC_2:
   \   000068   29           ADD       A,R1
   \   000069   C0E0         PUSH      A
   \   00006B   E5..         MOV       A,?V0
   \   00006D   F5..         MOV       ?V2,A
   \   00006F   7406         MOV       A,#0x6
   \   000071   12....       LCALL     ?XSTACK_DISP0_8
   \   000074   E582         MOV       A,DPL
   \   000076   25..         ADD       A,?V2
   \   000078   F582         MOV       DPL,A
   \   00007A   E4           CLR       A
   \   00007B   3583         ADDC      A,DPH
   \   00007D   F583         MOV       DPH,A
   \   00007F   D0E0         POP       A
   \   000081   F0           MOVX      @DPTR,A
    499              
    500              // 转换低4位
    501              uint8 lowNibble = macAddr[i] & 0x0F;
   \   000082   8A82         MOV       DPL,R2
   \   000084   8B83         MOV       DPH,R3
   \   000086   E0           MOVX      A,@DPTR
   \   000087   540F         ANL       A,#0xf
   \   000089   F9           MOV       R1,A
    502              macStr[pos++] = (lowNibble < 10) ? ('0' + lowNibble) : ('A' + lowNibble - 10);
   \   00008A   88..         MOV       ?V1,R0
   \   00008C   7401         MOV       A,#0x1
   \   00008E   28           ADD       A,R0
   \   00008F   F8           MOV       R0,A
   \   000090   E9           MOV       A,R1
   \   000091   C3           CLR       C
   \   000092   940A         SUBB      A,#0xa
   \   000094   5004         JNC       ??zclZEM_ReadAndSendMAC_3
   \   000096   7430         MOV       A,#0x30
   \   000098   8002         SJMP      ??zclZEM_ReadAndSendMAC_4
   \                     ??zclZEM_ReadAndSendMAC_3:
   \   00009A   7437         MOV       A,#0x37
   \                     ??zclZEM_ReadAndSendMAC_4:
   \   00009C   29           ADD       A,R1
   \   00009D   F9           MOV       R1,A
   \   00009E   AA..         MOV       R2,?V1
   \   0000A0   7406         MOV       A,#0x6
   \   0000A2   12....       LCALL     ?XSTACK_DISP0_8
   \   0000A5   12....       LCALL     ?Subroutine15 & 0xFFFF
   \                     ??CrossCallReturnLabel_20:
   \   0000A8   E9           MOV       A,R1
   \   0000A9   F0           MOVX      @DPTR,A
    503              
    504              // 添加冒号分隔符（最后一个字节后不加）
    505              if (i < 7) {
   \   0000AA   EC           MOV       A,R4
   \   0000AB   C3           CLR       C
   \   0000AC   9407         SUBB      A,#0x7
   \   0000AE   500C         JNC       ??zclZEM_ReadAndSendMAC_5
    506                macStr[pos++] = ':';
   \   0000B0   7406         MOV       A,#0x6
   \   0000B2   12....       LCALL     ?XSTACK_DISP0_8
   \   0000B5   12....       LCALL     ?Subroutine14 & 0xFFFF
    507              }
    508            }
   \                     ??CrossCallReturnLabel_18:
   \   0000B8   743A         MOV       A,#0x3a
   \   0000BA   F0           MOVX      @DPTR,A
   \   0000BB   08           INC       R0
   \                     ??zclZEM_ReadAndSendMAC_5:
   \   0000BC   0C           INC       R4
   \   0000BD   EC           MOV       A,R4
   \   0000BE   C3           CLR       C
   \   0000BF   9408         SUBB      A,#0x8
   \   0000C1   4082         JC        ??zclZEM_ReadAndSendMAC_0
    509            
    510            // 添加换行符
    511            macStr[pos++] = '\r';
   \   0000C3   E8           MOV       A,R0
   \   0000C4   FA           MOV       R2,A
   \   0000C5   7406         MOV       A,#0x6
   \   0000C7   12....       LCALL     ?XSTACK_DISP0_8
   \   0000CA   12....       LCALL     ?Subroutine15 & 0xFFFF
   \                     ??CrossCallReturnLabel_21:
   \   0000CD   740D         MOV       A,#0xd
   \   0000CF   F0           MOVX      @DPTR,A
   \   0000D0   08           INC       R0
    512            macStr[pos++] = '\n';
   \   0000D1   7406         MOV       A,#0x6
   \   0000D3   12....       LCALL     ?XSTACK_DISP0_8
   \   0000D6   12....       LCALL     ?Subroutine14 & 0xFFFF
   \                     ??CrossCallReturnLabel_19:
   \   0000D9   740A         MOV       A,#0xa
   \   0000DB   F0           MOVX      @DPTR,A
    513            
    514            // Send MAC address via UART
    515            // 统一使用UART0端口（协调器配置）
    516            HalUARTWrite(HAL_UART_PORT_0, macStr, pos);
   \   0000DC                ; Setup parameters for call to function HalUARTWrite
   \   0000DC   7401         MOV       A,#0x1
   \   0000DE   28           ADD       A,R0
   \   0000DF   FC           MOV       R4,A
   \   0000E0   7D00         MOV       R5,#0x0
   \   0000E2   7406         MOV       A,#0x6
   \   0000E4   12....       LCALL     ?XSTACK_DISP101_8
   \   0000E7   7900         MOV       R1,#0x0
   \   0000E9   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    517          }
   \   0000EC   7438         MOV       A,#0x38
   \   0000EE   02....       LJMP      ?Subroutine0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine15:
   \   000000   E582         MOV       A,DPL
   \   000002   2A           ADD       A,R2
   \   000003   F582         MOV       DPL,A
   \   000005   E4           CLR       A
   \   000006   3583         ADDC      A,DPH
   \   000008   F583         MOV       DPH,A
   \   00000A   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine14:
   \   000000   E582         MOV       A,DPL
   \   000002   28           ADD       A,R0
   \   000003   F582         MOV       DPL,A
   \   000005   E4           CLR       A
   \   000006   3583         ADDC      A,DPH
   \   000008   F583         MOV       DPH,A
   \   00000A   22           RET
    518          
    519          /*********************************************************************
    520           * @fn      zclZEM_UartCB
    521           *
    522           * @brief   UART callback function
    523           *
    524           * @param   port - UART port
    525           * @param   event - UART event
    526           *
    527           * @return  none
    528           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    529          static void zclZEM_UartCB(uint8 port, uint8 event)
   \                     zclZEM_UartCB:
    530          {
   \   000000   74F7         MOV       A,#-0x9
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    531            // 获取当前串口接收缓冲区有多少字节的数据
    532            uint8 rxLen = Hal_UART_RxBufLen(HAL_UART_PORT_0); 
   \   000005                ; Setup parameters for call to function Hal_UART_RxBufLen
   \   000005   7900         MOV       R1,#0x0
   \   000007   12....       LCALL     `??Hal_UART_RxBufLen::?relay`; Banked call to: Hal_UART_RxBufLen
   \   00000A   EA           MOV       A,R2
    533            if(rxLen != 0) // 如果字节数数量不等于0 
   \   00000B   601A         JZ        ??zclZEM_UartCB_0
    534            {
    535              // 从串口缓冲区中读取数据
    536              HalUARTRead(HAL_UART_PORT_0, zclZEM_UartBuf, rxLen);
   \   00000D   FE           MOV       R6,A
   \   00000E                ; Setup parameters for call to function HalUARTRead
   \   00000E   FC           MOV       R4,A
   \   00000F   7D00         MOV       R5,#0x0
   \   000011   7A..         MOV       R2,#zclZEM_UartBuf & 0xff
   \   000013   7B..         MOV       R3,#(zclZEM_UartBuf >> 8) & 0xff
   \   000015   7900         MOV       R1,#0x0
   \   000017   12....       LCALL     `??HalUARTRead::?relay`; Banked call to: HalUARTRead
    537              // 通过串口发送数据，例如把数据发送到串口助手
    538              HalUARTWrite(HAL_UART_PORT_0, zclZEM_UartBuf, rxLen);  
   \   00001A                ; Setup parameters for call to function HalUARTWrite
   \   00001A   EE           MOV       A,R6
   \   00001B   FC           MOV       R4,A
   \   00001C   7D00         MOV       R5,#0x0
   \   00001E   7A..         MOV       R2,#zclZEM_UartBuf & 0xff
   \   000020   7B..         MOV       R3,#(zclZEM_UartBuf >> 8) & 0xff
   \   000022   7900         MOV       R1,#0x0
   \   000024   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    539            }
    540          }
   \                     ??zclZEM_UartCB_0:
   \   000027                REQUIRE ?Subroutine1
   \   000027                ; // Fall through to label ?Subroutine1

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7F01         MOV       R7,#0x1
   \   000002   02....       LJMP      ?BANKED_LEAVE_XDATA
    541          
    542          /*********************************************************************
    543           * @fn      zclZEM_HandleKeys
    544           *
    545           * @brief   Handles all key events for this device.
    546           *
    547           * @param   shift - true if in shift/alt.
    548           * @param   keys - bit field for key events. Valid entries:
    549           *                 HAL_KEY_SW_5
    550           *                 HAL_KEY_SW_4
    551           *                 HAL_KEY_SW_3
    552           *                 HAL_KEY_SW_2
    553           *                 HAL_KEY_SW_1
    554           *
    555           * @return  none
    556           */
    557          static void zclZEM_HandleKeys( byte shift, byte keys )
    558          {
    559          }
    560          
    561          /*********************************************************************
    562           * @fn      zclZEM_LcdDisplayMainMode
    563           *
    564           * @brief   Called to display the main screen on the LCD.
    565           *
    566           * @param   none
    567           *
    568           * @return  none
    569           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    570          static void zclZEM_ProcessCommissioningStatus(bdbCommissioningModeMsg_t* bdbCommissioningModeMsg)
   \                     zclZEM_ProcessCommissioningStatus:
    571          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 96
   \   000004   74A0         MOV       A,#-0x60
   \   000006   12....       LCALL     ?ALLOC_XSTACK8
    572              switch(bdbCommissioningModeMsg->bdbCommissioningMode)
   \   000009   8A82         MOV       DPL,R2
   \   00000B   8B83         MOV       DPH,R3
   \   00000D   A3           INC       DPTR
   \   00000E   E0           MOVX      A,@DPTR
   \   00000F   14           DEC       A
   \   000010   6023         JZ        ??zclZEM_ProcessCommissioningStatus_0
   \   000012   14           DEC       A
   \   000013   600A         JZ        ??zclZEM_ProcessCommissioningStatus_1
   \   000015   24FD         ADD       A,#-0x3
   \   000017   7003         JNZ       $+5
   \   000019   02....       LJMP      ??zclZEM_ProcessCommissioningStatus_2 & 0xFFFF
   \   00001C   02....       LJMP      ??zclZEM_ProcessCommissioningStatus_3 & 0xFFFF
    573              {
    574                case BDB_COMMISSIONING_FORMATION:
    575                  if(bdbCommissioningModeMsg->bdbCommissioningStatus == BDB_COMMISSIONING_SUCCESS)
   \                     ??zclZEM_ProcessCommissioningStatus_1:
   \   00001F   8A82         MOV       DPL,R2
   \   000021   8B83         MOV       DPH,R3
   \   000023   E0           MOVX      A,@DPTR
   \   000024   6003         JZ        $+5
   \   000026   02....       LJMP      ??zclZEM_ProcessCommissioningStatus_3 & 0xFFFF
    576                  {
    577                    //After formation, perform nwk steering again plus the remaining commissioning modes that has not been process yet
    578                    bdb_StartCommissioning(BDB_COMMISSIONING_MODE_NWK_STEERING | bdbCommissioningModeMsg->bdbRemainingCommissioningModes);
   \   000029                ; Setup parameters for call to function bdb_StartCommissioning
   \   000029   A3           INC       DPTR
   \   00002A   A3           INC       DPTR
   \   00002B   E0           MOVX      A,@DPTR
   \   00002C   4402         ORL       A,#0x2
   \   00002E   F9           MOV       R1,A
   \   00002F   12....       LCALL     `??bdb_StartCommissioning::?relay`; Banked call to: bdb_StartCommissioning
   \   000032   02....       LJMP      ??zclZEM_ProcessCommissioningStatus_3 & 0xFFFF
    579                    // 网络形成成功
    580                    #ifdef ZDO_COORDINATOR
    581                    uint8 successMsg[] = "Network formation successful! PANID: ";
    582                    HalUARTWrite(HAL_UART_PORT_0, successMsg, sizeof(successMsg)-1);
    583                    
    584                    // 打印PANID（十六进制格式）
    585                    uint8 panidStr[8];
    586                    uint16 panId = _NIB.nwkPanId;
    587                    
    588                    // 转换高字节
    589                    uint8 highByte = (panId >> 8) & 0xFF;
    590                    uint8 highNibbleH = (highByte >> 4) & 0x0F;
    591                    uint8 lowNibbleH = highByte & 0x0F;
    592                    panidStr[0] = (highNibbleH < 10) ? ('0' + highNibbleH) : ('A' + highNibbleH - 10);
    593                    panidStr[1] = (lowNibbleH < 10) ? ('0' + lowNibbleH) : ('A' + lowNibbleH - 10);
    594                    
    595                    // 转换低字节
    596                    uint8 lowByte = panId & 0xFF;
    597                    uint8 highNibbleL = (lowByte >> 4) & 0x0F;
    598                    uint8 lowNibbleL = lowByte & 0x0F;
    599                    panidStr[2] = (highNibbleL < 10) ? ('0' + highNibbleL) : ('A' + highNibbleL - 10);
    600                    panidStr[3] = (lowNibbleL < 10) ? ('0' + lowNibbleL) : ('A' + lowNibbleL - 10);
    601                    
    602                    panidStr[4] = '\r';
    603                    panidStr[5] = '\n';
    604                    HalUARTWrite(0, panidStr, 6);
    605                    
    606                    // 打印网络地址（十六进制格式）
    607                    uint8 nwkAddrMsg[] = "Network Address: 0x";
    608                    HalUARTWrite(HAL_UART_PORT_0, nwkAddrMsg, sizeof(nwkAddrMsg)-1);
    609                    
    610                    uint16 nwkAddr = NLME_GetShortAddr(); // 获取协调器的网络地址
    611                    uint8 nwkAddrStr[6];
    612                    
    613                    // 转换高字节
    614                    uint8 nwkHighByte = (nwkAddr >> 8) & 0xFF;
    615                    uint8 nwkHighNibbleH = (nwkHighByte >> 4) & 0x0F;
    616                    uint8 nwkLowNibbleH = nwkHighByte & 0x0F;
    617                    nwkAddrStr[0] = (nwkHighNibbleH < 10) ? ('0' + nwkHighNibbleH) : ('A' + nwkHighNibbleH - 10);
    618                    nwkAddrStr[1] = (nwkLowNibbleH < 10) ? ('0' + nwkLowNibbleH) : ('A' + nwkLowNibbleH - 10);
    619                    
    620                    // 转换低字节
    621                    uint8 nwkLowByte = nwkAddr & 0xFF;
    622                    uint8 nwkHighNibbleL = (nwkLowByte >> 4) & 0x0F;
    623                    uint8 nwkLowNibbleL = nwkLowByte & 0x0F;
    624                    nwkAddrStr[2] = (nwkHighNibbleL < 10) ? ('0' + nwkHighNibbleL) : ('A' + nwkHighNibbleL - 10);
    625                    nwkAddrStr[3] = (nwkLowNibbleL < 10) ? ('0' + nwkLowNibbleL) : ('A' + nwkLowNibbleL - 10);
    626                    
    627                    nwkAddrStr[4] = '\r';
    628                    nwkAddrStr[5] = '\n';
    629                    HalUARTWrite(0, nwkAddrStr, 6);
    630                    
    631                    // 协调器组网成功后LED常亮
    632                    HalLedSet(HAL_LED_1, HAL_LED_MODE_ON);
    633                    
    634                    // 组网成功后允许设备加入网络
    635                    NLME_PermitJoiningRequest(255);
    636                    
    637                    // 组网成功后启动广播和组播定时器
    638                    // Broadcast
    639                    osal_start_timerEx(zclZEM_TaskID,
    640                                       ZEM_BROADCAST_EVT,
    641                                       ZEM_BROADCAST_PERIOD);
    642                    #endif
    643                  }
    644                  else
    645                  {
    646                    //Want to try other channels?
    647                    //try with bdb_setChannelAttribute
    648                    // 网络形成失败
    649                    #ifdef ZDO_COORDINATOR
    650                    uint8 failMsg[] = "Network formation failed! Retrying...\r\n";
    651                    HalUARTWrite(HAL_UART_PORT_0, failMsg, sizeof(failMsg)-1);
    652                    
    653                    // 直接重新调用组网函数
    654                    bdb_StartCommissioning(BDB_COMMISSIONING_MODE_NWK_FORMATION |
    655                                          BDB_COMMISSIONING_MODE_FINDING_BINDING);
    656                    #endif
    657                  }
    658                break;
    659                case BDB_COMMISSIONING_NWK_STEERING:
    660                  if(bdbCommissioningModeMsg->bdbCommissioningStatus == BDB_COMMISSIONING_SUCCESS)
   \                     ??zclZEM_ProcessCommissioningStatus_0:
   \   000035   8A82         MOV       DPL,R2
   \   000037   8B83         MOV       DPH,R3
   \   000039   E0           MOVX      A,@DPTR
   \   00003A   6003         JZ        $+5
   \   00003C   02....       LJMP      ??zclZEM_ProcessCommissioningStatus_4 & 0xFFFF
    661                  {
    662                    //YOUR JOB:
    663                    //We are on the nwk, what now?
    664                    // 网络引导成功
    665                    #ifdef ZDO_COORDINATOR
    666                    #else
    667                    uint8 steeringSuccessMsg[] = "Network steering successful! PANID: ";
   \   00003F   90....       MOV       DPTR,#`?<Constant "Network steering succ...">`
   \   000042   743B         MOV       A,#0x3b
   \   000044   12....       LCALL     ?XSTACK_DISP102_8
   \   000047   7425         MOV       A,#0x25
   \   000049   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    668                    HalUARTWrite(HAL_UART_PORT_0, steeringSuccessMsg, sizeof(steeringSuccessMsg)-1);
   \   00004C                ; Setup parameters for call to function HalUARTWrite
   \   00004C   7C24         MOV       R4,#0x24
   \   00004E   FD           MOV       R5,A
   \   00004F   743B         MOV       A,#0x3b
   \   000051   12....       LCALL     ?XSTACK_DISP101_8
   \   000054   7900         MOV       R1,#0x0
   \   000056   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    669                    
    670                    // 打印PANID（十六进制格式）
    671                    uint8 panidStr[8];
    672                    uint16 panId = _NIB.nwkPanId;
   \   000059   90....       MOV       DPTR,#_NIB + 33
   \   00005C   E0           MOVX      A,@DPTR
   \   00005D   FA           MOV       R2,A
   \   00005E   A3           INC       DPTR
   \   00005F   12....       LCALL     ?Subroutine8 & 0xFFFF
    673                    
    674                    // 转换高字节
    675                    uint8 highByte = (panId >> 8) & 0xFF;
    676                    uint8 highNibbleH = (highByte >> 4) & 0x0F;
    677                    uint8 lowNibbleH = highByte & 0x0F;
    678                    panidStr[0] = (highNibbleH < 10) ? ('0' + highNibbleH) : ('A' + highNibbleH - 10);
   \                     ??CrossCallReturnLabel_9:
   \   000062   5004         JNC       ??zclZEM_ProcessCommissioningStatus_5
   \   000064   7430         MOV       A,#0x30
   \   000066   8002         SJMP      ??zclZEM_ProcessCommissioningStatus_6
   \                     ??zclZEM_ProcessCommissioningStatus_5:
   \   000068   7437         MOV       A,#0x37
   \                     ??zclZEM_ProcessCommissioningStatus_6:
   \   00006A   12....       LCALL     ?Subroutine12 & 0xFFFF
    679                    panidStr[1] = (lowNibbleH < 10) ? ('0' + lowNibbleH) : ('A' + lowNibbleH - 10);
   \                     ??CrossCallReturnLabel_15:
   \   00006D   5004         JNC       ??zclZEM_ProcessCommissioningStatus_7
   \   00006F   7430         MOV       A,#0x30
   \   000071   8002         SJMP      ??zclZEM_ProcessCommissioningStatus_8
   \                     ??zclZEM_ProcessCommissioningStatus_7:
   \   000073   7437         MOV       A,#0x37
   \                     ??zclZEM_ProcessCommissioningStatus_8:
   \   000075   28           ADD       A,R0
   \   000076   F8           MOV       R0,A
   \   000077   7401         MOV       A,#0x1
   \   000079   12....       LCALL     ?XSTACK_DISP0_8
   \   00007C   E8           MOV       A,R0
   \   00007D   F0           MOVX      @DPTR,A
    680                    
    681                    // 转换低字节
    682                    uint8 lowByte = panId & 0xFF;
   \   00007E   EA           MOV       A,R2
   \   00007F   12....       LCALL     ?Subroutine11 & 0xFFFF
    683                    uint8 highNibbleL = (lowByte >> 4) & 0x0F;
    684                    uint8 lowNibbleL = lowByte & 0x0F;
    685                    panidStr[2] = (highNibbleL < 10) ? ('0' + highNibbleL) : ('A' + highNibbleL - 10);
   \                     ??CrossCallReturnLabel_13:
   \   000082   5004         JNC       ??zclZEM_ProcessCommissioningStatus_9
   \   000084   7430         MOV       A,#0x30
   \   000086   8002         SJMP      ??zclZEM_ProcessCommissioningStatus_10
   \                     ??zclZEM_ProcessCommissioningStatus_9:
   \   000088   7437         MOV       A,#0x37
   \                     ??zclZEM_ProcessCommissioningStatus_10:
   \   00008A   28           ADD       A,R0
   \   00008B   F8           MOV       R0,A
   \   00008C   7402         MOV       A,#0x2
   \   00008E   12....       LCALL     ?XSTACK_DISP0_8
   \   000091   E8           MOV       A,R0
   \   000092   F0           MOVX      @DPTR,A
    686                    panidStr[3] = (lowNibbleL < 10) ? ('0' + lowNibbleL) : ('A' + lowNibbleL - 10);
   \   000093   E9           MOV       A,R1
   \   000094   C3           CLR       C
   \   000095   940A         SUBB      A,#0xa
   \   000097   5004         JNC       ??zclZEM_ProcessCommissioningStatus_11
   \   000099   7430         MOV       A,#0x30
   \   00009B   8002         SJMP      ??zclZEM_ProcessCommissioningStatus_12
   \                     ??zclZEM_ProcessCommissioningStatus_11:
   \   00009D   7437         MOV       A,#0x37
   \                     ??zclZEM_ProcessCommissioningStatus_12:
   \   00009F   29           ADD       A,R1
   \   0000A0   F8           MOV       R0,A
   \   0000A1   7403         MOV       A,#0x3
   \   0000A3   12....       LCALL     ?XSTACK_DISP0_8
   \   0000A6   E8           MOV       A,R0
   \   0000A7   F0           MOVX      @DPTR,A
    687                    
    688                    panidStr[4] = '\r';
   \   0000A8   7404         MOV       A,#0x4
   \   0000AA   12....       LCALL     ?XSTACK_DISP0_8
   \   0000AD   740D         MOV       A,#0xd
   \   0000AF   F0           MOVX      @DPTR,A
    689                    panidStr[5] = '\n';
   \   0000B0   7405         MOV       A,#0x5
   \   0000B2   12....       LCALL     ?XSTACK_DISP0_8
   \   0000B5   740A         MOV       A,#0xa
   \   0000B7   F0           MOVX      @DPTR,A
    690                    HalUARTWrite(0, panidStr, 6);
   \   0000B8                ; Setup parameters for call to function HalUARTWrite
   \   0000B8   7C06         MOV       R4,#0x6
   \   0000BA   7D00         MOV       R5,#0x0
   \   0000BC   AA..         MOV       R2,?XSP + 0
   \   0000BE   AB..         MOV       R3,?XSP + 1
   \   0000C0   7900         MOV       R1,#0x0
   \   0000C2   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    691                    
    692                    // 入网成功后使用P2P向协调器发送MAC地址
    693                    zclZEM_SendMACToCoordinator();
   \   0000C5                ; Setup parameters for call to function zclZEM_SendMACToCoordinator
   \   0000C5   12....       LCALL     `??zclZEM_SendMACToCoordinator::?relay`; Banked call to: zclZEM_SendMACToCoordinator
    694                    
    695                    // 入网成功后启动P2P定时器，定期向协调器发送MAC地址
    696                    osal_start_timerEx(zclZEM_TaskID,
    697                                       ZEM_P2P_EVT,
    698                                       ZEM_P2P_PERIOD);
   \   0000C8                ; Setup parameters for call to function osal_start_timerEx
   \   0000C8   90....       MOV       DPTR,#__Constant_3e8
   \   0000CB   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   0000CE   7A00         MOV       R2,#0x0
   \   0000D0   7B02         MOV       R3,#0x2
   \   0000D2   90....       MOV       DPTR,#zclZEM_TaskID
   \   0000D5   E0           MOVX      A,@DPTR
   \   0000D6   F9           MOV       R1,A
   \   0000D7   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   0000DA   7404         MOV       A,#0x4
   \   0000DC   12....       LCALL     ?DEALLOC_XSTACK8
    699                    
    700                    // 终端入网成功后LED常亮
    701                    HalLedSet(HAL_LED_1, HAL_LED_MODE_ON);
   \   0000DF                ; Setup parameters for call to function HalLedSet
   \   0000DF   7A01         MOV       R2,#0x1
   \   0000E1   7901         MOV       R1,#0x1
   \   0000E3   12....       LCALL     `??HalLedSet::?relay`; Banked call to: HalLedSet
   \   0000E6   803C         SJMP      ??zclZEM_ProcessCommissioningStatus_3
    702                    #endif
    703                  }
    704                  else
    705                  {
    706                    // 网络引导失败
    707                    #ifdef ZDO_COORDINATOR
    708                    /* 协调器 */
    709                    #else
    710                    /* 路由器或者终端 */
    711                    uint8 failMsg[] = "Network steering failed! Retrying in 1 second...\r\n";
   \                     ??zclZEM_ProcessCommissioningStatus_4:
   \   0000E8   90....       MOV       DPTR,#`?<Constant "Network steering fail...">`
   \   0000EB   7408         MOV       A,#0x8
   \   0000ED   12....       LCALL     ?XSTACK_DISP102_8
   \   0000F0   7433         MOV       A,#0x33
   \   0000F2   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    712                    HalUARTWrite(HAL_UART_PORT_0, failMsg, sizeof(failMsg)-1);
   \   0000F5                ; Setup parameters for call to function HalUARTWrite
   \   0000F5   7C32         MOV       R4,#0x32
   \   0000F7   FD           MOV       R5,A
   \   0000F8   7408         MOV       A,#0x8
   \   0000FA   12....       LCALL     ?XSTACK_DISP101_8
   \   0000FD   7900         MOV       R1,#0x0
   \   0000FF   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    713                    
    714                    /* 无限重试网络引导 */
    715                    osal_start_timerEx(zclZEM_TaskID, 
    716                                              ZEM_REJOIN_EVT, 
    717                                              ZEM_REJOIN_PERIOD);
   \   000102                ; Setup parameters for call to function osal_start_timerEx
   \   000102   8009         SJMP      ??zclZEM_ProcessCommissioningStatus_13
    718                    #endif
    719                  }
    720                  break;
    721                case BDB_COMMISSIONING_FINDING_BINDING:
    722                  if(bdbCommissioningModeMsg->bdbCommissioningStatus == BDB_COMMISSIONING_SUCCESS)
    723                  {
    724                    //YOUR JOB:
    725                  }
    726                  else
    727                  {
    728                    //YOUR JOB:
    729                    //retry?, wait for user interaction?
    730                  }
    731                break;
    732                case BDB_COMMISSIONING_INITIALIZATION:
    733                  //Initialization notification can only be successful. Failure on initialization 
    734                  //only happens for ZED and is notified as BDB_COMMISSIONING_PARENT_LOST notification
    735                  
    736                  //YOUR JOB:
    737                  //We are on a network, what now?
    738                  
    739                break;
    740          #if ZG_BUILD_ENDDEVICE_TYPE    
    741              case BDB_COMMISSIONING_PARENT_LOST:
    742                if(bdbCommissioningModeMsg->bdbCommissioningStatus == BDB_COMMISSIONING_NETWORK_RESTORED)
   \                     ??zclZEM_ProcessCommissioningStatus_2:
   \   000104   8A82         MOV       DPL,R2
   \   000106   8B83         MOV       DPH,R3
   \   000108   E0           MOVX      A,@DPTR
   \   000109   640D         XRL       A,#0xd
   \   00010B   6017         JZ        ??zclZEM_ProcessCommissioningStatus_3
    743                {
    744                  //We did recover from losing parent
    745                }
    746                else
    747                {
    748                  //Parent not found, attempt to rejoin again after a fixed delay
    749                  //osal_start_timerEx(zclZEM_TaskID, SAMPLEAPP_END_DEVICE_REJOIN_EVT, SAMPLEAPP_END_DEVICE_REJOIN_DELAY);
    750                  
    751                  /* 协调器 */
    752          #ifdef ZDO_COORDINATOR
    753                  /* 路由器或者终端 */
    754          #else
    755                /* 启动重新加入事件 */
    756                osal_start_timerEx(zclZEM_TaskID, 
    757                                  ZEM_REJOIN_EVT, 
    758                                  ZEM_REJOIN_PERIOD);
   \   00010D                ; Setup parameters for call to function osal_start_timerEx
   \                     ??zclZEM_ProcessCommissioningStatus_13:
   \   00010D   90....       MOV       DPTR,#__Constant_3e8
   \   000110   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   000113   7A00         MOV       R2,#0x0
   \   000115   7B01         MOV       R3,#0x1
   \   000117   90....       MOV       DPTR,#zclZEM_TaskID
   \   00011A   E0           MOVX      A,@DPTR
   \   00011B   F9           MOV       R1,A
   \   00011C   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   00011F   7404         MOV       A,#0x4
   \   000121   12....       LCALL     ?DEALLOC_XSTACK8
    759          #endif
    760                }
    761              break;
    762          #endif 
    763              }
    764          
    765          }
   \                     ??zclZEM_ProcessCommissioningStatus_3:
   \   000124   7460         MOV       A,#0x60
   \   000126   12....       LCALL     ?DEALLOC_XSTACK8
   \   000129                REQUIRE ?Subroutine2
   \   000129                ; // Fall through to label ?Subroutine2

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   D083         POP       DPH
   \   000002   D082         POP       DPL
   \   000004   02....       LJMP      ?BRET
    766          
    767          /*********************************************************************
    768           * @fn      zclZEM_BasicResetCB
    769           *
    770           * @brief   Callback from the ZCL General Cluster Library
    771           *          to set all the Basic Cluster attributes to default values.
    772           *
    773           * @param   none
    774           *
    775           * @return  none
    776           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    777          static void zclZEM_BasicResetCB( void )
   \                     zclZEM_BasicResetCB:
    778          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    779            zclZEM_ResetAttributesToDefaultValues();
   \   000004                ; Setup parameters for call to function zclZEM_ResetAttributesToDefaultValues
   \   000004   12....       LCALL     `??zclZEM_ResetAttributesToDefaultValues::?relay`; Banked call to: zclZEM_ResetAttributesToDefaultValues
    780            
    781          }
   \   000007   80..         SJMP      ?Subroutine2
    782          
    783          /*********************************************************************
    784           * @fn      zclSampleApp_BatteryWarningCB
    785           *
    786           * @brief   Called to handle battery-low situation.
    787           *
    788           * @param   voltLevel - level of severity
    789           *
    790           * @return  none
    791           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    792          void zclSampleApp_BatteryWarningCB( uint8 voltLevel )
   \                     zclSampleApp_BatteryWarningCB:
    793          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    794            if ( voltLevel == VOLT_LEVEL_CAUTIOUS )
    795            {
    796              // Send warning message to the gateway and blink LED
    797            }
    798            else if ( voltLevel == VOLT_LEVEL_BAD )
    799            {
    800              // Shut down the system
    801            }
    802          }
   \   000000   02....       LJMP      ?BRET
    803          
    804          /******************************************************************************
    805           *
    806           *  Functions for processing ZCL Foundation incoming Command/Response messages
    807           *
    808           *****************************************************************************/
    809          
    810          /*********************************************************************
    811           * @fn      zclZEM_ProcessIncomingMsg
    812           *
    813           * @brief   Process ZCL Foundation incoming message
    814           *
    815           * @param   pInMsg - pointer to the received message
    816           *
    817           * @return  none
    818           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    819          static void zclZEM_ProcessIncomingMsg( zclIncomingMsg_t *pInMsg)
   \                     zclZEM_ProcessIncomingMsg:
    820          {
   \   000000   74F7         MOV       A,#-0x9
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    821            switch ( pInMsg->zclHdr.commandID )
   \   000005   EA           MOV       A,R2
   \   000006   2417         ADD       A,#0x17
   \   000008   F8           MOV       R0,A
   \   000009   E4           CLR       A
   \   00000A   3B           ADDC      A,R3
   \   00000B   F9           MOV       R1,A
   \   00000C   E8           MOV       A,R0
   \   00000D   FE           MOV       R6,A
   \   00000E   E9           MOV       A,R1
   \   00000F   FF           MOV       R7,A
   \   000010   8A82         MOV       DPL,R2
   \   000012   8B83         MOV       DPH,R3
   \   000014   A3           INC       DPTR
   \   000015   A3           INC       DPTR
   \   000016   A3           INC       DPTR
   \   000017   A3           INC       DPTR
   \   000018   A3           INC       DPTR
   \   000019   A3           INC       DPTR
   \   00001A   A3           INC       DPTR
   \   00001B   E0           MOVX      A,@DPTR
   \   00001C   14           DEC       A
   \   00001D   6016         JZ        ??zclZEM_ProcessIncomingMsg_0
   \   00001F   24FD         ADD       A,#-0x3
   \   000021   601F         JZ        ??zclZEM_ProcessIncomingMsg_1
   \   000023   24F7         ADD       A,#-0x9
   \   000025   602D         JZ        ??zclZEM_ProcessIncomingMsg_2
   \   000027   24FB         ADD       A,#-0x5
   \   000029   6024         JZ        ??zclZEM_ProcessIncomingMsg_3
   \   00002B   24FE         ADD       A,#-0x2
   \   00002D   6020         JZ        ??zclZEM_ProcessIncomingMsg_3
   \   00002F   24FE         ADD       A,#-0x2
   \   000031   6033         JZ        ??zclZEM_ProcessIncomingMsg_4
   \   000033   8043         SJMP      ??zclZEM_ProcessIncomingMsg_5
    822            {
    823          #ifdef ZCL_READ
    824              case ZCL_CMD_READ_RSP:
    825                zclZEM_ProcessInReadRspCmd( pInMsg );
   \                     ??zclZEM_ProcessIncomingMsg_0:
   \   000035   12....       LCALL     ?Subroutine9 & 0xFFFF
   \                     ??CrossCallReturnLabel_10:
   \   000038   E0           MOVX      A,@DPTR
   \   000039   F9           MOV       R1,A
   \   00003A   E8           MOV       A,R0
   \   00003B   C3           CLR       C
   \   00003C   99           SUBB      A,R1
   \   00003D   5039         JNC       ??zclZEM_ProcessIncomingMsg_5
   \   00003F   08           INC       R0
   \   000040   80F6         SJMP      ??CrossCallReturnLabel_10
    826                break;
    827          #endif
    828          #ifdef ZCL_WRITE
    829              case ZCL_CMD_WRITE_RSP:
    830                zclZEM_ProcessInWriteRspCmd( pInMsg );
   \                     ??zclZEM_ProcessIncomingMsg_1:
   \   000042   12....       LCALL     ?Subroutine9 & 0xFFFF
   \                     ??CrossCallReturnLabel_11:
   \   000045   E0           MOVX      A,@DPTR
   \   000046   F9           MOV       R1,A
   \   000047   E8           MOV       A,R0
   \   000048   C3           CLR       C
   \   000049   99           SUBB      A,R1
   \   00004A   502C         JNC       ??zclZEM_ProcessIncomingMsg_5
   \   00004C   08           INC       R0
   \   00004D   80F6         SJMP      ??CrossCallReturnLabel_11
    831                break;
    832          #endif
    833          #ifdef ZCL_REPORT
    834              // See ZCL Test Applicaiton (zcl_testapp.c) for sample code on Attribute Reporting
    835              case ZCL_CMD_CONFIG_REPORT:
    836                //zclZEM_ProcessInConfigReportCmd( pInMsg );
    837                break;
    838                case ZCL_CMD_READ_REPORT_CFG:
    839                //zclZEM_ProcessInReadReportCfgCmd( pInMsg );
    840                break;
    841              case ZCL_CMD_CONFIG_REPORT_RSP:
    842                //zclZEM_ProcessInConfigReportRspCmd( pInMsg );
    843                break;
    844              case ZCL_CMD_READ_REPORT_CFG_RSP:
    845                //zclZEM_ProcessInReadReportCfgRspCmd( pInMsg );
    846                break;
    847          
    848              case ZCL_CMD_REPORT:
    849                //zclZEM_ProcessInReportCmd( pInMsg );
    850                break;
    851          #endif
    852              case ZCL_CMD_DEFAULT_RSP:
    853                zclZEM_ProcessInDefaultRspCmd( pInMsg );
    854                break;
    855          #ifdef ZCL_DISCOVER
    856              case ZCL_CMD_DISCOVER_CMDS_RECEIVED_RSP:
    857                zclZEM_ProcessInDiscCmdsRspCmd( pInMsg );
   \                     ??zclZEM_ProcessIncomingMsg_3:
   \   00004F                ; Setup parameters for call to function zclZEM_ProcessInDiscCmdsRspCmd
    858                break;
    859          
    860              case ZCL_CMD_DISCOVER_CMDS_GEN_RSP:
    861                zclZEM_ProcessInDiscCmdsRspCmd( pInMsg );
   \   00004F                ; Setup parameters for call to function zclZEM_ProcessInDiscCmdsRspCmd
   \   00004F   12....       LCALL     `??zclZEM_ProcessInDiscCmdsRspCmd::?relay`; Banked call to: zclZEM_ProcessInDiscCmdsRspCmd
    862                break;
   \   000052   8024         SJMP      ??zclZEM_ProcessIncomingMsg_5
    863          
    864              case ZCL_CMD_DISCOVER_ATTRS_RSP:
    865                zclZEM_ProcessInDiscAttrsRspCmd( pInMsg );
   \                     ??zclZEM_ProcessIncomingMsg_2:
   \   000054   12....       LCALL     ?Subroutine10 & 0xFFFF
   \                     ??CrossCallReturnLabel_23:
   \   000057   8882         MOV       DPL,R0
   \   000059   8983         MOV       DPH,R1
   \   00005B   A3           INC       DPTR
   \   00005C   E0           MOVX      A,@DPTR
   \   00005D   FB           MOV       R3,A
   \   00005E   EA           MOV       A,R2
   \   00005F   C3           CLR       C
   \   000060   9B           SUBB      A,R3
   \   000061   5015         JNC       ??zclZEM_ProcessIncomingMsg_5
   \   000063   0A           INC       R2
   \   000064   80F1         SJMP      ??CrossCallReturnLabel_23
    866                break;
    867          
    868              case ZCL_CMD_DISCOVER_ATTRS_EXT_RSP:
    869                zclZEM_ProcessInDiscAttrsExtRspCmd( pInMsg );
   \                     ??zclZEM_ProcessIncomingMsg_4:
   \   000066   12....       LCALL     ?Subroutine10 & 0xFFFF
    870                break;
    871          #endif
    872              default:
    873                break;
    874            }
   \                     ??CrossCallReturnLabel_24:
   \   000069   8001         SJMP      ??zclZEM_ProcessIncomingMsg_6
   \                     ??zclZEM_ProcessIncomingMsg_7:
   \   00006B   0A           INC       R2
   \                     ??zclZEM_ProcessIncomingMsg_6:
   \   00006C   8882         MOV       DPL,R0
   \   00006E   8983         MOV       DPH,R1
   \   000070   A3           INC       DPTR
   \   000071   E0           MOVX      A,@DPTR
   \   000072   FB           MOV       R3,A
   \   000073   EA           MOV       A,R2
   \   000074   C3           CLR       C
   \   000075   9B           SUBB      A,R3
   \   000076   40F3         JC        ??zclZEM_ProcessIncomingMsg_7
    875          
    876            if ( pInMsg->attrCmd )
   \                     ??zclZEM_ProcessIncomingMsg_5:
   \   000078   8E82         MOV       DPL,R6
   \   00007A   8F83         MOV       DPH,R7
   \   00007C   E0           MOVX      A,@DPTR
   \   00007D   FA           MOV       R2,A
   \   00007E   A3           INC       DPTR
   \   00007F   E0           MOVX      A,@DPTR
   \   000080   FB           MOV       R3,A
   \   000081   EA           MOV       A,R2
   \   000082   4B           ORL       A,R3
   \   000083   6003         JZ        ??zclZEM_ProcessIncomingMsg_8
    877            {
    878              osal_mem_free( pInMsg->attrCmd );
   \   000085                ; Setup parameters for call to function osal_mem_free
   \   000085   12....       LCALL     `??osal_mem_free::?relay`; Banked call to: osal_mem_free
    879            }
    880          }
   \                     ??zclZEM_ProcessIncomingMsg_8:
   \   000088   02....       LJMP      ?Subroutine1 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine10:
   \   000000   8E82         MOV       DPL,R6
   \   000002   8F83         MOV       DPH,R7
   \   000004                REQUIRE ??Subroutine17_0
   \   000004                ; // Fall through to label ??Subroutine17_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine17_0:
   \   000000   E0           MOVX      A,@DPTR
   \   000001   F8           MOV       R0,A
   \   000002   A3           INC       DPTR
   \   000003   E0           MOVX      A,@DPTR
   \   000004   F9           MOV       R1,A
   \   000005   7A00         MOV       R2,#0x0
   \   000007   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine9:
   \   000000   8E82         MOV       DPL,R6
   \   000002   8F83         MOV       DPH,R7
   \   000004   E0           MOVX      A,@DPTR
   \   000005   F8           MOV       R0,A
   \   000006   A3           INC       DPTR
   \   000007   E0           MOVX      A,@DPTR
   \   000008   F9           MOV       R1,A
   \   000009   8882         MOV       DPL,R0
   \   00000B   8983         MOV       DPH,R1
   \   00000D   7800         MOV       R0,#0x0
   \   00000F   22           RET
    881          
    882          #ifdef ZCL_READ
    883          /*********************************************************************
    884           * @fn      zclZEM_ProcessInReadRspCmd
    885           *
    886           * @brief   Process the "Profile" Read Response Command
    887           *
    888           * @param   pInMsg - incoming message to process
    889           *
    890           * @return  none
    891           */
    892          static uint8 zclZEM_ProcessInReadRspCmd( zclIncomingMsg_t *pInMsg )
    893          {
    894            zclReadRspCmd_t *readRspCmd;
    895            uint8 i;
    896          
    897            readRspCmd = (zclReadRspCmd_t *)pInMsg->attrCmd;
    898            for ( i = 0; i < readRspCmd->numAttr; i++ )
    899            {
    900              // Notify the originator of the results of the original read attributes
    901              // attempt and, for each successfull request, the value of the requested
    902              // attribute
    903            }
    904          
    905            return ( TRUE );
    906          }
    907          #endif // ZCL_READ
    908          
    909          #ifdef ZCL_WRITE
    910          /*********************************************************************
    911           * @fn      zclZEM_ProcessInWriteRspCmd
    912           *
    913           * @brief   Process the "Profile" Write Response Command
    914           *
    915           * @param   pInMsg - incoming message to process
    916           *
    917           * @return  none
    918           */
    919          static uint8 zclZEM_ProcessInWriteRspCmd( zclIncomingMsg_t *pInMsg )
    920          {
    921            zclWriteRspCmd_t *writeRspCmd;
    922            uint8 i;
    923          
    924            writeRspCmd = (zclWriteRspCmd_t *)pInMsg->attrCmd;
    925            for ( i = 0; i < writeRspCmd->numAttr; i++ )
    926            {
    927              // Notify the device of the results of the its original write attributes
    928              // command.
    929            }
    930          
    931            return ( TRUE );
    932          }
    933          #endif // ZCL_WRITE
    934          
    935          /*********************************************************************
    936           * @fn      zclZEM_ProcessInDefaultRspCmd
    937           *
    938           * @brief   Process the "Profile" Default Response Command
    939           *
    940           * @param   pInMsg - incoming message to process
    941           *
    942           * @return  none
    943           */
    944          static uint8 zclZEM_ProcessInDefaultRspCmd( zclIncomingMsg_t *pInMsg )
    945          {
    946            // zclDefaultRspCmd_t *defaultRspCmd = (zclDefaultRspCmd_t *)pInMsg->attrCmd;
    947          
    948            // Device is notified of the Default Response command.
    949            (void)pInMsg;
    950          
    951            return ( TRUE );
    952          }
    953          
    954          #ifdef ZCL_DISCOVER
    955          /*********************************************************************
    956           * @fn      zclZEM_ProcessInDiscCmdsRspCmd
    957           *
    958           * @brief   Process the Discover Commands Response Command
    959           *
    960           * @param   pInMsg - incoming message to process
    961           *
    962           * @return  none
    963           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    964          static uint8 zclZEM_ProcessInDiscCmdsRspCmd( zclIncomingMsg_t *pInMsg )
   \                     zclZEM_ProcessInDiscCmdsRspCmd:
    965          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    966            zclDiscoverCmdsCmdRsp_t *discoverRspCmd;
    967            uint8 i;
    968          
    969            discoverRspCmd = (zclDiscoverCmdsCmdRsp_t *)pInMsg->attrCmd;
   \   000004   EA           MOV       A,R2
   \   000005   2417         ADD       A,#0x17
   \   000007   F582         MOV       DPL,A
   \   000009   E4           CLR       A
   \   00000A   3B           ADDC      A,R3
   \   00000B   F583         MOV       DPH,A
   \   00000D   12....       LCALL     ??Subroutine17_0 & 0xFFFF
    970            for ( i = 0; i < discoverRspCmd->numCmd; i++ )
   \                     ??CrossCallReturnLabel_22:
   \   000010   8001         SJMP      ??zclZEM_ProcessInDiscCmdsRspCmd_0
   \                     ??zclZEM_ProcessInDiscCmdsRspCmd_1:
   \   000012   0A           INC       R2
   \                     ??zclZEM_ProcessInDiscCmdsRspCmd_0:
   \   000013   8882         MOV       DPL,R0
   \   000015   8983         MOV       DPH,R1
   \   000017   A3           INC       DPTR
   \   000018   A3           INC       DPTR
   \   000019   E0           MOVX      A,@DPTR
   \   00001A   FB           MOV       R3,A
   \   00001B   EA           MOV       A,R2
   \   00001C   C3           CLR       C
   \   00001D   9B           SUBB      A,R3
   \   00001E   40F2         JC        ??zclZEM_ProcessInDiscCmdsRspCmd_1
    971            {
    972              // Device is notified of the result of its attribute discovery command.
    973            }
    974          
    975            return ( TRUE );
   \   000020   7901         MOV       R1,#0x1
   \   000022   02....       LJMP      ?Subroutine2 & 0xFFFF
    976          }
    977          
    978          /*********************************************************************
    979           * @fn      zclZEM_ProcessInDiscAttrsRspCmd
    980           *
    981           * @brief   Process the "Profile" Discover Attributes Response Command
    982           *
    983           * @param   pInMsg - incoming message to process
    984           *
    985           * @return  none
    986           */
    987          static uint8 zclZEM_ProcessInDiscAttrsRspCmd( zclIncomingMsg_t *pInMsg )
    988          {
    989            zclDiscoverAttrsRspCmd_t *discoverRspCmd;
    990            uint8 i;
    991          
    992            discoverRspCmd = (zclDiscoverAttrsRspCmd_t *)pInMsg->attrCmd;
    993            for ( i = 0; i < discoverRspCmd->numAttr; i++ )
    994            {
    995              // Device is notified of the result of its attribute discovery command.
    996            }
    997          
    998            return ( TRUE );
    999          }
   1000          
   1001          /*********************************************************************
   1002           * @fn      zclZEM_ProcessInDiscAttrsExtRspCmd
   1003           *
   1004           * @brief   Process the "Profile" Discover Attributes Extended Response Command
   1005           *
   1006           * @param   pInMsg - incoming message to process
   1007           *
   1008           * @return  none
   1009           */
   1010          static uint8 zclZEM_ProcessInDiscAttrsExtRspCmd( zclIncomingMsg_t *pInMsg )
   1011          {
   1012            zclDiscoverAttrsExtRsp_t *discoverRspCmd;
   1013            uint8 i;
   1014          
   1015            discoverRspCmd = (zclDiscoverAttrsExtRsp_t *)pInMsg->attrCmd;
   1016            for ( i = 0; i < discoverRspCmd->numAttr; i++ )
   1017            {
   1018              // Device is notified of the result of its attribute discovery command.
   1019            }
   1020          
   1021            return ( TRUE );
   1022          }
   1023          #endif // ZCL_DISCOVER
   1024          
   1025          
   1026          
   1027          
   1028          /*********************************************************************
   1029           * @fn      zclZEM_AF_P2P
   1030           *
   1031           * @brief   点对点发送函数
   1032           *
   1033           * @param   destNwkAddr - 目标设备的网络地址
   1034           * @param   cid - Cluster ID，后续课程将会详细讲解
   1035           * @param   len - 数据长度
   1036           * @param   data - 数据内容
   1037           *
   1038           * @return  none
   1039           */
   1040          static void zclZEM_AF_P2P(
   1041              uint16 destNwkAddr,
   1042              uint16 cid,
   1043              uint8 len,
   1044              uint8 *data)
   1045          {
   1046              afAddrType_t dstAddr; //寻址信息配置

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   1047              static uint8 transferId = 0;//传输ID，是数据包的标识符
   \                     ??transferId:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
   1048              
   1049              /* Destination */
   1050              dstAddr.addrMode = afAddr16Bit;// 设置目标地址模式为16位网络地址，表示使用P2P的通信方式
   1051              dstAddr.addr.shortAddr = destNwkAddr;//目标设备的网络地址
   1052              dstAddr.endPoint = ZEM_ENDPOINT;//目标设备的端点号
   1053              
   1054              transferId++;
   1055              
   1056              AF_DataRequest(&dstAddr,
   1057                  &ZEM_AppEp,//应用程序端点描述符
   1058                  cid,
   1059                  len,
   1060                  data,
   1061                  &transferId,
   1062                  AF_DISCV_ROUTE,//进行路由扫描操作，用于建立发送数据报文的通信路径。关于这个参数，暂时保持例程默认的代码就可以了
   1063                  AF_DEFAULT_RADIUS);//指定最大的路由跳转级数
   1064          }
   1065          
   1066          /*********************************************************************
   1067           * @fn      zclZEM_AF_Broadcast
   1068           *
   1069           * @brief   广播发送函数
   1070           *
   1071           * @param   cid - Cluster ID
   1072           * @param   len - 待发送数据的长度
   1073           * @param   data - 待发送数据的内容
   1074           *
   1075           * @return  none
   1076           */
   1077          static void zclZEM_AF_Broadcast(
   1078              uint16 cid,
   1079              uint8 len,
   1080              uint8 *data)
   1081          {
   1082              afAddrType_t dstAddr;

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   1083              static uint8 transferId = 0;
   \                     ??transferId_1:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
   1084              
   1085              /* Destination */
   1086              dstAddr.addrMode = afAddrBroadcast;   // 使用广播模式
   1087              dstAddr.addr.shortAddr = 0xFFFF; // 广播地址
   1088              dstAddr.endPoint = ZEM_ENDPOINT; // 目标设备的端点号
   1089              
   1090              /* Transfer id */
   1091              transferId++;
   1092              
   1093              /* Send */
   1094              AF_DataRequest(&dstAddr,
   1095                  &ZEM_AppEp,//应用程序端点描述符
   1096                  cid,
   1097                  len,
   1098                  data,
   1099                  &transferId,
   1100                  AF_TX_OPTIONS_NONE,
   1101                  AF_DEFAULT_RADIUS );//指定了最大的路由跳转级数
   1102          }
   1103          
   1104          /*********************************************************************
   1105           * @fn      zclZEM_AF_Groupcast
   1106           *
   1107           * @brief   组播发送函数
   1108           *
   1109           * @param   groupId - 组ID
   1110           * @param   cid - ClusterID，后续章节将会详细讲解
   1111           * @param   len - 待发送数据的长度
   1112           * @param   data - 待发送数据的内容
   1113           *
   1114           * @return  none
   1115           */
   1116          static void zclZEM_AF_Groupcast(
   1117              uint16 groupId,
   1118              uint16 cid,
   1119              uint8 len,
   1120              uint8 *data)
   1121          {
   1122              afAddrType_t dstAddr;

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   1123              static uint8 transferId = 0;
   \                     ??transferId_2:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
   1124              
   1125              /* Destination */
   1126              dstAddr.addrMode = afAddrGroup;//使用组播通信模式
   1127              dstAddr.addr.shortAddr = groupId;
   1128              dstAddr.endPoint = ZEM_ENDPOINT;//组中的设备的端点号
   1129              
   1130              /* Transfer id */
   1131              transferId++;
   1132              
   1133              /* Send */
   1134              AF_DataRequest(&dstAddr,
   1135                  &ZEM_AppEp,//应用程序端点描述符
   1136                  cid,
   1137                  len,
   1138                  data,
   1139                  &transferId,
   1140                  AF_TX_OPTIONS_NONE,
   1141                  AF_DEFAULT_RADIUS );//指定最大的路由跳转级数，暂时可忽略
   1142          }
   1143          
   1144          /*********************************************************************
   1145           * @fn      zclZEM_AF_RxProc
   1146           *
   1147           * @brief   接收数据处理函数
   1148           *
   1149           * @param   MSGpkt - 接收到数据
   1150           *
   1151           * @return  none
   1152           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1153          static void zclZEM_AF_RxProc(afIncomingMSGPacket_t *MSGpkt)
   \                     zclZEM_AF_RxProc:
   1154          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000                REQUIRE ?V4
   \   000000                REQUIRE ?V5
   \   000000                REQUIRE ?V6
   \   000000                REQUIRE ?V8
   \   000000                REQUIRE ?V9
   \   000000                REQUIRE ?V10
   \   000000   74ED         MOV       A,#-0x13
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 19
   \   000005                ; Auto size: 94
   \   000005   74A2         MOV       A,#-0x5e
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   1155              /*计数器，记录接收到的点对点通信数据包个数*/
   1156              static uint8 p2pCnt = 0;
   1157              /*计数器，记录接收到的广播通信数据包个数*/
   1158              static uint8 bcCnt = 0;
   1159              /*计数器，记录接收到的组播通信数据包个数*/
   1160              static uint8 gcCnt = 0;
   1161              
   1162              switch( MSGpkt->clusterId )  // 判断接收到的数据包的Cluster ID
                     ^
Warning[Pe546]: transfer of control bypasses initialization of:
            variable "bcRecvMsg" (declared at line 1182)
   \   00000A   75....       MOV       ?V4,#`?<Constant " Count: ">` & 0xff
   \   00000D   75....       MOV       ?V5,#(`?<Constant " Count: ">` >> 8) & 0xff
   \   000010   75..00       MOV       ?V6,#0x0
   \   000013   EA           MOV       A,R2
   \   000014   2422         ADD       A,#0x22
   \   000016   F5..         MOV       ?V0,A
   \   000018   E4           CLR       A
   \   000019   3B           ADDC      A,R3
   \   00001A   F5..         MOV       ?V1,A
   \   00001C   EA           MOV       A,R2
   \   00001D   2420         ADD       A,#0x20
   \   00001F   FE           MOV       R6,A
   \   000020   E4           CLR       A
   \   000021   3B           ADDC      A,R3
   \   000022   FF           MOV       R7,A
   \   000023   8A82         MOV       DPL,R2
   \   000025   8B83         MOV       DPH,R3
   \   000027   A3           INC       DPTR
   \   000028   A3           INC       DPTR
   \   000029   A3           INC       DPTR
   \   00002A   A3           INC       DPTR
   \   00002B   E0           MOVX      A,@DPTR
   \   00002C   F5..         MOV       ?V2,A
   \   00002E   A3           INC       DPTR
   \   00002F   E0           MOVX      A,@DPTR
   \   000030   F5..         MOV       ?V3,A
   \   000032   78..         MOV       R0,#?V2
   \   000034   12....       LCALL     ?US_SWITCH_DENSE
   \                     `?<Jumptable for zclZEM_AF_RxProc>_0`:
   \   000037   0000         DW        0
   \   000039   02           DB        2
   \   00003A   ....         DW        ??zclZEM_AF_RxProc_0
   \   00003C   ....         DW        ??zclZEM_AF_RxProc_1
   \   00003E   ....         DW        ??zclZEM_AF_RxProc_2
   \   000040   ....         DW        ??zclZEM_AF_RxProc_3
   1163              {
   1164                  case CLUSTER_P2P:
   1165                      p2pCnt++;  // 接收到P2P数据包，进行计数
   \                     ??zclZEM_AF_RxProc_1:
   \   000042   90....       MOV       DPTR,#??p2pCnt
   \   000045   E0           MOVX      A,@DPTR
   \   000046   04           INC       A
   \   000047   F0           MOVX      @DPTR,A
   1166                      // 通过串口输出接收到的数据和计数器值
   1167                      {
   1168                          uint8 p2pMsg[64];
   1169                          osal_memcpy(p2pMsg, "P2P Data: ", 10);
   \   000048                ; Setup parameters for call to function osal_memcpy
   \   000048   75....       MOV       ?V8,#`?<Constant "P2P Data: ">` & 0xff
   \   00004B   75....       MOV       ?V9,#(`?<Constant "P2P Data: ">` >> 8) & 0xff
   \   00004E   75..00       MOV       ?V10,#0x0
   \   000051   78..         MOV       R0,#?V8
   \   000053   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   000056   7C0A         MOV       R4,#0xa
   \   000058   7D00         MOV       R5,#0x0
   \   00005A   7403         MOV       A,#0x3
   \   00005C   12....       LCALL     ?XSTACK_DISP101_8
   \   00005F   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   000062   7403         MOV       A,#0x3
   \   000064   12....       LCALL     ?DEALLOC_XSTACK8
   1170                          osal_memcpy(p2pMsg + 10, MSGpkt->cmd.Data, MSGpkt->cmd.DataLength);
   \   000067                ; Setup parameters for call to function osal_memcpy
   \   000067   12....       LCALL     ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_3:
   \   00006A   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   00006D   8E82         MOV       DPL,R6
   \   00006F   8F83         MOV       DPH,R7
   \   000071   E0           MOVX      A,@DPTR
   \   000072   FC           MOV       R4,A
   \   000073   A3           INC       DPTR
   \   000074   E0           MOVX      A,@DPTR
   \   000075   FD           MOV       R5,A
   \   000076   740D         MOV       A,#0xd
   \   000078   12....       LCALL     ?XSTACK_DISP0_8
   \   00007B   AA82         MOV       R2,DPL
   \   00007D   AB83         MOV       R3,DPH
   \   00007F   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   000082   7403         MOV       A,#0x3
   \   000084   12....       LCALL     ?DEALLOC_XSTACK8
   1171                          osal_memcpy(p2pMsg + 10 + MSGpkt->cmd.DataLength, " Count: ", 8);
   \   000087                ; Setup parameters for call to function osal_memcpy
   \   000087   78..         MOV       R0,#?V4
   \   000089   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   00008C   7C08         MOV       R4,#0x8
   \   00008E   7D00         MOV       R5,#0x0
   \   000090   8E82         MOV       DPL,R6
   \   000092   8F83         MOV       DPH,R7
   \   000094   7403         MOV       A,#0x3
   \   000096   12....       LCALL     ?XSTACK_DISP100_8
   \   000099   89..         MOV       ?V1,R1
   \   00009B   12....       LCALL     ??Subroutine18_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_25:
   \   00009E   240A         ADD       A,#0xa
   \   0000A0   FA           MOV       R2,A
   \   0000A1   E4           CLR       A
   \   0000A2   39           ADDC      A,R1
   \   0000A3   FB           MOV       R3,A
   \   0000A4   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   0000A7   7403         MOV       A,#0x3
   \   0000A9   12....       LCALL     ?DEALLOC_XSTACK8
   1172                          p2pMsg[18 + MSGpkt->cmd.DataLength] = '0' + p2pCnt;
   \   0000AC   90....       MOV       DPTR,#??p2pCnt
   \   0000AF   E0           MOVX      A,@DPTR
   \   0000B0   2430         ADD       A,#0x30
   \   0000B2   C0E0         PUSH      A
   \   0000B4   12....       LCALL     ?Subroutine7 & 0xFFFF
   1173                          p2pMsg[19 + MSGpkt->cmd.DataLength] = '\r';
   1174                          p2pMsg[20 + MSGpkt->cmd.DataLength] = '\n';
   1175                          HalUARTWrite(HAL_UART_PORT_0, p2pMsg, 21 + MSGpkt->cmd.DataLength);
   1176                      }
   \                     ??CrossCallReturnLabel_26:
   \   0000B7   2412         ADD       A,#0x12
   \   0000B9   F582         MOV       DPL,A
   \   0000BB   E4           CLR       A
   \   0000BC   39           ADDC      A,R1
   \   0000BD   F583         MOV       DPH,A
   \   0000BF   D0E0         POP       A
   \   0000C1   12....       LCALL     ??Subroutine19_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_32:
   \   0000C4   2413         ADD       A,#0x13
   \   0000C6   12....       LCALL     ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_30:
   \   0000C9   2414         ADD       A,#0x14
   \   0000CB   12....       LCALL     ?Subroutine13 & 0xFFFF
   \                     ??CrossCallReturnLabel_16:
   \   0000CE   2415         ADD       A,#0x15
   \   0000D0   02....       LJMP      ??zclZEM_AF_RxProc_4 & 0xFFFF
   1177                      break;
   1178                  case CLUSTER_BROADCAST:
   1179                      bcCnt++;  // 接收到广播数据包，进行计数
   \                     ??zclZEM_AF_RxProc_2:
   \   0000D3   90....       MOV       DPTR,#??bcCnt
   \   0000D6   E0           MOVX      A,@DPTR
   \   0000D7   04           INC       A
   \   0000D8   F0           MOVX      @DPTR,A
   1180                      
   1181                      // 添加广播接收调试信息
   1182                      uint8 bcRecvMsg[] = "Broadcast message received!\r\n";
   \   0000D9   90....       MOV       DPTR,#`?<Constant "Broadcast message rec...">`
   \   0000DC   7440         MOV       A,#0x40
   \   0000DE   12....       LCALL     ?XSTACK_DISP102_8
   \   0000E1   741E         MOV       A,#0x1e
   \   0000E3   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
   1183                      HalUARTWrite(HAL_UART_PORT_0, bcRecvMsg, sizeof(bcRecvMsg)-1);
   \   0000E6                ; Setup parameters for call to function HalUARTWrite
   \   0000E6   7C1D         MOV       R4,#0x1d
   \   0000E8   FD           MOV       R5,A
   \   0000E9   7440         MOV       A,#0x40
   \   0000EB   12....       LCALL     ?XSTACK_DISP101_8
   \   0000EE   7900         MOV       R1,#0x0
   \   0000F0   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
   1184                      
   1185                      // 通过串口输出接收到的数据和计数器值
   1186                      {
   1187                          uint8 bcMsg[64];
   1188                          osal_memcpy(bcMsg, "Broadcast Data: ", 16);
   \   0000F3                ; Setup parameters for call to function osal_memcpy
   \   0000F3   75....       MOV       ?V8,#`?<Constant "Broadcast Data: ">` & 0xff
   \   0000F6   75....       MOV       ?V9,#(`?<Constant "Broadcast Data: ">` >> 8) & 0xff
   \   0000F9   75..00       MOV       ?V10,#0x0
   \   0000FC   78..         MOV       R0,#?V8
   \   0000FE   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   000101   7C10         MOV       R4,#0x10
   \   000103   7D00         MOV       R5,#0x0
   \   000105   7403         MOV       A,#0x3
   \   000107   12....       LCALL     ?XSTACK_DISP101_8
   \   00010A   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   00010D   7403         MOV       A,#0x3
   \   00010F   12....       LCALL     ?DEALLOC_XSTACK8
   1189                          osal_memcpy(bcMsg + 16, MSGpkt->cmd.Data, MSGpkt->cmd.DataLength);
   \   000112                ; Setup parameters for call to function osal_memcpy
   \   000112   12....       LCALL     ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   000115   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   000118   8E82         MOV       DPL,R6
   \   00011A   8F83         MOV       DPH,R7
   \   00011C   E0           MOVX      A,@DPTR
   \   00011D   FC           MOV       R4,A
   \   00011E   A3           INC       DPTR
   \   00011F   E0           MOVX      A,@DPTR
   \   000120   FD           MOV       R5,A
   \   000121   7413         MOV       A,#0x13
   \   000123   12....       LCALL     ?XSTACK_DISP0_8
   \   000126   AA82         MOV       R2,DPL
   \   000128   AB83         MOV       R3,DPH
   \   00012A   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   00012D   7403         MOV       A,#0x3
   \   00012F   12....       LCALL     ?DEALLOC_XSTACK8
   1190                          osal_memcpy(bcMsg + 16 + MSGpkt->cmd.DataLength, " Count: ", 8);
   \   000132                ; Setup parameters for call to function osal_memcpy
   \   000132   78..         MOV       R0,#?V4
   \   000134   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   000137   7C08         MOV       R4,#0x8
   \   000139   7D00         MOV       R5,#0x0
   \   00013B   8E82         MOV       DPL,R6
   \   00013D   8F83         MOV       DPH,R7
   \   00013F   7403         MOV       A,#0x3
   \   000141   12....       LCALL     ?XSTACK_DISP100_8
   \   000144   12....       LCALL     ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_6:
   \   000147   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   00014A   7403         MOV       A,#0x3
   \   00014C   12....       LCALL     ?DEALLOC_XSTACK8
   1191                          bcMsg[24 + MSGpkt->cmd.DataLength] = '0' + bcCnt;
   \   00014F   90....       MOV       DPTR,#??bcCnt
   \   000152   8065         SJMP      ??zclZEM_AF_RxProc_5
   1192                          bcMsg[25 + MSGpkt->cmd.DataLength] = '\r';
   1193                          bcMsg[26 + MSGpkt->cmd.DataLength] = '\n';
   1194                          HalUARTWrite(HAL_UART_PORT_0, bcMsg, 27 + MSGpkt->cmd.DataLength);
   1195                      }
   1196                      break;
   1197                  case CLUSTER_GROUPCAST:
   1198                      gcCnt++;  // 接收到组播数据包，进行计数
   \                     ??zclZEM_AF_RxProc_3:
   \   000154   90....       MOV       DPTR,#??gcCnt
   \   000157   E0           MOVX      A,@DPTR
   \   000158   04           INC       A
   \   000159   F0           MOVX      @DPTR,A
   1199                      // 通过串口输出接收到的数据和计数器值
   1200                      {
   1201                          uint8 gcMsg[64];
   1202                          osal_memcpy(gcMsg, "Groupcast Data: ", 16);
   \   00015A                ; Setup parameters for call to function osal_memcpy
   \   00015A   75....       MOV       ?V8,#`?<Constant "Groupcast Data: ">` & 0xff
   \   00015D   75....       MOV       ?V9,#(`?<Constant "Groupcast Data: ">` >> 8) & 0xff
   \   000160   75..00       MOV       ?V10,#0x0
   \   000163   78..         MOV       R0,#?V8
   \   000165   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   000168   7C10         MOV       R4,#0x10
   \   00016A   7D00         MOV       R5,#0x0
   \   00016C   7403         MOV       A,#0x3
   \   00016E   12....       LCALL     ?XSTACK_DISP101_8
   \   000171   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   000174   7403         MOV       A,#0x3
   \   000176   12....       LCALL     ?DEALLOC_XSTACK8
   1203                          osal_memcpy(gcMsg + 16, MSGpkt->cmd.Data, MSGpkt->cmd.DataLength);
   \   000179                ; Setup parameters for call to function osal_memcpy
   \   000179   12....       LCALL     ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   00017C   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   00017F   8E82         MOV       DPL,R6
   \   000181   8F83         MOV       DPH,R7
   \   000183   E0           MOVX      A,@DPTR
   \   000184   FC           MOV       R4,A
   \   000185   A3           INC       DPTR
   \   000186   E0           MOVX      A,@DPTR
   \   000187   FD           MOV       R5,A
   \   000188   7413         MOV       A,#0x13
   \   00018A   12....       LCALL     ?XSTACK_DISP0_8
   \   00018D   AA82         MOV       R2,DPL
   \   00018F   AB83         MOV       R3,DPH
   \   000191   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   000194   7403         MOV       A,#0x3
   \   000196   12....       LCALL     ?DEALLOC_XSTACK8
   1204                          osal_memcpy(gcMsg + 16 + MSGpkt->cmd.DataLength, " Count: ", 8);
   \   000199                ; Setup parameters for call to function osal_memcpy
   \   000199   78..         MOV       R0,#?V4
   \   00019B   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   00019E   7C08         MOV       R4,#0x8
   \   0001A0   7D00         MOV       R5,#0x0
   \   0001A2   8E82         MOV       DPL,R6
   \   0001A4   8F83         MOV       DPH,R7
   \   0001A6   7403         MOV       A,#0x3
   \   0001A8   12....       LCALL     ?XSTACK_DISP100_8
   \   0001AB   12....       LCALL     ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   0001AE   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   0001B1   7403         MOV       A,#0x3
   \   0001B3   12....       LCALL     ?DEALLOC_XSTACK8
   1205                          gcMsg[24 + MSGpkt->cmd.DataLength] = '0' + gcCnt;
   \   0001B6   90....       MOV       DPTR,#??gcCnt
   \                     ??zclZEM_AF_RxProc_5:
   \   0001B9   E0           MOVX      A,@DPTR
   \   0001BA   2430         ADD       A,#0x30
   \   0001BC   C0E0         PUSH      A
   1206                          gcMsg[25 + MSGpkt->cmd.DataLength] = '\r';
   1207                          gcMsg[26 + MSGpkt->cmd.DataLength] = '\n';
   1208                          HalUARTWrite(HAL_UART_PORT_0, gcMsg, 27 + MSGpkt->cmd.DataLength);
   1209                      }
   \   0001BE   12....       LCALL     ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_27:
   \   0001C1   2418         ADD       A,#0x18
   \   0001C3   F582         MOV       DPL,A
   \   0001C5   E4           CLR       A
   \   0001C6   39           ADDC      A,R1
   \   0001C7   F583         MOV       DPH,A
   \   0001C9   D0E0         POP       A
   \   0001CB   12....       LCALL     ??Subroutine19_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_33:
   \   0001CE   2419         ADD       A,#0x19
   \   0001D0   12....       LCALL     ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_31:
   \   0001D3   241A         ADD       A,#0x1a
   \   0001D5   12....       LCALL     ?Subroutine13 & 0xFFFF
   \                     ??CrossCallReturnLabel_17:
   \   0001D8   241B         ADD       A,#0x1b
   \                     ??zclZEM_AF_RxProc_4:
   \   0001DA   FC           MOV       R4,A
   \   0001DB   A3           INC       DPTR
   \   0001DC   E0           MOVX      A,@DPTR
   \   0001DD   3400         ADDC      A,#0x0
   \   0001DF   FD           MOV       R5,A
   \   0001E0   AA..         MOV       R2,?XSP + 0
   \   0001E2   AB..         MOV       R3,?XSP + 1
   \   0001E4   7900         MOV       R1,#0x0
   \   0001E6   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
   1210                      break;
   1211                  default:
   1212                      break;
   1213              }
   1214          }
   \                     ??zclZEM_AF_RxProc_0:
   \   0001E9   745E         MOV       A,#0x5e
   \   0001EB   12....       LCALL     ?DEALLOC_XSTACK8
   \   0001EE   7F0B         MOV       R7,#0xb
   \   0001F0   02....       LJMP      ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine13:
   \   000000   F582         MOV       DPL,A
   \   000002   E4           CLR       A
   \   000003   39           ADDC      A,R1
   \   000004   F583         MOV       DPH,A
   \   000006   740A         MOV       A,#0xa
   \   000008   F0           MOVX      @DPTR,A
   \   000009                ; Setup parameters for call to function HalUARTWrite
   \   000009                ; Setup parameters for call to function HalUARTWrite
   \   000009   8E82         MOV       DPL,R6
   \   00000B   8F83         MOV       DPH,R7
   \   00000D   E0           MOVX      A,@DPTR
   \   00000E   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   8E82         MOV       DPL,R6
   \   000002   8F83         MOV       DPH,R7
   \   000004   A8..         MOV       R0,?XSP + 0
   \   000006   88..         MOV       ?V0,R0
   \   000008                REQUIRE ??Subroutine18_0
   \   000008                ; // Fall through to label ??Subroutine18_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine18_0:
   \   000000   12....       LCALL     ?Subroutine16 & 0xFFFF
   \                     ??CrossCallReturnLabel_29:
   \   000003   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine16:
   \   000000   E0           MOVX      A,@DPTR
   \   000001   28           ADD       A,R0
   \   000002   F8           MOV       R0,A
   \   000003   A3           INC       DPTR
   \   000004   E0           MOVX      A,@DPTR
   \   000005   35..         ADDC      A,?V1
   \   000007   F9           MOV       R1,A
   \   000008   E8           MOV       A,R0
   \   000009   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   89..         MOV       ?V1,R1
   \   000002   12....       LCALL     ?Subroutine16 & 0xFFFF
   \                     ??CrossCallReturnLabel_28:
   \   000005   2410         ADD       A,#0x10
   \   000007   FA           MOV       R2,A
   \   000008   E4           CLR       A
   \   000009   39           ADDC      A,R1
   \   00000A   FB           MOV       R3,A
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   85..82       MOV       DPL,?V0
   \   000003   85..83       MOV       DPH,?V1
   \   000006   E0           MOVX      A,@DPTR
   \   000007   F5..         MOV       ?V0,A
   \   000009   A3           INC       DPTR
   \   00000A   E0           MOVX      A,@DPTR
   \   00000B   F5..         MOV       ?V1,A
   \   00000D   75..00       MOV       ?V2,#0x0
   \   000010   78..         MOV       R0,#?V0
   \   000012   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   F582         MOV       DPL,A
   \   000002   E4           CLR       A
   \   000003   39           ADDC      A,R1
   \   000004   F583         MOV       DPH,A
   \   000006   740D         MOV       A,#0xd
   \   000008                REQUIRE ??Subroutine19_0
   \   000008                ; // Fall through to label ??Subroutine19_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine19_0:
   \   000000   F0           MOVX      @DPTR,A
   \   000001   8E82         MOV       DPL,R6
   \   000003   8F83         MOV       DPH,R7
   \   000005   E0           MOVX      A,@DPTR
   \   000006   25..         ADD       A,?V0
   \   000008   F8           MOV       R0,A
   \   000009   A3           INC       DPTR
   \   00000A   E0           MOVX      A,@DPTR
   \   00000B   35..         ADDC      A,?V1
   \   00000D   F9           MOV       R1,A
   \   00000E   E8           MOV       A,R0
   \   00000F   22           RET

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   \                     ??p2pCnt:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   \                     ??bcCnt:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   \                     ??gcCnt:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   E0           MOVX      A,@DPTR
   \   000001   04           INC       A
   \   000002   F0           MOVX      @DPTR,A
   \   000003                ; Setup parameters for call to function AF_DataRequest
   \   000003                ; Setup parameters for call to function AF_DataRequest
   \   000003                ; Setup parameters for call to function AF_DataRequest
   \   000003   75..1E       MOV       ?V0,#0x1e
   \   000006   78..         MOV       R0,#?V0
   \   000008   22           RET

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZEM_AppEp>`:
   \   000000   08           DB 8
   \   000001   00           DB 0
   \   000002   ....         DW zclZEM_TaskID
   \   000004   ....         DW zclZEM_SimpleDesc
   \   000006   00           DB 0

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for reportableChange>`:
   \   000000   2C           DB 44
   \   000001   01           DB 1
   \   000002   00           DB 0
   \   000003   00           DB 0

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zclZEM_CmdCallbacks>`:
   \   000000   ....         DW `??zclZEM_BasicResetCB::?relay`
   \   000002   0000         DW 0H
   \   000004   0000         DW 0H
   \   000006   0000         DW 0H
   \   000008   0000         DW 0H
   \   00000A   0000         DW 0H
   \   00000C   0000         DW 0H
   \   00000E   0000         DW 0H
   \   000010   0000         DW 0H

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_Init::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_event_loop::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_event_loop

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_SendMACToCoordinator::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_SendMACToCoordinator

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_ReadAndSendMAC::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_ReadAndSendMAC

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_UartCB::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_UartCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_ProcessCommissioningStatus::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_ProcessCommissioningStatus

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_BasicResetCB::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_BasicResetCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleApp_BatteryWarningCB::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleApp_BatteryWarningCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_ProcessIncomingMsg::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_ProcessIncomingMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_ProcessInDiscCmdsRspCmd::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_ProcessInDiscCmdsRspCmd

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclZEM_AF_RxProc::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclZEM_AF_RxProc

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Received event type: 0x">`:
   \   000000   52656365     DB "Received event type: 0x"
   \            69766564
   \            20657665
   \            6E742074
   \            7970653A
   \            20307800

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Broadcast">`:
   \   000000   42726F61     DB "Broadcast"
   \            64636173
   \            7400    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Broadcast message sen...">`:
   \   000000   42726F61     DB "Broadcast message sent!\015\012"
   \            64636173
   \            74206D65
   \            73736167
   \            65207365
   \            6E74210D
   \            0A00    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Groupcast">`:
   \   000000   47726F75     DB "Groupcast"
   \            70636173
   \            7400    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "ZEM_P2P_EVT processed...">`:
   \   000000   5A454D5F     DB "ZEM_P2P_EVT processed! Network state: "
   \            5032505F
   \            45565420
   \            70726F63
   \            65737365
   \            6421204E
   \            6574776F
   \            726B2073
   \            74617465
   \            3A2000  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "ZEM_REJOIN_EVT proces...">`:
   \   000000   5A454D5F     DB 5AH, 45H, 4DH, 5FH, 52H, 45H, 4AH, 4FH
   \            52454A4F
   \   000008   494E5F45     DB 49H, 4EH, 5FH, 45H, 56H, 54H, 20H, 70H
   \            56542070
   \   000010   726F6365     DB 72H, 6FH, 63H, 65H, 73H, 73H, 65H, 64H
   \            73736564
   \   000018   21205374     DB 21H, 20H, 53H, 74H, 61H, 72H, 74H, 69H
   \            61727469
   \   000020   6E67206E     DB 6EH, 67H, 20H, 6EH, 65H, 74H, 77H, 6FH
   \            6574776F
   \   000028   726B2073     DB 72H, 6BH, 20H, 73H, 74H, 65H, 65H, 72H
   \            74656572
   \   000030   696E672E     DB 69H, 6EH, 67H, 2EH, 2EH, 2EH, 0DH, 0AH
   \            2E2E0D0A
   \   000038   00           DB 0

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "MAC address sent to c...">`:
   \   000000   4D414320     DB "MAC address sent to coordinator!\015\012"
   \            61646472
   \            65737320
   \            73656E74
   \            20746F20
   \            636F6F72
   \            64696E61
   \            746F7221
   \            0D0A00  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "MAC: ">`:
   \   000000   4D41433A     DB "MAC: "
   \            2000    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Network steering succ...">`:
   \   000000   4E657477     DB "Network steering successful! PANID: "
   \            6F726B20
   \            73746565
   \            72696E67
   \            20737563
   \            63657373
   \            66756C21
   \            2050414E
   \            49443A20
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Network steering fail...">`:
   \   000000   4E657477     DB 4EH, 65H, 74H, 77H, 6FH, 72H, 6BH, 20H
   \            6F726B20
   \   000008   73746565     DB 73H, 74H, 65H, 65H, 72H, 69H, 6EH, 67H
   \            72696E67
   \   000010   20666169     DB 20H, 66H, 61H, 69H, 6CH, 65H, 64H, 21H
   \            6C656421
   \   000018   20526574     DB 20H, 52H, 65H, 74H, 72H, 79H, 69H, 6EH
   \            7279696E
   \   000020   6720696E     DB 67H, 20H, 69H, 6EH, 20H, 31H, 20H, 73H
   \            20312073
   \   000028   65636F6E     DB 65H, 63H, 6FH, 6EH, 64H, 2EH, 2EH, 2EH
   \            642E2E2E
   \   000030   0D0A00       DB 0DH, 0AH, 0

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "P2P Data: ">`:
   \   000000   50325020     DB "P2P Data: "
   \            44617461
   \            3A2000  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant " Count: ">`:
   \   000000   20436F75     DB " Count: "
   \            6E743A20
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Broadcast message rec...">`:
   \   000000   42726F61     DB "Broadcast message received!\015\012"
   \            64636173
   \            74206D65
   \            73736167
   \            65207265
   \            63656976
   \            6564210D
   \            0A00    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Broadcast Data: ">`:
   \   000000   42726F61     DB "Broadcast Data: "
   \            64636173
   \            74204461
   \            74613A20
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Groupcast Data: ">`:
   \   000000   47726F75     DB "Groupcast Data: "
   \            70636173
   \            74204461
   \            74613A20
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_ea60:
   \   000000   60EA0000     DD 60000

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_2710:
   \   000000   10270000     DD 10000

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3e8:
   \   000000   E8030000     DD 1000
   1215          
   1216          /****************************************************************************
   1217          ****************************************************************************/
   1218          
   1219          

   Maximum stack usage in bytes:

   ISTACK XSTACK Function
   ------ ------ --------
      0      0   zclSampleApp_BatteryWarningCB
      1    308   zclZEM_AF_RxProc
        0    113   -> HalUARTWrite
        0    116   -> osal_memcpy
      2      0   zclZEM_BasicResetCB
        2      0   -> zclZEM_ResetAttributesToDefaultValues
      0     45   zclZEM_Init
        0     39   -> HalUARTOpen
        0     39   -> RegisterForKeys
        0     39   -> RegisterVoltageWarningCB
        0     39   -> afRegister
        0     39   -> bdb_RegisterCommissioningStatusCB
        0     39   -> bdb_RegisterSimpleDescriptor
        0     45   -> bdb_RepAddAttrCfgRecordDefaultToList
        0     39   -> bdb_StartCommissioning
        0     43   -> osal_start_timerEx
        0     39   -> zclGeneral_RegisterCmdCallbacks
        0     39   -> zclZEM_ReadAndSendMAC
        0     39   -> zclZEM_ResetAttributesToDefaultValues
        0     39   -> zcl_registerAttrList
        0     39   -> zcl_registerForMsg
      3    100   zclZEM_ProcessCommissioningStatus
        2     96   -> HalLedSet
        2     96   -> HalUARTWrite
        2     96   -> bdb_StartCommissioning
        2    100   -> osal_start_timerEx
        2     96   -> zclZEM_SendMACToCoordinator
      2      9   zclZEM_ProcessInDiscCmdsRspCmd
      0    201   zclZEM_ProcessIncomingMsg
        0      9   -> osal_mem_free
        0      9   -> zclZEM_ProcessInDiscCmdsRspCmd
      1    110   zclZEM_ReadAndSendMAC
        0     68   -> HalUARTWrite
        0     68   -> NLME_GetExtAddr
        0     71   -> osal_memcpy
      0    270   zclZEM_SendMACToCoordinator
        0     78   -> AF_DataRequest
        0     69   -> HalUARTWrite
        0     69   -> NLME_GetExtAddr
        0     72   -> osal_memcpy
      0      9   zclZEM_UartCB
        0      9   -> HalUARTRead
        0      9   -> HalUARTWrite
        0      9   -> Hal_UART_RxBufLen
      1    201   zclZEM_event_loop
        0    201   -> AF_DataRequest
        0    192   -> HalUARTWrite
        0    192   -> NLME_PermitJoiningRequest
        0    192   -> bdb_StartCommissioning
        0    192   -> bdb_ZedAttemptRecoverNwk
        0    192   -> osal_msg_deallocate
        0    192   -> osal_msg_receive
        0    196   -> osal_start_timerEx
        0    192   -> zclZEM_AF_RxProc
        0    192   -> zclZEM_ProcessIncomingMsg
        0    192   -> zclZEM_SendMACToCoordinator


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
       9  ?<Constant " Count: ">
      17  ?<Constant "Broadcast Data: ">
      30  ?<Constant "Broadcast message rec...">
      26  ?<Constant "Broadcast message sen...">
      10  ?<Constant "Broadcast">
      17  ?<Constant "Groupcast Data: ">
      10  ?<Constant "Groupcast">
      35  ?<Constant "MAC address sent to c...">
       6  ?<Constant "MAC: ">
      51  ?<Constant "Network steering fail...">
      37  ?<Constant "Network steering succ...">
      11  ?<Constant "P2P Data: ">
      24  ?<Constant "Received event type: 0x">
      39  ?<Constant "ZEM_P2P_EVT processed...">
      57  ?<Constant "ZEM_REJOIN_EVT proces...">
       7  ?<Initializer for ZEM_AppEp>
       4  ?<Initializer for reportableChange>
      18  ?<Initializer for zclZEM_CmdCallbacks>
       8  ??Subroutine17_0
       4  ??Subroutine18_0
      16  ??Subroutine19_0
       8  ?Subroutine0
       5  ?Subroutine1
       4  ?Subroutine10
      14  ?Subroutine11
      12  ?Subroutine12
      15  ?Subroutine13
      11  ?Subroutine14
      11  ?Subroutine15
      10  ?Subroutine16
       7  ?Subroutine2
       8  ?Subroutine3
       9  ?Subroutine4
      19  ?Subroutine5
      12  ?Subroutine6
       8  ?Subroutine7
      15  ?Subroutine8
      16  ?Subroutine9
       1  P1DIR
       1  P1SEL
       1  PERCFG
       7  ZEM_AppEp
       4  __Constant_2710
       4  __Constant_3e8
       4  __Constant_ea60
       1  bcCnt
       1  gcCnt
       1  p2pCnt
       4  reportableChange
       1  transferId
       1  transferId
       1  transferId
       3  zclSampleApp_BatteryWarningCB
       6  zclSampleApp_BatteryWarningCB::?relay
     499  zclZEM_AF_RxProc
       6  zclZEM_AF_RxProc::?relay
       9  zclZEM_BasicResetCB
       6  zclZEM_BasicResetCB::?relay
      18  zclZEM_CmdCallbacks
     286  zclZEM_Init
       6  zclZEM_Init::?relay
       1  zclZEM_NwkState
     297  zclZEM_ProcessCommissioningStatus
       6  zclZEM_ProcessCommissioningStatus::?relay
      37  zclZEM_ProcessInDiscCmdsRspCmd
       6  zclZEM_ProcessInDiscCmdsRspCmd::?relay
     139  zclZEM_ProcessIncomingMsg
       6  zclZEM_ProcessIncomingMsg::?relay
     241  zclZEM_ReadAndSendMAC
       6  zclZEM_ReadAndSendMAC::?relay
     190  zclZEM_SendMACToCoordinator
       6  zclZEM_SendMACToCoordinator::?relay
       1  zclZEM_TaskID
      64  zclZEM_UartBuf
      39  zclZEM_UartCB
       6  zclZEM_UartCB::?relay
     795  zclZEM_event_loop
       6  zclZEM_event_loop::?relay

 
 2 747 bytes in segment BANKED_CODE
    66 bytes in segment BANK_RELAYS
     3 bytes in segment SFR_AN
    29 bytes in segment XDATA_I
    29 bytes in segment XDATA_ID
   391 bytes in segment XDATA_ROM_C
    72 bytes in segment XDATA_Z
 
    95 bytes of CODE     memory
   379 bytes of CONST    memory (+ 12 bytes shared)
     0 bytes of DATA     memory (+  3 bytes shared)
 2 747 bytes of HUGECODE memory
   101 bytes of XDATA    memory

Errors: none
Warnings: 1

###############################################################################
#
# IAR C/C++ Compiler V10.10.1.4655 for 8051               06/Feb/2026  13:56:24
# Copyright 2004-2017 IAR Systems AB.
# Standalone license - IAR Embedded Workbench for 8051
#
#    Core               =  plain
#    Code model         =  banked
#    Data model         =  large
#    Calling convention =  xdata reentrant
#    Constant location  =  data_rom
#    Dptr setup         =  1,16
#                          
#    Source file        =  D:\project\Z-Stack 3.0.2\Components\stack\bdb\bdb.c
#    Command line       =  
#        -f C:\Users\KLF\AppData\Local\Temp\EWB076.tmp ("D:\project\Z-Stack
#        3.0.2\Components\stack\bdb\bdb.c" -D BDB_REPORTING -D xPOWER_SAVING -D
#        NWK_AUTO_POLL -D xZTOOL_P1 -D xMT_TASK -D xMT_APP_FUNC -D xMT_SYS_FUNC
#        -D xMT_ZDO_FUNC -D xMT_APP_CNF_FUNC -D LCD_SUPPORTED=DEBUG -D
#        MULTICAST_ENABLED=FALSE -D ZCL_READ -D ZCL_DISCOVER -D ZCL_WRITE -D
#        ZCL_BASIC -D ZCL_IDENTIFY -D ZCL_TEMPERATURE_MEASUREMENT -D ZCL_GROUPS
#        -D HAL_UART=TRUE -D INT_HEAP_LEN=2048 -lC "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\EndDeviceEB\List"
#        -lA "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\EndDeviceEB\List"
#        --diag_suppress Pe001,Pa010 -o "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\EndDeviceEB\Obj" -e
#        --debug --core=plain --dptr=16,1 --data_model=large
#        --code_model=banked --calling_convention=xdata_reentrant
#        --place_constants=data_rom --nr_virtual_regs 16 -f "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\Tools\CC2530DB\f8wEndev.cfg"
#        (-DCPU32MHZ -DROOT=__near_func -DMAC_CFG_TX_DATA_MAX=3
#        -DMAC_CFG_TX_MAX=6 -DMAC_CFG_RX_MAX=3) -f "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\Tools\CC2530DB\f8wConfig.cfg"
#        (-DZIGBEEPRO -DSECURE=1 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR
#        -DDEFAULT_CHANLIST=0x00100000 -DZDAPP_CONFIG_PAN_ID=0x1234
#        -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MASK=0x007F
#        -DBEACON_REQUEST_DELAY=100 -DBEACON_REQ_DELAY_MASK=0x00FF
#        -DLINK_STATUS_JITTER_MASK=0x007F -DROUTE_EXPIRY_TIME=30
#        -DAPSC_ACK_WAIT_DURATION_POLLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7
#        -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3
#        -DNWK_MAX_DATA_RETRIES=2 -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9
#        -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40 -DNWK_MAX_BINDING_ENTRIES=4
#        -DMAX_BINDING_CLUSTER_IDS=4 -DDEFAULT_KEY={0} -DMAC_MAX_FRAME_SIZE=116
#        -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const __code"
#        -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000
#        -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100 -DREJOIN_POLL_RATE=440
#        -DREJOIN_BACKOFF=900000 -DREJOIN_SCAN=900000 -DENABLE_LED4_DISABLE_S1)
#        -f "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\Tools\CC2530DB\f8wZCL.cfg"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\" -I
#        "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\Source\" -I
#        "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\Source\" -I
#        "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\ZMain\TI2530DB\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\hal\include\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\hal\target\CC2530EB\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\mac\include\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\mac\high_level\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\mac\low_level\srf04\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\mac\low_level\srf04\single_chip\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\mt\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\osal\include\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\services\saddr\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\services\sdata\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\af\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\bdb\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\gp\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\nwk\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\sapi\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\sec\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\sys\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\zcl\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\stack\zdo\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\zmac\"
#        -I "D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\..\..\..\..\..\Components\zmac\f8w\"
#        -Ohz --require_prototypes)
#    Locale             =  Chinese (Simplified)_China.936
#    List file          =  
#        D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\EndDeviceEB\List\bdb.lst
#    Object file        =  
#        D:\project\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\ZEM\CC2530DB\EndDeviceEB\Obj\bdb.r51
#
###############################################################################

D:\project\Z-Stack 3.0.2\Components\stack\bdb\bdb.c
      1          /**************************************************************************************************
      2            Filename:       bdb.c
      3            Revised:        $Date: 2016-02-25 11:51:49 -0700 (Thu, 25 Feb 2016) $
      4            Revision:       $Revision: - $
      5          
      6            Description:    This file contains the Base Device Behavior functions and attributes.
      7          
      8          
      9            Copyright 2006-2015 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /*********************************************************************
     41           * INCLUDES
     42           */
     43          
     44          #include "bdb.h"
     45          #include "ZDApp.h"
     46          #include "OSAL.h"
     47          #include "ZDConfig.h"
     48          #include "hal_led.h"
     49          #include "ZDObject.h"
     50          #include "OSAL_Nv.h"
     51          #include "AddrMgr.h"
     52          #include "ZDSecMgr.h"
     53          #include "nwk.h"
     54          #include "nwk_util.h"
     55          #include "ssp_hash.h"
     56          #ifdef BDB_REPORTING
     57          #include "bdb_Reporting.h"
     58          #endif 
     59          
     60          #if !defined (DISABLE_GREENPOWER_BASIC_PROXY) && (ZG_BUILD_RTR_TYPE)
     61          #include "gp_interface.h"
     62          #include "gp_common.h"
     63          #include "dgp_stub.h"
     64          #endif
     65          
     66          #include "bdb_interface.h"
     67          
     68          #if defined ( INTER_PAN ) 
     69          #if defined ( BDB_TL_INITIATOR )  
     70          #include "bdb_touchlink_initiator.h"
     71          #endif
     72          #if defined ( BDB_TL_TARGET )  
     73          #include "bdb_touchlink_target.h"
     74          #endif
     75          #endif
     76             
     77          #if defined ( INTER_PAN ) && ( defined ( BDB_TL_INITIATOR ) || defined ( BDB_TL_TARGET ) )
     78            #include "bdb_touchlink.h"
     79          #endif
     80           
     81          #ifdef MT_APP_CNF_FUNC
     82          #include "MT_APP_CONFIG.h"
     83          #endif
     84             
     85           /*********************************************************************
     86           * MACROS
     87           */
     88          //This is actually the channels used
     89          #define vScanChannels  zgDefaultChannelList
     90             
     91           /*********************************************************************
     92           * CONSTANTS
     93           */
     94          
     95          #define NUMBER_OF_CHANNELS     16
     96          
     97          #define CHANNEL_11_MASK_POS    11
     98          #define CHANNEL_26_MASK_POS    26
     99             

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    100          uint8 bdb_FB_InitiatorCurrentCyclesNumber = 0; //last cycle is #1 (i.e. cycles-left = (bdb_FB_InitiatorCurrentCyclesNumber - 1))
   \                     bdb_FB_InitiatorCurrentCyclesNumber:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    101          
    102          /*********************************************************************
    103           * TYPEDEFS
    104           */
    105           
    106           
    107           /*********************************************************************
    108           * GLOBAL VARIABLES
    109           */
    110          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    111          byte bdb_TaskID;
   \                     bdb_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_I, align 1, keep-with-next
    112          bdbAttributes_t bdbAttributes = BDB_ATTRIBUTES_DEFAULT_CONFIG;
   \                     bdbAttributes:
   \   000000                DS 19
   \   000013                REQUIRE `?<Initializer for bdbAttributes>`
   \   000013                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    113          epList_t *bdb_HeadEpDescriptorList = NULL;
   \                     bdb_HeadEpDescriptorList:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    114          epList_t *bdb_CurrEpDescriptorList = NULL;
   \                     bdb_CurrEpDescriptorList:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    115          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    116          bdbFindingBindingRespondent_t *pRespondentHead = NULL;
   \                     pRespondentHead:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    117          bdbFindingBindingRespondent_t *pRespondentCurr = NULL;
   \                     pRespondentCurr:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    118          bdbFindingBindingRespondent_t *pRespondentNext = NULL;
   \                     pRespondentNext:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    119          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    120          bdbCommissioningProcedureState_t bdbCommissioningProcedureState; 
   \                     bdbCommissioningProcedureState:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    121          bool bdb_initialization = FALSE;  //Variable to tell if the initialization process has been started
   \                     bdb_initialization:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    122          
    123          //Nwk formation and nwk steering for nodes not in nwk

   \                                 In  segment XDATA_I, align 1, keep-with-next
    124          bool vDoPrimaryScan = TRUE;
   \                     vDoPrimaryScan:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for vDoPrimaryScan>`
   \   000001                REQUIRE __INIT_XDATA_I
    125          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    126          uint8 zgBdbInstallCodeCRC[INSTALL_CODE_LEN + INSTALL_CODE_CRC_LEN] = {0x83,0xFE,0xD3,0x40,0x7A,0x93,0x97,0x23,0xA5,0xC6,0x39,0xB2,0x69,0x16,0xD5,0x05,0xC3,0xB5};
   \                     zgBdbInstallCodeCRC:
   \   000000                DS 18
   \   000012                REQUIRE `?<Initializer for zgBdbInstallCodeCRC>`
   \   000012                REQUIRE __INIT_XDATA_I
    127          
    128          //Pointer of the nwk being tried in association process
    129          #if (ZG_BUILD_JOINING_TYPE)

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    130          static networkDesc_t *pBDBListNwk = NULL;
   \                     pBDBListNwk:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    131          #endif
    132          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    133          uint8 bdb_ZclTransactionSequenceNumber=0x00;
   \                     bdb_ZclTransactionSequenceNumber:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    134          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    135          bool touchLinkTargetEnabled = FALSE;
   \                     touchLinkTargetEnabled:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    136          
    137           /*********************************************************************
    138           * EXTERNAL VARIABLES
    139           */
    140          
    141          extern devStartModes_t devStartMode;
    142          extern bool  requestNewTrustCenterLinkKey;
    143          extern uint32 requestLinkKeyTimeout;
    144          extern uint32 ZDApp_SavedPollRate;
    145          
    146          #if (BDB_FINDING_BINDING_CAPABILITY_ENABLED==1)
    147          extern bdbGCB_IdentifyTimeChange_t pfnIdentifyTimeChangeCB;
    148          extern uint8 bdbIndentifyActiveEndpoint;
    149          #endif
    150          
    151          extern bdbFindingBindingRespondent_t *pRespondentNext;
    152          
    153          #ifndef DISABLE_GREENPOWER_BASIC_PROXY
    154          extern ZDO_DeviceAnnce_t aliasConflictAnnce;
    155          #endif
    156          
    157          /*********************************************************************
    158           * EXTERNAL FUNCTIONS
    159           */
    160          
    161          extern void ZDApp_ResetTimerStart( uint16 delay );
    162          extern void ZDApp_NodeProfileSync( uint8 stackProfile );
    163          extern uint8 ZDApp_RestoreNwkKey( uint8 incrFrmCnt );
    164          extern uint8 ZDApp_ReadNetworkRestoreState( void );
    165          
    166          extern bdbFindingBindingRespondent_t* bdb_getRespondentRetry(bdbFindingBindingRespondent_t* pRespondentHead);
    167          extern void bdb_ProcessSimpleDesc( zdoIncomingMsg_t *msgPtr );
    168          extern void bdb_ProcessIEEEAddrRsp(zdoIncomingMsg_t *pMsg);
    169          
    170          /*********************************************************************
    171           * LOCAL VARIABLES
    172           */
    173          #if (ZG_BUILD_JOINING_TYPE)

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    174            static uint8 bdb_nwkAssocRetriesCount = 0;
   \                     bdb_nwkAssocRetriesCount:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    175          #endif
    176          #if (ZG_BUILD_COORDINATOR_TYPE)
    177            static bdb_joiningDeviceList_t *bdb_joiningDeviceList = NULL;
    178          #endif
    179            
    180          #if (BDB_FINDING_BINDING_CAPABILITY_ENABLED==1) 
    181          //Latch to save the status success of any attempt in the periodic F&B process  

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    182          static uint8 bdb_FBStateSuccessLatch = FALSE;
   \                     bdb_FBStateSuccessLatch:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    183          #endif
    184           /*********************************************************************
    185           * LOCAL FUNCTIONS
    186           */
    187          static void bdb_ProcessOSALMsg(bdbInMsg_t *msgPtr);
    188          void bdb_NotifyCommissioningModeStart(uint8 commissioningMode);
    189          static void bdb_processZDOMgs(zdoIncomingMsg_t *pMsg);
    190          
    191          #if (ZG_BUILD_JOINING_TYPE)
    192          static void bdb_requestTCStackVersion(void);
    193          static void bdb_requestTCLinkKey(void);
    194          static void bdb_requestVerifyTCLinkKey(void);
    195          static void bdb_tryNwkAssoc(void);
    196          #endif
    197          
    198          
    199          static void bdb_processTimeout(void);
    200          static void bdb_startResumeCommissioningProcess(void);
    201          static void bdb_nwkSteeringDeviceOnNwk(void);
    202          static void bdb_nwkJoiningFormation(bool isJoining);
    203          
    204          #if !defined (DISABLE_GREENPOWER_BASIC_PROXY) && (ZG_BUILD_RTR_TYPE)
    205          static uint8 gp_ChangeChannelReq(void);
    206          static void gp_CBInit(void);
    207          #endif
    208          
    209          
    210          #if (ZG_BUILD_COORDINATOR_TYPE)
    211          static void bdb_TCProcessJoiningList(void);
    212          static ZStatus_t bdb_TCJoiningDeviceFree(bdb_joiningDeviceList_t* JoiningDeviceToRemove);
    213          #endif
    214          #if (ZG_BUILD_COORDINATOR_TYPE)
    215          static bdbGCB_TCLinkKeyExchangeProcess_t  pfnTCLinkKeyExchangeProcessCB = NULL;
    216          #endif

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    217          static bdbGCB_CommissioningStatus_t       pfnCommissioningStatusCB = NULL; 
   \                     pfnCommissioningStatusCB:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    218          #if (ZG_BUILD_JOINING_TYPE)

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    219          static bdbGCB_CBKETCLinkKeyExchange_t     pfnCBKETCLinkKeyExchange = NULL;
   \                     pfnCBKETCLinkKeyExchange:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    220          static bdbGCB_FilterNwkDesc_t             pfnFilterNwkDesc = NULL;   
   \                     pfnFilterNwkDesc:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    221          #endif
    222          
    223          
    224          
    225          void bdb_calculateCCITT_CRC (uint8 *Mb, uint32 msglen, uint16 *crc);
    226          void bdb_crcInit(uint16 *crc, uint16 *crcinit_direct, uint16 *crcinit_nondirect);
    227          uint16 bdb_crcReflect (uint16 crc, uint16 bitnum);
    228          uint16 bdb_crcBitByBitFast(uint8 * p, uint32 len, uint16 crcinit_direct, uint16 crcinit_nondirect);
    229          void bdb_ProcessNodeDescRsp(zdoIncomingMsg_t *pMsg);
    230          
    231          /*********************************************************************
    232           * PUBLIC FUNCTIONS
    233           *********************************************************************/
    234          void bdb_filterNwkDisc(void);
    235          ZStatus_t bdb_joinProcess(networkDesc_t *pChosenNwk);
    236          
    237          ZStatus_t bdb_TCAddJoiningDevice(uint16 parentAddr, uint8* JoiningExtAddr);
    238          void bdb_TCjoiningDeviceComplete(uint8* JoiningExtAddr);
    239          
    240           /*********************************************************************
    241           * @fn          bdb_Init
    242           *
    243           * @brief       Initialization function for the Base Device Behavior.
    244           *
    245           * @param       task_id - bdb_TaskID Task ID
    246           *
    247           * @return      none
    248           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    249          void bdb_Init( byte task_id )
   \                     bdb_Init:
    250          {
   \   000000   74F7         MOV       A,#-0x9
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV       A,R1
   \   000006   FE           MOV       R6,A
    251            bdb_TaskID = task_id;
   \   000007   90....       MOV       DPTR,#bdb_TaskID
   \   00000A   F0           MOVX      @DPTR,A
    252              
    253          #if (ZG_BUILD_COORDINATOR_TYPE)
    254            if(ZG_DEVICE_COORDINATOR_TYPE)
    255            {
    256              if(bdbAttributes.bdbJoinUsesInstallCodeKey)
    257              {
    258                zgAllowInstallCodes = ZG_IC_MUST_USED;
    259              }
    260            }
    261          #endif
    262            
    263          #if defined ( INTER_PAN ) && defined ( BDB_TL_INITIATOR )  
    264            touchLinkInitiator_InitDevice( );
    265          #endif
    266          
    267          #if (BDB_REPORTING)
    268            bdb_RepInit();
   \   00000B                ; Setup parameters for call to function bdb_RepInit
   \   00000B   12....       LCALL     `??bdb_RepInit::?relay`; Banked call to: bdb_RepInit
    269          #endif  
    270            
    271            //Register ZDO callbacks
    272            ZDO_RegisterForZDOMsg ( task_id, Node_Desc_rsp );
   \   00000E                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00000E   7A02         MOV       R2,#0x2
   \   000010   7B80         MOV       R3,#-0x80
   \   000012   EE           MOV       A,R6
   \   000013   F9           MOV       R1,A
   \   000014   12....       LCALL     `??ZDO_RegisterForZDOMsg::?relay`; Banked call to: ZDO_RegisterForZDOMsg
    273          #if (BDB_FINDING_BINDING_CAPABILITY_ENABLED==1)  
    274            ZDO_RegisterForZDOMsg ( task_id, IEEE_addr_rsp );
   \   000017                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000017   7A01         MOV       R2,#0x1
   \   000019   7B80         MOV       R3,#-0x80
   \   00001B   EE           MOV       A,R6
   \   00001C   F9           MOV       R1,A
   \   00001D   12....       LCALL     `??ZDO_RegisterForZDOMsg::?relay`; Banked call to: ZDO_RegisterForZDOMsg
    275            ZDO_RegisterForZDOMsg ( task_id, Simple_Desc_rsp );
   \   000020                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000020   7A04         MOV       R2,#0x4
   \   000022   7B80         MOV       R3,#-0x80
   \   000024   EE           MOV       A,R6
   \   000025   F9           MOV       R1,A
   \   000026   12....       LCALL     `??ZDO_RegisterForZDOMsg::?relay`; Banked call to: ZDO_RegisterForZDOMsg
    276          #endif
    277            
    278          #if !defined (DISABLE_GREENPOWER_BASIC_PROXY) && (ZG_BUILD_RTR_TYPE)
    279            gp_RegisterGPChangeChannelReqForBDBCB(gp_ChangeChannelReq);
    280            gp_CBInit();
    281          #endif
    282          }
   \   000029   02....       LJMP      ?Subroutine0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7F01         MOV       R7,#0x1
   \   000002   02....       LJMP      ?BANKED_LEAVE_XDATA
    283          
    284          /*********************************************************************
    285           * @fn      bdb_RegisterSimpleDescriptor
    286           *
    287           * @brief   Register the Simple descriptor. This function also registers 
    288           *          the profile's cluster conversion table.
    289           *
    290           * @param   simpleDesc - a pointer to a valid SimpleDescriptionFormat_t, must not be NULL.
    291           *
    292           * @return  none
    293           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    294          void bdb_RegisterSimpleDescriptor( SimpleDescriptionFormat_t *simpleDesc )
   \                     bdb_RegisterSimpleDescriptor:
    295          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV       A,#-0xa
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV       A,R2
   \   000006   FE           MOV       R6,A
   \   000007   EB           MOV       A,R3
   \   000008   FF           MOV       R7,A
    296            endPointDesc_t *epDesc;
    297          
    298            // Register the application's endpoint descriptor
    299            //  - This memory is allocated and never freed.
    300            epDesc = osal_mem_alloc( sizeof ( endPointDesc_t ) );
   \   000009                ; Setup parameters for call to function osal_mem_alloc
   \   000009   7A07         MOV       R2,#0x7
   \   00000B   7B00         MOV       R3,#0x0
   \   00000D   12....       LCALL     `??osal_mem_alloc::?relay`; Banked call to: osal_mem_alloc
    301            if ( epDesc )
   \   000010   EA           MOV       A,R2
   \   000011   4B           ORL       A,R3
   \   000012   6023         JZ        ??bdb_RegisterSimpleDescriptor_0
    302            {
    303              // Fill out the endpoint description.
    304              epDesc->endPoint = simpleDesc->EndPoint;
   \   000014   8E82         MOV       DPL,R6
   \   000016   8F83         MOV       DPH,R7
   \   000018   E0           MOVX      A,@DPTR
   \   000019   8A82         MOV       DPL,R2
   \   00001B   8B83         MOV       DPH,R3
   \   00001D   F0           MOVX      @DPTR,A
    305              epDesc->task_id = &zcl_TaskID;   // all messages get sent to ZCL first
   \   00001E   A3           INC       DPTR
   \   00001F   A3           INC       DPTR
   \   000020   74..         MOV       A,#zcl_TaskID & 0xff
   \   000022   F0           MOVX      @DPTR,A
   \   000023   A3           INC       DPTR
   \   000024   74..         MOV       A,#(zcl_TaskID >> 8) & 0xff
   \   000026   12....       LCALL     ?Subroutine6 & 0xFFFF
    306              epDesc->simpleDesc = simpleDesc;
   \                     ??CrossCallReturnLabel_4:
   \   000029   EE           MOV       A,R6
   \   00002A   F0           MOVX      @DPTR,A
   \   00002B   A3           INC       DPTR
   \   00002C   EF           MOV       A,R7
   \   00002D   12....       LCALL     ?Subroutine6 & 0xFFFF
    307              epDesc->latencyReq = noLatencyReqs;
   \                     ??CrossCallReturnLabel_5:
   \   000030   A3           INC       DPTR
   \   000031   A3           INC       DPTR
   \   000032   E4           CLR       A
   \   000033   F0           MOVX      @DPTR,A
    308          
    309              // Register the endpoint description with the AF
    310              afRegister( epDesc );
   \   000034                ; Setup parameters for call to function afRegister
   \   000034   12....       LCALL     `??afRegister::?relay`; Banked call to: afRegister
    311            }
    312          }
   \                     ??bdb_RegisterSimpleDescriptor_0:
   \   000037   02....       LJMP      ??Subroutine41_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   F0           MOVX      @DPTR,A
   \   000001   8A82         MOV       DPL,R2
   \   000003   8B83         MOV       DPH,R3
   \   000005   A3           INC       DPTR
   \   000006   A3           INC       DPTR
   \   000007   A3           INC       DPTR
   \   000008   A3           INC       DPTR
   \   000009   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine41_0:
   \   000000   7F02         MOV       R7,#0x2
   \   000002   02....       LJMP      ?BANKED_LEAVE_XDATA
    313          
    314          #if (BDB_FINDING_BINDING_CAPABILITY_ENABLED==1)  
    315          /*********************************************************************
    316           * @fn      bdb_ZclIdentifyCmdInd
    317           *
    318           * @brief   Callback from the ZCL General Cluster Library when
    319           *          it received an Identity Command for this application.
    320           *
    321           * @param   identifyTime - the number of seconds to identify yourself
    322           * @param   endpoint - destination endpoint
    323           *
    324           * @return  none
    325           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    326          void bdb_ZclIdentifyCmdInd( uint16 identifyTime, uint8 endpoint )
   \                     bdb_ZclIdentifyCmdInd:
    327          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000   74F4         MOV       A,#-0xc
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 8
   \   000005   74F8         MOV       A,#-0x8
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   \   00000A   EA           MOV       A,R2
   \   00000B   FE           MOV       R6,A
   \   00000C   EB           MOV       A,R3
   \   00000D   FF           MOV       R7,A
   \   00000E   89..         MOV       ?V0,R1
    328            zclAttrRec_t identifyAttrRec;
    329            
    330            if ( zclFindAttrRec( endpoint, ZCL_CLUSTER_ID_GEN_IDENTIFY,
    331                                ATTRID_IDENTIFY_TIME, &identifyAttrRec ) )
   \   000010                ; Setup parameters for call to function zclFindAttrRec
   \   000010   A8..         MOV       R0,?XSP + 0
   \   000012   A9..         MOV       R1,?XSP + 1
   \   000014   88..         MOV       ?V2,R0
   \   000016   89..         MOV       ?V3,R1
   \   000018   78..         MOV       R0,#?V2
   \   00001A   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00001D   7C00         MOV       R4,#0x0
   \   00001F   7D00         MOV       R5,#0x0
   \   000021   7A03         MOV       R2,#0x3
   \   000023   7B00         MOV       R3,#0x0
   \   000025   A9..         MOV       R1,?V0
   \   000027   12....       LCALL     `??zclFindAttrRec::?relay`; Banked call to: zclFindAttrRec
   \   00002A   7402         MOV       A,#0x2
   \   00002C   12....       LCALL     ?DEALLOC_XSTACK8
   \   00002F   E9           MOV       A,R1
   \   000030   6056         JZ        ??bdb_ZclIdentifyCmdInd_0
    332            {
    333              //If we are processing an actual change
    334              if(*(uint16*)identifyAttrRec.attr.dataPtr != identifyTime)
   \   000032   7406         MOV       A,#0x6
   \   000034   12....       LCALL     ?XSTACK_DISP0_8
   \   000037   12....       LCALL     ?Subroutine16 & 0xFFFF
   \                     ??CrossCallReturnLabel_22:
   \   00003A   E0           MOVX      A,@DPTR
   \   00003B   6E           XRL       A,R6
   \   00003C   7003         JNZ       ??bdb_ZclIdentifyCmdInd_1
   \   00003E   A3           INC       DPTR
   \   00003F   E0           MOVX      A,@DPTR
   \   000040   6F           XRL       A,R7
   \                     ??bdb_ZclIdentifyCmdInd_1:
   \   000041   6045         JZ        ??bdb_ZclIdentifyCmdInd_0
    335              {
    336                if ( identifyTime > 0 )
   \   000043   EE           MOV       A,R6
   \   000044   4F           ORL       A,R7
   \   000045   8882         MOV       DPL,R0
   \   000047   8983         MOV       DPH,R1
   \   000049   601E         JZ        ??bdb_ZclIdentifyCmdInd_2
    337                {
    338                  *((uint16*)identifyAttrRec.attr.dataPtr) = identifyTime;
   \   00004B   EE           MOV       A,R6
   \   00004C   F0           MOVX      @DPTR,A
   \   00004D   A3           INC       DPTR
   \   00004E   EF           MOV       A,R7
   \   00004F   F0           MOVX      @DPTR,A
    339                  osal_start_timerEx( bdb_TaskID, BDB_IDENTIFY_TIMEOUT, 1000 );
   \   000050                ; Setup parameters for call to function osal_start_timerEx
   \   000050   90....       MOV       DPTR,#__Constant_3e8
   \   000053   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   000056   7A00         MOV       R2,#0x0
   \   000058   7B20         MOV       R3,#0x20
   \   00005A   90....       MOV       DPTR,#bdb_TaskID
   \   00005D   E0           MOVX      A,@DPTR
   \   00005E   F9           MOV       R1,A
   \   00005F   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   000062   7404         MOV       A,#0x4
   \   000064   12....       LCALL     ?DEALLOC_XSTACK8
   \   000067   800F         SJMP      ??bdb_ZclIdentifyCmdInd_3
    340                }
    341                else if ( identifyTime <= 0 )
    342                {
    343                  *((uint16*)identifyAttrRec.attr.dataPtr) = 0;
   \                     ??bdb_ZclIdentifyCmdInd_2:
   \   000069   E4           CLR       A
   \   00006A   F0           MOVX      @DPTR,A
   \   00006B   A3           INC       DPTR
   \   00006C   F0           MOVX      @DPTR,A
    344                  osal_stop_timerEx( bdb_TaskID, BDB_IDENTIFY_TIMEOUT );
   \   00006D                ; Setup parameters for call to function osal_stop_timerEx
   \   00006D   FA           MOV       R2,A
   \   00006E   7B20         MOV       R3,#0x20
   \   000070   90....       MOV       DPTR,#bdb_TaskID
   \   000073   E0           MOVX      A,@DPTR
   \   000074   F9           MOV       R1,A
   \   000075   12....       LCALL     `??osal_stop_timerEx::?relay`; Banked call to: osal_stop_timerEx
    345                }
    346                
    347                if(pfnIdentifyTimeChangeCB != NULL)
   \                     ??bdb_ZclIdentifyCmdInd_3:
   \   000078   90....       MOV       DPTR,#pfnIdentifyTimeChangeCB
   \   00007B   12....       LCALL     ??Subroutine36_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_71:
   \   00007E   6008         JZ        ??bdb_ZclIdentifyCmdInd_0
    348                {
    349                  pfnIdentifyTimeChangeCB(endpoint);
   \   000080                ; Setup parameters for indirect call
   \   000080   A9..         MOV       R1,?V0
   \   000082   12....       LCALL     ??Subroutine34_0 & 0xFFFF
    350                }
    351              }
    352            }
   \                     ??CrossCallReturnLabel_59:
   \   000085   12....       LCALL     ?CALL_IND
    353          }
   \                     ??bdb_ZclIdentifyCmdInd_0:
   \   000088   7408         MOV       A,#0x8
   \   00008A   02....       LJMP      ??Subroutine32_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine32_0:
   \   000000   12....       LCALL     ?DEALLOC_XSTACK8
   \   000003                REQUIRE ??Subroutine33_0
   \   000003                ; // Fall through to label ??Subroutine33_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine33_0:
   \   000000   7F04         MOV       R7,#0x4
   \   000002   02....       LJMP      ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine34_0:
   \   000000   E0           MOVX      A,@DPTR
   \   000001   F583         MOV       DPH,A
   \   000003   8882         MOV       DPL,R0
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine16:
   \   000000   E0           MOVX      A,@DPTR
   \   000001   F8           MOV       R0,A
   \   000002   A3           INC       DPTR
   \   000003   E0           MOVX      A,@DPTR
   \   000004   F9           MOV       R1,A
   \   000005   8882         MOV       DPL,R0
   \   000007   8983         MOV       DPH,R1
   \   000009   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine36_0:
   \   000000   E0           MOVX      A,@DPTR
   \   000001   F8           MOV       R0,A
   \   000002   A3           INC       DPTR
   \   000003   E0           MOVX      A,@DPTR
   \   000004   F9           MOV       R1,A
   \   000005   E8           MOV       A,R0
   \   000006   49           ORL       A,R1
   \   000007   22           RET
    354          #endif
    355          
    356          
    357          #if (ZG_BUILD_JOINING_TYPE) 
    358           /*********************************************************************
    359           * @fn          bdb_setActiveCentralizedLinkKey
    360           *
    361           * @brief       Set the active centralized key to be used, Global or IC derived. See zstack_CentralizedLinkKeyModes_t
    362           *
    363           * @param       zstack_CentralizedLinkKeyModes - Key to be used for joining centralized network
    364           * @param       pKey - Key to be used (if any)
    365           *
    366           * @return      ZStatus_t - ZFailure when no valid BDB_INSTALL_CODE_USE is used
    367           *                          ZInvalidParameter when IC buffer is null
    368           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    369          ZStatus_t bdb_setActiveCentralizedLinkKey(uint8 zstack_CentralizedLinkKeyModes, uint8* pKey)
   \                     bdb_setActiveCentralizedLinkKey:
    370          {
   \   000000                REQUIRE ?V0
   \   000000   74F7         MOV       A,#-0x9
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 8
   \   000005   74F8         MOV       A,#-0x8
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   \   00000A   89..         MOV       ?V0,R1
   \   00000C   EA           MOV       A,R2
   \   00000D   FE           MOV       R6,A
   \   00000E   EB           MOV       A,R3
   \   00000F   FF           MOV       R7,A
    371            ZStatus_t Status;
    372          
    373            uint8 extAddr[Z_EXTADDR_LEN];
    374          
    375            osal_memset(extAddr,0x00,Z_EXTADDR_LEN);
   \   000010                ; Setup parameters for call to function osal_memset
   \   000010   7C08         MOV       R4,#0x8
   \   000012   7D00         MOV       R5,#0x0
   \   000014   7900         MOV       R1,#0x0
   \   000016   AA..         MOV       R2,?XSP + 0
   \   000018   AB..         MOV       R3,?XSP + 1
   \   00001A   12....       LCALL     `??osal_memset::?relay`; Banked call to: osal_memset
    376          
    377            if(pKey == NULL)
   \   00001D   EE           MOV       A,R6
   \   00001E   4F           ORL       A,R7
   \   00001F   603E         JZ        ??bdb_setActiveCentralizedLinkKey_0
    378            {
    379              return ZInvalidParameter;
    380            }
    381          
    382            //Clear it, if the request requires it, it will be set
    383            gZDSECMGR_TC_ATTEMPT_DEFAULT_KEY = FALSE;
   \   000021   90....       MOV       DPTR,#gZDSECMGR_TC_ATTEMPT_DEFAULT_KEY
   \   000024   E4           CLR       A
   \   000025   F0           MOVX      @DPTR,A
    384          
    385            switch(zstack_CentralizedLinkKeyModes)
   \   000026   E5..         MOV       A,?V0
   \   000028   600E         JZ        ??bdb_setActiveCentralizedLinkKey_1
   \   00002A   14           DEC       A
   \   00002B   6013         JZ        ??bdb_setActiveCentralizedLinkKey_2
   \   00002D   14           DEC       A
   \   00002E   600D         JZ        ??bdb_setActiveCentralizedLinkKey_3
   \   000030   14           DEC       A
   \   000031   601D         JZ        ??bdb_setActiveCentralizedLinkKey_4
   \   000033   14           DEC       A
   \   000034   6017         JZ        ??bdb_setActiveCentralizedLinkKey_5
   \   000036   8027         SJMP      ??bdb_setActiveCentralizedLinkKey_0
    386            {
    387              case zstack_UseDefaultGlobalTrustCenterLinkKey:
    388                //Set the default key to be used in centralized networks as defaultTCLinkKey
    389                Status = APSME_SetDefaultKey();
   \                     ??bdb_setActiveCentralizedLinkKey_1:
   \   000038                ; Setup parameters for call to function APSME_SetDefaultKey
   \   000038   12....       LCALL     `??APSME_SetDefaultKey::?relay`; Banked call to: APSME_SetDefaultKey
   \   00003B   801E         SJMP      ??bdb_setActiveCentralizedLinkKey_6
    390              break;
    391          
    392              case zstack_UseInstallCodeWithFallback:
    393                //same as zstack_UseInstallCode but attempt default TRUE
    394                gZDSECMGR_TC_ATTEMPT_DEFAULT_KEY = TRUE;
   \                     ??bdb_setActiveCentralizedLinkKey_3:
   \   00003D   7401         MOV       A,#0x1
   \   00003F   F0           MOVX      @DPTR,A
    395              case zstack_UseInstallCode:
    396                 //Set the install code as default key
    397                Status = bdb_addInstallCode(pKey,extAddr);
   \                     ??bdb_setActiveCentralizedLinkKey_2:
   \   000040                ; Setup parameters for call to function bdb_addInstallCode
   \   000040   AC..         MOV       R4,?XSP + 0
   \   000042   AD..         MOV       R5,?XSP + 1
   \   000044   EE           MOV       A,R6
   \   000045   FA           MOV       R2,A
   \   000046   EF           MOV       A,R7
   \   000047   FB           MOV       R3,A
   \   000048   12....       LCALL     `??bdb_addInstallCode::?relay`; Banked call to: bdb_addInstallCode
   \   00004B   800E         SJMP      ??bdb_setActiveCentralizedLinkKey_6
    398              break;
    399          
    400              case zstack_UseAPSKeyWithFallback:
    401                //same as zstack_UseAPSKey but attempt default TRUE
    402                gZDSECMGR_TC_ATTEMPT_DEFAULT_KEY = TRUE;
   \                     ??bdb_setActiveCentralizedLinkKey_5:
   \   00004D   7401         MOV       A,#0x1
   \   00004F   F0           MOVX      @DPTR,A
    403              case zstack_UseAPSKey:
    404                //Set the key as global default
    405                Status = APSME_AddTCLinkKey(pKey,extAddr);
   \                     ??bdb_setActiveCentralizedLinkKey_4:
   \   000050                ; Setup parameters for call to function APSME_AddTCLinkKey
   \   000050   AC..         MOV       R4,?XSP + 0
   \   000052   AD..         MOV       R5,?XSP + 1
   \   000054   EE           MOV       A,R6
   \   000055   FA           MOV       R2,A
   \   000056   EF           MOV       A,R7
   \   000057   FB           MOV       R3,A
   \   000058   12....       LCALL     `??APSME_AddTCLinkKey::?relay`; Banked call to: APSME_AddTCLinkKey
   \                     ??bdb_setActiveCentralizedLinkKey_6:
   \   00005B   E9           MOV       A,R1
   \   00005C   F9           MOV       R1,A
    406              break;
   \   00005D   8002         SJMP      ??bdb_setActiveCentralizedLinkKey_7
    407              
    408              default:
    409                Status = ZInvalidParameter;
   \                     ??bdb_setActiveCentralizedLinkKey_0:
   \   00005F   7902         MOV       R1,#0x2
    410              break;
    411            }
    412          
    413            return Status;
   \                     ??bdb_setActiveCentralizedLinkKey_7:
   \   000061   7408         MOV       A,#0x8
   \   000063   12....       LCALL     ?DEALLOC_XSTACK8
   \   000066   02....       LJMP      ?Subroutine0 & 0xFFFF
    414          }
    415          #endif
    416          
    417          
    418              
    419            
    420          /******************************************************************************
    421           * @fn          bdb_addInstallCode
    422           *
    423           * @brief       Interface to add an install codes and adds a APS TC Link key.
    424           *
    425           * @param       pInstallCode - [in] Install Code with CRC (buffer size of 18 bytes).
    426           *              pExt - [in] Extended address of the node.
    427           *
    428           * @return      ZStatus_t
    429           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    430          ZStatus_t bdb_addInstallCode(uint8* pInstallCode, uint8* pExt)
   \                     bdb_addInstallCode:
    431          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000                REQUIRE ?V4
   \   000000                REQUIRE ?V5
   \   000000   74F2         MOV       A,#-0xe
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 16
   \   000005   74F0         MOV       A,#-0x10
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   \   00000A   EA           MOV       A,R2
   \   00000B   FE           MOV       R6,A
   \   00000C   EB           MOV       A,R3
   \   00000D   FF           MOV       R7,A
   \   00000E   8C..         MOV       ?V0,R4
   \   000010   8D..         MOV       ?V1,R5
    432            uint8  hashOutput[16];
    433            uint16 CRC;
    434            
    435          #if (ZG_BUILD_COORDINATOR_TYPE)
    436            if(ZG_DEVICE_COORDINATOR_TYPE)
    437            {
    438              if(zgAllowInstallCodes == ZG_IC_NOT_SUPPORTED)
    439              {
    440                return ZFailure;
    441              }
    442            }
    443          #endif
    444                 
    445            if((pInstallCode == NULL) || (pExt == NULL))
   \   000012   EE           MOV       A,R6
   \   000013   4F           ORL       A,R7
   \   000014   6020         JZ        ??bdb_addInstallCode_0
   \   000016   EC           MOV       A,R4
   \   000017   45..         ORL       A,?V1
   \   000019   601B         JZ        ??bdb_addInstallCode_0
    446            {
    447              return ZInvalidParameter;
    448            }
    449            
    450            CRC = bdb_GenerateInstallCodeCRC(pInstallCode);
   \   00001B                ; Setup parameters for call to function bdb_GenerateInstallCodeCRC
   \   00001B   12....       LCALL     `??bdb_GenerateInstallCodeCRC::?relay`; Banked call to: bdb_GenerateInstallCodeCRC
   \   00001E   8A..         MOV       ?V2,R2
   \   000020   8B..         MOV       ?V3,R3
    451          
    452            //Validate CRC
    453            if(CRC != osal_build_uint16(&pInstallCode[INSTALL_CODE_LEN]))
   \   000022                ; Setup parameters for call to function osal_build_uint16
   \   000022   EE           MOV       A,R6
   \   000023   2410         ADD       A,#0x10
   \   000025   FA           MOV       R2,A
   \   000026   E4           CLR       A
   \   000027   3F           ADDC      A,R7
   \   000028   FB           MOV       R3,A
   \   000029   12....       LCALL     `??osal_build_uint16::?relay`; Banked call to: osal_build_uint16
   \   00002C   EA           MOV       A,R2
   \   00002D   65..         XRL       A,?V2
   \   00002F   7003         JNZ       ??bdb_addInstallCode_1
   \   000031   EB           MOV       A,R3
   \   000032   65..         XRL       A,?V3
   \                     ??bdb_addInstallCode_1:
   \   000034   6004         JZ        ??bdb_addInstallCode_2
    454            {
    455              return ZInvalidParameter;
   \                     ??bdb_addInstallCode_0:
   \   000036   7902         MOV       R1,#0x2
   \   000038   8035         SJMP      ??bdb_addInstallCode_3
    456            }
    457          
    458            sspMMOHash (NULL, 0, pInstallCode,(INSTALL_CODE_LEN + INSTALL_CODE_CRC_LEN) * BITS_PER_BYTE, hashOutput);
   \                     ??bdb_addInstallCode_2:
   \   00003A                ; Setup parameters for call to function sspMMOHash
   \   00003A   A8..         MOV       R0,?XSP + 0
   \   00003C   A9..         MOV       R1,?XSP + 1
   \   00003E   88..         MOV       ?V2,R0
   \   000040   89..         MOV       ?V3,R1
   \   000042   78..         MOV       R0,#?V2
   \   000044   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000047   75..90       MOV       ?V2,#-0x70
   \   00004A   75..00       MOV       ?V3,#0x0
   \   00004D   78..         MOV       R0,#?V2
   \   00004F   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000052   EE           MOV       A,R6
   \   000053   FC           MOV       R4,A
   \   000054   EF           MOV       A,R7
   \   000055   FD           MOV       R5,A
   \   000056   7900         MOV       R1,#0x0
   \   000058   7A00         MOV       R2,#0x0
   \   00005A   7B00         MOV       R3,#0x0
   \   00005C   12....       LCALL     `??sspMMOHash::?relay`; Banked call to: sspMMOHash
   \   00005F   7404         MOV       A,#0x4
   \   000061   12....       LCALL     ?DEALLOC_XSTACK8
    459          
    460            return APSME_AddTCLinkKey(hashOutput,pExt);
   \   000064                ; Setup parameters for call to function APSME_AddTCLinkKey
   \   000064   AC..         MOV       R4,?V0
   \   000066   AD..         MOV       R5,?V1
   \   000068   AA..         MOV       R2,?XSP + 0
   \   00006A   AB..         MOV       R3,?XSP + 1
   \   00006C   12....       LCALL     `??APSME_AddTCLinkKey::?relay`; Banked call to: APSME_AddTCLinkKey
   \                     ??bdb_addInstallCode_3:
   \   00006F   7410         MOV       A,#0x10
   \   000071   12....       LCALL     ?DEALLOC_XSTACK8
   \   000074   7F06         MOV       R7,#0x6
   \   000076   02....       LJMP      ?BANKED_LEAVE_XDATA
    461          }    
    462              
    463          
    464          #if (ZG_BUILD_COORDINATOR_TYPE)
    465           /*********************************************************************
    466           * @fn      bdb_RegisterTCLinkKeyExchangeProcessCB
    467           *
    468           * @brief   Register a callback to receive notifications on the joining devices 
    469           *          and its status on TC link key exchange
    470           *
    471           * @param   bdbGCB_TCLinkKeyExchangeProcess - application callback 
    472           *          (extended address of device, status: 0 = Joining, 1 = TC link key exchange success, 2 = TC link key exchange failed)
    473           *
    474           * @return  none
    475           */
    476          void bdb_RegisterTCLinkKeyExchangeProcessCB(bdbGCB_TCLinkKeyExchangeProcess_t bdbGCB_TCLinkKeyExchangeProcess)
    477          {
    478            if(bdbGCB_TCLinkKeyExchangeProcess != NULL)
    479            {
    480              pfnTCLinkKeyExchangeProcessCB = bdbGCB_TCLinkKeyExchangeProcess;
    481            }
    482          }
    483          
    484          
    485          
    486           /*********************************************************************
    487           * @fn          bdb_setTCRequireKeyExchange
    488           *
    489           * @brief       Set the bdb_setTCRequireKeyExchange attribute
    490           *
    491           * @param       isKeyExchangeRequired - True if TC will remove devices that do 
    492           *              not perform key exchange after bdbTrustCenterNodeJoinTimeout, 
    493           *              False to not remove devices.
    494           *
    495           * @return      none
    496           */
    497          void bdb_setTCRequireKeyExchange(bool isKeyExchangeRequired)
    498          {
    499            bdbAttributes.bdbTrustCenterRequireKeyExchange = isKeyExchangeRequired;
    500          }
    501          
    502          
    503          
    504           /*********************************************************************
    505           * @fn          bdb_TCAddJoiningDevice
    506           *
    507           * @brief       Add a joining device to the list of devices that must request a 
    508           *              key before bdbTrustCenterNodeJoinTimeout.
    509           *
    510           * @param       parentAddr - Address of the parent device
    511           * @param       JoiningExtAddr - IEEE address of the joining device
    512           *
    513           * @return      ZStatus_t - ZFailure No memory to allocate the device in the list
    514           *                          ZInvalidParameter
    515           */
    516          ZStatus_t bdb_TCAddJoiningDevice(uint16 parentAddr, uint8* JoiningExtAddr)
    517          {
    518            bdb_joiningDeviceList_t* tempJoiningDescNode;
    519            
    520            if((parentAddr == INVALID_NODE_ADDR) || (JoiningExtAddr == NULL))
    521            {
    522              return ZInvalidParameter;
    523            }
    524            
    525            //If the list was empty and element was allocated, then start the timer
    526            if(bdb_joiningDeviceList == NULL)
    527            {
    528              bdb_joiningDeviceList = osal_mem_alloc(sizeof(bdb_joiningDeviceList_t));
    529              if(bdb_joiningDeviceList == NULL)
    530              {
    531                return ZFailure;
    532              }
    533             
    534              osal_start_reload_timer(bdb_TaskID,BDB_TC_JOIN_TIMEOUT,1000);
    535              tempJoiningDescNode = bdb_joiningDeviceList;
    536            }
    537            //if the list was not empty then add the entry at the end of the list
    538            else
    539            {
    540              tempJoiningDescNode = bdb_joiningDeviceList;
    541              
    542              //Validate that this is not already in the list... somehow
    543              if(osal_memcmp(JoiningExtAddr,tempJoiningDescNode->bdbJoiningNodeEui64,Z_EXTADDR_LEN))
    544              {
    545                //The device added is already in the list, refresh its time and do nothing else
    546                tempJoiningDescNode->NodeJoinTimeout = bdbAttributes.bdbTrustCenterNodeJoinTimeout;
    547                return ZSuccess;
    548              }
    549              
    550              while(tempJoiningDescNode->nextDev != NULL)
    551              {
    552                tempJoiningDescNode = tempJoiningDescNode->nextDev;
    553                
    554                //Validate that this is not already in the list... somehow
    555                if(osal_memcmp(JoiningExtAddr,tempJoiningDescNode->bdbJoiningNodeEui64,Z_EXTADDR_LEN))
    556                {
    557                  //The device added is already in the list, refresh its time and do nothing else
    558                  tempJoiningDescNode->NodeJoinTimeout = bdbAttributes.bdbTrustCenterNodeJoinTimeout;
    559                  return ZSuccess;
    560                }
    561              }
    562              
    563              tempJoiningDescNode->nextDev = osal_mem_alloc(sizeof(bdb_joiningDeviceList_t));
    564              if(tempJoiningDescNode->nextDev == NULL)
    565              {
    566                return ZFailure;
    567              }
    568              
    569              tempJoiningDescNode = tempJoiningDescNode->nextDev;
    570            }
    571            
    572            if(pfnTCLinkKeyExchangeProcessCB)
    573            {
    574              bdb_TCLinkKeyExchProcess_t bdb_TCLinkKeyExchProcess;
    575              osal_memcpy(bdb_TCLinkKeyExchProcess.extAddr,tempJoiningDescNode->bdbJoiningNodeEui64, Z_EXTADDR_LEN);
    576              bdb_TCLinkKeyExchProcess.status = BDB_TC_LK_EXCH_PROCESS_JOINING;
    577              
    578              bdb_SendMsg(bdb_TaskID, BDB_TC_LINK_KEY_EXCHANGE_PROCESS, BDB_MSG_EVENT_SUCCESS,sizeof(bdb_TCLinkKeyExchProcess_t),(uint8*)&bdb_TCLinkKeyExchProcess);
    579            }
    580            
    581            tempJoiningDescNode->nextDev = NULL;
    582            tempJoiningDescNode->NodeJoinTimeout = bdbAttributes.bdbTrustCenterNodeJoinTimeout;
    583            tempJoiningDescNode->parentAddr = parentAddr;
    584            osal_memcpy(tempJoiningDescNode->bdbJoiningNodeEui64, JoiningExtAddr, Z_EXTADDR_LEN);
    585            
    586            return ZSuccess;
    587          }
    588          
    589          /****************************************************************************
    590           * @fn          bdb_TCProcessJoiningList
    591           *
    592           * @brief       Process the timer to handle the joining devices if the TC link 
    593           *              key is mandatory for all devices
    594           *
    595           * @param       none
    596           *
    597           * @return      none
    598           */
    599          void bdb_TCProcessJoiningList(void)
    600          {
    601            bdb_joiningDeviceList_t* tempJoiningDescNode;
    602            
    603            if(bdb_joiningDeviceList)
    604            {
    605              tempJoiningDescNode = bdb_joiningDeviceList;
    606            
    607              while(tempJoiningDescNode)
    608              {
    609                if(tempJoiningDescNode->NodeJoinTimeout)
    610                {
    611                  tempJoiningDescNode->NodeJoinTimeout--;
    612                }
    613                
    614                if(tempJoiningDescNode->NodeJoinTimeout == 0)
    615                {
    616                  //Check if the key exchange is required 
    617                  if(bdb_doTrustCenterRequireKeyExchange())
    618                  {
    619                      AddrMgrEntry_t entry;
    620                      
    621                      entry.user = ADDRMGR_USER_DEFAULT;
    622                      osal_memcpy(entry.extAddr,tempJoiningDescNode->bdbJoiningNodeEui64, Z_EXTADDR_LEN);
    623                      
    624                      if(AddrMgrEntryLookupExt(&entry))
    625                      {
    626                        ZDSecMgrAPSRemove(entry.nwkAddr,entry.extAddr,tempJoiningDescNode->parentAddr);
    627                      }
    628                  }
    629                  
    630                  //Expired device either is legacy device not using the TCLK entry or got 
    631                  //removed from the network because of timeout, eitherway it is not using
    632                  //TCLK entry neither the Security user in the address manager, so free the entry
    633                  //in both tables.
    634                  
    635                  uint16 keyNvIndex;
    636                  uint16 index;        
    637                  APSME_TCLKDevEntry_t TCLKDevEntry;
    638                  uint8 found;
    639                  
    640                  //Remove the entry in address manager
    641                  ZDSecMgrAddrClear(tempJoiningDescNode->bdbJoiningNodeEui64);
    642                  
    643                  //search for the entry in the TCLK table
    644                  keyNvIndex = APSME_SearchTCLinkKeyEntry(tempJoiningDescNode->bdbJoiningNodeEui64,&found, NULL);
    645                  
    646                  //If found, erase it.
    647                  if(found == TRUE)
    648                  {
    649                    osal_memset(&TCLKDevEntry,0,sizeof(APSME_TCLKDevEntry_t));
    650                    TCLKDevEntry.keyAttributes = ZG_DEFAULT_KEY;
    651                    
    652                    //Increase the shift by one. Validate the maximum shift of the seed which is 15
    653                    index = keyNvIndex - ZCD_NV_TCLK_TABLE_START;
    654                    
    655                    TCLinkKeyFrmCntr[index].rxFrmCntr = 0;
    656                    TCLinkKeyFrmCntr[index].txFrmCntr = 0;
    657                    
    658                    //Update the entry
    659                    osal_nv_write(keyNvIndex,0,sizeof(APSME_TCLKDevEntry_t), &TCLKDevEntry );
    660                  }
    661                  
    662                  if(pfnTCLinkKeyExchangeProcessCB)
    663                  {
    664                    bdb_TCLinkKeyExchProcess_t bdb_TCLinkKeyExchProcess;
    665                    osal_memcpy(bdb_TCLinkKeyExchProcess.extAddr,tempJoiningDescNode->bdbJoiningNodeEui64, Z_EXTADDR_LEN);
    666                    bdb_TCLinkKeyExchProcess.status = BDB_TC_LK_EXCH_PROCESS_EXCH_FAIL;
    667                    
    668                    bdb_SendMsg(bdb_TaskID, BDB_TC_LINK_KEY_EXCHANGE_PROCESS, BDB_MSG_EVENT_SUCCESS,sizeof(bdb_TCLinkKeyExchProcess_t),(uint8*)&bdb_TCLinkKeyExchProcess);
    669                  }
    670                 
    671                  //Free the device from the list
    672                  bdb_TCJoiningDeviceFree(tempJoiningDescNode);
    673                }
    674                tempJoiningDescNode = tempJoiningDescNode->nextDev;
    675              }
    676            }
    677          
    678            //we are done with the list
    679            if(bdb_joiningDeviceList == NULL)
    680            {
    681              osal_stop_timerEx(bdb_TaskID,BDB_TC_JOIN_TIMEOUT);
    682            }
    683          }
    684          
    685          
    686          
    687          /****************************************************************************
    688           * @fn          bdb_TCjoiningDeviceComplete
    689           *
    690           * @brief       This function frees a joining device from the list that has 
    691           *              finished TC link key exchange process
    692           *
    693           * @param       JoiningExtAddr - Extended address of the device
    694           *
    695           * @return      none
    696           */
    697          void bdb_TCjoiningDeviceComplete(uint8* JoiningExtAddr)
    698          {
    699            bdb_joiningDeviceList_t* tempJoiningDescNode;
    700            
    701            if((bdb_joiningDeviceList != NULL) && (JoiningExtAddr != NULL))
    702            {
    703              tempJoiningDescNode = bdb_joiningDeviceList;
    704              
    705              while(tempJoiningDescNode != NULL)
    706              {
    707                if(osal_memcmp(tempJoiningDescNode->bdbJoiningNodeEui64,JoiningExtAddr,Z_EXTADDR_LEN))
    708                {
    709                  if(pfnTCLinkKeyExchangeProcessCB)
    710                  {
    711                    bdb_TCLinkKeyExchProcess_t bdb_TCLinkKeyExchProcess;
    712                    osal_memcpy(bdb_TCLinkKeyExchProcess.extAddr,tempJoiningDescNode->bdbJoiningNodeEui64, Z_EXTADDR_LEN);
    713                    bdb_TCLinkKeyExchProcess.status = BDB_TC_LK_EXCH_PROCESS_EXCH_SUCCESS;
    714                    
    715                    bdb_SendMsg(bdb_TaskID, BDB_TC_LINK_KEY_EXCHANGE_PROCESS, BDB_MSG_EVENT_SUCCESS,sizeof(bdb_TCLinkKeyExchProcess_t),(uint8*)&bdb_TCLinkKeyExchProcess);
    716                  }        
    717                  
    718                  bdb_TCJoiningDeviceFree(tempJoiningDescNode);
    719                  break;
    720                }
    721                tempJoiningDescNode = tempJoiningDescNode->nextDev;
    722              }
    723             
    724              if(bdb_joiningDeviceList == NULL)
    725              {
    726                osal_stop_timerEx(bdb_TaskID,BDB_TC_JOIN_TIMEOUT);
    727              }
    728            }
    729          }
    730          
    731          
    732          
    733          /****************************************************************************
    734           * @fn          bdb_TCJoiningDeviceFree
    735           *
    736           * @brief       This function frees a joining device from the list.
    737           *
    738           * @param       ZSuccess - If the device was found and erased
    739           * @param       ZInvalidParameter - Not found
    740           *
    741           * @return      none
    742           */
    743          ZStatus_t bdb_TCJoiningDeviceFree(bdb_joiningDeviceList_t* JoiningDeviceToRemove)
    744          {
    745            bdb_joiningDeviceList_t* descCurrent;
    746            bdb_joiningDeviceList_t* descPrev;
    747            
    748            //validate empty list?
    749            
    750            //Is it the first?
    751            if(osal_memcmp(bdb_joiningDeviceList->bdbJoiningNodeEui64, JoiningDeviceToRemove->bdbJoiningNodeEui64, Z_EXTADDR_LEN))
    752            {
    753              descCurrent = bdb_joiningDeviceList;
    754              bdb_joiningDeviceList = bdb_joiningDeviceList->nextDev;
    755              osal_mem_free( descCurrent );
    756              return ZSuccess;
    757            }
    758            
    759            descPrev = NULL;
    760            descCurrent = bdb_joiningDeviceList;
    761            
    762            while(descCurrent != NULL)
    763            {
    764              if(osal_memcmp(descCurrent->nextDev->bdbJoiningNodeEui64, JoiningDeviceToRemove->bdbJoiningNodeEui64, Z_EXTADDR_LEN))
    765              {
    766                descPrev = descCurrent;
    767                break;
    768              }
    769              descCurrent = descCurrent->nextDev;
    770            }
    771            if(descPrev == NULL)
    772            {
    773              //Not found
    774              return ZInvalidParameter;
    775            }
    776            
    777            descPrev->nextDev = descPrev->nextDev->nextDev;
    778              
    779            osal_mem_free( JoiningDeviceToRemove );
    780            return ZSuccess;
    781          
    782          }
    783          
    784           /*********************************************************************
    785           * @fn          bdb_setJoinUsesInstallCodeKey
    786           *
    787           * @brief       Set BDB attribute bdbJoinUsesInstallCodeKey.
    788           *
    789           * @param       set - If TRUE only devices with IC register in TC can join the 
    790           *              nwk, otherwise devices may or not have a IC register
    791           *
    792           * @return      none
    793           */
    794          void bdb_setJoinUsesInstallCodeKey(bool set)
    795          {
    796            bdbAttributes.bdbJoinUsesInstallCodeKey = set;
    797            if(set)
    798            {
    799              zgAllowInstallCodes = ZG_IC_MUST_USED;
    800            }
    801            else
    802            {
    803              zgAllowInstallCodes = ZG_IC_SUPPORTED_NOT_REQUIRED;
    804            }
    805          }
    806          #endif
    807          
    808           /*********************************************************************
    809           * @fn          bdb_StartCommissioning
    810           *
    811           * @brief       Start the commissioning process setting the commissioning mode given.
    812           *
    813           * @param       mode - refer to bdbCommissioningMode
    814           *
    815           * @return      none
    816           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    817          void bdb_StartCommissioning(uint8 mode)
   \                     bdb_StartCommissioning:
    818          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000   74F4         MOV       A,#-0xc
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 85
   \   000005   74AB         MOV       A,#-0x55
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   \   00000A   89..         MOV       ?V0,R1
    819            //Application cannot request to set the device in initialization mode or parent lost
    820            mode &= ~(BDB_COMMISSIONING_MODE_INITIALIZATION | BDB_COMMISSIONING_MODE_PARENT_LOST);
    821              
    822          #ifdef BDB_TL_INITIATOR
    823            if ( touchlinkFNReset == TRUE )
    824            {
    825              return;
    826            }
    827          #else
    828            //Commissioning mode used only for initiator
    829            mode &= ~BDB_COMMISSIONING_MODE_INITIATOR_TL;
   \   00000C   53..CE       ANL       ?V0,#0xce
    830          #endif
    831            
    832          #if (BDB_FINDING_BINDING_CAPABILITY_ENABLED==0)    
    833            //Commissioning mode used only for devices with F&B
    834            mode &= ~BDB_COMMISSIONING_MODE_FINDING_BINDING;
    835          #endif
    836           
    837            //If we have running process or the machine state is triggered, then just append and it will be excecuted
    838            if((bdbAttributes.bdbCommissioningMode) || (osal_get_timeoutEx(bdb_TaskID,BDB_CHANGE_COMMISSIONING_STATE)))
   \   00000F   90....       MOV       DPTR,#bdbAttributes + 11
   \   000012   E0           MOVX      A,@DPTR
   \   000013   7012         JNZ       ??bdb_StartCommissioning_0
   \   000015                ; Setup parameters for call to function osal_get_timeoutEx
   \   000015   7A04         MOV       R2,#0x4
   \   000017   7B00         MOV       R3,#0x0
   \   000019   90....       MOV       DPTR,#bdb_TaskID
   \   00001C   E0           MOVX      A,@DPTR
   \   00001D   F9           MOV       R1,A
   \   00001E   12....       LCALL     `??osal_get_timeoutEx::?relay`; Banked call to: osal_get_timeoutEx
   \   000021   EA           MOV       A,R2
   \   000022   4B           ORL       A,R3
   \   000023   4C           ORL       A,R4
   \   000024   4D           ORL       A,R5
   \   000025   6032         JZ        ??bdb_StartCommissioning_1
    839            {
    840          #if ZG_BUILD_ENDDEVICE_TYPE
    841              if(ZG_DEVICE_ENDDEVICE_TYPE)
    842              {
    843                //Devices with parent lost are not allowed to perform actions
    844                if(bdbAttributes.bdbCommissioningMode & BDB_COMMISSIONING_MODE_PARENT_LOST)
   \                     ??bdb_StartCommissioning_0:
   \   000027   90....       MOV       DPTR,#bdbAttributes + 11
   \   00002A   E0           MOVX      A,@DPTR
   \   00002B   A2E5         MOV       C,0xE0 /* A   */.5
   \   00002D   5003         JNC       $+5
   \   00002F   02....       LJMP      ??bdb_StartCommissioning_2 & 0xFFFF
    845                {
    846                  return;
    847                }
    848              }
    849          #endif
    850              
    851              //If we are on the network and got requested to do nwk steering, we do not need to wait other process, 
    852              // just send permit joining and report the application
    853              if((bdbAttributes.bdbNodeIsOnANetwork) && (mode & BDB_COMMISSIONING_MODE_NWK_STEERING))
   \   000032   90....       MOV       DPTR,#bdbAttributes + 14
   \   000035   E0           MOVX      A,@DPTR
   \   000036   6013         JZ        ??bdb_StartCommissioning_3
   \   000038   E5..         MOV       A,?V0
   \   00003A   A2E1         MOV       C,0xE0 /* A   */.1
   \   00003C   500D         JNC       ??bdb_StartCommissioning_3
    854              {
    855                bdb_nwkSteeringDeviceOnNwk();
   \   00003E                ; Setup parameters for call to function bdb_nwkSteeringDeviceOnNwk
   \   00003E   12....       LCALL     `??bdb_nwkSteeringDeviceOnNwk::?relay`; Banked call to: bdb_nwkSteeringDeviceOnNwk
    856                bdb_reportCommissioningState(BDB_COMMISSIONING_STATE_STEERING_ON_NWK, TRUE);
   \   000041                ; Setup parameters for call to function bdb_reportCommissioningState
   \   000041   7A01         MOV       R2,#0x1
   \   000043   7904         MOV       R1,#0x4
   \   000045   12....       LCALL     `??bdb_reportCommissioningState::?relay`; Banked call to: bdb_reportCommissioningState
    857                
    858                //Clean nwk steering
    859                mode ^= BDB_COMMISSIONING_MODE_NWK_STEERING; 
   \   000048   63..02       XRL       ?V0,#0x2
    860              }
    861              
    862              //add the remaining valid commissioning modes requested, those will be process when bdb finish its current process
    863              bdbAttributes.bdbCommissioningMode |= mode & BDB_COMMISSIONING_MODES;
   \                     ??bdb_StartCommissioning_3:
   \   00004B   743F         MOV       A,#0x3f
   \   00004D   55..         ANL       A,?V0
   \   00004F   F8           MOV       R0,A
   \   000050   90....       MOV       DPTR,#bdbAttributes + 11
   \   000053   E0           MOVX      A,@DPTR
   \   000054   48           ORL       A,R0
   \   000055   F0           MOVX      @DPTR,A
    864              return;      
   \   000056   02....       LJMP      ??bdb_StartCommissioning_2 & 0xFFFF
    865            }
    866          
    867            //Save the commissioning modes valid requested
    868            bdbAttributes.bdbCommissioningMode |= mode & BDB_COMMISSIONING_MODES;
   \                     ??bdb_StartCommissioning_1:
   \   000059   743F         MOV       A,#0x3f
   \   00005B   55..         ANL       A,?V0
   \   00005D   FE           MOV       R6,A
   \   00005E   90....       MOV       DPTR,#bdbAttributes + 11
   \   000061   E0           MOVX      A,@DPTR
   \   000062   4E           ORL       A,R6
   \   000063   F0           MOVX      @DPTR,A
    869            
    870            
    871            //Start processing the initialization, once per power cycle.
    872            if(!bdb_initialization)
   \   000064   90....       MOV       DPTR,#bdb_initialization
   \   000067   E0           MOVX      A,@DPTR
   \   000068   6003         JZ        $+5
   \   00006A   02....       LJMP      ??bdb_StartCommissioning_4 & 0xFFFF
    873            {
    874              bdb_initialization = TRUE;
   \   00006D   7401         MOV       A,#0x1
   \   00006F   F0           MOVX      @DPTR,A
    875              
    876          #ifdef BDB_REPORTING
    877              //Delete NV data if startup was with factory reset
    878              if(ZDO_INITDEV_NEW_NETWORK_STATE == ZDApp_ReadNetworkRestoreState())
   \   000070                ; Setup parameters for call to function ZDApp_ReadNetworkRestoreState
   \   000070   12....       LCALL     `??ZDApp_ReadNetworkRestoreState::?relay`; Banked call to: ZDApp_ReadNetworkRestoreState
   \   000073   E9           MOV       A,R1
   \   000074   6401         XRL       A,#0x1
   \   000076   701A         JNZ       ??bdb_StartCommissioning_5
    879              {
    880                //Factory reset bdb reporting NV data
    881                uint16 attrRepNvLen = osal_nv_item_len( ZCD_NV_BDBREPORTINGCONFIG );
   \   000078                ; Setup parameters for call to function osal_nv_item_len
   \   000078   7A56         MOV       R2,#0x56
   \   00007A   7B00         MOV       R3,#0x0
   \   00007C   12....       LCALL     `??osal_nv_item_len::?relay`; Banked call to: osal_nv_item_len
   \   00007F   8A..         MOV       ?V2,R2
   \   000081   8B..         MOV       ?V3,R3
   \   000083   AC..         MOV       R4,?V2
   \   000085   AD..         MOV       R5,?V3
    882                if ( attrRepNvLen > 0 )
   \   000087   EC           MOV       A,R4
   \   000088   4D           ORL       A,R5
   \   000089   6007         JZ        ??bdb_StartCommissioning_5
    883                {
    884                  osal_nv_delete( ZCD_NV_BDBREPORTINGCONFIG, attrRepNvLen );
   \   00008B                ; Setup parameters for call to function osal_nv_delete
   \   00008B   7A56         MOV       R2,#0x56
   \   00008D   7B00         MOV       R3,#0x0
   \   00008F   12....       LCALL     `??osal_nv_delete::?relay`; Banked call to: osal_nv_delete
    885                }
    886              }
    887          
    888              //Construct the Endpoint-cluster array
    889              bdb_RepConstructReportingData();
   \                     ??bdb_StartCommissioning_5:
   \   000092                ; Setup parameters for call to function bdb_RepConstructReportingData
   \   000092   12....       LCALL     `??bdb_RepConstructReportingData::?relay`; Banked call to: bdb_RepConstructReportingData
    890          #endif //BDB_REPORTING
    891              
    892              osal_nv_read(ZCD_NV_BDBNODEISONANETWORK,0,sizeof(bdbAttributes.bdbNodeIsOnANetwork),&bdbAttributes.bdbNodeIsOnANetwork);
   \   000095                ; Setup parameters for call to function osal_nv_read
   \   000095   75....       MOV       ?V2,#(bdbAttributes + 14) & 0xff
   \   000098   75....       MOV       ?V3,#((bdbAttributes + 14) >> 8) & 0xff
   \   00009B   78..         MOV       R0,#?V2
   \   00009D   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000A0   75..01       MOV       ?V2,#0x1
   \   0000A3   75..00       MOV       ?V3,#0x0
   \   0000A6   78..         MOV       R0,#?V2
   \   0000A8   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000AB   7C00         MOV       R4,#0x0
   \   0000AD   7D00         MOV       R5,#0x0
   \   0000AF   7A55         MOV       R2,#0x55
   \   0000B1   7B00         MOV       R3,#0x0
   \   0000B3   12....       LCALL     `??osal_nv_read::?relay`; Banked call to: osal_nv_read
   \   0000B6   7404         MOV       A,#0x4
   \   0000B8   12....       LCALL     ?DEALLOC_XSTACK8
    893              
    894              // NV
    895              extern void HalUARTWrite(uint8 port, uint8 *buf, uint16 len);
    896              uint8 nvMsg[] = "NV read: ";
   \   0000BB   90....       MOV       DPTR,#`?<Constant "NV read: ">`
   \   0000BE   7418         MOV       A,#0x18
   \   0000C0   12....       LCALL     ?XSTACK_DISP102_8
   \   0000C3   740A         MOV       A,#0xa
   \   0000C5   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    897              HalUARTWrite(0, nvMsg, sizeof(nvMsg)-1);
   \   0000C8                ; Setup parameters for call to function HalUARTWrite
   \   0000C8   7C09         MOV       R4,#0x9
   \   0000CA   FD           MOV       R5,A
   \   0000CB   7418         MOV       A,#0x18
   \   0000CD   12....       LCALL     ?XSTACK_DISP101_8
   \   0000D0   7900         MOV       R1,#0x0
   \   0000D2   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    898              uint8 statusMsg[4];
    899              statusMsg[0] = '0' + bdbAttributes.bdbNodeIsOnANetwork;
   \   0000D5   90....       MOV       DPTR,#bdbAttributes + 14
   \   0000D8   E0           MOVX      A,@DPTR
   \   0000D9   2430         ADD       A,#0x30
   \   0000DB   C0E0         PUSH      A
   \   0000DD   7401         MOV       A,#0x1
   \   0000DF   12....       LCALL     ?XSTACK_DISP0_8
   \   0000E2   D0E0         POP       A
   \   0000E4   F0           MOVX      @DPTR,A
    900              statusMsg[1] = '\r';
   \   0000E5   7402         MOV       A,#0x2
   \   0000E7   12....       LCALL     ?XSTACK_DISP0_8
   \   0000EA   740D         MOV       A,#0xd
   \   0000EC   F0           MOVX      @DPTR,A
    901              statusMsg[2] = '\n';
   \   0000ED   7403         MOV       A,#0x3
   \   0000EF   12....       LCALL     ?XSTACK_DISP0_8
   \   0000F2   740A         MOV       A,#0xa
   \   0000F4   F0           MOVX      @DPTR,A
    902              HalUARTWrite(0, statusMsg, 3);
   \   0000F5                ; Setup parameters for call to function HalUARTWrite
   \   0000F5   7C03         MOV       R4,#0x3
   \   0000F7   7D00         MOV       R5,#0x0
   \   0000F9   7401         MOV       A,#0x1
   \   0000FB   12....       LCALL     ?XSTACK_DISP101_8
   \   0000FE   7900         MOV       R1,#0x0
   \   000100   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    903              
    904              //Are we on a network
    905              if(bdbAttributes.bdbNodeIsOnANetwork == TRUE)
   \   000103   90....       MOV       DPTR,#bdbAttributes + 14
   \   000106   E0           MOVX      A,@DPTR
   \   000107   6401         XRL       A,#0x1
   \   000109   6003         JZ        $+5
   \   00010B   02....       LJMP      ??bdb_StartCommissioning_4 & 0xFFFF
    906              {
    907          #ifdef ZG_BUILD_JOINING_TYPE
    908                //Only for joining devices validate the joining procedure
    909                if(ZG_DEVICE_JOINING_TYPE)
   \   00010E   90....       MOV       DPTR,#zgDeviceLogicalType
   \   000111   E0           MOVX      A,@DPTR
   \   000112   6401         XRL       A,#0x1
   \   000114   6008         JZ        ??bdb_StartCommissioning_6
   \   000116   E0           MOVX      A,@DPTR
   \   000117   6402         XRL       A,#0x2
   \   000119   6003         JZ        $+5
   \   00011B   02....       LJMP      ??bdb_StartCommissioning_7 & 0xFFFF
    910                {
    911                  //If we got into a network
    912                  if(!osal_isbufset( AIB_apsTrustCenterAddress, 0x00, Z_EXTADDR_LEN ))
   \                     ??bdb_StartCommissioning_6:
   \   00011E                ; Setup parameters for call to function osal_isbufset
   \   00011E   7C08         MOV       R4,#0x8
   \   000120   7900         MOV       R1,#0x0
   \   000122   90....       MOV       DPTR,#AIB_apsTrustCenterAddress
   \   000125   12....       LCALL     ??Subroutine42_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_93:
   \   000128   12....       LCALL     `??osal_isbufset::?relay`; Banked call to: osal_isbufset
   \   00012B   E9           MOV       A,R1
   \   00012C   6003         JZ        $+5
   \   00012E   02....       LJMP      ??bdb_StartCommissioning_7 & 0xFFFF
    913                  {
    914                    //Which is not distributed
    915                    if(!APSME_IsDistributedSecurity())
   \   000131                ; Setup parameters for call to function APSME_IsDistributedSecurity
   \   000131   12....       LCALL     `??APSME_IsDistributedSecurity::?relay`; Banked call to: APSME_IsDistributedSecurity
   \   000134   E9           MOV       A,R1
   \   000135   6003         JZ        $+5
   \   000137   02....       LJMP      ??bdb_StartCommissioning_7 & 0xFFFF
    916                    {
    917                      uint8 keyAttributes;
    918                      osal_nv_read(ZCD_NV_TCLK_TABLE_START, osal_offsetof(APSME_TCLKDevEntry_t,keyAttributes), sizeof(uint8), &keyAttributes);
   \   00013A                ; Setup parameters for call to function osal_nv_read
   \   00013A   A8..         MOV       R0,?XSP + 0
   \   00013C   A9..         MOV       R1,?XSP + 1
   \   00013E   88..         MOV       ?V2,R0
   \   000140   89..         MOV       ?V3,R1
   \   000142   78..         MOV       R0,#?V2
   \   000144   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000147   75..01       MOV       ?V2,#0x1
   \   00014A   75..00       MOV       ?V3,#0x0
   \   00014D   78..         MOV       R0,#?V2
   \   00014F   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000152   7C10         MOV       R4,#0x10
   \   000154   7D00         MOV       R5,#0x0
   \   000156   7A11         MOV       R2,#0x11
   \   000158   7B01         MOV       R3,#0x1
   \   00015A   12....       LCALL     `??osal_nv_read::?relay`; Banked call to: osal_nv_read
   \   00015D   7404         MOV       A,#0x4
   \   00015F   12....       LCALL     ?DEALLOC_XSTACK8
    919                      //If we must perform the TCLK exchange and we didn't complete it, then reset to FN
    920                      if(requestNewTrustCenterLinkKey && (keyAttributes != ZG_NON_R21_NWK_JOINED) && (keyAttributes != ZG_VERIFIED_KEY))
   \   000162   90....       MOV       DPTR,#requestNewTrustCenterLinkKey
   \   000165   E0           MOVX      A,@DPTR
   \   000166   7003         JNZ       $+5
   \   000168   02....       LJMP      ??bdb_StartCommissioning_7 & 0xFFFF
   \   00016B   85..82       MOV       DPL,?XSP + 0
   \   00016E   85..83       MOV       DPH,?XSP + 1
   \   000171   E0           MOVX      A,@DPTR
   \   000172   64FD         XRL       A,#0xfd
   \   000174   7003         JNZ       $+5
   \   000176   02....       LJMP      ??bdb_StartCommissioning_7 & 0xFFFF
   \   000179   E0           MOVX      A,@DPTR
   \   00017A   6402         XRL       A,#0x2
   \   00017C   7003         JNZ       $+5
   \   00017E   02....       LJMP      ??bdb_StartCommissioning_7 & 0xFFFF
    921                      {
    922                        //Force to initialize the entry
    923                        APSME_TCLKDevEntry_t APSME_TCLKDevEntry;
    924                        
    925                        osal_memset(&APSME_TCLKDevEntry,0,sizeof(APSME_TCLKDevEntry_t));
   \   000181                ; Setup parameters for call to function osal_memset
   \   000181   7C13         MOV       R4,#0x13
   \   000183   7D00         MOV       R5,#0x0
   \   000185   7900         MOV       R1,#0x0
   \   000187   7405         MOV       A,#0x5
   \   000189   12....       LCALL     ?XSTACK_DISP101_8
   \   00018C   12....       LCALL     `??osal_memset::?relay`; Banked call to: osal_memset
    926                        APSME_TCLKDevEntry.keyAttributes = ZG_DEFAULT_KEY;
   \   00018F   7415         MOV       A,#0x15
   \   000191   12....       LCALL     ?XSTACK_DISP0_8
   \   000194   74FF         MOV       A,#-0x1
   \   000196   F0           MOVX      @DPTR,A
    927                        osal_nv_write(ZCD_NV_TCLK_TABLE_START, 0, sizeof(APSME_TCLKDevEntry_t), &APSME_TCLKDevEntry);
   \   000197                ; Setup parameters for call to function osal_nv_write
   \   000197   7405         MOV       A,#0x5
   \   000199   12....       LCALL     ?XSTACK_DISP100_8
   \   00019C   88..         MOV       ?V2,R0
   \   00019E   89..         MOV       ?V3,R1
   \   0001A0   78..         MOV       R0,#?V2
   \   0001A2   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0001A5   75..13       MOV       ?V2,#0x13
   \   0001A8   75..00       MOV       ?V3,#0x0
   \   0001AB   78..         MOV       R0,#?V2
   \   0001AD   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0001B0   7C00         MOV       R4,#0x0
   \   0001B2   7D00         MOV       R5,#0x0
   \   0001B4   7A11         MOV       R2,#0x11
   \   0001B6   7B01         MOV       R3,#0x1
   \   0001B8   12....       LCALL     `??osal_nv_write::?relay`; Banked call to: osal_nv_write
   \   0001BB   7404         MOV       A,#0x4
   \   0001BD   12....       LCALL     ?DEALLOC_XSTACK8
    928                        TCLinkKeyFrmCntr[0].txFrmCntr = 0;
   \   0001C0   90....       MOV       DPTR,#TCLinkKeyFrmCntr
   \   0001C3   E4           CLR       A
   \   0001C4   F0           MOVX      @DPTR,A
   \   0001C5   A3           INC       DPTR
   \   0001C6   F0           MOVX      @DPTR,A
   \   0001C7   A3           INC       DPTR
   \   0001C8   F0           MOVX      @DPTR,A
   \   0001C9   A3           INC       DPTR
   \   0001CA   F0           MOVX      @DPTR,A
    929                        TCLinkKeyFrmCntr[0].rxFrmCntr = 0;
   \   0001CB   A3           INC       DPTR
   \   0001CC   F0           MOVX      @DPTR,A
   \   0001CD   A3           INC       DPTR
   \   0001CE   F0           MOVX      @DPTR,A
   \   0001CF   A3           INC       DPTR
   \   0001D0   F0           MOVX      @DPTR,A
   \   0001D1   A3           INC       DPTR
   \   0001D2   F0           MOVX      @DPTR,A
    930                        
    931                        
    932                        //reset the device parameters to FN
    933                        bdbAttributes.bdbNodeIsOnANetwork = FALSE;
   \   0001D3   90....       MOV       DPTR,#bdbAttributes + 14
   \   0001D6   F0           MOVX      @DPTR,A
    934                        osal_nv_write(ZCD_NV_BDBNODEISONANETWORK,0,sizeof(bdbAttributes.bdbNodeIsOnANetwork),&bdbAttributes.bdbNodeIsOnANetwork);
   \   0001D7                ; Setup parameters for call to function osal_nv_write
   \   0001D7   75....       MOV       ?V2,#(bdbAttributes + 14) & 0xff
   \   0001DA   75....       MOV       ?V3,#((bdbAttributes + 14) >> 8) & 0xff
   \   0001DD   78..         MOV       R0,#?V2
   \   0001DF   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0001E2   75..01       MOV       ?V2,#0x1
   \   0001E5   75..00       MOV       ?V3,#0x0
   \   0001E8   78..         MOV       R0,#?V2
   \   0001EA   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0001ED   7C00         MOV       R4,#0x0
   \   0001EF   7D00         MOV       R5,#0x0
   \   0001F1   7A55         MOV       R2,#0x55
   \   0001F3   7B00         MOV       R3,#0x0
   \   0001F5   12....       LCALL     `??osal_nv_write::?relay`; Banked call to: osal_nv_write
   \   0001F8   7404         MOV       A,#0x4
   \   0001FA   12....       LCALL     ?DEALLOC_XSTACK8
    935                        zgWriteStartupOptions(ZG_STARTUP_SET, ZCD_STARTOPT_DEFAULT_CONFIG_STATE | ZCD_STARTOPT_DEFAULT_NETWORK_STATE);
   \   0001FD                ; Setup parameters for call to function zgWriteStartupOptions
   \   0001FD   7A03         MOV       R2,#0x3
   \   0001FF   79FF         MOV       R1,#-0x1
   \   000201   12....       LCALL     `??zgWriteStartupOptions::?relay`; Banked call to: zgWriteStartupOptions
    936                        
    937                        //Then start the commissioning process requested
    938                        bdbCommissioningProcedureState.bdbCommissioningState = BDB_COMMISSIONING_STATE_START_RESUME;
   \   000204   805A         SJMP      ??bdb_StartCommissioning_8
    939                        osal_set_event( bdb_TaskID, BDB_CHANGE_COMMISSIONING_STATE );
    940                        return;
    941                      }
    942                    }
    943                  }
    944                }
    945          #endif //ZG_BUILD_JOINING_TYPE
    946                
    947                //Set the initialization
    948                bdbAttributes.bdbCommissioningMode |= BDB_COMMISSIONING_MODE_INITIALIZATION;
    949                bdbCommissioningProcedureState.bdbCommissioningState = BDB_INITIALIZATION;
   \                     ??bdb_StartCommissioning_7:
   \   000206   90....       MOV       DPTR,#bdbCommissioningProcedureState
   \   000209   7407         MOV       A,#0x7
   \   00020B   F0           MOVX      @DPTR,A
    950                bdbAttributes.bdbCommissioningMode |= mode & BDB_COMMISSIONING_MODES;
   \   00020C   7410         MOV       A,#0x10
   \   00020E   4E           ORL       A,R6
   \   00020F   F8           MOV       R0,A
   \   000210   90....       MOV       DPTR,#bdbAttributes + 11
   \   000213   E0           MOVX      A,@DPTR
   \   000214   48           ORL       A,R0
   \   000215   F0           MOVX      @DPTR,A
    951                
    952                if(ZDOInitDevice(0) == ZDO_INITDEV_RESTORED_NETWORK_STATE)
   \   000216                ; Setup parameters for call to function ZDOInitDeviceEx
   \   000216   7900         MOV       R1,#0x0
   \   000218   7A00         MOV       R2,#0x0
   \   00021A   7B00         MOV       R3,#0x0
   \   00021C   12....       LCALL     `??ZDOInitDeviceEx::?relay`; Banked call to: ZDOInitDeviceEx
   \   00021F   E9           MOV       A,R1
   \   000220   7005         JNZ       ??bdb_StartCommissioning_9
    953                {
    954          #ifdef BDB_REPORTING
    955                  //Mark the clusterEndpoint entries that have binding, starts reporting if at least one entry was marked
    956                  bdb_RepUpdateMarkBindings();
   \   000222                ; Setup parameters for call to function bdb_RepUpdateMarkBindings
   \   000222   12....       LCALL     `??bdb_RepUpdateMarkBindings::?relay`; Banked call to: bdb_RepUpdateMarkBindings
    957          #endif
    958                  return;
   \   000225   8049         SJMP      ??bdb_StartCommissioning_2
    959                }
    960                bdb_setNodeIsOnANetwork(FALSE);  
   \                     ??bdb_StartCommissioning_9:
   \   000227                ; Setup parameters for call to function bdb_setNodeIsOnANetwork
   \   000227   7900         MOV       R1,#0x0
   \   000229   12....       LCALL     `??bdb_setNodeIsOnANetwork::?relay`; Banked call to: bdb_setNodeIsOnANetwork
    961                //Not in the network
    962                bdb_reportCommissioningState(BDB_INITIALIZATION,FALSE);
   \   00022C                ; Setup parameters for call to function bdb_reportCommissioningState
   \   00022C   7A00         MOV       R2,#0x0
   \   00022E   7907         MOV       R1,#0x7
   \   000230   8029         SJMP      ??bdb_StartCommissioning_10
    963                return;
    964              }
    965            }
    966          
    967            //Got requested only to initialize, if so, report that it failed
    968            if(bdbAttributes.bdbCommissioningMode == 0)
   \                     ??bdb_StartCommissioning_4:
   \   000232   90....       MOV       DPTR,#bdbAttributes + 11
   \   000235   E0           MOVX      A,@DPTR
   \   000236   7028         JNZ       ??bdb_StartCommissioning_8
    969            {
    970              // bdbCommissioningMode
    971              uint8 debugMsg[] = "bdbCommissioningMode == 0, \r\n";
   \   000238   90....       MOV       DPTR,#`?<Constant "bdbCommissioningMode ...">`
   \   00023B   7422         MOV       A,#0x22
   \   00023D   12....       LCALL     ?XSTACK_DISP102_8
   \   000240   7433         MOV       A,#0x33
   \   000242   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    972              HalUARTWrite(0, debugMsg, sizeof(debugMsg)-1);
                     ^
Warning[Pe676]: using out-of-scope declaration of function "HalUARTWrite"
          (declared at line 895)
   \   000245                ; Setup parameters for call to function HalUARTWrite
   \   000245   7C32         MOV       R4,#0x32
   \   000247   FD           MOV       R5,A
   \   000248   7422         MOV       A,#0x22
   \   00024A   12....       LCALL     ?XSTACK_DISP101_8
   \   00024D   7900         MOV       R1,#0x0
   \   00024F   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    973              
    974              //Set the initialization state and report it to fail
    975              bdbCommissioningProcedureState.bdbCommissioningState = BDB_INITIALIZATION;
   \   000252   90....       MOV       DPTR,#bdbCommissioningProcedureState
   \   000255   7407         MOV       A,#0x7
   \   000257   F0           MOVX      @DPTR,A
    976              bdb_reportCommissioningState(BDB_INITIALIZATION,FALSE);
   \   000258                ; Setup parameters for call to function bdb_reportCommissioningState
   \   000258   7A00         MOV       R2,#0x0
   \   00025A   F9           MOV       R1,A
   \                     ??bdb_StartCommissioning_10:
   \   00025B   12....       LCALL     `??bdb_reportCommissioningState::?relay`; Banked call to: bdb_reportCommissioningState
    977              return;
   \   00025E   8010         SJMP      ??bdb_StartCommissioning_2
    978            }
    979          
    980            
    981            //Start the commissioning process
    982            bdbCommissioningProcedureState.bdbCommissioningState = BDB_COMMISSIONING_STATE_START_RESUME;
   \                     ??bdb_StartCommissioning_8:
   \   000260   90....       MOV       DPTR,#bdbCommissioningProcedureState
   \   000263   E4           CLR       A
   \   000264   F0           MOVX      @DPTR,A
    983            osal_set_event( bdb_TaskID, BDB_CHANGE_COMMISSIONING_STATE );
   \   000265                ; Setup parameters for call to function osal_set_event
   \   000265   7A04         MOV       R2,#0x4
   \   000267   FB           MOV       R3,A
   \   000268   90....       MOV       DPTR,#bdb_TaskID
   \   00026B   E0           MOVX      A,@DPTR
   \   00026C   F9           MOV       R1,A
   \   00026D   12....       LCALL     `??osal_set_event::?relay`; Banked call to: osal_set_event
    984          }
   \                     ??bdb_StartCommissioning_2:
   \   000270   7455         MOV       A,#0x55
   \   000272   02....       LJMP      ??Subroutine32_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine42_0:
   \   000000   E0           MOVX      A,@DPTR
   \   000001   FA           MOV       R2,A
   \   000002   A3           INC       DPTR
   \   000003   E0           MOVX      A,@DPTR
   \   000004   FB           MOV       R3,A
   \   000005   22           RET
    985          
    986          
    987           /*********************************************************************
    988           * @fn          bdb_NotifyCommissioningModeStart
    989           *
    990           * @brief       Notify the user about a commissioning method just started
    991           *
    992           * @param       commissioningMode
    993           *
    994           * @return      none
    995           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    996          void bdb_NotifyCommissioningModeStart(uint8 commissioningMode)
   \                     bdb_NotifyCommissioningModeStart:
    997          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV       A,#-0xa
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 3
   \   000005   74FD         MOV       A,#-0x3
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
    998            bdbCommissioningModeMsg_t bdbCommissioningModeMsg;
    999          
   1000            bdbCommissioningModeMsg.bdbCommissioningMode = commissioningMode;
   \   00000A   7401         MOV       A,#0x1
   \   00000C   12....       LCALL     ?XSTACK_DISP0_8
   \   00000F   E9           MOV       A,R1
   \   000010   12....       LCALL     ?Subroutine7 & 0xFFFF
   1001            bdbCommissioningModeMsg.bdbCommissioningStatus = BDB_COMMISSIONING_IN_PROGRESS;
   \                     ??CrossCallReturnLabel_6:
   \   000013   12....       LCALL     ?Subroutine5 & 0xFFFF
   1002            //Remaining commissioning modes are set just before the call to the application to avoid race conditions
   1003          
   1004            bdb_NotifyApp((uint8*)&bdbCommissioningModeMsg);
   \                     ??CrossCallReturnLabel_0:
   \   000016   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000019   7C03         MOV       R4,#0x3
   \   00001B   7B00         MOV       R3,#0x0
   \   00001D   7A0A         MOV       R2,#0xa
   \   00001F   90....       MOV       DPTR,#bdb_TaskID
   \   000022   E0           MOVX      A,@DPTR
   \   000023   F9           MOV       R1,A
   \   000024   12....       LCALL     `??bdb_SendMsg::?relay`; Banked call to: bdb_SendMsg
   \   000027   7402         MOV       A,#0x2
   \   000029   12....       LCALL     ?DEALLOC_XSTACK8
   1005          }
   \   00002C   7403         MOV       A,#0x3
   \   00002E   02....       LJMP      ??Subroutine40_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   F0           MOVX      @DPTR,A
   \   000001                ; Setup parameters for call to function bdb_SendMsg
   \   000001                ; Setup parameters for call to function bdb_SendMsg
   \   000001                ; Setup parameters for call to function bdb_SendMsg
   \   000001                ; Setup parameters for call to function bdb_SendMsg
   \   000001   A8..         MOV       R0,?XSP + 0
   \   000003   A9..         MOV       R1,?XSP + 1
   \   000005   88..         MOV       ?V0,R0
   \   000007   89..         MOV       ?V1,R1
   \   000009   78..         MOV       R0,#?V0
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   F0           MOVX      @DPTR,A
   \   000001   85..82       MOV       DPL,?XSP + 0
   \   000004   85..83       MOV       DPH,?XSP + 1
   \   000007   7401         MOV       A,#0x1
   \   000009   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine40_0:
   \   000000   12....       LCALL     ?DEALLOC_XSTACK8
   \   000003                REQUIRE ??Subroutine41_0
   \   000003                ; // Fall through to label ??Subroutine41_0
   1006          
   1007          
   1008          
   1009          #if (ZG_BUILD_JOINING_TYPE)
   1010           /*********************************************************************
   1011           * @fn          bdb_setNodeJoinLinkKeyType
   1012           *
   1013           * @brief       Set the key type in use in the network joined. Global centralized key is used by default
   1014           *
   1015           * @param       none
   1016           *
   1017           * @return      none
   1018           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1019          void bdb_setNodeJoinLinkKeyType(uint8 KeyType)
   \                     bdb_setNodeJoinLinkKeyType:
   1020          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1021            bdbAttributes.bdbNodeJoinLinkKeyType = KeyType;
   \   000004   E9           MOV       A,R1
   \   000005   90....       MOV       DPTR,#bdbAttributes + 15
   \   000008   02....       LJMP      ??Subroutine30_0 & 0xFFFF
   1022          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine30_0:
   \   000000   F0           MOVX      @DPTR,A
   \   000001                REQUIRE ??Subroutine31_0
   \   000001                ; // Fall through to label ??Subroutine31_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine31_0:
   \   000000   D083         POP       DPH
   \   000002   D082         POP       DPL
   \   000004   02....       LJMP      ?BRET
   1023          #endif
   1024          
   1025           /*********************************************************************
   1026           * @fn          bdb_setFN
   1027           *
   1028           * @brief       Set configuration for FN. This FN configuration will be perfome 
   1029           *              upon call to ZDOInitDevice
   1030           *
   1031           * @param       none
   1032           *
   1033           * @return      none
   1034           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1035          void bdb_setFN(void)
   \                     bdb_setFN:
   1036          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1037            bdb_setNodeIsOnANetwork(FALSE);
   \   000004                ; Setup parameters for call to function bdb_setNodeIsOnANetwork
   \   000004   7900         MOV       R1,#0x0
   \   000006   12....       LCALL     `??bdb_setNodeIsOnANetwork::?relay`; Banked call to: bdb_setNodeIsOnANetwork
   1038          
   1039          #if defined ( INTER_PAN ) && defined ( BDB_TL_INITIATOR )
   1040              touchLink_InitFreeRanges( TRUE );
   1041              touchLink_UpdateNV( TOUCHLINK_UPDATE_NV_RANGES );
   1042          #endif
   1043          #if defined ( INTER_PAN ) && defined ( BDB_TL_TARGET ) 
   1044              touchLink_InitFreeRanges( FALSE );
   1045              touchLink_UpdateNV( TOUCHLINK_UPDATE_NV_RANGES );
   1046          #endif
   1047          
   1048            //Set the device as factory new
   1049            zgWriteStartupOptions(ZG_STARTUP_SET, ZCD_STARTOPT_DEFAULT_CONFIG_STATE | ZCD_STARTOPT_DEFAULT_NETWORK_STATE);
   \   000009                ; Setup parameters for call to function zgWriteStartupOptions
   \   000009   7A03         MOV       R2,#0x3
   \   00000B   79FF         MOV       R1,#-0x1
   \   00000D   12....       LCALL     `??zgWriteStartupOptions::?relay`; Banked call to: zgWriteStartupOptions
   1050          }
   \   000010   02....       LJMP      ??Subroutine31_0 & 0xFFFF
   1051          
   1052           /*********************************************************************
   1053           * @fn          bdb_resetLocalAction
   1054           *
   1055           * @brief       Application interface to perform BDB Reset to FN.
   1056           *
   1057           * @param       none
   1058           *
   1059           * @return      none
   1060           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1061          void bdb_resetLocalAction(void)
   \                     bdb_resetLocalAction:
   1062          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 5
   \   000004   74FB         MOV       A,#-0x5
   \   000006   12....       LCALL     ?ALLOC_XSTACK8
   1063            //Process reset as nwk leave if the device is on the network and is able to process it
   1064            if((ZG_BUILD_JOINING_TYPE) && (bdbAttributes.bdbNodeIsOnANetwork) && (!(bdbAttributes.bdbCommissioningMode & BDB_COMMISSIONING_MODE_PARENT_LOST)))
   \   000009   90....       MOV       DPTR,#bdbAttributes + 14
   \   00000C   E0           MOVX      A,@DPTR
   \   00000D   6021         JZ        ??bdb_resetLocalAction_0
   \   00000F   90....       MOV       DPTR,#bdbAttributes + 11
   \   000012   E0           MOVX      A,@DPTR
   \   000013   A2E5         MOV       C,0xE0 /* A   */.5
   \   000015   4019         JC        ??bdb_resetLocalAction_0
   1065            {
   1066              NLME_LeaveReq_t leaveReq;
   1067              // Set every field to 0
   1068              osal_memset( &leaveReq, 0, sizeof( NLME_LeaveReq_t ) );
   \   000017                ; Setup parameters for call to function osal_memset
   \   000017   7C05         MOV       R4,#0x5
   \   000019   7D00         MOV       R5,#0x0
   \   00001B   7900         MOV       R1,#0x0
   \   00001D   AA..         MOV       R2,?XSP + 0
   \   00001F   AB..         MOV       R3,?XSP + 1
   \   000021   12....       LCALL     `??osal_memset::?relay`; Banked call to: osal_memset
   1069              
   1070              bdb_setFN();
   \   000024                ; Setup parameters for call to function bdb_setFN
   \   000024   12....       LCALL     `??bdb_setFN::?relay`; Banked call to: bdb_setFN
   1071                
   1072              NLME_LeaveReq( &leaveReq );
   \   000027                ; Setup parameters for call to function NLME_LeaveReq
   \   000027   AA..         MOV       R2,?XSP + 0
   \   000029   AB..         MOV       R3,?XSP + 1
   \   00002B   12....       LCALL     `??NLME_LeaveReq::?relay`; Banked call to: NLME_LeaveReq
   1073              
   1074              return;
   \   00002E   800A         SJMP      ??bdb_resetLocalAction_1
   1075            }
   1076            else
   1077            {
   1078              bdb_setFN();
   \                     ??bdb_resetLocalAction_0:
   \   000030                ; Setup parameters for call to function bdb_setFN
   \   000030   12....       LCALL     `??bdb_setFN::?relay`; Banked call to: bdb_setFN
   1079              
   1080              ZDApp_ResetTimerStart( 500 );
   \   000033                ; Setup parameters for call to function ZDApp_ResetTimerStart
   \   000033   7AF4         MOV       R2,#-0xc
   \   000035   7B01         MOV       R3,#0x1
   \   000037   12....       LCALL     `??ZDApp_ResetTimerStart::?relay`; Banked call to: ZDApp_ResetTimerStart
   1081            }
   1082          }
   \                     ??bdb_resetLocalAction_1:
   \   00003A   7405         MOV       A,#0x5
   \   00003C   02....       LJMP      ?Subroutine4 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   12....       LCALL     ?DEALLOC_XSTACK8
   \   000003   02....       LJMP      ??Subroutine31_0 & 0xFFFF
   1083          
   1084          
   1085           /*********************************************************************
   1086           * @fn          bdb_parentLost
   1087           *
   1088           * @brief       Notify bdb that connection with parent is lost
   1089           *
   1090           * @return      none
   1091           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1092          void bdb_parentLost(void)
   \                     bdb_parentLost:
   1093          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 1
   \   000004   74FF         MOV       A,#-0x1
   \   000006   12....       LCALL     ?ALLOC_XSTACK8
   1094          #if ZG_BUILD_ENDDEVICE_TYPE
   1095            if(ZG_DEVICE_ENDDEVICE_TYPE)
   \   000009   8006         SJMP      ??bdb_parentLost_0
   1096            {
   1097              while(pBDBListNwk)
   1098              {
   1099                bdb_nwkDescFree(pBDBListNwk);
   \                     ??bdb_parentLost_1:
   \   00000B                ; Setup parameters for call to function bdb_nwkDescFree
   \   00000B   12....       LCALL     ?Subroutine15 & 0xFFFF
   1100              }
   \                     ??CrossCallReturnLabel_100:
   \   00000E   12....       LCALL     `??bdb_nwkDescFree::?relay`; Banked call to: bdb_nwkDescFree
   \                     ??bdb_parentLost_0:
   \   000011   90....       MOV       DPTR,#pBDBListNwk
   \   000014   12....       LCALL     ??Subroutine36_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_72:
   \   000017   70F2         JNZ       ??bdb_parentLost_1
   1101              
   1102              nwk_desc_list_free();  
   \   000019                ; Setup parameters for call to function nwk_desc_list_free
   \   000019   12....       LCALL     `??nwk_desc_list_free::?relay`; Banked call to: nwk_desc_list_free
   1103              if(bdbCommissioningProcedureState.bdbCommissioningState != BDB_PARENT_LOST)
   \   00001C   90....       MOV       DPTR,#bdbCommissioningProcedureState
   \   00001F   E0           MOVX      A,@DPTR
   \   000020   6408         XRL       A,#0x8
   \   000022   6010         JZ        ??bdb_parentLost_2
   1104              {
   1105                //If parent lost during TCLK exchange, then report TCLK exchange fail
   1106                if(bdbCommissioningProcedureState.bdbCommissioningState == BDB_COMMISSIONING_STATE_TC_LINK_KEY_EXCHANGE)
   \   000024   E0           MOVX      A,@DPTR
   \   000025   6401         XRL       A,#0x1
   \   000027   7006         JNZ       ??bdb_parentLost_3
   1107                {
   1108                  bdb_reportCommissioningState(BDB_COMMISSIONING_STATE_TC_LINK_KEY_EXCHANGE, FALSE);
   \   000029                ; Setup parameters for call to function bdb_reportCommissioningState
   \   000029   7A00         MOV       R2,#0x0
   \   00002B   7901         MOV       R1,#0x1
   \   00002D   8028         SJMP      ??bdb_parentLost_4
   1109                  return;
   1110                }
   1111                bdbCommissioningProcedureState.bdb_ParentLostSavedState = bdbCommissioningProcedureState.bdbCommissioningState;
   \                     ??bdb_parentLost_3:
   \   00002F   E0           MOVX      A,@DPTR
   \   000030   90....       MOV       DPTR,#bdbCommissioningProcedureState + 3
   \   000033   F0           MOVX      @DPTR,A
   1112                
   1113              }
   1114              bdbCommissioningProcedureState.bdbCommissioningState = BDB_PARENT_LOST;
   \                     ??bdb_parentLost_2:
   \   000034   90....       MOV       DPTR,#bdbCommissioningProcedureState
   \   000037   7408         MOV       A,#0x8
   \   000039   F0           MOVX      @DPTR,A
   1115              NLME_OrphanStateSet();
   \   00003A                ; Setup parameters for call to function NLME_OrphanStateSet
   \   00003A   12....       LCALL     `??NLME_OrphanStateSet::?relay`; Banked call to: NLME_OrphanStateSet
   1116              ZDApp_ChangeState( DEV_NWK_ORPHAN );
   \   00003D                ; Setup parameters for call to function ZDApp_ChangeState
   \   00003D   790A         MOV       R1,#0xa
   \   00003F   12....       LCALL     `??ZDApp_ChangeState::?relay`; Banked call to: ZDApp_ChangeState
   1117              
   1118              // turn receiver off while in orphan state
   1119              byte temp = FALSE;
   \   000042   85..82       MOV       DPL,?XSP + 0
   \   000045   85..83       MOV       DPH,?XSP + 1
   \   000048   E4           CLR       A
   \   000049   F0           MOVX      @DPTR,A
   1120              ZMacSetReq(ZMacRxOnIdle, &temp);
   \   00004A                ; Setup parameters for call to function ZMacSetReq
   \   00004A   AA..         MOV       R2,?XSP + 0
   \   00004C   AB..         MOV       R3,?XSP + 1
   \   00004E   7952         MOV       R1,#0x52
   \   000050   12....       LCALL     `??ZMacSetReq::?relay`; Banked call to: ZMacSetReq
   1121              
   1122              bdb_reportCommissioningState(BDB_PARENT_LOST,FALSE);
   \   000053                ; Setup parameters for call to function bdb_reportCommissioningState
   \   000053   7A00         MOV       R2,#0x0
   \   000055   7908         MOV       R1,#0x8
   \                     ??bdb_parentLost_4:
   \   000057   12....       LCALL     `??bdb_reportCommissioningState::?relay`; Banked call to: bdb_reportCommissioningState
   1123            }
   1124          #endif
   1125          }
   \   00005A   7401         MOV       A,#0x1
   \   00005C   02....       LJMP      ?Subroutine4 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine15:
   \   000000   90....       MOV       DPTR,#pBDBListNwk
   \   000003                REQUIRE ??Subroutine42_0
   \   000003                ; // Fall through to label ??Subroutine42_0
   1126          
   1127          
   1128          
   1129          
   1130          
   1131           /*********************************************************************
   1132           * @fn          bdb_NetworkRestoredResumeState
   1133           *
   1134           * @brief       Restore the state of child device after parent lost
   1135           *
   1136           * @return      none
   1137           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1138          void bdb_NetworkRestoredResumeState(void)
   \                     bdb_NetworkRestoredResumeState:
   1139          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1140          #if (BDB_FINDING_BINDING_CAPABILITY_ENABLED==1)   
   1141          #if ZG_BUILD_ENDDEVICE_TYPE
   1142            if(ZG_DEVICE_ENDDEVICE_TYPE)
   1143            {
   1144              uint8 restoreSimpleDesc = FALSE;
   \   000004   7A00         MOV       R2,#0x0
   1145              //If restored when F&B still enabled, then restore the simple descriptors attempts
   1146              if(bdbCommissioningProcedureState.bdbCommissioningState == BDB_COMMISSIONING_STATE_FINDING_BINDING)
   \   000006   90....       MOV       DPTR,#bdbCommissioningProcedureState
   \   000009   E0           MOVX      A,@DPTR
   \   00000A   6406         XRL       A,#0x6
   \   00000C   7046         JNZ       ??bdb_NetworkRestoredResumeState_0
   1147              {
   1148                bdbFindingBindingRespondent_t  *pRespondentTemp = NULL;
   1149                
   1150                pRespondentTemp = pRespondentHead;
   \   00000E   90....       MOV       DPTR,#pRespondentHead
   \   000011   12....       LCALL     ?Subroutine20 & 0xFFFF
   \                     ??CrossCallReturnLabel_31:
   \   000014   EC           MOV       A,R4
   \   000015   F8           MOV       R0,A
   \   000016   ED           MOV       A,R5
   \   000017   801A         SJMP      ??bdb_NetworkRestoredResumeState_1
   1151                
   1152                while(pRespondentTemp != NULL)
   1153                {
   1154                  if(pRespondentTemp->attempts & FINDING_AND_BINDING_PARENT_LOST)
   \                     ??bdb_NetworkRestoredResumeState_2:
   \   000019   E8           MOV       A,R0
   \   00001A   240C         ADD       A,#0xc
   \   00001C   F582         MOV       DPL,A
   \   00001E   E4           CLR       A
   \   00001F   39           ADDC      A,R1
   \   000020   F583         MOV       DPH,A
   \   000022   E0           MOVX      A,@DPTR
   \   000023   A2E6         MOV       C,0xE0 /* A   */.6
   \   000025   5005         JNC       ??bdb_NetworkRestoredResumeState_3
   1155                  {
   1156                    pRespondentTemp->attempts &= ~FINDING_AND_BINDING_PARENT_LOST;
   \   000027   C2E6         CLR       0xE0 /* A   */.6
   \   000029   F0           MOVX      @DPTR,A
   1157                    restoreSimpleDesc = TRUE;
   \   00002A   7A01         MOV       R2,#0x1
   1158                  }
   1159                  pRespondentTemp = pRespondentTemp->pNext;
   \                     ??bdb_NetworkRestoredResumeState_3:
   \   00002C   12....       LCALL     ?Subroutine28 & 0xFFFF
   1160                }
   \                     ??CrossCallReturnLabel_53:
   \   00002F   E0           MOVX      A,@DPTR
   \   000030   F8           MOV       R0,A
   \   000031   A3           INC       DPTR
   \   000032   E0           MOVX      A,@DPTR
   \                     ??bdb_NetworkRestoredResumeState_1:
   \   000033   F9           MOV       R1,A
   \   000034   E8           MOV       A,R0
   \   000035   49           ORL       A,R1
   \   000036   70E1         JNZ       ??bdb_NetworkRestoredResumeState_2
   1161              }
   1162              if(restoreSimpleDesc)
   \   000038   EA           MOV       A,R2
   \   000039   A2E0         MOV       C,0xE0 /* A   */.0
   \   00003B   5017         JNC       ??bdb_NetworkRestoredResumeState_0
   1163              {
   1164                //Restore the simple Descriptor sending after 1 second of restoring the network
   1165                osal_start_timerEx(bdb_TaskID,BDB_RESPONDENT_PROCESS_TIMEOUT, 1000);
   \   00003D                ; Setup parameters for call to function osal_start_timerEx
   \   00003D   90....       MOV       DPTR,#__Constant_3e8
   \   000040   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   000043   7A00         MOV       R2,#0x0
   \   000045   7B40         MOV       R3,#0x40
   \   000047   90....       MOV       DPTR,#bdb_TaskID
   \   00004A   E0           MOVX      A,@DPTR
   \   00004B   F9           MOV       R1,A
   \   00004C   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   00004F   7404         MOV       A,#0x4
   \   000051   12....       LCALL     ?DEALLOC_XSTACK8
   1166              }
   1167            }
   1168          #endif
   1169          #endif
   1170          }
   \                     ??bdb_NetworkRestoredResumeState_0:
   \   000054   80..         SJMP      ??Subroutine31_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine28:
   \   000000   E8           MOV       A,R0
   \   000001   240F         ADD       A,#0xf
   \   000003   F582         MOV       DPL,A
   \   000005   E4           CLR       A
   \   000006   39           ADDC      A,R1
   \   000007   F583         MOV       DPH,A
   \   000009   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine20:
   \   000000   E0           MOVX      A,@DPTR
   \   000001   FC           MOV       R4,A
   \   000002   A3           INC       DPTR
   \   000003   E0           MOVX      A,@DPTR
   \   000004   FD           MOV       R5,A
   \   000005   22           RET
   1171          
   1172          #if ZG_BUILD_ENDDEVICE_TYPE
   1173           /*********************************************************************
   1174           * @fn          bdb_ZedAttemptRecoverNwk
   1175           *
   1176           * @brief       Instruct the ZED to try to rejoin its previews network
   1177           *
   1178           * @return      success if the attempt is being excecuted
   1179           *              False if device do not have nwk parameters to perform this action
   1180           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1181          uint8 bdb_ZedAttemptRecoverNwk(void)
   \                     bdb_ZedAttemptRecoverNwk:
   1182          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1183            if(ZG_DEVICE_ENDDEVICE_TYPE)
   1184            {
   1185              if(bdbAttributes.bdbNodeIsOnANetwork)
   \   000004   90....       MOV       DPTR,#bdbAttributes + 14
   \   000007   E0           MOVX      A,@DPTR
   \   000008   6018         JZ        ??bdb_ZedAttemptRecoverNwk_0
   1186              {
   1187                if(bdbCommissioningProcedureState.bdbCommissioningState == BDB_PARENT_LOST)
   \   00000A   90....       MOV       DPTR,#bdbCommissioningProcedureState
   \   00000D   E0           MOVX      A,@DPTR
   \   00000E   6408         XRL       A,#0x8
   \   000010   7010         JNZ       ??bdb_ZedAttemptRecoverNwk_0
   1188                {
   1189                  if(ZDOInitDevice(0) == ZDO_INITDEV_RESTORED_NETWORK_STATE)
   \   000012                ; Setup parameters for call to function ZDOInitDeviceEx
   \   000012   7900         MOV       R1,#0x0
   \   000014   7A00         MOV       R2,#0x0
   \   000016   7B00         MOV       R3,#0x0
   \   000018   12....       LCALL     `??ZDOInitDeviceEx::?relay`; Banked call to: ZDOInitDeviceEx
   \   00001B   E9           MOV       A,R1
   \   00001C   7004         JNZ       ??bdb_ZedAttemptRecoverNwk_0
   1190                  {
   1191                    return ZSuccess;
   \   00001E   7900         MOV       R1,#0x0
   \   000020   8002         SJMP      ??bdb_ZedAttemptRecoverNwk_1
   1192                  }
   1193                }
   1194              }
   1195            }
   1196            return ZFailure;
   \                     ??bdb_ZedAttemptRecoverNwk_0:
   \   000022   7901         MOV       R1,#0x1
   \                     ??bdb_ZedAttemptRecoverNwk_1:
   \   000024   80..         SJMP      ??Subroutine31_0
   1197          }
   1198          
   1199          #endif
   1200          
   1201           /*********************************************************************
   1202           * @fn          bdb_reportCommissioningState
   1203           *
   1204           * @brief       Process the result of a BDB main state attempt.
   1205           *
   1206           * @param       bdbCommissioningState - MainState that is issuing fail
   1207           * @param       didSuccess - TRUE if the main state were success, FALSE otherwise
   1208           *
   1209           * @return      none
   1210           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1211          void bdb_reportCommissioningState(uint8 bdbCommissioningState,bool didSuccess)
   \                     bdb_reportCommissioningState:
   1212          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV       A,#-0xa
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 4
   \   000005   74FC         MOV       A,#-0x4
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   \   00000A   E9           MOV       A,R1
   \   00000B   FE           MOV       R6,A
   \   00000C   EA           MOV       A,R2
   \   00000D   FF           MOV       R7,A
   1213            bdbCommissioningModeMsg_t bdbCommissioningModeMsg;
   1214            //Process only if we are in that state, or if we are on parent lost and processing F&B
   1215            if((bdbCommissioningProcedureState.bdbCommissioningState == bdbCommissioningState)
   1216               || ((bdbCommissioningProcedureState.bdbCommissioningState == BDB_PARENT_LOST) && (bdbCommissioningProcedureState.bdb_ParentLostSavedState == BDB_COMMISSIONING_STATE_FINDING_BINDING)))
   \   00000E   90....       MOV       DPTR,#bdbCommissioningProcedureState
   \   000011   E0           MOVX      A,@DPTR
   \   000012   6E           XRL       A,R6
   \   000013   6013         JZ        ??bdb_reportCommissioningState_0
   \   000015   E0           MOVX      A,@DPTR
   \   000016   6408         XRL       A,#0x8
   \   000018   6003         JZ        $+5
   \   00001A   02....       LJMP      ??bdb_reportCommissioningState_1 & 0xFFFF
   \   00001D   90....       MOV       DPTR,#bdbCommissioningProcedureState + 3
   \   000020   E0           MOVX      A,@DPTR
   \   000021   6406         XRL       A,#0x6
   \   000023   6003         JZ        $+5
   \   000025   02....       LJMP      ??bdb_reportCommissioningState_1 & 0xFFFF
   1217            {
   1218              switch(bdbCommissioningState)
   \                     ??bdb_reportCommissioningState_0:
   \   000028   EE           MOV       A,R6
   \   000029   14           DEC       A
   \   00002A   7003         JNZ       $+5
   \   00002C   02....       LJMP      ??bdb_reportCommissioningState_2 & 0xFFFF
   \   00002F   14           DEC       A
   \   000030   7003         JNZ       $+5
   \   000032   02....       LJMP      ??bdb_reportCommissioningState_3 & 0xFFFF
   \   000035   14           DEC       A
   \   000036   6021         JZ        ??bdb_reportCommissioningState_4
   \   000038   14           DEC       A
   \   000039   7003         JNZ       $+5
   \   00003B   02....       LJMP      ??bdb_reportCommissioningState_5 & 0xFFFF
   \   00003E   14           DEC       A
   \   00003F   7003         JNZ       $+5
   \   000041   02....       LJMP      ??bdb_reportCommissioningState_6 & 0xFFFF
   \   000044   14           DEC       A
   \   000045   7003         JNZ       $+5
   \   000047   02....       LJMP      ??bdb_reportCommissioningState_7 & 0xFFFF
   \   00004A   14           DEC       A
   \   00004B   7003         JNZ       $+5
   \   00004D   02....       LJMP      ??bdb_reportCommissioningState_8 & 0xFFFF
   \   000050   14           DEC       A
   \   000051   7003         JNZ       $+5
   \   000053   02....       LJMP      ??bdb_reportCommissioningState_9 & 0xFFFF
   \   000056   02....       LJMP      ??bdb_reportCommissioningState_10 & 0xFFFF
   1219              {
   1220          #if (ZG_BUILD_JOINING_TYPE)
   1221                case BDB_COMMISSIONING_STATE_JOINING:
   1222                  if(ZG_DEVICE_JOINING_TYPE)
   \                     ??bdb_reportCommissioningState_4:
   \   000059   90....       MOV       DPTR,#zgDeviceLogicalType
   \   00005C   E0           MOVX      A,@DPTR
   \   00005D   6401         XRL       A,#0x1
   \   00005F   6008         JZ        ??bdb_reportCommissioningState_11
   \   000061   E0           MOVX      A,@DPTR
   \   000062   6402         XRL       A,#0x2
   \   000064   6003         JZ        $+5
   \   000066   02....       LJMP      ??bdb_reportCommissioningState_10 & 0xFFFF
   1223                  {
   1224                    //Prepare for the next state or commissioning mode to be excecuted
   1225                    osal_start_timerEx(bdb_TaskID,BDB_CHANGE_COMMISSIONING_STATE,50);
   \                     ??bdb_reportCommissioningState_11:
   \   000069                ; Setup parameters for call to function osal_start_timerEx
   \   000069   90....       MOV       DPTR,#__Constant_32
   \   00006C   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   00006F   7A04         MOV       R2,#0x4
   \   000071   7B00         MOV       R3,#0x0
   \   000073   90....       MOV       DPTR,#bdb_TaskID
   \   000076   E0           MOVX      A,@DPTR
   \   000077   F9           MOV       R1,A
   \   000078   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   00007B   7404         MOV       A,#0x4
   \   00007D   12....       LCALL     ?DEALLOC_XSTACK8
   1226          
   1227                    if(didSuccess)
   \   000080   EF           MOV       A,R7
   \   000081   6022         JZ        ??bdb_reportCommissioningState_12
   1228                    {
   1229                      //Next state is TC link key exchange
   1230                      bdbCommissioningProcedureState.bdbCommissioningState = BDB_COMMISSIONING_STATE_TC_LINK_KEY_EXCHANGE;
   \   000083   90....       MOV       DPTR,#bdbCommissioningProcedureState
   \   000086   7401         MOV       A,#0x1
   \   000088   F0           MOVX      @DPTR,A
   \   000089   8006         SJMP      ??bdb_reportCommissioningState_13
   1231                      //Free the list of nwk discovered
   1232                      while(pBDBListNwk)
   1233                      {
   1234                        bdb_nwkDescFree(pBDBListNwk);
   \                     ??bdb_reportCommissioningState_14:
   \   00008B                ; Setup parameters for call to function bdb_nwkDescFree
   \   00008B   12....       LCALL     ?Subroutine15 & 0xFFFF
   1235                      }
   \                     ??CrossCallReturnLabel_101:
   \   00008E   12....       LCALL     `??bdb_nwkDescFree::?relay`; Banked call to: bdb_nwkDescFree
   \                     ??bdb_reportCommissioningState_13:
   \   000091   90....       MOV       DPTR,#pBDBListNwk
   \   000094   12....       LCALL     ??Subroutine36_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_73:
   \   000097   70F2         JNZ       ??bdb_reportCommissioningState_14
   1236                      
   1237                      //Set the poll rate of the ZED joining device to 1 second to allow TCLK 
   1238                      //exchange be perfomed successfully in cases in which application has a 
   1239                      //slow pollrate
   1240                      NLME_SetPollRate(TCLK_POLL_RATE);
   \   000099                ; Setup parameters for call to function NLME_SetPollRate
   \   000099   90....       MOV       DPTR,#__Constant_3e8
   \   00009C   12....       LCALL     ?XLOAD_R2345
   \   00009F   12....       LCALL     `??NLME_SetPollRate::?relay`; Banked call to: NLME_SetPollRate
   1241                      
   1242                      //No notification in this step
   1243                      return;
   \   0000A2   02....       LJMP      ??bdb_reportCommissioningState_1 & 0xFFFF
   1244                    } 
   1245                    else
   1246                    {
   1247                      uint8 temp = FALSE;
   \                     ??bdb_reportCommissioningState_12:
   \   0000A5   7403         MOV       A,#0x3
   \   0000A7   12....       LCALL     ?XSTACK_DISP0_8
   \   0000AA   E4           CLR       A
   \   0000AB   F0           MOVX      @DPTR,A
   1248                      //If fail, then restore poll rate
   1249                      NLME_SetPollRate(POLL_RATE);
   \   0000AC                ; Setup parameters for call to function NLME_SetPollRate
   \   0000AC   90....       MOV       DPTR,#__Constant_3e8
   \   0000AF   12....       LCALL     ?XLOAD_R2345
   \   0000B2   12....       LCALL     `??NLME_SetPollRate::?relay`; Banked call to: NLME_SetPollRate
   1250                      bdbAttributes.bdbCommissioningStatus = BDB_COMMISSIONING_NO_NETWORK;
   \   0000B5   90....       MOV       DPTR,#bdbAttributes + 10
   \   0000B8   7402         MOV       A,#0x2
   \   0000BA   F0           MOVX      @DPTR,A
   1251                      bdbCommissioningModeMsg.bdbCommissioningMode = BDB_COMMISSIONING_NWK_STEERING;
   \   0000BB   14           DEC       A
   \   0000BC   12....       LCALL     ?XSTACK_DISP0_8
   \   0000BF   7401         MOV       A,#0x1
   \   0000C1   F0           MOVX      @DPTR,A
   1252                      bdbCommissioningProcedureState.bdbCommissioningState = BDB_COMMISSIONING_STATE_START_RESUME;
   \   0000C2   90....       MOV       DPTR,#bdbCommissioningProcedureState
   \   0000C5   E4           CLR       A
   \   0000C6   F0           MOVX      @DPTR,A
   1253                      bdbAttributes.bdbCommissioningMode &= ~BDB_COMMISSIONING_MODE_NWK_STEERING;
   \   0000C7   90....       MOV       DPTR,#bdbAttributes + 11
   \   0000CA   E0           MOVX      A,@DPTR
   \   0000CB   C2E1         CLR       0xE0 /* A   */.1
   \   0000CD   F0           MOVX      @DPTR,A
   1254                      
   1255                      //Turn off the radio
   1256                      ZMacSetReq(ZMacRxOnIdle, &temp);
   \   0000CE                ; Setup parameters for call to function ZMacSetReq
   \   0000CE   7403         MOV       A,#0x3
   \   0000D0   12....       LCALL     ?XSTACK_DISP101_8
   \   0000D3   7952         MOV       R1,#0x52
   \   0000D5   12....       LCALL     `??ZMacSetReq::?relay`; Banked call to: ZMacSetReq
   1257                      //Set the device to FN, to start as new for subsequent attempts
   1258                      bdb_setFN();
   \   0000D8                ; Setup parameters for call to function bdb_setFN
   \   0000D8   12....       LCALL     `??bdb_setFN::?relay`; Banked call to: bdb_setFN
   1259                      NLME_ResetRequest();
   \   0000DB                ; Setup parameters for call to function NLME_ResetRequest
   \   0000DB   12....       LCALL     `??NLME_ResetRequest::?relay`; Banked call to: NLME_ResetRequest
   1260                      ZDApp_ChangeState( DEV_HOLD );
   \   0000DE                ; Setup parameters for call to function ZDApp_ChangeState
   \   0000DE   7900         MOV       R1,#0x0
   \   0000E0   12....       LCALL     `??ZDApp_ChangeState::?relay`; Banked call to: ZDApp_ChangeState
   1261                      
   1262                      //Free the list of nwk discovered
   1263                      while(pBDBListNwk)
   \                     ??bdb_reportCommissioningState_15:
   \   0000E3   90....       MOV       DPTR,#pBDBListNwk
   \   0000E6   12....       LCALL     ??Subroutine36_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_74:
   \   0000E9   7003         JNZ       $+5
   \   0000EB   02....       LJMP      ??bdb_reportCommissioningState_10 & 0xFFFF
   1264                      {
   1265                        bdb_nwkDescFree(pBDBListNwk);
   \   0000EE                ; Setup parameters for call to function bdb_nwkDescFree
   \   0000EE   12....       LCALL     ?Subroutine15 & 0xFFFF
   1266                      }
   1267                    }
   1268                  }
   \                     ??CrossCallReturnLabel_102:
   \   0000F1   12....       LCALL     `??bdb_nwkDescFree::?relay`; Banked call to: bdb_nwkDescFree
   \   0000F4   80ED         SJMP      ??bdb_reportCommissioningState_15
   1269                break;
   1270          
   1271                case BDB_COMMISSIONING_STATE_TC_LINK_KEY_EXCHANGE:
   1272                  if(ZG_DEVICE_JOINING_TYPE)
   \                     ??bdb_reportCommissioningState_2:
   \   0000F6   90....       MOV       DPTR,#zgDeviceLogicalType
   \   0000F9   E0           MOVX      A,@DPTR
   \   0000FA   6401         XRL       A,#0x1
   \   0000FC   6008         JZ        ??bdb_reportCommissioningState_16
   \   0000FE   E0           MOVX      A,@DPTR
   \   0000FF   6402         XRL       A,#0x2
   \   000101   6003         JZ        $+5
   \   000103   02....       LJMP      ??bdb_reportCommissioningState_10 & 0xFFFF
   1273                  {
   1274                    if(didSuccess)
   \                     ??bdb_reportCommissioningState_16:
   \   000106   EF           MOV       A,R7
   \   000107   603B         JZ        ??bdb_reportCommissioningState_17
   1275                    {
   1276                      //Clear any setting that would set the device as FN
   1277                      zgWriteStartupOptions(ZG_STARTUP_CLEAR, ZCD_STARTOPT_DEFAULT_CONFIG_STATE | ZCD_STARTOPT_DEFAULT_NETWORK_STATE);            
   \   000109                ; Setup parameters for call to function zgWriteStartupOptions
   \   000109   7A03         MOV       R2,#0x3
   \   00010B   7900         MOV       R1,#0x0
   \   00010D   12....       LCALL     `??zgWriteStartupOptions::?relay`; Banked call to: zgWriteStartupOptions
   1278                      
   1279                      //Next state is nwk steering on the nwk (permit joining)
   1280                      bdbCommissioningProcedureState.bdbCommissioningState = BDB_COMMISSIONING_STATE_STEERING_ON_NWK;
   \   000110   90....       MOV       DPTR,#bdbCommissioningProcedureState
   \   000113   7404         MOV       A,#0x4
   \   000115   12....       LCALL     ??Subroutine39_0 & 0xFFFF
   1281                      osal_start_timerEx(bdb_TaskID,BDB_CHANGE_COMMISSIONING_STATE, 50);
   \                     ??CrossCallReturnLabel_91:
   \   000118   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   00011B   7A04         MOV       R2,#0x4
   \   00011D   7B00         MOV       R3,#0x0
   \   00011F   90....       MOV       DPTR,#bdb_TaskID
   \   000122   E0           MOVX      A,@DPTR
   \   000123   F9           MOV       R1,A
   \   000124   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   000127   7404         MOV       A,#0x4
   \   000129   12....       LCALL     ?DEALLOC_XSTACK8
   1282                      
   1283                      //Set the poll rate to the application default after TCLK success
   1284                      NLME_SetPollRate(POLL_RATE);
   \   00012C                ; Setup parameters for call to function NLME_SetPollRate
   \   00012C   90....       MOV       DPTR,#__Constant_3e8
   \   00012F   12....       LCALL     ?XLOAD_R2345
   \   000132   12....       LCALL     `??NLME_SetPollRate::?relay`; Banked call to: NLME_SetPollRate
   1285          
   1286                      osal_stop_timerEx( bdb_TaskID, BDB_PROCESS_TIMEOUT );
   \   000135                ; Setup parameters for call to function osal_stop_timerEx
   \   000135   7A00         MOV       R2,#0x0
   \   000137   7B10         MOV       R3,#0x10
   \   000139   90....       MOV       DPTR,#bdb_TaskID
   \   00013C   E0           MOVX      A,@DPTR
   \   00013D   F9           MOV       R1,A
   \   00013E   12....       LCALL     `??osal_stop_timerEx::?relay`; Banked call to: osal_stop_timerEx
   1287                      //No notification to the user is needed
   1288                      return;
   \   000141   02....       LJMP      ??bdb_reportCommissioningState_1 & 0xFFFF
   1289                    }
   1290                    else
   1291                    {
   1292                      bdbCommissioningModeMsg.bdbCommissioningMode = BDB_COMMISSIONING_NWK_STEERING;
   \                     ??bdb_reportCommissioningState_17:
   \   000144   7401         MOV       A,#0x1
   \   000146   12....       LCALL     ?XSTACK_DISP0_8
   \   000149   7401         MOV       A,#0x1
   \   00014B   F0           MOVX      @DPTR,A
   1293                      bdbAttributes.bdbCommissioningStatus = BDB_COMMISSIONING_TCLK_EX_FAILURE;
   \   00014C   90....       MOV       DPTR,#bdbAttributes + 10
   \   00014F   7407         MOV       A,#0x7
   \   000151   F0           MOVX      @DPTR,A
   1294                      
   1295                      osal_stop_timerEx( bdb_TaskID, BDB_PROCESS_TIMEOUT);
   \   000152                ; Setup parameters for call to function osal_stop_timerEx
   \   000152   7A00         MOV       R2,#0x0
   \   000154   7B10         MOV       R3,#0x10
   \   000156   90....       MOV       DPTR,#bdb_TaskID
   \   000159   E0           MOVX      A,@DPTR
   \   00015A   F9           MOV       R1,A
   \   00015B   12....       LCALL     `??osal_stop_timerEx::?relay`; Banked call to: osal_stop_timerEx
   1296                     
   1297                      //No process shall be attempted after this fail
   1298                      bdbAttributes.bdbCommissioningMode = 0;
   \   00015E   90....       MOV       DPTR,#bdbAttributes + 11
   \   000161   E4           CLR       A
   \   000162   F0           MOVX      @DPTR,A
   1299                      
   1300                      //Fill the context for the user notification
   1301                      osal_start_timerEx(bdb_TaskID,BDB_TC_LINK_KEY_EXCHANGE_FAIL,BDB_TC_LINK_KEY_EXCHANGE_FAIL_LEAVE_TIMEOUT);
   \   000163                ; Setup parameters for call to function osal_start_timerEx
   \   000163   90....       MOV       DPTR,#__Constant_1388
   \   000166   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   000169   7A02         MOV       R2,#0x2
   \   00016B   7B00         MOV       R3,#0x0
   \   00016D   90....       MOV       DPTR,#bdb_TaskID
   \   000170   E0           MOVX      A,@DPTR
   \   000171   F9           MOV       R1,A
   \   000172   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   000175   7404         MOV       A,#0x4
   \   000177   12....       LCALL     ?DEALLOC_XSTACK8
   \   00017A   02....       LJMP      ??bdb_reportCommissioningState_10 & 0xFFFF
   1302                    }
   1303                  }
   1304                break;
   1305          #endif
   1306                
   1307                case BDB_COMMISSIONING_STATE_STEERING_ON_NWK:
   1308                  bdbCommissioningModeMsg.bdbCommissioningMode = BDB_COMMISSIONING_NWK_STEERING;
   \                     ??bdb_reportCommissioningState_5:
   \   00017D   7401         MOV       A,#0x1
   \   00017F   12....       LCALL     ?XSTACK_DISP0_8
   \   000182   7401         MOV       A,#0x1
   \   000184   F0           MOVX      @DPTR,A
   1309                  if(didSuccess)
   \   000185   EF           MOV       A,R7
   \   000186   600A         JZ        ??bdb_reportCommissioningState_18
   1310                  {
   1311                    bdbAttributes.bdbCommissioningStatus = BDB_COMMISSIONING_SUCCESS;
   \   000188   90....       MOV       DPTR,#bdbAttributes + 10
   \   00018B   E4           CLR       A
   \   00018C   F0           MOVX      @DPTR,A
   1312                    
   1313          #if (ZG_BUILD_RTR_TYPE)          
   1314                    //Update ZDApp state
   1315                    if(ZG_DEVICE_RTRONLY_TYPE)
   1316                    {          
   1317                      ZDApp_ChangeState( DEV_ROUTER );
   1318                    }
   1319          #endif
   1320          #if (ZG_BUILD_ENDDEVICE_TYPE)
   1321                    if(ZG_DEVICE_ENDDEVICE_TYPE)
   1322                    {
   1323                      ZDApp_ChangeState( DEV_END_DEVICE );
   \   00018D                ; Setup parameters for call to function ZDApp_ChangeState
   \   00018D   7906         MOV       R1,#0x6
   \   00018F   12....       LCALL     `??ZDApp_ChangeState::?relay`; Banked call to: ZDApp_ChangeState
   1324                    }
   1325          #endif
   1326                  }
   1327          #if (ZG_BUILD_COORDINATOR_TYPE)
   1328                  else
   1329                  {
   1330                    if(ZG_DEVICE_COORDINATOR_TYPE)
   1331                    {
   1332                      bdbAttributes.bdbCommissioningStatus = BDB_COMMISSIONING_NO_NETWORK;
   1333                    }
   1334                  }
   1335          #endif
   1336                  
   1337                  bdbCommissioningProcedureState.bdbCommissioningState = BDB_COMMISSIONING_STATE_START_RESUME;
   \                     ??bdb_reportCommissioningState_18:
   \   000192   12....       LCALL     ?Subroutine11 & 0xFFFF
   1338                  osal_start_timerEx(bdb_TaskID,BDB_CHANGE_COMMISSIONING_STATE,50);
   \                     ??CrossCallReturnLabel_87:
   \   000195   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   000198   7A04         MOV       R2,#0x4
   \   00019A   7B00         MOV       R3,#0x0
   \   00019C   90....       MOV       DPTR,#bdb_TaskID
   \   00019F   E0           MOVX      A,@DPTR
   \   0001A0   F9           MOV       R1,A
   \   0001A1   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   0001A4   7404         MOV       A,#0x4
   \   0001A6   12....       LCALL     ?DEALLOC_XSTACK8
   1339                  bdbAttributes.bdbCommissioningMode &= ~BDB_COMMISSIONING_MODE_NWK_STEERING;
   \   0001A9   90....       MOV       DPTR,#bdbAttributes + 11
   \   0001AC   E0           MOVX      A,@DPTR
   \   0001AD   C2E1         CLR       0xE0 /* A   */.1
   \   0001AF   02....       LJMP      ??bdb_reportCommissioningState_19 & 0xFFFF
   1340                break;
   1341                
   1342                case BDB_COMMISSIONING_STATE_FORMATION:
   1343                  bdbCommissioningModeMsg.bdbCommissioningMode = BDB_COMMISSIONING_FORMATION;
   \                     ??bdb_reportCommissioningState_6:
   \   0001B2   7401         MOV       A,#0x1
   \   0001B4   12....       LCALL     ?XSTACK_DISP0_8
   \   0001B7   7402         MOV       A,#0x2
   \   0001B9   F0           MOVX      @DPTR,A
   1344          
   1345                  if(didSuccess)
   \   0001BA   EF           MOV       A,R7
   \   0001BB   90....       MOV       DPTR,#bdbAttributes + 10
   \   0001BE   600A         JZ        ??bdb_reportCommissioningState_20
   1346                  {
   1347                    bdbAttributes.bdbCommissioningStatus = BDB_COMMISSIONING_SUCCESS;
   \   0001C0   E4           CLR       A
   \   0001C1   F0           MOVX      @DPTR,A
   1348          
   1349                    //Clear any setting that would set the device as FN
   1350                    zgWriteStartupOptions(ZG_STARTUP_CLEAR, ZCD_STARTOPT_DEFAULT_CONFIG_STATE | ZCD_STARTOPT_DEFAULT_NETWORK_STATE);          
   \   0001C2                ; Setup parameters for call to function zgWriteStartupOptions
   \   0001C2   7A03         MOV       R2,#0x3
   \   0001C4   F9           MOV       R1,A
   \   0001C5   12....       LCALL     `??zgWriteStartupOptions::?relay`; Banked call to: zgWriteStartupOptions
   \   0001C8   8003         SJMP      ??bdb_reportCommissioningState_21
   1351                    
   1352                     //Update ZDApp State
   1353          #if (ZG_BUILD_RTR_TYPE)
   1354                    if(ZG_DEVICE_RTRONLY_TYPE)
   1355                    {          
   1356                      ZDApp_ChangeState( DEV_ROUTER );
   1357                    }
   1358          #endif    
   1359          #if (ZG_BUILD_COORDINATOR_TYPE)
   1360                    if(ZG_DEVICE_COORDINATOR_TYPE)
   1361                    {          
   1362                      ZDApp_ChangeState( DEV_ZB_COORD );
   1363                    }     
   1364          #endif
   1365                  }
   1366                  else
   1367                  {
   1368                    bdbAttributes.bdbCommissioningStatus = BDB_COMMISSIONING_FORMATION_FAILURE;
   \                     ??bdb_reportCommissioningState_20:
   \   0001CA   7408         MOV       A,#0x8
   \   0001CC   F0           MOVX      @DPTR,A
   1369                    //If not on the nwk, then restart the nwk parameters
   1370          #if (ZG_BUILD_RTR_TYPE)
   1371                    if(ZG_DEVICE_RTR_TYPE)
   1372                    {           
   1373                      if(!bdbAttributes.bdbNodeIsOnANetwork)
   1374                      {
   1375                        uint8 temp = FALSE;
   1376                        //Turn off the radio
   1377                        ZMacSetReq(ZMacRxOnIdle, &temp);
   1378                        //Set the device to FN, to start as new for subsequent attempts
   1379                        bdb_setFN();
   1380                        NLME_ResetRequest();
   1381                        ZDApp_ChangeState( DEV_HOLD );
   1382                      }
   1383                    }
   1384          #endif
   1385                  }
   1386                  bdbCommissioningProcedureState.bdbCommissioningState = BDB_COMMISSIONING_STATE_START_RESUME;
   \                     ??bdb_reportCommissioningState_21:
   \   0001CD   12....       LCALL     ?Subroutine11 & 0xFFFF
   1387                  osal_start_timerEx(bdb_TaskID,BDB_CHANGE_COMMISSIONING_STATE,50);
   \                     ??CrossCallReturnLabel_88:
   \   0001D0   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   0001D3   7A04         MOV       R2,#0x4
   \   0001D5   7B00         MOV       R3,#0x0
   \   0001D7   90....       MOV       DPTR,#bdb_TaskID
   \   0001DA   E0           MOVX      A,@DPTR
   \   0001DB   F9           MOV       R1,A
   \   0001DC   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   0001DF   7404         MOV       A,#0x4
   \   0001E1   12....       LCALL     ?DEALLOC_XSTACK8
   1388                  bdbAttributes.bdbCommissioningMode &= ~BDB_COMMISSIONING_MODE_NWK_FORMATION;
   \   0001E4   90....       MOV       DPTR,#bdbAttributes + 11
   \   0001E7   E0           MOVX      A,@DPTR
   \   0001E8   C2E2         CLR       0xE0 /* A   */.2
   \   0001EA   02....       LJMP      ??bdb_reportCommissioningState_19 & 0xFFFF
   1389                break;  
   1390                
   1391          
   1392                case BDB_COMMISSIONING_STATE_FINDING_BINDING:
   1393          #if (BDB_FINDING_BINDING_CAPABILITY_ENABLED==1) 
   1394                  bdbCommissioningModeMsg.bdbCommissioningMode = BDB_COMMISSIONING_FINDING_BINDING;
   \                     ??bdb_reportCommissioningState_7:
   \   0001ED   7401         MOV       A,#0x1
   \   0001EF   12....       LCALL     ?XSTACK_DISP0_8
   \   0001F2   7403         MOV       A,#0x3
   \   0001F4   F0           MOVX      @DPTR,A
   1395          
   1396                  //Do not notify the status if we have another identify to send
   1397                  if(bdbAttributes.bdbCommissioningStatus == BDB_COMMISSIONING_SUCCESS)
   \   0001F5   90....       MOV       DPTR,#bdbAttributes + 10
   \   0001F8   E0           MOVX      A,@DPTR
   \   0001F9   7006         JNZ       ??bdb_reportCommissioningState_22
   1398                  {
   1399                    //Success at least once during F&B as initiator, mark it
   1400                    bdb_FBStateSuccessLatch = TRUE;
   \   0001FB   90....       MOV       DPTR,#bdb_FBStateSuccessLatch
   \   0001FE   7401         MOV       A,#0x1
   \   000200   F0           MOVX      @DPTR,A
   1401                  }        
   1402                  
   1403                  //Will we process another indentify?
   1404                  if(((FINDING_AND_BINDING_PERIODIC_ENABLE == FALSE) || (bdb_FB_InitiatorCurrentCyclesNumber == 0)) && (bdb_getRespondentRetry(pRespondentHead) == NULL) && (osal_get_timeoutEx( bdb_TaskID, BDB_RESPONDENT_PROCESS_TIMEOUT) == 0))
   \                     ??bdb_reportCommissioningState_22:
   \   000201   90....       MOV       DPTR,#bdb_FB_InitiatorCurrentCyclesNumber
   \   000204   E0           MOVX      A,@DPTR
   \   000205   6003         JZ        $+5
   \   000207   02....       LJMP      ??bdb_reportCommissioningState_1 & 0xFFFF
   \   00020A                ; Setup parameters for call to function bdb_getRespondentRetry
   \   00020A   90....       MOV       DPTR,#pRespondentHead
   \   00020D   12....       LCALL     ??Subroutine42_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_94:
   \   000210   12....       LCALL     `??bdb_getRespondentRetry::?relay`; Banked call to: bdb_getRespondentRetry
   \   000213   8B..         MOV       ?V1,R3
   \   000215   EA           MOV       A,R2
   \   000216   45..         ORL       A,?V1
   \   000218   6003         JZ        $+5
   \   00021A   02....       LJMP      ??bdb_reportCommissioningState_1 & 0xFFFF
   \   00021D                ; Setup parameters for call to function osal_get_timeoutEx
   \   00021D   7A00         MOV       R2,#0x0
   \   00021F   7B40         MOV       R3,#0x40
   \   000221   90....       MOV       DPTR,#bdb_TaskID
   \   000224   E0           MOVX      A,@DPTR
   \   000225   F9           MOV       R1,A
   \   000226   12....       LCALL     `??osal_get_timeoutEx::?relay`; Banked call to: osal_get_timeoutEx
   \   000229   EA           MOV       A,R2
   \   00022A   4B           ORL       A,R3
   \   00022B   4C           ORL       A,R4
   \   00022C   4D           ORL       A,R5
   \   00022D   6003         JZ        $+5
   \   00022F   02....       LJMP      ??bdb_reportCommissioningState_1 & 0xFFFF
   1405                  {
   1406                    // Dealocate respondent list and clean all the F&B process
   1407                    pRespondentCurr = NULL;
   \   000232   90....       MOV       DPTR,#pRespondentCurr
   \   000235   E4           CLR       A
   \   000236   F0           MOVX      @DPTR,A
   \   000237   A3           INC       DPTR
   \   000238   F0           MOVX      @DPTR,A
   1408                    pRespondentNext = NULL;
   \   000239   90....       MOV       DPTR,#pRespondentNext
   \   00023C   F0           MOVX      @DPTR,A
   \   00023D   A3           INC       DPTR
   \   00023E   F0           MOVX      @DPTR,A
   1409                    bdb_zclRespondentListClean( &pRespondentHead );
   \   00023F                ; Setup parameters for call to function bdb_zclRespondentListClean
   \   00023F   7A..         MOV       R2,#pRespondentHead & 0xff
   \   000241   7B..         MOV       R3,#(pRespondentHead >> 8) & 0xff
   \   000243   12....       LCALL     `??bdb_zclRespondentListClean::?relay`; Banked call to: bdb_zclRespondentListClean
   1410                    osal_stop_timerEx( bdb_TaskID, BDB_RESPONDENT_PROCESS_TIMEOUT );
   \   000246                ; Setup parameters for call to function osal_stop_timerEx
   \   000246   7A00         MOV       R2,#0x0
   \   000248   7B40         MOV       R3,#0x40
   \   00024A   90....       MOV       DPTR,#bdb_TaskID
   \   00024D   E0           MOVX      A,@DPTR
   \   00024E   F9           MOV       R1,A
   \   00024F   12....       LCALL     `??osal_stop_timerEx::?relay`; Banked call to: osal_stop_timerEx
   1411                    
   1412                    //Report success if in any of the attempts we got success, regardless that we did receive no rsp on the last attempt
   1413                    if(bdb_FBStateSuccessLatch && (bdbAttributes.bdbCommissioningStatus == BDB_COMMISSIONING_FB_NO_IDENTIFY_QUERY_RESPONSE))
   \   000252   90....       MOV       DPTR,#bdb_FBStateSuccessLatch
   \   000255   E0           MOVX      A,@DPTR
   \   000256   600A         JZ        ??bdb_reportCommissioningState_23
   \   000258   90....       MOV       DPTR,#bdbAttributes + 10
   \   00025B   E0           MOVX      A,@DPTR
   \   00025C   640B         XRL       A,#0xb
   \   00025E   7002         JNZ       ??bdb_reportCommissioningState_23
   1414                    {
   1415                      bdbAttributes.bdbCommissioningStatus = BDB_COMMISSIONING_SUCCESS;
   \   000260   E4           CLR       A
   \   000261   F0           MOVX      @DPTR,A
   1416                    }
   1417                    
   1418                    //Set default state
   1419                    bdb_FBStateSuccessLatch = FALSE;
   \                     ??bdb_reportCommissioningState_23:
   \   000262   90....       MOV       DPTR,#bdb_FBStateSuccessLatch
   \   000265   E4           CLR       A
   \   000266   F0           MOVX      @DPTR,A
   1420                    
   1421                    //Resume BDB machine state only if we were in F&B, if we were on parent lost, only clean the commissioning mode and remove from bdb_ParentLostSavedState
   1422                    if(bdbCommissioningProcedureState.bdbCommissioningState == BDB_COMMISSIONING_STATE_FINDING_BINDING)
   \   000267   90....       MOV       DPTR,#bdbCommissioningProcedureState
   \   00026A   E0           MOVX      A,@DPTR
   \   00026B   6406         XRL       A,#0x6
   \   00026D   7019         JNZ       ??bdb_reportCommissioningState_24
   1423                    {
   1424                      bdbCommissioningProcedureState.bdbCommissioningState = BDB_COMMISSIONING_STATE_START_RESUME;
   \   00026F   12....       LCALL     ??Subroutine38_0 & 0xFFFF
   1425                      osal_start_timerEx(bdb_TaskID,BDB_CHANGE_COMMISSIONING_STATE,50); 
   1426                    }
   \                     ??CrossCallReturnLabel_90:
   \   000272   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   000275   7A04         MOV       R2,#0x4
   \   000277   7B00         MOV       R3,#0x0
   \   000279   90....       MOV       DPTR,#bdb_TaskID
   \   00027C   E0           MOVX      A,@DPTR
   \   00027D   F9           MOV       R1,A
   \   00027E   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   000281   7404         MOV       A,#0x4
   \   000283   12....       LCALL     ?DEALLOC_XSTACK8
   \   000286   800A         SJMP      ??bdb_reportCommissioningState_25
   1427                    else if(bdbCommissioningProcedureState.bdb_ParentLostSavedState == BDB_COMMISSIONING_STATE_FINDING_BINDING)
   \                     ??bdb_reportCommissioningState_24:
   \   000288   90....       MOV       DPTR,#bdbCommissioningProcedureState + 3
   \   00028B   E0           MOVX      A,@DPTR
   \   00028C   6406         XRL       A,#0x6
   \   00028E   7002         JNZ       ??bdb_reportCommissioningState_25
   1428                    {
   1429                      bdbCommissioningProcedureState.bdb_ParentLostSavedState = BDB_COMMISSIONING_STATE_START_RESUME;
   \   000290   E4           CLR       A
   \   000291   F0           MOVX      @DPTR,A
   1430                    }
   1431                    
   1432                    bdbAttributes.bdbCommissioningMode &= ~BDB_COMMISSIONING_MODE_FINDING_BINDING;
   \                     ??bdb_reportCommissioningState_25:
   \   000292   90....       MOV       DPTR,#bdbAttributes + 11
   \   000295   E0           MOVX      A,@DPTR
   \   000296   C2E3         CLR       0xE0 /* A   */.3
   \   000298   02....       LJMP      ??bdb_reportCommissioningState_19 & 0xFFFF
   1433                  }
   1434                  else
   1435                  {
   1436                    return;
   1437                  }
   1438          
   1439          #endif
   1440                break;     
   1441                case BDB_COMMISSIONING_STATE_TL:
   1442                  // Set NWK task to run
   1443                  nwk_setStateIdle( FALSE );
   \                     ??bdb_reportCommissioningState_3:
   \   00029B                ; Setup parameters for call to function nwk_setStateIdle
   \   00029B   7900         MOV       R1,#0x0
   \   00029D   12....       LCALL     `??nwk_setStateIdle::?relay`; Banked call to: nwk_setStateIdle
   1444                  bdbCommissioningModeMsg.bdbCommissioningMode = BDB_COMMISSIONING_TOUCHLINK;
   \   0002A0   7401         MOV       A,#0x1
   \   0002A2   12....       LCALL     ?XSTACK_DISP0_8
   \   0002A5   7404         MOV       A,#0x4
   \   0002A7   F0           MOVX      @DPTR,A
   1445                  if(didSuccess)
   \   0002A8   EF           MOV       A,R7
   \   0002A9   600C         JZ        ??bdb_reportCommissioningState_26
   1446                  {
   1447                    bdbAttributes.bdbCommissioningStatus = BDB_COMMISSIONING_SUCCESS;
   \   0002AB   90....       MOV       DPTR,#bdbAttributes + 10
   \   0002AE   E4           CLR       A
   \   0002AF   F0           MOVX      @DPTR,A
   1448                    bdbAttributes.bdbCommissioningMode = BDB_COMMISSIONING_MODE_IDDLE;
   \   0002B0   A3           INC       DPTR
   \   0002B1   F0           MOVX      @DPTR,A
   1449                    
   1450                    //Update ZDApp state
   1451          #if (ZG_BUILD_RTR_TYPE)
   1452                    if(ZG_DEVICE_RTRONLY_TYPE)
   1453                    {          
   1454                      ZDApp_ChangeState( DEV_ROUTER );
   1455                    }
   1456          #endif
   1457          #if (ZG_BUILD_ENDDEVICE_TYPE)
   1458                    if(ZG_DEVICE_ENDDEVICE_TYPE)
   1459                    {
   1460                      ZDApp_ChangeState( DEV_END_DEVICE );
   \   0002B2                ; Setup parameters for call to function ZDApp_ChangeState
   \   0002B2   7906         MOV       R1,#0x6
   \   0002B4   12....       LCALL     `??ZDApp_ChangeState::?relay`; Banked call to: ZDApp_ChangeState
   1461                    }
   1462          #endif          
   1463                  }
   1464                  //The fail status is already set from the calling function to report commissioning process
   1465                  
   1466                  // The commissioning FAIL status is set before calling the bdb_reportCommissioningState
   1467                  bdbCommissioningProcedureState.bdbCommissioningState = BDB_COMMISSIONING_STATE_START_RESUME;
   \                     ??bdb_reportCommissioningState_26:
   \   0002B7   12....       LCALL     ?Subroutine11 & 0xFFFF
   1468                  osal_start_timerEx(bdb_TaskID,BDB_CHANGE_COMMISSIONING_STATE,50); 
   \                     ??CrossCallReturnLabel_89:
   \   0002BA   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   0002BD   7A04         MOV       R2,#0x4
   \   0002BF   7B00         MOV       R3,#0x0
   \   0002C1   90....       MOV       DPTR,#bdb_TaskID
   \   0002C4   E0           MOVX      A,@DPTR
   \   0002C5   F9           MOV       R1,A
   \   0002C6   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   0002C9   7404         MOV       A,#0x4
   \   0002CB   12....       LCALL     ?DEALLOC_XSTACK8
   1469                  //Clear the event
   1470                  bdbAttributes.bdbCommissioningMode &= ~BDB_COMMISSIONING_MODE_INITIATOR_TL;
   \   0002CE   90....       MOV       DPTR,#bdbAttributes + 11
   \   0002D1   E0           MOVX      A,@DPTR
   \   0002D2   C2E0         CLR       0xE0 /* A   */.0
   \   0002D4   8065         SJMP      ??bdb_reportCommissioningState_19
   1471                  
   1472                break;
   1473                
   1474                case BDB_INITIALIZATION:
   1475                  //Notify user about successfull initialization
   1476                  bdbCommissioningModeMsg.bdbCommissioningMode = BDB_COMMISSIONING_INITIALIZATION;
   \                     ??bdb_reportCommissioningState_8:
   \   0002D6   7401         MOV       A,#0x1
   \   0002D8   12....       LCALL     ?XSTACK_DISP0_8
   \   0002DB   E4           CLR       A
   \   0002DC   F0           MOVX      @DPTR,A
   1477                  if(didSuccess)
   \   0002DD   EF           MOV       A,R7
   \   0002DE   6035         JZ        ??bdb_reportCommissioningState_27
   1478                  {
   1479                    //Update ZDApp state
   1480          #if (ZG_BUILD_COORDINATOR_TYPE)
   1481                    if(ZG_DEVICE_COORDINATOR_TYPE)
   1482                    {          
   1483                      ZDApp_ChangeState( DEV_ZB_COORD );
   1484                    }
   1485          #endif          
   1486          #if (ZG_BUILD_ENDDEVICE_TYPE)
   1487                    if(ZG_DEVICE_ENDDEVICE_TYPE)
   1488                    {
   1489                      uint32 pollrate = POLL_RATE;
   1490                      NLME_SetPollRate(pollrate);
   \   0002E0                ; Setup parameters for call to function NLME_SetPollRate
   \   0002E0   90....       MOV       DPTR,#__Constant_3e8
   \   0002E3   12....       LCALL     ?XLOAD_R2345
   \   0002E6   12....       LCALL     `??NLME_SetPollRate::?relay`; Banked call to: NLME_SetPollRate
   1491                      ZDApp_ChangeState( DEV_NWK_SEC_REJOIN_CURR_CHANNEL );
   \   0002E9                ; Setup parameters for call to function ZDApp_ChangeState
   \   0002E9   7904         MOV       R1,#0x4
   \   0002EB   12....       LCALL     `??ZDApp_ChangeState::?relay`; Banked call to: ZDApp_ChangeState
   1492                      
   1493                    }
   1494          #endif          
   1495                    ZDApp_RestoreNwkSecMaterial();
   \   0002EE                ; Setup parameters for call to function ZDApp_RestoreNwkSecMaterial
   \   0002EE   12....       LCALL     `??ZDApp_RestoreNwkSecMaterial::?relay`; Banked call to: ZDApp_RestoreNwkSecMaterial
   1496                    bdbAttributes.bdbCommissioningStatus = BDB_COMMISSIONING_NETWORK_RESTORED;
   \   0002F1   90....       MOV       DPTR,#bdbAttributes + 10
   \   0002F4   740D         MOV       A,#0xd
   \   0002F6   F0           MOVX      @DPTR,A
   1497                    bdbCommissioningProcedureState.bdbCommissioningState = BDB_COMMISSIONING_STATE_START_RESUME;
   \   0002F7   90....       MOV       DPTR,#bdbCommissioningProcedureState
   \   0002FA   E4           CLR       A
   \   0002FB   F0           MOVX      @DPTR,A
   1498                    osal_start_timerEx(bdb_TaskID,BDB_CHANGE_COMMISSIONING_STATE,200);
   \   0002FC                ; Setup parameters for call to function osal_start_timerEx
   \   0002FC   90....       MOV       DPTR,#__Constant_c8
   \   0002FF   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   000302   7A04         MOV       R2,#0x4
   \   000304   7B00         MOV       R3,#0x0
   \   000306   90....       MOV       DPTR,#bdb_TaskID
   \   000309   E0           MOVX      A,@DPTR
   \   00030A   F9           MOV       R1,A
   \   00030B   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   00030E   7404         MOV       A,#0x4
   \   000310   12....       LCALL     ?DEALLOC_XSTACK8
   \   000313   8020         SJMP      ??bdb_reportCommissioningState_28
   1499                  }
   1500                  else
   1501                  {
   1502          #if (ZG_BUILD_ENDDEVICE_TYPE)                   
   1503                    if(ZG_DEVICE_ENDDEVICE_TYPE)
   1504                    {
   1505                      if(bdb_isDeviceNonFactoryNew())
   \                     ??bdb_reportCommissioningState_27:
   \   000315   90....       MOV       DPTR,#bdbAttributes + 14
   \   000318   E0           MOVX      A,@DPTR
   \   000319   6014         JZ        ??bdb_reportCommissioningState_29
   1506                      {
   1507                        //Notify the user about losing parent
   1508                        bdbCommissioningModeMsg.bdbCommissioningMode = BDB_COMMISSIONING_PARENT_LOST;
   \   00031B   7401         MOV       A,#0x1
   \   00031D   12....       LCALL     ?XSTACK_DISP0_8
   \   000320   7405         MOV       A,#0x5
   \   000322   F0           MOVX      @DPTR,A
   1509                        bdbAttributes.bdbCommissioningMode |= BDB_COMMISSIONING_MODE_PARENT_LOST;
   \   000323   90....       MOV       DPTR,#bdbAttributes + 11
   \   000326   E0           MOVX      A,@DPTR
   \   000327   D2E5         SETB      0xE0 /* A   */.5
   \   000329   F0           MOVX      @DPTR,A
   1510                        
   1511                        //Update ZDApp state
   1512                        ZDApp_ChangeState( DEV_NWK_ORPHAN );
   \   00032A                ; Setup parameters for call to function ZDApp_ChangeState
   \   00032A   790A         MOV       R1,#0xa
   \   00032C   12....       LCALL     `??ZDApp_ChangeState::?relay`; Banked call to: ZDApp_ChangeState
   1513                      }
   1514                    }
   1515          #endif
   1516                    bdbAttributes.bdbCommissioningStatus = BDB_COMMISSIONING_NO_NETWORK;
   \                     ??bdb_reportCommissioningState_29:
   \   00032F   90....       MOV       DPTR,#bdbAttributes + 10
   \   000332   7402         MOV       A,#0x2
   \   000334   F0           MOVX      @DPTR,A
   1517                  }
   1518                  bdbAttributes.bdbCommissioningMode &= ~BDB_COMMISSIONING_MODE_INITIALIZATION;
   \                     ??bdb_reportCommissioningState_28:
   \   000335   90....       MOV       DPTR,#bdbAttributes + 11
   \   000338   E0           MOVX      A,@DPTR
   \   000339   C2E4         CLR       0xE0 /* A   */.4
   \                     ??bdb_reportCommissioningState_19:
   \   00033B   F0           MOVX      @DPTR,A
   1519          
   1520                break;
   \   00033C   804E         SJMP      ??bdb_reportCommissioningState_10
   1521          #if (ZG_BUILD_ENDDEVICE_TYPE)     
   1522                case BDB_PARENT_LOST:
   1523                  bdbCommissioningModeMsg.bdbCommissioningMode = BDB_COMMISSIONING_PARENT_LOST;
   \                     ??bdb_reportCommissioningState_9:
   \   00033E   7401         MOV       A,#0x1
   \   000340   12....       LCALL     ?XSTACK_DISP0_8
   \   000343   7405         MOV       A,#0x5
   \   000345   F0           MOVX      @DPTR,A
   1524                  if(ZG_DEVICE_ENDDEVICE_TYPE)
   1525                  {
   1526                    if(didSuccess)
   \   000346   EF           MOV       A,R7
   \   000347   602D         JZ        ??bdb_reportCommissioningState_30
   1527                    {
   1528                      uint32 pollrate = POLL_RATE;
   1529                      bdbCommissioningProcedureState.bdbCommissioningState = bdbCommissioningProcedureState.bdb_ParentLostSavedState;  
   \   000349   90....       MOV       DPTR,#bdbCommissioningProcedureState + 3
   \   00034C   E0           MOVX      A,@DPTR
   \   00034D   90....       MOV       DPTR,#bdbCommissioningProcedureState
   \   000350   F0           MOVX      @DPTR,A
   1530                      bdbCommissioningProcedureState.bdb_ParentLostSavedState = 0;
   \   000351   90....       MOV       DPTR,#bdbCommissioningProcedureState + 3
   \   000354   E4           CLR       A
   \   000355   F0           MOVX      @DPTR,A
   1531                      NLME_SetPollRate(pollrate);
   \   000356                ; Setup parameters for call to function NLME_SetPollRate
   \   000356   90....       MOV       DPTR,#__Constant_3e8
   \   000359   12....       LCALL     ?XLOAD_R2345
   \   00035C   12....       LCALL     `??NLME_SetPollRate::?relay`; Banked call to: NLME_SetPollRate
   1532                      bdbAttributes.bdbCommissioningMode &= ~BDB_COMMISSIONING_MODE_PARENT_LOST;
   \   00035F   90....       MOV       DPTR,#bdbAttributes + 11
   \   000362   E0           MOVX      A,@DPTR
   \   000363   C2E5         CLR       0xE0 /* A   */.5
   \   000365   F0           MOVX      @DPTR,A
   1533                      bdbAttributes.bdbCommissioningStatus = BDB_COMMISSIONING_NETWORK_RESTORED;
   \   000366   90....       MOV       DPTR,#bdbAttributes + 10
   \   000369   740D         MOV       A,#0xd
   \   00036B   F0           MOVX      @DPTR,A
   1534                      //Update ZDApp state
   1535                      ZDApp_ChangeState( DEV_NWK_SEC_REJOIN_CURR_CHANNEL );
   \   00036C                ; Setup parameters for call to function ZDApp_ChangeState
   \   00036C   7904         MOV       R1,#0x4
   \   00036E   12....       LCALL     `??ZDApp_ChangeState::?relay`; Banked call to: ZDApp_ChangeState
   1536                      
   1537                      bdb_NetworkRestoredResumeState();
   \   000371                ; Setup parameters for call to function bdb_NetworkRestoredResumeState
   \   000371   12....       LCALL     `??bdb_NetworkRestoredResumeState::?relay`; Banked call to: bdb_NetworkRestoredResumeState
   \   000374   8016         SJMP      ??bdb_reportCommissioningState_10
   1538                    }
   1539                    else
   1540                    {
   1541                      bdbAttributes.bdbCommissioningMode |= BDB_COMMISSIONING_MODE_PARENT_LOST;
   \                     ??bdb_reportCommissioningState_30:
   \   000376   90....       MOV       DPTR,#bdbAttributes + 11
   \   000379   E0           MOVX      A,@DPTR
   \   00037A   D2E5         SETB      0xE0 /* A   */.5
   \   00037C   F0           MOVX      @DPTR,A
   1542                      bdbAttributes.bdbCommissioningStatus = BDB_COMMISSIONING_NO_NETWORK;
   \   00037D   90....       MOV       DPTR,#bdbAttributes + 10
   \   000380   7402         MOV       A,#0x2
   \   000382   F0           MOVX      @DPTR,A
   1543                      
   1544                      NLME_SetPollRate(0);
   \   000383                ; Setup parameters for call to function NLME_SetPollRate
   \   000383   90....       MOV       DPTR,#__Constant_0
   \   000386   12....       LCALL     ?XLOAD_R2345
   \   000389   12....       LCALL     `??NLME_SetPollRate::?relay`; Banked call to: NLME_SetPollRate
   1545                      
   1546                    }
   1547                  }
   1548                break;
   1549          #endif
   1550              }
   1551          #ifdef MT_APP_CNF_FUNC
   1552              //Notify the user about the status, the main state which has failed
   1553              bdbCommissioningModeMsg.bdbCommissioningStatus = bdbAttributes.bdbCommissioningStatus;
   1554              
   1555              bdb_NotifyApp((uint8*)&bdbCommissioningModeMsg);
   1556          #else
   1557              if(pfnCommissioningStatusCB)
   \                     ??bdb_reportCommissioningState_10:
   \   00038C   90....       MOV       DPTR,#pfnCommissioningStatusCB
   \   00038F   12....       LCALL     ??Subroutine36_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_75:
   \   000392   6023         JZ        ??bdb_reportCommissioningState_1
   1558              {
   1559                //Notify the user about the status, the main state which has failed
   1560                bdbCommissioningModeMsg.bdbCommissioningStatus = bdbAttributes.bdbCommissioningStatus;
   \   000394   90....       MOV       DPTR,#bdbAttributes + 10
   \   000397   E0           MOVX      A,@DPTR
   \   000398   85..82       MOV       DPL,?XSP + 0
   \   00039B   85..83       MOV       DPH,?XSP + 1
   \   00039E   12....       LCALL     ?Subroutine5 & 0xFFFF
   1561                
   1562                bdb_NotifyApp((uint8*)&bdbCommissioningModeMsg);
   1563              }
   1564          #endif
   1565            }  
   \                     ??CrossCallReturnLabel_1:
   \   0003A1   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0003A4   7C03         MOV       R4,#0x3
   \   0003A6   7B00         MOV       R3,#0x0
   \   0003A8   7A0A         MOV       R2,#0xa
   \   0003AA   90....       MOV       DPTR,#bdb_TaskID
   \   0003AD   E0           MOVX      A,@DPTR
   \   0003AE   F9           MOV       R1,A
   \   0003AF   12....       LCALL     `??bdb_SendMsg::?relay`; Banked call to: bdb_SendMsg
   \   0003B2   7402         MOV       A,#0x2
   \   0003B4   12....       LCALL     ?DEALLOC_XSTACK8
   1566          }
   \                     ??bdb_reportCommissioningState_1:
   \   0003B7   7404         MOV       A,#0x4
   \   0003B9   02....       LJMP      ??Subroutine40_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine11:
   \   000000   90....       MOV       DPTR,#bdbCommissioningProcedureState
   \   000003                REQUIRE ??Subroutine38_0
   \   000003                ; // Fall through to label ??Subroutine38_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine38_0:
   \   000000   E4           CLR       A
   \   000001                REQUIRE ??Subroutine39_0
   \   000001                ; // Fall through to label ??Subroutine39_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine39_0:
   \   000000   F0           MOVX      @DPTR,A
   \   000001                ; Setup parameters for call to function osal_start_timerEx
   \   000001                ; Setup parameters for call to function osal_start_timerEx
   \   000001                ; Setup parameters for call to function osal_start_timerEx
   \   000001                ; Setup parameters for call to function osal_start_timerEx
   \   000001                ; Setup parameters for call to function osal_start_timerEx
   \   000001                ; Setup parameters for call to function osal_start_timerEx
   \   000001   90....       MOV       DPTR,#__Constant_32
   \   000004   22           RET
   1567          
   1568          
   1569           /*********************************************************************
   1570           * @fn          bdb_nwkFormationAttempt
   1571           *
   1572           * @brief       Process a nwk formation attempt.
   1573           *
   1574           * @param       didSuccess - TRUE if the nwk formation was success, FALSE 
   1575           *                         otherwise and try secondary channel
   1576           *
   1577           * @return      none
   1578           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1579          void bdb_nwkFormationAttempt(bool didSuccess)
   \                     bdb_nwkFormationAttempt:
   1580          {
   \   000000   74F7         MOV       A,#-0x9
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV       A,R1
   1581            if(didSuccess)
   \   000006   6004         JZ        ??bdb_nwkFormationAttempt_0
   1582            {
   1583              bdb_reportCommissioningState(BDB_COMMISSIONING_STATE_FORMATION,TRUE);
   \   000008                ; Setup parameters for call to function bdb_reportCommissioningState
   \   000008   7A01         MOV       R2,#0x1
   \   00000A   801F         SJMP      ??bdb_nwkFormationAttempt_1
   1584            }
   1585            else
   1586            {
   1587              //Can we try the secondary channel set?
   1588              if((vDoPrimaryScan) && (bdbAttributes.bdbSecondaryChannelSet))
   \                     ??bdb_nwkFormationAttempt_0:
   \   00000C   90....       MOV       DPTR,#vDoPrimaryScan
   \   00000F   E0           MOVX      A,@DPTR
   \   000010   6017         JZ        ??bdb_nwkFormationAttempt_2
   \   000012   90....       MOV       DPTR,#bdbAttributes
   \   000015   12....       LCALL     ?XLOAD_R0123
   \   000018   E8           MOV       A,R0
   \   000019   49           ORL       A,R1
   \   00001A   4A           ORL       A,R2
   \   00001B   4B           ORL       A,R3
   \   00001C   600B         JZ        ??bdb_nwkFormationAttempt_2
   1589              {
   1590                vDoPrimaryScan = FALSE;
   \   00001E   90....       MOV       DPTR,#vDoPrimaryScan
   \   000021   E4           CLR       A
   \   000022   F0           MOVX      @DPTR,A
   1591                bdb_nwkJoiningFormation(FALSE);
   \   000023                ; Setup parameters for call to function bdb_nwkJoiningFormation
   \   000023   F9           MOV       R1,A
   \   000024   12....       LCALL     `??bdb_nwkJoiningFormation::?relay`; Banked call to: bdb_nwkJoiningFormation
   \   000027   8007         SJMP      ??bdb_nwkFormationAttempt_3
   1592              }
   1593              else
   1594              {
   1595                bdb_reportCommissioningState(BDB_COMMISSIONING_STATE_FORMATION, FALSE);
   \                     ??bdb_nwkFormationAttempt_2:
   \   000029                ; Setup parameters for call to function bdb_reportCommissioningState
   \   000029   7A00         MOV       R2,#0x0
   \                     ??bdb_nwkFormationAttempt_1:
   \   00002B   7905         MOV       R1,#0x5
   \   00002D   12....       LCALL     `??bdb_reportCommissioningState::?relay`; Banked call to: bdb_reportCommissioningState
   1596              }
   1597            }
   1598          }
   \                     ??bdb_nwkFormationAttempt_3:
   \   000030                REQUIRE ?Subroutine0
   \   000030                ; // Fall through to label ?Subroutine0
   1599          
   1600          
   1601          
   1602          /*********************************************************************
   1603           * @fn          bdb_isDeviceNonFactoryNew
   1604           *
   1605           * @brief       Returns the state of bdbNodeIsOnANetwork attribute
   1606           * 
   1607           * @param       none
   1608           *
   1609           * @return      bdbNodeIsOnANetwork
   1610           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1611          bool bdb_isDeviceNonFactoryNew(void)
   \                     bdb_isDeviceNonFactoryNew:
   1612          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1613            return bdbAttributes.bdbNodeIsOnANetwork;
   \   000004   90....       MOV       DPTR,#bdbAttributes + 14
   \   000007   E0           MOVX      A,@DPTR
   \   000008   F9           MOV       R1,A
   \   000009   02....       LJMP      ??Subroutine31_0 & 0xFFFF
   1614          }
   1615          
   1616          
   1617          /*********************************************************************
   1618           * @fn          bdb_doTrustCenterRequireKeyExchange
   1619           *
   1620           * @brief       Returns the state of bdbTrustCenterRequireKeyExchange attribute
   1621           * 
   1622           * @param       none
   1623           *
   1624           * @return      bdbTrustCenterRequireKeyExchange
   1625           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1626          bool bdb_doTrustCenterRequireKeyExchange(void)
   \                     bdb_doTrustCenterRequireKeyExchange:
   1627          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   1628          #if (ZG_BUILD_COORDINATOR_TYPE) 
   1629            return bdbAttributes.bdbTrustCenterRequireKeyExchange;
   1630          #else
   1631            return 0;
   \   000000   7900         MOV       R1,#0x0
   \   000002   02....       LJMP      ?BRET
   1632          #endif
   1633          }
   1634          
   1635          /*********************************************************************
   1636           * @fn      bdb_rejoinNwk
   1637           *
   1638           * @brief   Attempt to rejoin/resume a nwk from nv parameters
   1639           *
   1640           * @param   none
   1641           *
   1642           * @return  ZStatus_t
   1643           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1644          ZStatus_t bdb_rejoinNwk(void)
   \                     bdb_rejoinNwk:
   1645          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV       A,#-0xa
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV       A,#-0x1
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   1646            ZStatus_t rejoinStatus = ZSuccess;
   \   00000A   7E00         MOV       R6,#0x0
   1647            
   1648            //Update the seq number
   1649            _NIB.SequenceNum ++;
   \   00000C   90....       MOV       DPTR,#_NIB
   \   00000F   E0           MOVX      A,@DPTR
   \   000010   04           INC       A
   \   000011   F0           MOVX      @DPTR,A
   1650            
   1651            osal_nv_write(ZCD_NV_NIB,osal_offsetof( nwkIB_t, SequenceNum ), sizeof( uint8), &_NIB.SequenceNum );
   \   000012                ; Setup parameters for call to function osal_nv_write
   \   000012   75....       MOV       ?V0,#_NIB & 0xff
   \   000015   75....       MOV       ?V1,#(_NIB >> 8) & 0xff
   \   000018   78..         MOV       R0,#?V0
   \   00001A   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00001D   75..01       MOV       ?V0,#0x1
   \   000020   8E..         MOV       ?V1,R6
   \   000022   78..         MOV       R0,#?V0
   \   000024   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000027   7C00         MOV       R4,#0x0
   \   000029   7D00         MOV       R5,#0x0
   \   00002B   7A21         MOV       R2,#0x21
   \   00002D   7B00         MOV       R3,#0x0
   \   00002F   12....       LCALL     `??osal_nv_write::?relay`; Banked call to: osal_nv_write
   \   000032   7404         MOV       A,#0x4
   \   000034   12....       LCALL     ?DEALLOC_XSTACK8
   1652            
   1653            // Transition state machine to correct rejoin state based on nwk key
   1654            if ( ZDApp_RestoreNwkKey( FALSE )== TRUE )
   \   000037                ; Setup parameters for call to function ZDApp_RestoreNwkKey
   \   000037   7900         MOV       R1,#0x0
   \   000039   12....       LCALL     `??ZDApp_RestoreNwkKey::?relay`; Banked call to: ZDApp_RestoreNwkKey
   \   00003C   E9           MOV       A,R1
   \   00003D   6401         XRL       A,#0x1
   \   00003F   7004         JNZ       ??bdb_rejoinNwk_0
   1655            {
   1656              ZDApp_ChangeState( DEV_NWK_SEC_REJOIN_CURR_CHANNEL );
   \   000041                ; Setup parameters for call to function ZDApp_ChangeState
   \   000041   7904         MOV       R1,#0x4
   \   000043   8002         SJMP      ??bdb_rejoinNwk_1
   1657            }
   1658            else
   1659            {
   1660              ZDApp_ChangeState( DEV_NWK_TC_REJOIN_CURR_CHANNEL );
   \                     ??bdb_rejoinNwk_0:
   \   000045                ; Setup parameters for call to function ZDApp_ChangeState
   \   000045   790E         MOV       R1,#0xe
   \                     ??bdb_rejoinNwk_1:
   \   000047   12....       LCALL     `??ZDApp_ChangeState::?relay`; Banked call to: ZDApp_ChangeState
   1661            }
   1662          
   1663            // Before trying to do rejoin, check if the device has a valid short address
   1664            // If not, generate a random short address for itself
   1665            if ( _NIB.nwkDevAddress == INVALID_NODE_ADDR )
   \   00004A   90....       MOV       DPTR,#_NIB + 20
   \   00004D   E0           MOVX      A,@DPTR
   \   00004E   64FE         XRL       A,#0xfe
   \   000050   7003         JNZ       ??bdb_rejoinNwk_2
   \   000052   A3           INC       DPTR
   \   000053   E0           MOVX      A,@DPTR
   \   000054   F4           CPL       A
   \                     ??bdb_rejoinNwk_2:
   \   000055   7002         JNZ       ??bdb_rejoinNwk_3
   1666            {
   1667              rejoinStatus = ZFailure;
   \   000057   7E01         MOV       R6,#0x1
   1668            }
   1669          
   1670            // Check if the device has a valid PanID, if not, set it to the discovered Pan
   1671            if ( _NIB.nwkPanId == 0xFFFF )
   \                     ??bdb_rejoinNwk_3:
   \   000059   90....       MOV       DPTR,#_NIB + 33
   \   00005C   E0           MOVX      A,@DPTR
   \   00005D   F4           CPL       A
   \   00005E   7003         JNZ       ??bdb_rejoinNwk_4
   \   000060   A3           INC       DPTR
   \   000061   E0           MOVX      A,@DPTR
   \   000062   F4           CPL       A
   \                     ??bdb_rejoinNwk_4:
   \   000063   7004         JNZ       ??bdb_rejoinNwk_5
   1672            {
   1673              rejoinStatus = ZFailure;
   \   000065   7E01         MOV       R6,#0x1
   \   000067   803A         SJMP      ??bdb_rejoinNwk_6
   1674            }
   1675          
   1676            if(rejoinStatus == ZSuccess)
   \                     ??bdb_rejoinNwk_5:
   \   000069   EE           MOV       A,R6
   \   00006A   A2E0         MOV       C,0xE0 /* A   */.0
   \   00006C   4035         JC        ??bdb_rejoinNwk_6
   1677            {
   1678              uint8 tmp = true;
   \   00006E   85..82       MOV       DPL,?XSP + 0
   \   000071   85..83       MOV       DPH,?XSP + 1
   \   000074   7401         MOV       A,#0x1
   \   000076   F0           MOVX      @DPTR,A
   1679              ZMacSetReq( ZMacRxOnIdle, &tmp ); // Set receiver always on during rejoin
   \   000077                ; Setup parameters for call to function ZMacSetReq
   \   000077   AA..         MOV       R2,?XSP + 0
   \   000079   AB..         MOV       R3,?XSP + 1
   \   00007B   7952         MOV       R1,#0x52
   \   00007D   12....       LCALL     `??ZMacSetReq::?relay`; Banked call to: ZMacSetReq
   1680                  
   1681              // Perform Secure or Unsecure Rejoin depending on available configuration
   1682              if ( ZG_SECURE_ENABLED && ( ZDApp_RestoreNwkKey( TRUE ) == TRUE ) )
   \   000080                ; Setup parameters for call to function ZDApp_RestoreNwkKey
   \   000080   7901         MOV       R1,#0x1
   \   000082   12....       LCALL     `??ZDApp_RestoreNwkKey::?relay`; Banked call to: ZDApp_RestoreNwkKey
   \   000085   E9           MOV       A,R1
   \   000086   6401         XRL       A,#0x1
   \   000088   90....       MOV       DPTR,#_NIB + 22
   \   00008B   700B         JNZ       ??bdb_rejoinNwk_7
   1683              {
   1684                rejoinStatus = NLME_ReJoinRequest( ZDO_UseExtendedPANID, _NIB.nwkLogicalChannel);
   \   00008D                ; Setup parameters for call to function NLME_ReJoinRequest
   \   00008D   E0           MOVX      A,@DPTR
   \   00008E   F9           MOV       R1,A
   \   00008F   7A..         MOV       R2,#ZDO_UseExtendedPANID & 0xff
   \   000091   7B..         MOV       R3,#(ZDO_UseExtendedPANID >> 8) & 0xff
   \   000093   12....       LCALL     `??NLME_ReJoinRequest::?relay`; Banked call to: NLME_ReJoinRequest
   \   000096   8009         SJMP      ??bdb_rejoinNwk_8
   1685              }
   1686              else
   1687              {
   1688                rejoinStatus = NLME_ReJoinRequestUnsecure( ZDO_UseExtendedPANID, _NIB.nwkLogicalChannel);
   \                     ??bdb_rejoinNwk_7:
   \   000098                ; Setup parameters for call to function NLME_ReJoinRequestUnsecure
   \   000098   E0           MOVX      A,@DPTR
   \   000099   F9           MOV       R1,A
   \   00009A   7A..         MOV       R2,#ZDO_UseExtendedPANID & 0xff
   \   00009C   7B..         MOV       R3,#(ZDO_UseExtendedPANID >> 8) & 0xff
   \   00009E   12....       LCALL     `??NLME_ReJoinRequestUnsecure::?relay`; Banked call to: NLME_ReJoinRequestUnsecure
   \                     ??bdb_rejoinNwk_8:
   \   0000A1   E9           MOV       A,R1
   \   0000A2   FE           MOV       R6,A
   1689              }
   1690            }
   1691            
   1692            return rejoinStatus;
   \                     ??bdb_rejoinNwk_6:
   \   0000A3   EE           MOV       A,R6
   \   0000A4   F9           MOV       R1,A
   \   0000A5   02....       LJMP      ?Subroutine1 & 0xFFFF
   1693          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7401         MOV       A,#0x1
   \   000002                REQUIRE ??Subroutine40_0
   \   000002                ; // Fall through to label ??Subroutine40_0
   1694          
   1695          #if (ZG_BUILD_JOINING_TYPE)
   1696           /*********************************************************************
   1697           * @fn          bdb_nwkDiscoveryAttempt
   1698           *
   1699           * @brief       Process a nwk discovery attempt
   1700           *
   1701           * @param       didSuccess - TRUE we found nwk in the scanned channels, FALSE if 
   1702           *                           no suitable nwks were found, try secondary channel
   1703           *
   1704           * @return      none
   1705           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1706          void bdb_nwkDiscoveryAttempt(bool didSuccess)
   \                     bdb_nwkDiscoveryAttempt:
   1707          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV       A,#-0xa
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV       A,#-0x1
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   \   00000A   E9           MOV       A,R1
   \   00000B   FE           MOV       R6,A
   1708            uint8 bdbJoinEvent = BDB_JOIN_EVENT_NWK_DISCOVERY;
   \   00000C   85..82       MOV       DPL,?XSP + 0
   \   00000F   85..83       MOV       DPH,?XSP + 1
   \   000012   E4           CLR       A
   \   000013   F0           MOVX      @DPTR,A
   1709            
   1710            if(didSuccess)
   \   000014   EE           MOV       A,R6
   \   000015   6022         JZ        ??bdb_nwkDiscoveryAttempt_0
   1711            {
   1712              bdb_SendMsg(bdb_TaskID, BDB_COMMISSIONING_STATE_JOINING, BDB_MSG_EVENT_SUCCESS,sizeof(bdbJoinEvent),(uint8*)&bdbJoinEvent);
   \   000017                ; Setup parameters for call to function bdb_SendMsg
   \   000017   A8..         MOV       R0,?XSP + 0
   \   000019   A9..         MOV       R1,?XSP + 1
   \   00001B   88..         MOV       ?V0,R0
   \   00001D   89..         MOV       ?V1,R1
   \   00001F   78..         MOV       R0,#?V0
   \   000021   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000024   7C01         MOV       R4,#0x1
   \   000026   7B00         MOV       R3,#0x0
   \   000028   7A03         MOV       R2,#0x3
   \   00002A   90....       MOV       DPTR,#bdb_TaskID
   \   00002D   E0           MOVX      A,@DPTR
   \   00002E   F9           MOV       R1,A
   \   00002F   12....       LCALL     `??bdb_SendMsg::?relay`; Banked call to: bdb_SendMsg
   \   000032   7402         MOV       A,#0x2
   \   000034   12....       LCALL     ?DEALLOC_XSTACK8
   \   000037   8030         SJMP      ??bdb_nwkDiscoveryAttempt_1
   1713            }
   1714            else
   1715            {
   1716              //Can we try the secondary channel set?
   1717              if((vDoPrimaryScan) && (bdbAttributes.bdbSecondaryChannelSet))
   \                     ??bdb_nwkDiscoveryAttempt_0:
   \   000039   90....       MOV       DPTR,#vDoPrimaryScan
   \   00003C   E0           MOVX      A,@DPTR
   \   00003D   6023         JZ        ??bdb_nwkDiscoveryAttempt_2
   \   00003F   90....       MOV       DPTR,#bdbAttributes
   \   000042   12....       LCALL     ?XLOAD_R0123
   \   000045   E8           MOV       A,R0
   \   000046   49           ORL       A,R1
   \   000047   4A           ORL       A,R2
   \   000048   4B           ORL       A,R3
   \   000049   6017         JZ        ??bdb_nwkDiscoveryAttempt_2
   1718              {
   1719                vDoPrimaryScan = FALSE;
   \   00004B   90....       MOV       DPTR,#vDoPrimaryScan
   \   00004E   E4           CLR       A
   \   00004F   F0           MOVX      @DPTR,A
   1720                bdb_setChannel(bdbAttributes.bdbSecondaryChannelSet);
   \   000050                ; Setup parameters for call to function bdb_setChannel
   \   000050   90....       MOV       DPTR,#bdbAttributes
   \   000053   12....       LCALL     ?XLOAD_R2345
   \   000056   12....       LCALL     `??bdb_setChannel::?relay`; Banked call to: bdb_setChannel
   1721                
   1722                ZDApp_NetworkInit( 50 );
   \   000059                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000059   7A32         MOV       R2,#0x32
   \   00005B   7B00         MOV       R3,#0x0
   \   00005D   12....       LCALL     `??ZDApp_NetworkInit::?relay`; Banked call to: ZDApp_NetworkInit
   \   000060   8007         SJMP      ??bdb_nwkDiscoveryAttempt_1
   1723              }
   1724              else
   1725              {
   1726                bdb_reportCommissioningState(BDB_COMMISSIONING_STATE_JOINING, FALSE);
   \                     ??bdb_nwkDiscoveryAttempt_2:
   \   000062                ; Setup parameters for call to function bdb_reportCommissioningState
   \   000062   7A00         MOV       R2,#0x0
   \   000064   7903         MOV       R1,#0x3
   \   000066   12....       LCALL     `??bdb_reportCommissioningState::?relay`; Banked call to: bdb_reportCommissioningState
   1727              }
   1728            }
   1729          }
   \                     ??bdb_nwkDiscoveryAttempt_1:
   \   000069   02....       LJMP      ?Subroutine1 & 0xFFFF
   1730          
   1731           /*********************************************************************
   1732           * @fn          bdb_filterNwkDisc
   1733           *
   1734           * @brief       Filter the nwks found and attempt to join the suitable nwks
   1735           *              Here the application can include nwk filters 
   1736           *
   1737           * @param       none
   1738           *
   1739           * @return      none
   1740           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1741          void bdb_filterNwkDisc(void)
   \                     bdb_filterNwkDisc:
   1742          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000   74F5         MOV       A,#-0xb
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 0
   1743            networkDesc_t* pNwkDesc;
   1744            uint8 i = 0;
   1745            uint8 ResultCount = 0;
   \   000005   75..00       MOV       ?V0,#0x0
   1746            uint8 stackProfile = 0;
   \   000008   75..00       MOV       ?V1,#0x0
   1747            uint8 stackProfilePro = 0;
   1748            
   1749            pBDBListNwk  = nwk_getNwkDescList();
   \   00000B                ; Setup parameters for call to function nwk_getNwkDescList
   \   00000B   12....       LCALL     `??nwk_getNwkDescList::?relay`; Banked call to: nwk_getNwkDescList
   \   00000E   90....       MOV       DPTR,#pBDBListNwk
   \   000011   12....       LCALL     ?Subroutine10 & 0xFFFF
   1750            nwk_desc_list_release();
   \                     ??CrossCallReturnLabel_10:
   \   000014                ; Setup parameters for call to function nwk_desc_list_release
   \   000014   12....       LCALL     `??nwk_desc_list_release::?relay`; Banked call to: nwk_desc_list_release
   1751            
   1752            pNwkDesc = pBDBListNwk;
   \   000017   90....       MOV       DPTR,#pBDBListNwk
   \   00001A   8005         SJMP      ??CrossCallReturnLabel_43
   1753            while (pNwkDesc)
   1754            {
   1755              ResultCount++;
   \                     ??bdb_filterNwkDisc_0:
   \   00001C   05..         INC       ?V0
   1756              pNwkDesc = pNwkDesc->nextDesc;
   \   00001E   12....       LCALL     ?Subroutine24 & 0xFFFF
   1757            }
   \                     ??CrossCallReturnLabel_43:
   \   000021   12....       LCALL     ?Subroutine27 & 0xFFFF
   \                     ??CrossCallReturnLabel_49:
   \   000024   EE           MOV       A,R6
   \   000025   4F           ORL       A,R7
   \   000026   70F4         JNZ       ??bdb_filterNwkDisc_0
   1758            
   1759            if(pBDBListNwk)
   \   000028   90....       MOV       DPTR,#pBDBListNwk
   \   00002B   12....       LCALL     ??Subroutine36_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_76:
   \   00002E   7003         JNZ       $+5
   \   000030   02....       LJMP      ??bdb_filterNwkDisc_1 & 0xFFFF
   1760            {
   1761              if(pfnFilterNwkDesc)
   \   000033   90....       MOV       DPTR,#pfnFilterNwkDesc
   \   000036   12....       LCALL     ??Subroutine36_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_77:
   \   000039   600E         JZ        ??bdb_filterNwkDisc_2
   1762              {
   1763                pfnFilterNwkDesc(pBDBListNwk, ResultCount);
   \   00003B                ; Setup parameters for indirect call
   \   00003B   A9..         MOV       R1,?V0
   \   00003D   12....       LCALL     ?Subroutine15 & 0xFFFF
   1764              }
   \                     ??CrossCallReturnLabel_103:
   \   000040   90....       MOV       DPTR,#pfnFilterNwkDesc + 1
   \   000043   12....       LCALL     ??Subroutine34_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_60:
   \   000046   12....       LCALL     ?CALL_IND
   1765              
   1766              for ( stackProfile = 0; stackProfile < STACK_PROFILE_MAX; stackProfile++ )
   1767              {
   1768                pNwkDesc = pBDBListNwk;
   \                     ??bdb_filterNwkDisc_2:
   \   000049   90....       MOV       DPTR,#pBDBListNwk
   \   00004C   12....       LCALL     ?Subroutine27 & 0xFFFF
   1769                
   1770                if(pNwkDesc)
   \                     ??CrossCallReturnLabel_50:
   \   00004F   EE           MOV       A,R6
   \   000050   4F           ORL       A,R7
   \   000051   7003         JNZ       $+5
   \   000053   02....       LJMP      ??bdb_filterNwkDisc_3 & 0xFFFF
   1771                {
   1772                  for ( i = 0; i < ResultCount; i++, pNwkDesc = pNwkDesc->nextDesc )
   \   000056   75..00       MOV       ?V2,#0x0
   \   000059   02....       LJMP      ??CrossCallReturnLabel_51 & 0xFFFF
   1773                  {
   1774                    if ( nwk_ExtPANIDValid( ZDO_UseExtendedPANID ) == true )
   1775                    {
   1776                      // If the extended Pan ID is commissioned to a non zero value
   1777                      // Only join the Pan that has match EPID
   1778                      if ( osal_ExtAddrEqual( ZDO_UseExtendedPANID, pNwkDesc->extendedPANID) == false )
   1779                      {
   1780                        //Remove from the list
   1781                        bdb_nwkDescFree(pNwkDesc);
   1782                        ResultCount--;
   1783                        continue;
   1784                      }
   1785                    }
   1786                    else if ( zgConfigPANID != 0xFFFF )
   \                     ??bdb_filterNwkDisc_4:
   \   00005C   90....       MOV       DPTR,#zgConfigPANID
   \   00005F   E0           MOVX      A,@DPTR
   \   000060   F4           CPL       A
   \   000061   7003         JNZ       ??bdb_filterNwkDisc_5
   \   000063   A3           INC       DPTR
   \   000064   E0           MOVX      A,@DPTR
   \   000065   F4           CPL       A
   \                     ??bdb_filterNwkDisc_5:
   \   000066   6013         JZ        ??bdb_filterNwkDisc_6
   1787                    {
   1788                      // PAN Id is preconfigured. check if it matches
   1789                      if ( pNwkDesc->panId != zgConfigPANID )
   \   000068   8E82         MOV       DPL,R6
   \   00006A   8F83         MOV       DPH,R7
   \   00006C   12....       LCALL     ?Subroutine21 & 0xFFFF
   1790                      {
   1791                        //Remove from the list
   1792                        bdb_nwkDescFree(pNwkDesc);
   1793                        ResultCount--;
   1794                        continue;
   1795                      }
   1796                    }
   \                     ??CrossCallReturnLabel_35:
   \   00006F   90....       MOV       DPTR,#zgConfigPANID
   \   000072   E0           MOVX      A,@DPTR
   \   000073   68           XRL       A,R0
   \   000074   7003         JNZ       ??bdb_filterNwkDisc_7
   \   000076   A3           INC       DPTR
   \   000077   E0           MOVX      A,@DPTR
   \   000078   69           XRL       A,R1
   \                     ??bdb_filterNwkDisc_7:
   \   000079   7058         JNZ       ??bdb_filterNwkDisc_8
   1797          
   1798                    if ( pNwkDesc->chosenRouter != _NIB.nwkCoordAddress || _NIB.nwkCoordAddress == INVALID_NODE_ADDR )
   \                     ??bdb_filterNwkDisc_6:
   \   00007B   90....       MOV       DPTR,#_NIB + 23
   \   00007E   12....       LCALL     ?Subroutine21 & 0xFFFF
   \                     ??CrossCallReturnLabel_36:
   \   000081   8E82         MOV       DPL,R6
   \   000083   8F83         MOV       DPH,R7
   \   000085   A3           INC       DPTR
   \   000086   A3           INC       DPTR
   \   000087   A3           INC       DPTR
   \   000088   A3           INC       DPTR
   \   000089   A3           INC       DPTR
   \   00008A   A3           INC       DPTR
   \   00008B   A3           INC       DPTR
   \   00008C   E0           MOVX      A,@DPTR
   \   00008D   68           XRL       A,R0
   \   00008E   7003         JNZ       ??bdb_filterNwkDisc_9
   \   000090   A3           INC       DPTR
   \   000091   E0           MOVX      A,@DPTR
   \   000092   69           XRL       A,R1
   \                     ??bdb_filterNwkDisc_9:
   \   000093   700A         JNZ       ??bdb_filterNwkDisc_10
   \   000095   74FE         MOV       A,#-0x2
   \   000097   68           XRL       A,R0
   \   000098   7003         JNZ       ??bdb_filterNwkDisc_11
   \   00009A   74FF         MOV       A,#-0x1
   \   00009C   69           XRL       A,R1
   \                     ??bdb_filterNwkDisc_11:
   \   00009D   700B         JNZ       ??bdb_filterNwkDisc_12
   1799                    {
   1800                      // check that network is allowing joining
   1801                      if ( ZSTACK_ROUTER_BUILD )
   1802                      {
   1803                        if ( stackProfilePro == FALSE )
   1804                        {
   1805                          if ( !pNwkDesc->routerCapacity )
   1806                          {
   1807                            //Remove from the list
   1808                            bdb_nwkDescFree(pNwkDesc);
   1809                            ResultCount--;
   1810                            continue;
   1811                          }
   1812                        }
   1813                        else
   1814                        {
   1815                          if ( !pNwkDesc->deviceCapacity )
   1816                          {
   1817                            //Remove from the list
   1818                            bdb_nwkDescFree(pNwkDesc);
   1819                            ResultCount--;
   1820                            continue;
   1821                          }
   1822                        }
   1823                      }
   1824                      else if ( ZSTACK_END_DEVICE_BUILD )
   1825                      {
   1826                        if ( !pNwkDesc->deviceCapacity )
   \                     ??bdb_filterNwkDisc_10:
   \   00009F   8E82         MOV       DPL,R6
   \   0000A1   8F83         MOV       DPH,R7
   \   0000A3   A3           INC       DPTR
   \   0000A4   A3           INC       DPTR
   \   0000A5   A3           INC       DPTR
   \   0000A6   A3           INC       DPTR
   \   0000A7   E0           MOVX      A,@DPTR
   \   0000A8   6029         JZ        ??bdb_filterNwkDisc_8
   1827                        {
   1828                          //Remove from the list
   1829                          bdb_nwkDescFree(pNwkDesc);
   1830                          ResultCount--;
   1831                          continue;
   1832                        }
   1833                      }
   1834                    }
   1835          
   1836                    // check version of zigbee protocol
   1837                    if ( pNwkDesc->version != _NIB.nwkProtocolVersion )
   \                     ??bdb_filterNwkDisc_12:
   \   0000AA   8E82         MOV       DPL,R6
   \   0000AC   8F83         MOV       DPH,R7
   \   0000AE   A3           INC       DPTR
   \   0000AF   A3           INC       DPTR
   \   0000B0   A3           INC       DPTR
   \   0000B1   A3           INC       DPTR
   \   0000B2   A3           INC       DPTR
   \   0000B3   E0           MOVX      A,@DPTR
   \   0000B4   F8           MOV       R0,A
   \   0000B5   90....       MOV       DPTR,#_NIB + 17
   \   0000B8   E0           MOVX      A,@DPTR
   \   0000B9   68           XRL       A,R0
   \   0000BA   7020         JNZ       ??bdb_filterNwkDisc_13
   1838                      continue;
   1839          
   1840                    // check version of stack profile
   1841                    if ( pNwkDesc->stackProfile != zgStackProfile  )
   \   0000BC   8E82         MOV       DPL,R6
   \   0000BE   8F83         MOV       DPH,R7
   \   0000C0   A3           INC       DPTR
   \   0000C1   A3           INC       DPTR
   \   0000C2   A3           INC       DPTR
   \   0000C3   A3           INC       DPTR
   \   0000C4   A3           INC       DPTR
   \   0000C5   A3           INC       DPTR
   \   0000C6   E0           MOVX      A,@DPTR
   \   0000C7   F8           MOV       R0,A
   \   0000C8   90....       MOV       DPTR,#zgStackProfile
   \   0000CB   E0           MOVX      A,@DPTR
   \   0000CC   68           XRL       A,R0
   \   0000CD   600D         JZ        ??bdb_filterNwkDisc_13
   1842                    {
   1843                      if ( ((zgStackProfile == HOME_CONTROLS) && (pNwkDesc->stackProfile == ZIGBEEPRO_PROFILE))
   1844                          || ((zgStackProfile == ZIGBEEPRO_PROFILE) && (pNwkDesc->stackProfile == HOME_CONTROLS))  )
   1845                      {
   1846                        stackProfilePro = TRUE;
   1847                      }
   1848          
   1849                      if ( stackProfile == 0 )
   \   0000CF   E5..         MOV       A,?V1
   \   0000D1   7009         JNZ       ??bdb_filterNwkDisc_13
   1850                      {
   1851                        //Remove from the list
   1852                        bdb_nwkDescFree(pNwkDesc);
   \                     ??bdb_filterNwkDisc_8:
   \   0000D3                ; Setup parameters for call to function bdb_nwkDescFree
   \   0000D3   EE           MOV       A,R6
   \   0000D4   FA           MOV       R2,A
   \   0000D5   EF           MOV       A,R7
   \   0000D6   FB           MOV       R3,A
   \   0000D7   12....       LCALL     `??bdb_nwkDescFree::?relay`; Banked call to: bdb_nwkDescFree
   1853                        ResultCount--;
   \   0000DA   15..         DEC       ?V0
   1854                        continue;
   1855                      }
   1856                    }
   \                     ??bdb_filterNwkDisc_13:
   \   0000DC   05..         INC       ?V2
   \   0000DE   12....       LCALL     ?Subroutine24 & 0xFFFF
   \                     ??CrossCallReturnLabel_44:
   \   0000E1   12....       LCALL     ?Subroutine27 & 0xFFFF
   \                     ??CrossCallReturnLabel_51:
   \   0000E4   E5..         MOV       A,?V2
   \   0000E6   C3           CLR       C
   \   0000E7   95..         SUBB      A,?V0
   \   0000E9   5025         JNC       ??bdb_filterNwkDisc_3
   \   0000EB                ; Setup parameters for call to function nwk_ExtPANIDValid
   \   0000EB   7A..         MOV       R2,#ZDO_UseExtendedPANID & 0xff
   \   0000ED   7B..         MOV       R3,#(ZDO_UseExtendedPANID >> 8) & 0xff
   \   0000EF   12....       LCALL     `??nwk_ExtPANIDValid::?relay`; Banked call to: nwk_ExtPANIDValid
   \   0000F2   E9           MOV       A,R1
   \   0000F3   6401         XRL       A,#0x1
   \   0000F5   6003         JZ        $+5
   \   0000F7   02....       LJMP      ??bdb_filterNwkDisc_4 & 0xFFFF
   \   0000FA                ; Setup parameters for call to function sAddrExtCmp
   \   0000FA   EE           MOV       A,R6
   \   0000FB   240B         ADD       A,#0xb
   \   0000FD   FC           MOV       R4,A
   \   0000FE   E4           CLR       A
   \   0000FF   3F           ADDC      A,R7
   \   000100   FD           MOV       R5,A
   \   000101   7A..         MOV       R2,#ZDO_UseExtendedPANID & 0xff
   \   000103   7B..         MOV       R3,#(ZDO_UseExtendedPANID >> 8) & 0xff
   \   000105   12....       LCALL     `??sAddrExtCmp::?relay`; Banked call to: sAddrExtCmp
   \   000108   E9           MOV       A,R1
   \   000109   6003         JZ        $+5
   \   00010B   02....       LJMP      ??bdb_filterNwkDisc_6 & 0xFFFF
   \   00010E   80C3         SJMP      ??bdb_filterNwkDisc_8
   1857                  }
   1858                }
   1859              }
   \                     ??bdb_filterNwkDisc_3:
   \   000110   05..         INC       ?V1
   \   000112   E5..         MOV       A,?V1
   \   000114   C3           CLR       C
   \   000115   9402         SUBB      A,#0x2
   \   000117   5003         JNC       $+5
   \   000119   02....       LJMP      ??bdb_filterNwkDisc_2 & 0xFFFF
   1860            }
   1861          }
   \                     ??bdb_filterNwkDisc_1:
   \   00011C   7F03         MOV       R7,#0x3
   \   00011E   02....       LJMP      ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine24:
   \   000000   EE           MOV       A,R6
   \   000001   12....       LCALL     ?Subroutine29 & 0xFFFF
   \                     ??CrossCallReturnLabel_57:
   \   000004   3F           ADDC      A,R7
   \   000005   F583         MOV       DPH,A
   \   000007   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine29:
   \   000000   2414         ADD       A,#0x14
   \   000002   F582         MOV       DPL,A
   \   000004   E4           CLR       A
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine21:
   \   000000   E0           MOVX      A,@DPTR
   \   000001   F8           MOV       R0,A
   \   000002   A3           INC       DPTR
   \   000003   E0           MOVX      A,@DPTR
   \   000004   F9           MOV       R1,A
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine27:
   \   000000   E0           MOVX      A,@DPTR
   \   000001   FE           MOV       R6,A
   \   000002   A3           INC       DPTR
   \   000003   E0           MOVX      A,@DPTR
   \   000004   FF           MOV       R7,A
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine10:
   \   000000   EA           MOV       A,R2
   \   000001   F0           MOVX      @DPTR,A
   \   000002   A3           INC       DPTR
   \   000003   EB           MOV       A,R3
   \   000004   F0           MOVX      @DPTR,A
   \   000005   22           RET
   1862                
   1863           /*********************************************************************
   1864           * @fn          bdb_tryNwkAssoc
   1865           *
   1866           * @brief       Try to associate to the first network in the network descriptor list
   1867           *
   1868           * @param       none
   1869           *
   1870           * @return      none
   1871           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1872          static void bdb_tryNwkAssoc(void)
   \                     bdb_tryNwkAssoc:
   1873          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV       A,#-0xa
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV       A,#-0x1
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   1874            if(pBDBListNwk)
   \   00000A   90....       MOV       DPTR,#pBDBListNwk
   \   00000D   12....       LCALL     ??Subroutine36_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_78:
   \   000010   90....       MOV       DPTR,#bdbCommissioningProcedureState + 2
   \   000013   6017         JZ        ??bdb_tryNwkAssoc_0
   1875            {
   1876              bdbCommissioningProcedureState.bdbJoinState = BDB_JOIN_STATE_ASSOC;
   \   000015   12....       LCALL     ?Subroutine9 & 0xFFFF
   1877              
   1878              //Try the first in the list after the filtering
   1879              if(ZSuccess != bdb_joinProcess(pBDBListNwk))
   \                     ??CrossCallReturnLabel_8:
   \   000018   12....       LCALL     `??bdb_joinProcess::?relay`; Banked call to: bdb_joinProcess
   \   00001B   E9           MOV       A,R1
   \   00001C   6033         JZ        ??bdb_tryNwkAssoc_1
   1880              {
   1881                //If fail, free the first in the list and prepare for futher processing, either next nwk or discover again
   1882                uint8 bdbJoinEvent = BDB_JOIN_EVENT_ASSOCIATION;
   \   00001E   85..82       MOV       DPL,?XSP + 0
   \   000021   85..83       MOV       DPH,?XSP + 1
   \   000024   12....       LCALL     ?Subroutine9 & 0xFFFF
   1883                bdb_nwkDescFree(pBDBListNwk);
   \                     ??CrossCallReturnLabel_9:
   \   000027   12....       LCALL     `??bdb_nwkDescFree::?relay`; Banked call to: bdb_nwkDescFree
   1884                bdb_SendMsg(bdb_TaskID,BDB_COMMISSIONING_STATE_JOINING,BDB_MSG_EVENT_FAIL,sizeof(uint8),&bdbJoinEvent);
   \   00002A                ; Setup parameters for call to function bdb_SendMsg
   \   00002A   8005         SJMP      ??bdb_tryNwkAssoc_2
   1885              }
   1886            }
   1887            else
   1888            {
   1889              bdbCommissioningProcedureState.bdbJoinState = BDB_JOIN_STATE_NWK_DISC;
   \                     ??bdb_tryNwkAssoc_0:
   \   00002C   E4           CLR       A
   \   00002D   12....       LCALL     ??Subroutine37_0 & 0xFFFF
   1890              uint8 bdbJoinEvent = BDB_JOIN_EVENT_NWK_DISCOVERY;
   \                     ??CrossCallReturnLabel_86:
   \   000030   F0           MOVX      @DPTR,A
   1891              
   1892              bdb_SendMsg(bdb_TaskID,BDB_COMMISSIONING_STATE_JOINING,BDB_MSG_EVENT_FAIL,sizeof(uint8),&bdbJoinEvent);
   \   000031                ; Setup parameters for call to function bdb_SendMsg
   \                     ??bdb_tryNwkAssoc_2:
   \   000031   A8..         MOV       R0,?XSP + 0
   \   000033   A9..         MOV       R1,?XSP + 1
   \   000035   88..         MOV       ?V0,R0
   \   000037   89..         MOV       ?V1,R1
   \   000039   78..         MOV       R0,#?V0
   \   00003B   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00003E   7C01         MOV       R4,#0x1
   \   000040   7B01         MOV       R3,#0x1
   \   000042   7A03         MOV       R2,#0x3
   \   000044   90....       MOV       DPTR,#bdb_TaskID
   \   000047   E0           MOVX      A,@DPTR
   \   000048   F9           MOV       R1,A
   \   000049   12....       LCALL     `??bdb_SendMsg::?relay`; Banked call to: bdb_SendMsg
   \   00004C   7402         MOV       A,#0x2
   \   00004E   12....       LCALL     ?DEALLOC_XSTACK8
   1893            }
   1894          }
   \                     ??bdb_tryNwkAssoc_1:
   \   000051   02....       LJMP      ?Subroutine1 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine9:
   \   000000   7401         MOV       A,#0x1
   \   000002   F0           MOVX      @DPTR,A
   \   000003                ; Setup parameters for call to function bdb_joinProcess
   \   000003                ; Setup parameters for call to function bdb_nwkDescFree
   \   000003   90....       MOV       DPTR,#pBDBListNwk
   \   000006   E0           MOVX      A,@DPTR
   \   000007   FA           MOV       R2,A
   \   000008   A3           INC       DPTR
   \   000009   E0           MOVX      A,@DPTR
   \   00000A   FB           MOV       R3,A
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine37_0:
   \   000000   F0           MOVX      @DPTR,A
   \   000001   85..82       MOV       DPL,?XSP + 0
   \   000004   85..83       MOV       DPH,?XSP + 1
   \   000007   22           RET
   1895          
   1896          
   1897          
   1898           /*********************************************************************
   1899           * @fn          bdb_nwkAssocAttemt
   1900           *
   1901           * @brief       Process the result of an attempt to associate to a network 
   1902           *
   1903           * @param       didSuccess - bool
   1904           *
   1905           * @return      none
   1906           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1907          void bdb_nwkAssocAttemt(bool didSuccess)
   \                     bdb_nwkAssocAttemt:
   1908          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV       A,#-0xa
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV       A,#-0x1
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   \   00000A   E9           MOV       A,R1
   \   00000B   FE           MOV       R6,A
   1909            bdbAttributes.bdbCommissioningStatus = BDB_COMMISSIONING_STATE_JOINING;
   \   00000C   90....       MOV       DPTR,#bdbAttributes + 10
   \   00000F   7403         MOV       A,#0x3
   \   000011   12....       LCALL     ?Subroutine7 & 0xFFFF
   1910            uint8 bdbJoinEvent = BDB_JOIN_EVENT_ASSOCIATION;
   \                     ??CrossCallReturnLabel_7:
   \   000014   F0           MOVX      @DPTR,A
   1911            uint8 status;
   1912            
   1913            if(didSuccess)
   \   000015   EE           MOV       A,R6
   \   000016   6004         JZ        ??bdb_nwkAssocAttemt_0
   1914            {
   1915              status = BDB_MSG_EVENT_SUCCESS;
   \   000018   7B00         MOV       R3,#0x0
   \   00001A   801A         SJMP      ??bdb_nwkAssocAttemt_1
   1916            }
   1917            else
   1918            {
   1919              if(bdb_nwkAssocRetriesCount < BDBC_REC_SAME_NETWORK_RETRY_ATTEMPS)
   \                     ??bdb_nwkAssocAttemt_0:
   \   00001C   90....       MOV       DPTR,#bdb_nwkAssocRetriesCount
   \   00001F   E0           MOVX      A,@DPTR
   \   000020   C3           CLR       C
   \   000021   9403         SUBB      A,#0x3
   \   000023   5004         JNC       ??bdb_nwkAssocAttemt_2
   1920              {
   1921                bdb_nwkAssocRetriesCount++;
   \   000025   E0           MOVX      A,@DPTR
   \   000026   04           INC       A
   \   000027   800A         SJMP      ??bdb_nwkAssocAttemt_3
   1922              }
   1923              else
   1924              {
   1925                //Free the first in the list and prepare for futher processing
   1926                bdb_nwkDescFree(pBDBListNwk);
   \                     ??bdb_nwkAssocAttemt_2:
   \   000029                ; Setup parameters for call to function bdb_nwkDescFree
   \   000029   12....       LCALL     ?Subroutine15 & 0xFFFF
   \                     ??CrossCallReturnLabel_104:
   \   00002C   12....       LCALL     `??bdb_nwkDescFree::?relay`; Banked call to: bdb_nwkDescFree
   1927                bdb_nwkAssocRetriesCount = 0;
   \   00002F   90....       MOV       DPTR,#bdb_nwkAssocRetriesCount
   \   000032   E4           CLR       A
   \                     ??bdb_nwkAssocAttemt_3:
   \   000033   F0           MOVX      @DPTR,A
   1928              }
   1929              status = BDB_MSG_EVENT_FAIL;
   \   000034   7B01         MOV       R3,#0x1
   1930            }
   1931            bdb_SendMsg(bdb_TaskID,BDB_COMMISSIONING_STATE_JOINING,status,sizeof(uint8),&bdbJoinEvent);
   \                     ??bdb_nwkAssocAttemt_1:
   \   000036                ; Setup parameters for call to function bdb_SendMsg
   \   000036   A8..         MOV       R0,?XSP + 0
   \   000038   A9..         MOV       R1,?XSP + 1
   \   00003A   88..         MOV       ?V0,R0
   \   00003C   89..         MOV       ?V1,R1
   \   00003E   78..         MOV       R0,#?V0
   \   000040   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000043   7C01         MOV       R4,#0x1
   \   000045   7A03         MOV       R2,#0x3
   \   000047   90....       MOV       DPTR,#bdb_TaskID
   \   00004A   E0           MOVX      A,@DPTR
   \   00004B   F9           MOV       R1,A
   \   00004C   12....       LCALL     `??bdb_SendMsg::?relay`; Banked call to: bdb_SendMsg
   \   00004F   7402         MOV       A,#0x2
   \   000051   12....       LCALL     ?DEALLOC_XSTACK8
   1932          }
   \   000054   02....       LJMP      ?Subroutine1 & 0xFFFF
   1933                                 
   1934          
   1935          /****************************************************************************
   1936           * @fn          bdb_nwkDescFree
   1937           *
   1938           * @brief       This function frees one network discovery data.
   1939           *
   1940           * @param       ZSuccess - If the device was found and erased
   1941           * @param       ZInvalidParameter - Not found
   1942           *
   1943           * @return      none
   1944           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1945          ZStatus_t bdb_nwkDescFree(networkDesc_t* nodeDescToRemove)
   \                     bdb_nwkDescFree:
   1946          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1947            networkDesc_t* current_desc;
   1948            networkDesc_t* prev_desc;
   1949            
   1950            current_desc = pBDBListNwk;
   \   000004   90....       MOV       DPTR,#pBDBListNwk
   \   000007   8007         SJMP      ??CrossCallReturnLabel_45
   1951          
   1952            while(current_desc != NULL)
   1953            {  
   1954              if(current_desc == nodeDescToRemove)
   1955              {
   1956                if (current_desc == pBDBListNwk)
   1957                {
   1958                  pBDBListNwk = pBDBListNwk->nextDesc;
   1959                }
   1960                else
   1961                {
   1962                  prev_desc->nextDesc = current_desc->nextDesc;
   1963                }
   1964                
   1965                osal_mem_free( current_desc );
   1966                
   1967                return ZSuccess;
   1968              }
   1969          
   1970              prev_desc = current_desc;
   \                     ??bdb_nwkDescFree_0:
   \   000009   E8           MOV       A,R0
   \   00000A   FC           MOV       R4,A
   \   00000B   E9           MOV       A,R1
   \   00000C   FD           MOV       R5,A
   1971              current_desc = current_desc->nextDesc;
   \   00000D   12....       LCALL     ?Subroutine25 & 0xFFFF
   \                     ??CrossCallReturnLabel_45:
   \   000010   12....       LCALL     ??Subroutine36_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_70:
   \   000013   603E         JZ        ??bdb_nwkDescFree_1
   \   000015   EA           MOV       A,R2
   \   000016   68           XRL       A,R0
   \   000017   7002         JNZ       ??bdb_nwkDescFree_2
   \   000019   EB           MOV       A,R3
   \   00001A   69           XRL       A,R1
   \                     ??bdb_nwkDescFree_2:
   \   00001B   70EC         JNZ       ??bdb_nwkDescFree_0
   \   00001D   12....       LCALL     ?Subroutine15 & 0xFFFF
   \                     ??CrossCallReturnLabel_105:
   \   000020   E8           MOV       A,R0
   \   000021   6A           XRL       A,R2
   \   000022   7002         JNZ       ??bdb_nwkDescFree_3
   \   000024   E9           MOV       A,R1
   \   000025   6B           XRL       A,R3
   \                     ??bdb_nwkDescFree_3:
   \   000026   7010         JNZ       ??bdb_nwkDescFree_4
   \   000028   E0           MOVX      A,@DPTR
   \   000029   CA           XCH       A,R2
   \   00002A   12....       LCALL     ?Subroutine29 & 0xFFFF
   \                     ??CrossCallReturnLabel_55:
   \   00002D   3A           ADDC      A,R2
   \   00002E   F583         MOV       DPH,A
   \   000030   12....       LCALL     ??Subroutine42_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_95:
   \   000033   90....       MOV       DPTR,#pBDBListNwk
   \   000036   800D         SJMP      ??bdb_nwkDescFree_5
   \                     ??bdb_nwkDescFree_4:
   \   000038   12....       LCALL     ?Subroutine25 & 0xFFFF
   \                     ??CrossCallReturnLabel_46:
   \   00003B   12....       LCALL     ??Subroutine42_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_96:
   \   00003E   EC           MOV       A,R4
   \   00003F   12....       LCALL     ?Subroutine29 & 0xFFFF
   \                     ??CrossCallReturnLabel_56:
   \   000042   3D           ADDC      A,R5
   \   000043   F583         MOV       DPH,A
   \                     ??bdb_nwkDescFree_5:
   \   000045   12....       LCALL     ?Subroutine10 & 0xFFFF
   \                     ??CrossCallReturnLabel_11:
   \   000048                ; Setup parameters for call to function osal_mem_free
   \   000048   E8           MOV       A,R0
   \   000049   FA           MOV       R2,A
   \   00004A   E9           MOV       A,R1
   \   00004B   FB           MOV       R3,A
   \   00004C   12....       LCALL     `??osal_mem_free::?relay`; Banked call to: osal_mem_free
   \   00004F   7900         MOV       R1,#0x0
   \   000051   8002         SJMP      ??bdb_nwkDescFree_6
   1972            }
   1973            
   1974            return ZInvalidParameter;
   \                     ??bdb_nwkDescFree_1:
   \   000053   7902         MOV       R1,#0x2
   \                     ??bdb_nwkDescFree_6:
   \   000055   02....       LJMP      ??Subroutine31_0 & 0xFFFF
   1975          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine25:
   \   000000   E8           MOV       A,R0
   \   000001   12....       LCALL     ?Subroutine29 & 0xFFFF
   \                     ??CrossCallReturnLabel_58:
   \   000004   39           ADDC      A,R1
   \   000005   F583         MOV       DPH,A
   \   000007   22           RET
   1976          
   1977          /*********************************************************************
   1978          * @fn          bdb_joinProcess
   1979          *
   1980          * @brief       Start the joining process for the selected nwk
   1981          *
   1982          * @return      ZStatus_t
   1983          */  

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1984          ZStatus_t bdb_joinProcess(networkDesc_t *pChosenNwk)
   \                     bdb_joinProcess:
   1985          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV       A,#-0xa
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV       A,R2
   \   000006   FE           MOV       R6,A
   \   000007   EB           MOV       A,R3
   \   000008   FF           MOV       R7,A
   1986            ZStatus_t status;
   1987           
   1988            ZDApp_ChangeState( DEV_NWK_JOINING );
   \   000009                ; Setup parameters for call to function ZDApp_ChangeState
   \   000009   7903         MOV       R1,#0x3
   \   00000B   12....       LCALL     `??ZDApp_ChangeState::?relay`; Banked call to: ZDApp_ChangeState
   1989            ZDApp_NodeProfileSync( pChosenNwk->stackProfile);
   \   00000E                ; Setup parameters for call to function ZDApp_NodeProfileSync
   \   00000E   8E82         MOV       DPL,R6
   \   000010   8F83         MOV       DPH,R7
   \   000012   A3           INC       DPTR
   \   000013   A3           INC       DPTR
   \   000014   A3           INC       DPTR
   \   000015   A3           INC       DPTR
   \   000016   A3           INC       DPTR
   \   000017   A3           INC       DPTR
   \   000018   E0           MOVX      A,@DPTR
   \   000019   F9           MOV       R1,A
   \   00001A   12....       LCALL     `??ZDApp_NodeProfileSync::?relay`; Banked call to: ZDApp_NodeProfileSync
   1990          
   1991            status =  NLME_JoinRequest( pChosenNwk->extendedPANID, pChosenNwk->panId,
   1992                                  pChosenNwk->logicalChannel,
   1993                                  ZDO_Config_Node_Descriptor.CapabilityFlags,
   1994                                  pChosenNwk->chosenRouter, pChosenNwk->chosenRouterDepth );
   \   00001D                ; Setup parameters for call to function NLME_JoinRequest
   \   00001D   8E82         MOV       DPL,R6
   \   00001F   8F83         MOV       DPH,R7
   \   000021   A3           INC       DPTR
   \   000022   A3           INC       DPTR
   \   000023   A3           INC       DPTR
   \   000024   A3           INC       DPTR
   \   000025   A3           INC       DPTR
   \   000026   A3           INC       DPTR
   \   000027   A3           INC       DPTR
   \   000028   A3           INC       DPTR
   \   000029   A3           INC       DPTR
   \   00002A   A3           INC       DPTR
   \   00002B   E0           MOVX      A,@DPTR
   \   00002C   F5..         MOV       ?V0,A
   \   00002E   78..         MOV       R0,#?V0
   \   000030   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   000033   8E82         MOV       DPL,R6
   \   000035   8F83         MOV       DPH,R7
   \   000037   A3           INC       DPTR
   \   000038   A3           INC       DPTR
   \   000039   A3           INC       DPTR
   \   00003A   A3           INC       DPTR
   \   00003B   A3           INC       DPTR
   \   00003C   A3           INC       DPTR
   \   00003D   A3           INC       DPTR
   \   00003E   12....       LCALL     ?PUSH_XSTACK8_X_TWO
   \   000041   90....       MOV       DPTR,#ZDO_Config_Node_Descriptor + 2
   \   000044   E0           MOVX      A,@DPTR
   \   000045   F5..         MOV       ?V0,A
   \   000047   78..         MOV       R0,#?V0
   \   000049   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   00004C   8E82         MOV       DPL,R6
   \   00004E   8F83         MOV       DPH,R7
   \   000050   A3           INC       DPTR
   \   000051   A3           INC       DPTR
   \   000052   E0           MOVX      A,@DPTR
   \   000053   F9           MOV       R1,A
   \   000054   8E82         MOV       DPL,R6
   \   000056   8F83         MOV       DPH,R7
   \   000058   12....       LCALL     ?Subroutine20 & 0xFFFF
   \                     ??CrossCallReturnLabel_32:
   \   00005B   EE           MOV       A,R6
   \   00005C   240B         ADD       A,#0xb
   \   00005E   FA           MOV       R2,A
   \   00005F   E4           CLR       A
   \   000060   3F           ADDC      A,R7
   \   000061   FB           MOV       R3,A
   \   000062   12....       LCALL     `??NLME_JoinRequest::?relay`; Banked call to: NLME_JoinRequest
   \   000065   7404         MOV       A,#0x4
   \   000067   12....       LCALL     ?DEALLOC_XSTACK8
   \   00006A   E9           MOV       A,R1
   \   00006B   FE           MOV       R6,A
   1995            
   1996            if(status == ZSuccess)
   \   00006C   7054         JNZ       ??bdb_joinProcess_0
   1997            {
   1998              // The receiver is on, turn network layer polling off.
   1999              if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   \   00006E   90....       MOV       DPTR,#ZDO_Config_Node_Descriptor + 2
   \   000071   E0           MOVX      A,@DPTR
   \   000072   A2E3         MOV       C,0xE0 /* A   */.3
   \   000074   5029         JNC       ??bdb_joinProcess_1
   2000              {
   2001                // for an End Device with NO Child Table Management process or for a Router
   2002                if ( ( ZG_DEVICE_RTR_TYPE )  ||
   2003                     ( (ZG_DEVICE_ENDDEVICE_TYPE) && ( zgChildAgingEnable == FALSE ) ) )
   \   000076   90....       MOV       DPTR,#zgDeviceLogicalType
   \   000079   E0           MOVX      A,@DPTR
   \   00007A   600A         JZ        ??bdb_joinProcess_2
   \   00007C   6401         XRL       A,#0x1
   \   00007E   6006         JZ        ??bdb_joinProcess_2
   \   000080   90....       MOV       DPTR,#zgChildAgingEnable
   \   000083   E0           MOVX      A,@DPTR
   \   000084   703C         JNZ       ??bdb_joinProcess_0
   2004                {
   2005                  NLME_SetPollRate( 0 );
   \                     ??bdb_joinProcess_2:
   \   000086                ; Setup parameters for call to function NLME_SetPollRate
   \   000086   90....       MOV       DPTR,#__Constant_0
   \   000089   12....       LCALL     ?XLOAD_R2345
   \   00008C   12....       LCALL     `??NLME_SetPollRate::?relay`; Banked call to: NLME_SetPollRate
   2006                  NLME_SetQueuedPollRate( 0 );
   \   00008F                ; Setup parameters for call to function NLME_SetQueuedPollRate
   \   00008F   7A00         MOV       R2,#0x0
   \   000091   7B00         MOV       R3,#0x0
   \   000093   12....       LCALL     `??NLME_SetQueuedPollRate::?relay`; Banked call to: NLME_SetQueuedPollRate
   2007                  NLME_SetResponseRate( 0 );
   \   000096                ; Setup parameters for call to function NLME_SetResponseRate
   \   000096   7A00         MOV       R2,#0x0
   \   000098   7B00         MOV       R3,#0x0
   \   00009A   12....       LCALL     `??NLME_SetResponseRate::?relay`; Banked call to: NLME_SetResponseRate
   \   00009D   8023         SJMP      ??bdb_joinProcess_0
   2008                }
   2009              }
   2010              else
   2011              {
   2012                if ( (ZG_SECURE_ENABLED) && (devStartMode == MODE_JOIN) )
   \                     ??bdb_joinProcess_1:
   \   00009F   90....       MOV       DPTR,#devStartMode
   \   0000A2   E0           MOVX      A,@DPTR
   \   0000A3   701D         JNZ       ??bdb_joinProcess_0
   2013                {
   2014                  ZDApp_SavedPollRate = zgPollRate;
   \   0000A5   90....       MOV       DPTR,#zgPollRate
   \   0000A8   12....       LCALL     ?XLOAD_R0123
   \   0000AB   90....       MOV       DPTR,#ZDApp_SavedPollRate
   \   0000AE   12....       LCALL     ?XSTORE_R0123
   2015                  NLME_SetPollRate( zgRejoinPollRate );
   \   0000B1                ; Setup parameters for call to function NLME_SetPollRate
   \   0000B1   90....       MOV       DPTR,#zgRejoinPollRate
   \   0000B4   E0           MOVX      A,@DPTR
   \   0000B5   F5..         MOV       ?V0,A
   \   0000B7   A3           INC       DPTR
   \   0000B8   E0           MOVX      A,@DPTR
   \   0000B9   AA..         MOV       R2,?V0
   \   0000BB   FB           MOV       R3,A
   \   0000BC   E4           CLR       A
   \   0000BD   FC           MOV       R4,A
   \   0000BE   FD           MOV       R5,A
   \   0000BF   12....       LCALL     `??NLME_SetPollRate::?relay`; Banked call to: NLME_SetPollRate
   2016                }
   2017              }
   2018            }
   2019            return status;
   \                     ??bdb_joinProcess_0:
   \   0000C2   EE           MOV       A,R6
   \   0000C3   F9           MOV       R1,A
   \   0000C4   02....       LJMP      ??Subroutine41_0 & 0xFFFF
   2020          }
   2021          #endif
   2022          
   2023          
   2024           /*********************************************************************
   2025           * @fn          bdb_setChannelAttribute
   2026           *
   2027           * @brief       Set the primary or seconday channel for discovery or formation procedure
   2028           *
   2029           * @param       isPrimaryChannel - True if channel to set is primary,  
   2030           *                                 False if the channel to set is secondary
   2031           *
   2032           * @param       channel - Channel mask
   2033           *
   2034           * @return      none
   2035           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2036          void bdb_setChannelAttribute(bool isPrimaryChannel, uint32 channel)
   \                     bdb_setChannelAttribute:
   2037          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000   74F4         MOV       A,#-0xc
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV       ?V0,R2
   \   000007   8B..         MOV       ?V1,R3
   \   000009   8C..         MOV       ?V2,R4
   \   00000B   8D..         MOV       ?V3,R5
   2038            if(isPrimaryChannel)
   \   00000D   E9           MOV       A,R1
   \   00000E   6005         JZ        ??bdb_setChannelAttribute_0
   2039            {
   2040              bdbAttributes.bdbPrimaryChannelSet = channel;
   \   000010   90....       MOV       DPTR,#bdbAttributes + 4
   \   000013   8003         SJMP      ??bdb_setChannelAttribute_1
   2041            }
   2042            else
   2043            {
   2044              bdbAttributes.bdbSecondaryChannelSet = channel;
   \                     ??bdb_setChannelAttribute_0:
   \   000015   90....       MOV       DPTR,#bdbAttributes
   \                     ??bdb_setChannelAttribute_1:
   \   000018   78..         MOV       R0,#?V0
   \   00001A   12....       LCALL     ?L_MOV_TO_X
   2045            }
   2046          }
   \   00001D   02....       LJMP      ??Subroutine33_0 & 0xFFFF
   2047          
   2048           /*********************************************************************
   2049           * @fn          bdb_setChannel
   2050           *
   2051           * @brief       Set channel and save it in Nv for joining/formation operations
   2052           *
   2053           * @param       channel - Channel mask
   2054           *
   2055           * @return      none
   2056           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2057          void bdb_setChannel(uint32 channel)
   \                     bdb_setChannel:
   2058          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000   74F4         MOV       A,#-0xc
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV       ?V0,R2
   \   000007   8B..         MOV       ?V1,R3
   \   000009   8C..         MOV       ?V2,R4
   \   00000B   8D..         MOV       ?V3,R5
   2059            //Assign the channel and save it into nv
   2060            vScanChannels = channel;
   \   00000D   90....       MOV       DPTR,#zgDefaultChannelList
   \   000010   78..         MOV       R0,#?V0
   \   000012   12....       LCALL     ?L_MOV_TO_X
   2061            runtimeChannel = channel;
   \   000015   90....       MOV       DPTR,#runtimeChannel
   \   000018   78..         MOV       R0,#?V0
   \   00001A   12....       LCALL     ?L_MOV_TO_X
   2062              
   2063            osal_nv_write(ZCD_NV_CHANLIST,0,sizeof(uint32),&vScanChannels);
   \   00001D                ; Setup parameters for call to function osal_nv_write
   \   00001D   75....       MOV       ?V0,#zgDefaultChannelList & 0xff
   \   000020   75....       MOV       ?V1,#(zgDefaultChannelList >> 8) & 0xff
   \   000023   78..         MOV       R0,#?V0
   \   000025   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000028   75..04       MOV       ?V0,#0x4
   \   00002B   75..00       MOV       ?V1,#0x0
   \   00002E   78..         MOV       R0,#?V0
   \   000030   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000033   7C00         MOV       R4,#0x0
   \   000035   7D00         MOV       R5,#0x0
   \   000037   7A84         MOV       R2,#-0x7c
   \   000039   7B00         MOV       R3,#0x0
   \   00003B   12....       LCALL     `??osal_nv_write::?relay`; Banked call to: osal_nv_write
   \   00003E   02....       LJMP      ?Subroutine2 & 0xFFFF
   2064          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   7404         MOV       A,#0x4
   \   000002                REQUIRE ??Subroutine32_0
   \   000002                ; // Fall through to label ??Subroutine32_0
   2065          
   2066          
   2067           /*********************************************************************
   2068           * @fn          bdb_nwkJoiningFormation   
   2069           *
   2070           * @brief       Performs Joining/Formation operation on primary or secondary channel
   2071           *
   2072           * @param       isJoining - TRUE if the device is performing joining, FALSE is performing Formation
   2073           *
   2074           * @return      none
   2075           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2076          void bdb_nwkJoiningFormation(bool isJoining)
   \                     bdb_nwkJoiningFormation:
   2077          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000   74F4         MOV       A,#-0xc
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   E9           MOV       A,R1
   \   000006   FE           MOV       R6,A
   2078            
   2079            if((vDoPrimaryScan) && (bdbAttributes.bdbPrimaryChannelSet))
   \   000007   90....       MOV       DPTR,#vDoPrimaryScan
   \   00000A   E0           MOVX      A,@DPTR
   \   00000B   601C         JZ        ??bdb_nwkJoiningFormation_0
   \   00000D   90....       MOV       DPTR,#bdbAttributes + 4
   \   000010   78..         MOV       R0,#?V0
   \   000012   12....       LCALL     ?L_MOV_X
   \   000015   E5..         MOV       A,?V0
   \   000017   45..         ORL       A,?V1
   \   000019   45..         ORL       A,?V2
   \   00001B   45..         ORL       A,?V3
   \   00001D   600A         JZ        ??bdb_nwkJoiningFormation_0
   2080            {
   2081              bdb_setChannel(bdbAttributes.bdbPrimaryChannelSet);
   \   00001F                ; Setup parameters for call to function bdb_setChannel
   \   00001F   AA..         MOV       R2,?V0
   \   000021   AB..         MOV       R3,?V1
   \   000023   AC..         MOV       R4,?V2
   \   000025   AD..         MOV       R5,?V3
   \   000027   800B         SJMP      ??bdb_nwkJoiningFormation_1
   2082            }
   2083            else
   2084            {
   2085              vDoPrimaryScan = FALSE;
   \                     ??bdb_nwkJoiningFormation_0:
   \   000029   90....       MOV       DPTR,#vDoPrimaryScan
   \   00002C   E4           CLR       A
   \   00002D   F0           MOVX      @DPTR,A
   2086              bdb_setChannel(bdbAttributes.bdbSecondaryChannelSet);
   \   00002E                ; Setup parameters for call to function bdb_setChannel
   \   00002E   90....       MOV       DPTR,#bdbAttributes
   \   000031   12....       LCALL     ?XLOAD_R2345
   \                     ??bdb_nwkJoiningFormation_1:
   \   000034   12....       LCALL     `??bdb_setChannel::?relay`; Banked call to: bdb_setChannel
   2087            }
   2088          
   2089            if(vScanChannels)
   \   000037   90....       MOV       DPTR,#zgDefaultChannelList
   \   00003A   12....       LCALL     ?XLOAD_R0123
   \   00003D   E8           MOV       A,R0
   \   00003E   49           ORL       A,R1
   \   00003F   4A           ORL       A,R2
   \   000040   4B           ORL       A,R3
   \   000041   601A         JZ        ??bdb_nwkJoiningFormation_2
   2090            {
   2091              if(ZG_DEVICE_RTRONLY_TYPE)
   \   000043   90....       MOV       DPTR,#zgDeviceLogicalType
   \   000046   E0           MOVX      A,@DPTR
   \   000047   6401         XRL       A,#0x1
   \   000049   7007         JNZ       ??bdb_nwkJoiningFormation_3
   2092              {
   2093                if(isJoining)
   \   00004B   EE           MOV       A,R6
   \   00004C   7004         JNZ       ??bdb_nwkJoiningFormation_3
   2094                {
   2095                  ZDOInitDeviceEx(100,0);
   2096                }
   2097                else
   2098                {
   2099                  ZDOInitDeviceEx(100,1);
   \   00004E                ; Setup parameters for call to function ZDOInitDeviceEx
   \   00004E   7901         MOV       R1,#0x1
   \   000050   8002         SJMP      ??bdb_nwkJoiningFormation_4
   2100                }
   2101              }
   2102              //ZED can only join, and ZC can only create
   2103              else
   2104              {
   2105                ZDOInitDeviceEx(100,0);
   \                     ??bdb_nwkJoiningFormation_3:
   \   000052                ; Setup parameters for call to function ZDOInitDeviceEx
   \   000052   7900         MOV       R1,#0x0
   \                     ??bdb_nwkJoiningFormation_4:
   \   000054   7A64         MOV       R2,#0x64
   \   000056   7B00         MOV       R3,#0x0
   \   000058   12....       LCALL     `??ZDOInitDeviceEx::?relay`; Banked call to: ZDOInitDeviceEx
   \   00005B   800E         SJMP      ??bdb_nwkJoiningFormation_5
   2106              }
   2107            }
   2108            else
   2109            {
   2110              if(isJoining)
   \                     ??bdb_nwkJoiningFormation_2:
   \   00005D   EE           MOV       A,R6
   \   00005E   7A00         MOV       R2,#0x0
   \   000060   6004         JZ        ??bdb_nwkJoiningFormation_6
   2111              {
   2112                bdb_reportCommissioningState(BDB_COMMISSIONING_STATE_JOINING, FALSE);
   \   000062                ; Setup parameters for call to function bdb_reportCommissioningState
   \   000062   7903         MOV       R1,#0x3
   \   000064   8002         SJMP      ??bdb_nwkJoiningFormation_7
   2113              }
   2114              else
   2115              {
   2116                bdb_reportCommissioningState(BDB_COMMISSIONING_STATE_FORMATION, FALSE);
   \                     ??bdb_nwkJoiningFormation_6:
   \   000066                ; Setup parameters for call to function bdb_reportCommissioningState
   \   000066   7905         MOV       R1,#0x5
   \                     ??bdb_nwkJoiningFormation_7:
   \   000068   12....       LCALL     `??bdb_reportCommissioningState::?relay`; Banked call to: bdb_reportCommissioningState
   2117              }
   2118            }
   2119          }
   \                     ??bdb_nwkJoiningFormation_5:
   \   00006B   80..         SJMP      ??Subroutine33_0
   2120          
   2121          #if (ZG_BUILD_JOINING_TYPE)
   2122           /*********************************************************************
   2123           * @fn          bdb_tcLinkKeyExchangeAttempt
   2124           *
   2125           * @brief       Generic send msg for TC link key exchange process attempts
   2126           *
   2127           * @param       didSuccess - FALSE if the step failed/timeout, TRUE otherwise
   2128           * @param       bdbTCExchangeState - Step in which the attemp was done
   2129           *
   2130           * @return      none
   2131           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2132          void bdb_tcLinkKeyExchangeAttempt(bool didSuccess, uint8 bdbTCExchangeState)
   \                     bdb_tcLinkKeyExchangeAttempt:
   2133          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000   74F4         MOV       A,#-0xc
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV       A,#-0x1
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   \   00000A   E9           MOV       A,R1
   \   00000B   FF           MOV       R7,A
   2134            bool bdbEventStatus = BDB_MSG_EVENT_SUCCESS;
   \   00000C   7E00         MOV       R6,#0x0
   2135            uint8 dummy;
   2136            bdbCommissioningProcedureState.bdbTCExchangeState = bdbTCExchangeState;
   \   00000E   EA           MOV       A,R2
   \   00000F   90....       MOV       DPTR,#bdbCommissioningProcedureState + 1
   \   000012   F0           MOVX      @DPTR,A
   2137            if(didSuccess)
   \   000013   EF           MOV       A,R7
   \   000014   6013         JZ        ??bdb_tcLinkKeyExchangeAttempt_0
   2138            {
   2139              //Allow try since we are performing a new step.
   2140              osal_stop_timerEx(bdb_TaskID, BDB_PROCESS_TIMEOUT);
   \   000016                ; Setup parameters for call to function osal_stop_timerEx
   \   000016   7A00         MOV       R2,#0x0
   \   000018   7B10         MOV       R3,#0x10
   \   00001A   90....       MOV       DPTR,#bdb_TaskID
   \   00001D   E0           MOVX      A,@DPTR
   \   00001E   F9           MOV       R1,A
   \   00001F   12....       LCALL     `??osal_stop_timerEx::?relay`; Banked call to: osal_stop_timerEx
   2141              bdbAttributes.bdbTCLinkKeyExchangeAttempts = 0;
   \   000022   90....       MOV       DPTR,#bdbAttributes + 16
   \   000025   E4           CLR       A
   \   000026   F0           MOVX      @DPTR,A
   \   000027   8002         SJMP      ??bdb_tcLinkKeyExchangeAttempt_1
   2142            }
   2143            else
   2144            {
   2145              bdbEventStatus = BDB_MSG_EVENT_FAIL;
   \                     ??bdb_tcLinkKeyExchangeAttempt_0:
   \   000029   7E01         MOV       R6,#0x1
   2146            }
   2147            bdb_SendMsg(bdb_TaskID,BDB_COMMISSIONING_STATE_TC_LINK_KEY_EXCHANGE,bdbEventStatus,1, &dummy);
   \                     ??bdb_tcLinkKeyExchangeAttempt_1:
   \   00002B                ; Setup parameters for call to function bdb_SendMsg
   \   00002B   A8..         MOV       R0,?XSP + 0
   \   00002D   A9..         MOV       R1,?XSP + 1
   \   00002F   88..         MOV       ?V2,R0
   \   000031   89..         MOV       ?V3,R1
   \   000033   78..         MOV       R0,#?V2
   \   000035   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000038   7C01         MOV       R4,#0x1
   \   00003A   EE           MOV       A,R6
   \   00003B   FB           MOV       R3,A
   \   00003C   7A01         MOV       R2,#0x1
   \   00003E   90....       MOV       DPTR,#bdb_TaskID
   \   000041   E0           MOVX      A,@DPTR
   \   000042   F9           MOV       R1,A
   \   000043   12....       LCALL     `??bdb_SendMsg::?relay`; Banked call to: bdb_SendMsg
   \   000046   7402         MOV       A,#0x2
   \   000048   12....       LCALL     ?DEALLOC_XSTACK8
   2148          }
   \   00004B   7401         MOV       A,#0x1
   \   00004D   80..         SJMP      ??Subroutine32_0
   2149          
   2150          
   2151           /*********************************************************************
   2152           * @fn          bdb_requestVerifyTCLinkKey
   2153           *
   2154           * @brief       Attempt to verify the TC link key by sending Verify Key Request
   2155           *
   2156           * @param       none
   2157           *
   2158           * @return      none
   2159           */
   2160          void bdb_requestVerifyTCLinkKey(void)
   2161          {
   2162              uint8 TC_ExtAddr[Z_EXTADDR_LEN];
   2163              APSME_VerifyKeyReq_t vKey;
   2164              
   2165              APSME_GetRequest( apsTrustCenterAddress,0, TC_ExtAddr );
   2166              
   2167              vKey.tcExtAddr = TC_ExtAddr;
   2168              vKey.keyType = KEY_TYPE_TC_LINK;
   2169              
   2170              APSME_VerifyKeyReq( &vKey );
   2171              
   2172              osal_stop_timerEx(bdb_TaskID,BDB_PROCESS_TIMEOUT);
   2173              osal_start_timerEx(bdb_TaskID,BDB_PROCESS_TIMEOUT,BDBC_TC_LINK_KEY_EXANGE_TIMEOUT);
   2174              
   2175          }
   2176          
   2177          /*********************************************************************
   2178           * @fn          bdb_requestTCLinkKey
   2179           *
   2180           * @brief       Attempt to request a TC link key
   2181           *
   2182           * @param       none
   2183           *
   2184           * @return      none
   2185           */
   2186          void bdb_requestTCLinkKey(void)
   2187          {
   2188            zAddrType_t destAddr;
   2189            APSME_RequestKeyReq_t req;
   2190          
   2191            destAddr.addrMode = Addr16Bit;
   2192            destAddr.addr.shortAddr = 0x0000;
   2193            
   2194            req.dstAddr = destAddr.addr.shortAddr;
   2195            req.keyType = KEY_TYPE_TC_LINK;
   2196            
   2197            APSME_RequestKeyReq(&req);
   2198            
   2199            osal_stop_timerEx(bdb_TaskID,BDB_PROCESS_TIMEOUT);
   2200            
   2201            osal_start_timerEx(bdb_TaskID,BDB_PROCESS_TIMEOUT,(uint32)requestLinkKeyTimeout);
   2202          } 
   2203          
   2204          
   2205          /*********************************************************************
   2206           * @fn          bdb_requestTCStackVersion
   2207           *
   2208           * @brief       Attempt to request the TC stack version using ZDP Node desc if 
   2209           *              join a Centralized nwk
   2210           *
   2211           * @param       none
   2212           *
   2213           * @return      none
   2214           */
   2215          void bdb_requestTCStackVersion(void)
   2216          {
   2217            if(requestNewTrustCenterLinkKey)
   2218            {
   2219              if(!APSME_IsDistributedSecurity())
   2220              {
   2221                if(bdbAttributes.bdbTCLinkKeyExchangeMethod == BDB_TC_LINK_KEY_EXCHANGE_APS_KEY)
   2222                {
   2223                  zAddrType_t destAddr;
   2224                 
   2225                  destAddr.addrMode = Addr16Bit;
   2226                  destAddr.addr.shortAddr = 0x0000;
   2227                 
   2228                  ZDP_NodeDescReq( &destAddr, destAddr.addr.shortAddr, 0);  
   2229                  
   2230                  osal_stop_timerEx(bdb_TaskID,BDB_PROCESS_TIMEOUT);
   2231                  osal_start_timerEx( bdb_TaskID, BDB_PROCESS_TIMEOUT, BDBC_TC_LINK_KEY_EXANGE_TIMEOUT );
   2232                  return;
   2233                }
   2234                else
   2235                {
   2236                  if(pfnCBKETCLinkKeyExchange)
   2237                  {
   2238                    pfnCBKETCLinkKeyExchange();
   2239                  }
   2240                  return;
   2241                }
   2242              }
   2243              else
   2244              {
   2245                bdb_setNodeJoinLinkKeyType(BDB_DISTRIBUTED_SECURITY_GLOBAL_LINK_KEY);
   2246              }
   2247            }
   2248            else
   2249            {
   2250              //Key not required, set default which is global
   2251              bdb_setNodeJoinLinkKeyType(BDB_DEFAULT_GLOBAL_TRUST_CENTER_LINK_KEY);
   2252            }
   2253            //TC link key not required or join distributed nwk
   2254            bdb_reportCommissioningState(BDB_COMMISSIONING_STATE_TC_LINK_KEY_EXCHANGE,TRUE);
   2255          }
   2256          #endif
   2257          
   2258          
   2259          /*********************************************************************
   2260           * @fn          bdb_nwkSteeringDeviceOnNwk
   2261           *
   2262           * @brief       Send ZDP mgmt permit joining
   2263           *
   2264           * @param       none
   2265           *
   2266           * @return      none
   2267           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2268          void bdb_nwkSteeringDeviceOnNwk(void)
   \                     bdb_nwkSteeringDeviceOnNwk:
   2269          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 9
   \   000004   74F7         MOV       A,#-0x9
   \   000006   12....       LCALL     ?ALLOC_XSTACK8
   2270            zAddrType_t dstAddr;
   2271            dstAddr.addr.shortAddr = NWK_BROADCAST_SHORTADDR_DEVZCZR;
   \   000009   85..82       MOV       DPL,?XSP + 0
   \   00000C   85..83       MOV       DPH,?XSP + 1
   \   00000F   74FC         MOV       A,#-0x4
   \   000011   F0           MOVX      @DPTR,A
   \   000012   A3           INC       DPTR
   \   000013   74FF         MOV       A,#-0x1
   \   000015   F0           MOVX      @DPTR,A
   2272            dstAddr.addrMode = AddrBroadcast;
   \   000016   7408         MOV       A,#0x8
   \   000018   12....       LCALL     ?XSTACK_DISP0_8
   \   00001B   740F         MOV       A,#0xf
   \   00001D   F0           MOVX      @DPTR,A
   2273            // Trust Center significance is always true
   2274            ZDP_MgmtPermitJoinReq( &dstAddr, BDBC_MIN_COMMISSIONING_TIME, TRUE, FALSE );
   \   00001E                ; Setup parameters for call to function ZDP_MgmtPermitJoinReq
   \   00001E   7D00         MOV       R5,#0x0
   \   000020   7C01         MOV       R4,#0x1
   \   000022   79B4         MOV       R1,#-0x4c
   \   000024   AA..         MOV       R2,?XSP + 0
   \   000026   AB..         MOV       R3,?XSP + 1
   \   000028   12....       LCALL     `??ZDP_MgmtPermitJoinReq::?relay`; Banked call to: ZDP_MgmtPermitJoinReq
   2275          }
   \   00002B   7409         MOV       A,#0x9
   \   00002D                REQUIRE ?Subroutine4
   \   00002D                ; // Fall through to label ?Subroutine4
   2276          
   2277          
   2278          /*********************************************************************
   2279           * @fn          bdb_startResumeCommissioningProcess
   2280           *
   2281           * @brief       Starts or resume the commissioning operations sets in the 
   2282           *              commissioningMode attribute
   2283           *
   2284           * @param       none
   2285           *
   2286           * @return      none
   2287           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2288          void bdb_startResumeCommissioningProcess(void)
   \                     bdb_startResumeCommissioningProcess:
   2289          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV       A,#-0xa
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 11
   \   000005   74F5         MOV       A,#-0xb
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   2290          
   2291          #if ( defined ( BDB_TL_INITIATOR ) && (BDB_TOUCHLINK_CAPABILITY_ENABLED == TRUE) ) 
   2292            if(bdbAttributes.bdbCommissioningMode & BDB_COMMISSIONING_MODE_INITIATOR_TL)
   2293            {
   2294              uint16 nwkAddr;
   2295          
   2296              //Does the device supports this commissioning mode?
   2297              if(bdbAttributes.bdbNodeCommissioningCapability & BDB_TOUCHLINK_CAPABILITY)
   2298              {
   2299                //Clear previous state and substates
   2300                osal_memset(&bdbCommissioningProcedureState,0,sizeof(bdbCommissioningProcedureState));
   2301                bdbCommissioningProcedureState.bdbCommissioningState = BDB_COMMISSIONING_STATE_TL;
   2302                
   2303                // Get our short address
   2304                ZMacGetReq( ZMacShortAddress, (byte*)&nwkAddr );
   2305                if ( nwkAddr >= NWK_BROADCAST_SHORTADDR_DEVZCZR )
   2306                {
   2307                  initiatorSelectNwkParams();
   2308                }
   2309                
   2310                touchLinkInitiator_StartDevDisc( );  
   2311                
   2312                bdb_NotifyCommissioningModeStart(BDB_COMMISSIONING_TOUCHLINK);
   2313              }
   2314              else
   2315              {
   2316                //Process the next commissioning mode
   2317                bdb_reportCommissioningState( BDB_COMMISSIONING_STATE_TL, FALSE );
   2318              }
   2319              return;
   2320            }
   2321          #endif // BDB_TOUCHLINK_CAPABILITY_ENABLED  
   2322            
   2323          #if ZG_BUILD_ENDDEVICE_TYPE
   2324            if(ZG_DEVICE_ENDDEVICE_TYPE)
   2325            {
   2326              if(bdbAttributes.bdbCommissioningMode & BDB_COMMISSIONING_MODE_PARENT_LOST)
   \   00000A   90....       MOV       DPTR,#bdbAttributes + 11
   \   00000D   E0           MOVX      A,@DPTR
   \   00000E   A2E5         MOV       C,0xE0 /* A   */.5
   \   000010   5003         JNC       $+5
   \   000012   02....       LJMP      ??bdb_startResumeCommissioningProcess_0 & 0xFFFF
   2327              {
   2328                //No commissioning process can be performed if the ZED has lost its parent
   2329                return;
   2330              }
   2331            }
   2332          #endif
   2333            
   2334            if(bdbAttributes.bdbCommissioningMode & BDB_COMMISSIONING_MODE_NWK_STEERING)
   \   000015   A2E1         MOV       C,0xE0 /* A   */.1
   \   000017   5053         JNC       ??bdb_startResumeCommissioningProcess_1
   2335            {
   2336              bdbCommissioningProcedureState.bdbCommissioningState = BDB_COMMISSIONING_STATE_STEERING_ON_NWK;
   \   000019   90....       MOV       DPTR,#bdbCommissioningProcedureState
   \   00001C   7404         MOV       A,#0x4
   \   00001E   F0           MOVX      @DPTR,A
   2337              
   2338              if(bdbAttributes.bdbNodeCommissioningCapability & BDB_NETWORK_STEERING_CAPABILITY)
   \   00001F   90....       MOV       DPTR,#bdbAttributes + 12
   \   000022   E0           MOVX      A,@DPTR
   \   000023   A2E0         MOV       C,0xE0 /* A   */.0
   \   000025   5042         JNC       ??bdb_startResumeCommissioningProcess_2
   2339              {
   2340          #if (BDB_TOUCHLINK_CAPABILITY_ENABLED == TRUE)
   2341                bdb_ClearNetworkParams();
   2342          #endif
   2343                if(bdbAttributes.bdbNodeIsOnANetwork)
   \   000027   90....       MOV       DPTR,#bdbAttributes + 14
   \   00002A   E0           MOVX      A,@DPTR
   \   00002B   600C         JZ        ??bdb_startResumeCommissioningProcess_3
   2344                {
   2345                  bdb_nwkSteeringDeviceOnNwk();
   \   00002D                ; Setup parameters for call to function bdb_nwkSteeringDeviceOnNwk
   \   00002D   12....       LCALL     `??bdb_nwkSteeringDeviceOnNwk::?relay`; Banked call to: bdb_nwkSteeringDeviceOnNwk
   2346                  bdb_reportCommissioningState(BDB_COMMISSIONING_STATE_STEERING_ON_NWK, TRUE);
   \   000030                ; Setup parameters for call to function bdb_reportCommissioningState
   \   000030   7A01         MOV       R2,#0x1
   \   000032   7904         MOV       R1,#0x4
   \   000034   12....       LCALL     `??bdb_reportCommissioningState::?relay`; Banked call to: bdb_reportCommissioningState
   \   000037   8030         SJMP      ??bdb_startResumeCommissioningProcess_2
   2347                }
   2348          #if (ZG_BUILD_JOINING_TYPE)
   2349                else
   2350                {
   2351                  if(ZG_DEVICE_JOINING_TYPE)
   \                     ??bdb_startResumeCommissioningProcess_3:
   \   000039   90....       MOV       DPTR,#zgDeviceLogicalType
   \   00003C   E0           MOVX      A,@DPTR
   \   00003D   6401         XRL       A,#0x1
   \   00003F   6005         JZ        ??bdb_startResumeCommissioningProcess_4
   \   000041   E0           MOVX      A,@DPTR
   \   000042   6402         XRL       A,#0x2
   \   000044   7023         JNZ       ??bdb_startResumeCommissioningProcess_2
   2352                  {
   2353                    vDoPrimaryScan = TRUE;
   \                     ??bdb_startResumeCommissioningProcess_4:
   \   000046   90....       MOV       DPTR,#vDoPrimaryScan
   \   000049   7401         MOV       A,#0x1
   \   00004B   F0           MOVX      @DPTR,A
   2354                    
   2355                    //Initialize the commissioning procedure state, bdbJoinState to nwk discovery and TCLinkKeyExchange to not active
   2356                    osal_memset(&bdbCommissioningProcedureState,0,sizeof(bdbCommissioningProcedureState_t));
   \   00004C                ; Setup parameters for call to function osal_memset
   \   00004C   7C04         MOV       R4,#0x4
   \   00004E   7D00         MOV       R5,#0x0
   \   000050   7900         MOV       R1,#0x0
   \   000052   7A..         MOV       R2,#bdbCommissioningProcedureState & 0xff
   \   000054   7B..         MOV       R3,#(bdbCommissioningProcedureState >> 8) & 0xff
   \   000056   12....       LCALL     `??osal_memset::?relay`; Banked call to: osal_memset
   2357                    bdbCommissioningProcedureState.bdbCommissioningState = BDB_COMMISSIONING_STATE_JOINING;
   \   000059   90....       MOV       DPTR,#bdbCommissioningProcedureState
   \   00005C   7403         MOV       A,#0x3
   \   00005E   F0           MOVX      @DPTR,A
   2358                    bdb_nwkJoiningFormation(TRUE);
   \   00005F                ; Setup parameters for call to function bdb_nwkJoiningFormation
   \   00005F   7901         MOV       R1,#0x1
   \   000061   12....       LCALL     `??bdb_nwkJoiningFormation::?relay`; Banked call to: bdb_nwkJoiningFormation
   2359                    bdb_NotifyCommissioningModeStart(BDB_COMMISSIONING_NWK_STEERING);
   \   000064                ; Setup parameters for call to function bdb_NotifyCommissioningModeStart
   \   000064   7901         MOV       R1,#0x1
   \   000066   12....       LCALL     `??bdb_NotifyCommissioningModeStart::?relay`; Banked call to: bdb_NotifyCommissioningModeStart
   2360                  }
   2361                }
   2362          #endif
   2363          #if (ZG_BUILD_COORDINATOR_TYPE)
   2364                if(ZG_DEVICE_COORDINATOR_TYPE)
   2365                {
   2366                  bdb_reportCommissioningState(BDB_COMMISSIONING_STATE_STEERING_ON_NWK, FALSE);
   2367                }
   2368          #endif
   2369              }
   2370              return;
   \                     ??bdb_startResumeCommissioningProcess_2:
   \   000069   02....       LJMP      ??bdb_startResumeCommissioningProcess_0 & 0xFFFF
   2371            }
   2372            
   2373            if(bdbAttributes.bdbCommissioningMode & BDB_COMMISSIONING_MODE_NWK_FORMATION)
   \                     ??bdb_startResumeCommissioningProcess_1:
   \   00006C   A2E2         MOV       C,0xE0 /* A   */.2
   \   00006E   500F         JNC       ??bdb_startResumeCommissioningProcess_5
   2374            {
   2375              bdbCommissioningProcedureState.bdbCommissioningState = BDB_COMMISSIONING_STATE_FORMATION;
   \   000070   90....       MOV       DPTR,#bdbCommissioningProcedureState
   \   000073   7405         MOV       A,#0x5
   \   000075   F0           MOVX      @DPTR,A
   2376              
   2377              if(bdbAttributes.bdbNodeCommissioningCapability & BDB_NETWORK_FORMATION_CAPABILITY)
   2378              {
   2379                if(!bdbAttributes.bdbNodeIsOnANetwork)
   2380                {
   2381          #if (BDB_TOUCHLINK_CAPABILITY_ENABLED == TRUE)
   2382                bdb_ClearNetworkParams();
   2383          #endif
   2384                  vDoPrimaryScan = TRUE;
   2385                  
   2386                  osal_memset(&bdbCommissioningProcedureState,0,sizeof(bdbCommissioningProcedureState));
   2387                  bdbCommissioningProcedureState.bdbCommissioningState = BDB_COMMISSIONING_STATE_FORMATION;
   2388          
   2389                  bdb_nwkJoiningFormation(FALSE);
   2390                  bdb_NotifyCommissioningModeStart(BDB_COMMISSIONING_FORMATION);
   2391                  return;
   2392                }
   2393              }
   2394              bdb_reportCommissioningState(BDB_COMMISSIONING_STATE_FORMATION, FALSE);
   \   000076                ; Setup parameters for call to function bdb_reportCommissioningState
   \   000076   7A00         MOV       R2,#0x0
   \   000078   F9           MOV       R1,A
   \   000079   12....       LCALL     `??bdb_reportCommissioningState::?relay`; Banked call to: bdb_reportCommissioningState
   2395              return;
   \   00007C   02....       LJMP      ??bdb_startResumeCommissioningProcess_0 & 0xFFFF
   2396            }
   2397          
   2398          #if (BDB_FINDING_BINDING_CAPABILITY_ENABLED==1)    
   2399            if(bdbAttributes.bdbCommissioningMode & BDB_COMMISSIONING_MODE_FINDING_BINDING)
   \                     ??bdb_startResumeCommissioningProcess_5:
   \   00007F   A2E3         MOV       C,0xE0 /* A   */.3
   \   000081   4003         JC        $+5
   \   000083   02....       LJMP      ??bdb_startResumeCommissioningProcess_0 & 0xFFFF
   2400            {
   2401              bdbCommissioningProcedureState.bdbCommissioningState = BDB_COMMISSIONING_STATE_FINDING_BINDING;
   \   000086   90....       MOV       DPTR,#bdbCommissioningProcedureState
   \   000089   7406         MOV       A,#0x6
   \   00008B   F0           MOVX      @DPTR,A
   2402              
   2403              //Is the device on a network?
   2404              if(bdb_isDeviceNonFactoryNew())
   \   00008C   90....       MOV       DPTR,#bdbAttributes + 14
   \   00008F   E0           MOVX      A,@DPTR
   \   000090   7003         JNZ       $+5
   \   000092   02....       LJMP      ??bdb_startResumeCommissioningProcess_6 & 0xFFFF
   2405              {
   2406                zclAttrRec_t attrRec;
   2407          
   2408                endPointDesc_t *bdb_CurrEpDescriptor = NULL;
   2409          
   2410                bdb_CurrEpDescriptor = bdb_setEpDescListToActiveEndpoint();
   \   000095                ; Setup parameters for call to function bdb_setEpDescListToActiveEndpoint
   \   000095   12....       LCALL     `??bdb_setEpDescListToActiveEndpoint::?relay`; Banked call to: bdb_setEpDescListToActiveEndpoint
   \   000098   8A..         MOV       ?V0,R2
   \   00009A   8B..         MOV       ?V1,R3
   \   00009C   AE..         MOV       R6,?V0
   \   00009E   AF..         MOV       R7,?V1
   2411                
   2412                //If not found endpoint with Identify cluster is found, then report fail
   2413                if(bdb_CurrEpDescriptor == NULL)
   \   0000A0   EE           MOV       A,R6
   \   0000A1   4F           ORL       A,R7
   \   0000A2   7003         JNZ       $+5
   \   0000A4   02....       LJMP      ??bdb_startResumeCommissioningProcess_6 & 0xFFFF
   2414                {
   2415                  bdb_exitFindingBindingWStatus(BDB_COMMISSIONING_FAILURE);
   \   0000A7                ; Setup parameters for call to function bdb_exitFindingBindingWStatus
   2416                  return;
   2417                }
   2418                
   2419                if( bdb_CurrEpDescriptorList->epDesc->epType & BDB_FINDING_AND_BINDING_TARGET)  //F&B as Target
   \   0000A7   12....       LCALL     ?Subroutine17 & 0xFFFF
   \                     ??CrossCallReturnLabel_26:
   \   0000AA   F8           MOV       R0,A
   \   0000AB   A3           INC       DPTR
   \   0000AC   12....       LCALL     ??Subroutine34_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_61:
   \   0000AF   A3           INC       DPTR
   \   0000B0   E0           MOVX      A,@DPTR
   \   0000B1   A2E1         MOV       C,0xE0 /* A   */.1
   \   0000B3   4003         JC        $+5
   \   0000B5   02....       LJMP      ??bdb_startResumeCommissioningProcess_7 & 0xFFFF
   2420                {
   2421                  if (zclFindAttrRec( bdb_CurrEpDescriptor->endPoint, ZCL_CLUSTER_ID_GEN_IDENTIFY,
   2422                            ATTRID_IDENTIFY_TIME, &attrRec ) )
   \   0000B8                ; Setup parameters for call to function zclFindAttrRec
   \   0000B8   7403         MOV       A,#0x3
   \   0000BA   12....       LCALL     ?XSTACK_DISP100_8
   \   0000BD   88..         MOV       ?V0,R0
   \   0000BF   89..         MOV       ?V1,R1
   \   0000C1   78..         MOV       R0,#?V0
   \   0000C3   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000C6   7C00         MOV       R4,#0x0
   \   0000C8   7D00         MOV       R5,#0x0
   \   0000CA   7A03         MOV       R2,#0x3
   \   0000CC   7B00         MOV       R3,#0x0
   \   0000CE   8E82         MOV       DPL,R6
   \   0000D0   8F83         MOV       DPH,R7
   \   0000D2   E0           MOVX      A,@DPTR
   \   0000D3   F9           MOV       R1,A
   \   0000D4   12....       LCALL     `??zclFindAttrRec::?relay`; Banked call to: zclFindAttrRec
   \   0000D7   7402         MOV       A,#0x2
   \   0000D9   12....       LCALL     ?DEALLOC_XSTACK8
   \   0000DC   E9           MOV       A,R1
   \   0000DD   7003         JNZ       $+5
   \   0000DF   02....       LJMP      ??bdb_startResumeCommissioningProcess_8 & 0xFFFF
   2423                  {
   2424                    //Set it to at less 180 
   2425                    if ( *((uint16*)attrRec.attr.dataPtr) <= BDBC_MIN_COMMISSIONING_TIME )
   \   0000E2   7409         MOV       A,#0x9
   \   0000E4   12....       LCALL     ?XSTACK_DISP0_8
   \   0000E7   12....       LCALL     ?Subroutine16 & 0xFFFF
   \                     ??CrossCallReturnLabel_23:
   \   0000EA   C3           CLR       C
   \   0000EB   E0           MOVX      A,@DPTR
   \   0000EC   94B5         SUBB      A,#-0x4b
   \   0000EE   A3           INC       DPTR
   \   0000EF   E0           MOVX      A,@DPTR
   \   0000F0   9400         SUBB      A,#0x0
   \   0000F2   5040         JNC       ??bdb_startResumeCommissioningProcess_9
   2426                    {
   2427                      *((uint16*)attrRec.attr.dataPtr) = BDBC_MIN_COMMISSIONING_TIME;
   \   0000F4   8882         MOV       DPL,R0
   \   0000F6   8983         MOV       DPH,R1
   \   0000F8   74B4         MOV       A,#-0x4c
   \   0000FA   F0           MOVX      @DPTR,A
   \   0000FB   A3           INC       DPTR
   \   0000FC   E4           CLR       A
   \   0000FD   F0           MOVX      @DPTR,A
   2428                       osal_start_timerEx( bdb_TaskID, BDB_IDENTIFY_TIMEOUT, 1000 );
   \   0000FE                ; Setup parameters for call to function osal_start_timerEx
   \   0000FE   90....       MOV       DPTR,#__Constant_3e8
   \   000101   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   000104   7A00         MOV       R2,#0x0
   \   000106   7B20         MOV       R3,#0x20
   \   000108   90....       MOV       DPTR,#bdb_TaskID
   \   00010B   E0           MOVX      A,@DPTR
   \   00010C   F9           MOV       R1,A
   \   00010D   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   000110   7404         MOV       A,#0x4
   \   000112   12....       LCALL     ?DEALLOC_XSTACK8
   2429          
   2430                      if(pfnIdentifyTimeChangeCB != NULL)
   \   000115   90....       MOV       DPTR,#pfnIdentifyTimeChangeCB
   \   000118   12....       LCALL     ??Subroutine36_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_79:
   \   00011B   6017         JZ        ??bdb_startResumeCommissioningProcess_9
   2431                      {
   2432                        if(bdbIndentifyActiveEndpoint == 0xFF)
   \   00011D   90....       MOV       DPTR,#bdbIndentifyActiveEndpoint
   \   000120   E0           MOVX      A,@DPTR
   \   000121   F4           CPL       A
   \   000122   7004         JNZ       ??bdb_startResumeCommissioningProcess_10
   2433                        {
   2434                          pfnIdentifyTimeChangeCB(bdbIndentifyActiveEndpoint);  
   \   000124                ; Setup parameters for indirect call
   \   000124   79FF         MOV       R1,#-0x1
   \   000126   8006         SJMP      ??bdb_startResumeCommissioningProcess_11
   2435                        }
   2436                        else
   2437                        {
   2438                          pfnIdentifyTimeChangeCB(bdb_CurrEpDescriptor->endPoint);
   \                     ??bdb_startResumeCommissioningProcess_10:
   \   000128                ; Setup parameters for indirect call
   \   000128   8E82         MOV       DPL,R6
   \   00012A   8F83         MOV       DPH,R7
   \   00012C   E0           MOVX      A,@DPTR
   \   00012D   F9           MOV       R1,A
   2439                        }
   2440                      }
   2441                    }
   \                     ??bdb_startResumeCommissioningProcess_11:
   \   00012E   12....       LCALL     ?Subroutine18 & 0xFFFF
   \                     ??CrossCallReturnLabel_64:
   \   000131   12....       LCALL     ?CALL_IND
   2442                    //Attribute found and set, report success
   2443                    if(!(bdb_CurrEpDescriptorList->epDesc->epType & BDB_FINDING_AND_BINDING_INITIATOR))
   \                     ??bdb_startResumeCommissioningProcess_9:
   \   000134   12....       LCALL     ?Subroutine13 & 0xFFFF
   \                     ??CrossCallReturnLabel_16:
   \   000137   4004         JC        ??bdb_startResumeCommissioningProcess_12
   2444                    {
   2445                      bdb_exitFindingBindingWStatus(BDB_COMMISSIONING_FB_TARGET_IN_PROGRESS);
   \   000139                ; Setup parameters for call to function bdb_exitFindingBindingWStatus
   \   000139   7909         MOV       R1,#0x9
   \   00013B   802C         SJMP      ??bdb_startResumeCommissioningProcess_13
   2446                    }
   2447                    else
   2448                    {
   2449                      bdbCommissioningModeMsg_t bdbCommissioningModeMsg;
   2450          
   2451                      bdbCommissioningModeMsg.bdbCommissioningMode = BDB_COMMISSIONING_FINDING_BINDING;
   \                     ??bdb_startResumeCommissioningProcess_12:
   \   00013D   7401         MOV       A,#0x1
   \   00013F   12....       LCALL     ?XSTACK_DISP0_8
   \   000142   12....       LCALL     ?Subroutine8 & 0xFFFF
   2452                      bdbCommissioningModeMsg.bdbCommissioningStatus = BDB_COMMISSIONING_FB_TARGET_IN_PROGRESS;
   2453          
   2454                      bdb_NotifyApp((uint8*)&bdbCommissioningModeMsg);
   2455                    }
   2456                  }
   \                     ??CrossCallReturnLabel_84:
   \   000145   7409         MOV       A,#0x9
   \   000147   12....       LCALL     ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_2:
   \   00014A   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00014D   7C03         MOV       R4,#0x3
   \   00014F   7B00         MOV       R3,#0x0
   \   000151   7A0A         MOV       R2,#0xa
   \   000153   90....       MOV       DPTR,#bdb_TaskID
   \   000156   E0           MOVX      A,@DPTR
   \   000157   F9           MOV       R1,A
   \   000158   12....       LCALL     `??bdb_SendMsg::?relay`; Banked call to: bdb_SendMsg
   \   00015B   7402         MOV       A,#0x2
   \   00015D   12....       LCALL     ?DEALLOC_XSTACK8
   \   000160   800A         SJMP      ??bdb_startResumeCommissioningProcess_7
   2457                  else
   2458                  {
   2459                    //Attribute not found and no initiator process, report fail
   2460                    if(!(bdb_CurrEpDescriptorList->epDesc->epType & BDB_FINDING_AND_BINDING_INITIATOR))
   \                     ??bdb_startResumeCommissioningProcess_8:
   \   000162   12....       LCALL     ?Subroutine13 & 0xFFFF
   \                     ??CrossCallReturnLabel_17:
   \   000165   4005         JC        ??bdb_startResumeCommissioningProcess_7
   2461                    {
   2462                      bdb_exitFindingBindingWStatus(BDB_COMMISSIONING_FAILURE);
   \   000167                ; Setup parameters for call to function bdb_exitFindingBindingWStatus
   \   000167   790E         MOV       R1,#0xe
   \                     ??bdb_startResumeCommissioningProcess_13:
   \   000169   12....       LCALL     `??bdb_exitFindingBindingWStatus::?relay`; Banked call to: bdb_exitFindingBindingWStatus
   2463                    }
   2464                  }
   2465                }  //F&B Target
   2466                
   2467                if( bdb_CurrEpDescriptorList->epDesc->epType & BDB_FINDING_AND_BINDING_INITIATOR)  //F&B as Initiator
   \                     ??bdb_startResumeCommissioningProcess_7:
   \   00016C   12....       LCALL     ?Subroutine17 & 0xFFFF
   \                     ??CrossCallReturnLabel_27:
   \   00016F   2401         ADD       A,#0x1
   \   000171   F8           MOV       R0,A
   \   000172   A3           INC       DPTR
   \   000173   E0           MOVX      A,@DPTR
   \   000174   3400         ADDC      A,#0x0
   \   000176   F9           MOV       R1,A
   \   000177   8882         MOV       DPL,R0
   \   000179   8983         MOV       DPH,R1
   \   00017B   E0           MOVX      A,@DPTR
   \   00017C   A2E0         MOV       C,0xE0 /* A   */.0
   \   00017E   5069         JNC       ??bdb_startResumeCommissioningProcess_0
   2468                {
   2469                  bdbCommissioningModeMsg_t bdbCommissioningModeMsg;
   2470                  
   2471                  //If no function to add binds is available then do not process Initiator
   2472                  if(!pbindAddEntry)
   \   000180   90....       MOV       DPTR,#pbindAddEntry
   \   000183   12....       LCALL     ?Subroutine14 & 0xFFFF
   \                     ??CrossCallReturnLabel_19:
   \   000186   7010         JNZ       ??bdb_startResumeCommissioningProcess_14
   2473                  {
   2474                    //If no target process, then report fail
   2475                    if(!(bdb_CurrEpDescriptorList->epDesc->epType & BDB_FINDING_AND_BINDING_TARGET))
   \   000188   8882         MOV       DPL,R0
   \   00018A   8983         MOV       DPH,R1
   \   00018C   E0           MOVX      A,@DPTR
   \   00018D   A2E1         MOV       C,0xE0 /* A   */.1
   \   00018F   4058         JC        ??bdb_startResumeCommissioningProcess_0
   2476                    {
   2477                      bdb_exitFindingBindingWStatus(BDB_COMMISSIONING_FAILURE);
   2478                    }        
   2479                  }
   2480                  else
   2481                  {
   2482                    //Send identify query with the endpoint requested
   2483                    if(bdb_SendIdentifyQuery(bdb_CurrEpDescriptor->endPoint) != ZSuccess)
   2484                    {
   2485                      bdb_exitFindingBindingWStatus(BDB_COMMISSIONING_FAILURE);
   2486                    }
   2487          
   2488                    //If periodic F&B is enabled
   2489                    if ( FINDING_AND_BINDING_PERIODIC_ENABLE == TRUE )
   2490                    {
   2491                      // total F&B time will be at least BDBC_MIN_COMMISSIONING_TIME, and at most (BDBC_MIN_COMMISSIONING_TIME + FINDING_AND_BINDING_PERIODIC_TIME - 1)
   2492                      bdb_FB_InitiatorCurrentCyclesNumber = (BDBC_MIN_COMMISSIONING_TIME + (FINDING_AND_BINDING_PERIODIC_TIME - 1)) / FINDING_AND_BINDING_PERIODIC_TIME;
   2493                      
   2494                      osal_start_timerEx(bdb_TaskID, BDB_FINDING_AND_BINDING_PERIOD_TIMEOUT, FINDING_AND_BINDING_PERIODIC_TIME * 1000);
   2495                    }
   2496          
   2497                    bdbCommissioningModeMsg.bdbCommissioningMode = BDB_COMMISSIONING_FINDING_BINDING;
   2498                    bdbCommissioningModeMsg.bdbCommissioningStatus = BDB_COMMISSIONING_FB_INITITATOR_IN_PROGRESS;
   2499          
   2500                    bdb_NotifyApp((uint8*)&bdbCommissioningModeMsg);
   2501                  }
   2502                } //F&B Initiator
   2503              }
   2504              //Not in the network
   2505              else
   2506              {
   2507                bdb_exitFindingBindingWStatus(BDB_COMMISSIONING_FAILURE);
   \                     ??bdb_startResumeCommissioningProcess_6:
   \   000191                ; Setup parameters for call to function bdb_exitFindingBindingWStatus
   \   000191   790E         MOV       R1,#0xe
   \   000193   12....       LCALL     `??bdb_exitFindingBindingWStatus::?relay`; Banked call to: bdb_exitFindingBindingWStatus
   2508              }
   2509              
   2510              return;
   \   000196   8051         SJMP      ??bdb_startResumeCommissioningProcess_0
   \                     ??bdb_startResumeCommissioningProcess_14:
   \   000198                ; Setup parameters for call to function bdb_SendIdentifyQuery
   \   000198   8E82         MOV       DPL,R6
   \   00019A   8F83         MOV       DPH,R7
   \   00019C   E0           MOVX      A,@DPTR
   \   00019D   F9           MOV       R1,A
   \   00019E   12....       LCALL     `??bdb_SendIdentifyQuery::?relay`; Banked call to: bdb_SendIdentifyQuery
   \   0001A1   E9           MOV       A,R1
   \   0001A2   6005         JZ        ??bdb_startResumeCommissioningProcess_15
   \   0001A4                ; Setup parameters for call to function bdb_exitFindingBindingWStatus
   \   0001A4   790E         MOV       R1,#0xe
   \   0001A6   12....       LCALL     `??bdb_exitFindingBindingWStatus::?relay`; Banked call to: bdb_exitFindingBindingWStatus
   \                     ??bdb_startResumeCommissioningProcess_15:
   \   0001A9   90....       MOV       DPTR,#bdb_FB_InitiatorCurrentCyclesNumber
   \   0001AC   740C         MOV       A,#0xc
   \   0001AE   F0           MOVX      @DPTR,A
   \   0001AF                ; Setup parameters for call to function osal_start_timerEx
   \   0001AF   90....       MOV       DPTR,#__Constant_3a98
   \   0001B2   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   0001B5   7A40         MOV       R2,#0x40
   \   0001B7   7B00         MOV       R3,#0x0
   \   0001B9   90....       MOV       DPTR,#bdb_TaskID
   \   0001BC   E0           MOVX      A,@DPTR
   \   0001BD   F9           MOV       R1,A
   \   0001BE   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   0001C1   7404         MOV       A,#0x4
   \   0001C3   12....       LCALL     ?DEALLOC_XSTACK8
   \   0001C6   7401         MOV       A,#0x1
   \   0001C8   12....       LCALL     ?XSTACK_DISP0_8
   \   0001CB   12....       LCALL     ?Subroutine8 & 0xFFFF
   2511            }
   \                     ??CrossCallReturnLabel_85:
   \   0001CE   740A         MOV       A,#0xa
   \   0001D0   12....       LCALL     ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_3:
   \   0001D3   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0001D6   7C03         MOV       R4,#0x3
   \   0001D8   7B00         MOV       R3,#0x0
   \   0001DA   7A0A         MOV       R2,#0xa
   \   0001DC   90....       MOV       DPTR,#bdb_TaskID
   \   0001DF   E0           MOVX      A,@DPTR
   \   0001E0   F9           MOV       R1,A
   \   0001E1   12....       LCALL     `??bdb_SendMsg::?relay`; Banked call to: bdb_SendMsg
   \   0001E4   7402         MOV       A,#0x2
   \   0001E6   12....       LCALL     ?DEALLOC_XSTACK8
   2512          #endif
   2513            
   2514          }
   \                     ??bdb_startResumeCommissioningProcess_0:
   \   0001E9   740B         MOV       A,#0xb
   \   0001EB   02....       LJMP      ??Subroutine40_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine18:
   \   000000   90....       MOV       DPTR,#pfnIdentifyTimeChangeCB + 1
   \   000003                REQUIRE ??Subroutine34_0
   \   000003                ; // Fall through to label ??Subroutine34_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine17:
   \   000000   12....       LCALL     ?Subroutine26 & 0xFFFF
   \                     ??CrossCallReturnLabel_48:
   \   000003   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine26:
   \   000000   90....       MOV       DPTR,#bdb_CurrEpDescriptorList
   \   000003   E0           MOVX      A,@DPTR
   \   000004   F8           MOV       R0,A
   \   000005   A3           INC       DPTR
   \   000006   E0           MOVX      A,@DPTR
   \   000007   F583         MOV       DPH,A
   \   000009   8882         MOV       DPL,R0
   \   00000B   A3           INC       DPTR
   \   00000C   A3           INC       DPTR
   \   00000D   E0           MOVX      A,@DPTR
   \   00000E   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine13:
   \   000000   12....       LCALL     ?Subroutine26 & 0xFFFF
   \                     ??CrossCallReturnLabel_47:
   \   000003   F8           MOV       R0,A
   \   000004   A3           INC       DPTR
   \   000005   E0           MOVX      A,@DPTR
   \   000006   F583         MOV       DPH,A
   \   000008   8882         MOV       DPL,R0
   \   00000A   A3           INC       DPTR
   \   00000B   E0           MOVX      A,@DPTR
   \   00000C   A2E0         MOV       C,0xE0 /* A   */.0
   \   00000E   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine8:
   \   000000   7403         MOV       A,#0x3
   \   000002                REQUIRE ??Subroutine37_0
   \   000002                ; // Fall through to label ??Subroutine37_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine14:
   \   000000   E0           MOVX      A,@DPTR
   \   000001   FA           MOV       R2,A
   \   000002   A3           INC       DPTR
   \   000003   E0           MOVX      A,@DPTR
   \   000004   FB           MOV       R3,A
   \   000005   EA           MOV       A,R2
   \   000006   4B           ORL       A,R3
   \   000007   22           RET
   2515          
   2516          /*********************************************************************
   2517           * @fn          bdb_event_loop
   2518           *
   2519           * @brief       Main event loop bdb tasks.
   2520           *
   2521           * @param       task_id - task id
   2522           * @param       events - event bitmap
   2523           *
   2524           * @return      unprocessed events
   2525           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2526          UINT16 bdb_event_loop(byte task_id, UINT16 events)
   \                     bdb_event_loop:
   2527          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000                REQUIRE ?V4
   \   000000                REQUIRE ?V6
   \   000000                REQUIRE ?V7
   \   000000   74F0         MOV       A,#-0x10
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 13
   \   000005   74F3         MOV       A,#-0xd
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   \   00000A   EA           MOV       A,R2
   \   00000B   FE           MOV       R6,A
   \   00000C   EB           MOV       A,R3
   \   00000D   FF           MOV       R7,A
   2528            (void)task_id;  // Intentionally unreferenced parameter
   2529            
   2530          #if (BDB_FINDING_BINDING_CAPABILITY_ENABLED==1)  
   2531            endPointDesc_t * bdb_CurrEpDescriptor;
   2532          #endif
   2533            
   2534            if(events & BDB_CHANGE_COMMISSIONING_STATE)
   \   00000E   EE           MOV       A,R6
   \   00000F   5404         ANL       A,#0x4
   \   000011   6052         JZ        ??bdb_event_loop_0
   2535            {
   2536              switch(bdbCommissioningProcedureState.bdbCommissioningState)
   \   000013   90....       MOV       DPTR,#bdbCommissioningProcedureState
   \   000016   E0           MOVX      A,@DPTR
   \   000017   600D         JZ        ??bdb_event_loop_1
   \   000019   14           DEC       A
   \   00001A   600F         JZ        ??bdb_event_loop_2
   \   00001C   24FD         ADD       A,#-0x3
   \   00001E   6014         JZ        ??bdb_event_loop_3
   \   000020   24FE         ADD       A,#-0x2
   \   000022   601C         JZ        ??bdb_event_loop_4
   \   000024   8039         SJMP      ??bdb_event_loop_5
   2537              {
   2538                case BDB_COMMISSIONING_STATE_START_RESUME:
   2539                  bdb_startResumeCommissioningProcess();
   \                     ??bdb_event_loop_1:
   \   000026                ; Setup parameters for call to function bdb_startResumeCommissioningProcess
   \   000026   12....       LCALL     `??bdb_startResumeCommissioningProcess::?relay`; Banked call to: bdb_startResumeCommissioningProcess
   2540                break;
   \   000029   8034         SJMP      ??bdb_event_loop_5
   2541                
   2542                case BDB_COMMISSIONING_STATE_TC_LINK_KEY_EXCHANGE:
   2543                  if (ZG_BUILD_JOINING_TYPE)
   2544                  {
   2545                    bdb_tcLinkKeyExchangeAttempt(TRUE,BDB_REQ_TC_STACK_VERSION);
   \                     ??bdb_event_loop_2:
   \   00002B                ; Setup parameters for call to function bdb_tcLinkKeyExchangeAttempt
   \   00002B   7A01         MOV       R2,#0x1
   \   00002D   7901         MOV       R1,#0x1
   \   00002F   12....       LCALL     `??bdb_tcLinkKeyExchangeAttempt::?relay`; Banked call to: bdb_tcLinkKeyExchangeAttempt
   2546                  }
   2547                break;
   \   000032   802B         SJMP      ??bdb_event_loop_5
   2548                
   2549                case BDB_COMMISSIONING_STATE_STEERING_ON_NWK:
   2550                  bdb_nwkSteeringDeviceOnNwk();
   \                     ??bdb_event_loop_3:
   \   000034                ; Setup parameters for call to function bdb_nwkSteeringDeviceOnNwk
   \   000034   12....       LCALL     `??bdb_nwkSteeringDeviceOnNwk::?relay`; Banked call to: bdb_nwkSteeringDeviceOnNwk
   2551                  
   2552                  bdb_reportCommissioningState(BDB_COMMISSIONING_STATE_STEERING_ON_NWK, TRUE);
   \   000037                ; Setup parameters for call to function bdb_reportCommissioningState
   \   000037   7A01         MOV       R2,#0x1
   \   000039   7904         MOV       R1,#0x4
   \   00003B   12....       LCALL     `??bdb_reportCommissioningState::?relay`; Banked call to: bdb_reportCommissioningState
   2553                break;
   \   00003E   801F         SJMP      ??bdb_event_loop_5
   2554                
   2555                case BDB_COMMISSIONING_STATE_FINDING_BINDING:
   2556                  bdbAttributes.bdbCommissioningStatus = BDB_COMMISSIONING_SUCCESS;
   \                     ??bdb_event_loop_4:
   \   000040   90....       MOV       DPTR,#bdbAttributes + 10
   \   000043   E4           CLR       A
   \   000044   F0           MOVX      @DPTR,A
   2557                  bdbCommissioningProcedureState.bdbCommissioningState = BDB_COMMISSIONING_STATE_START_RESUME;
   \   000045   90....       MOV       DPTR,#bdbCommissioningProcedureState
   \   000048   12....       LCALL     ??Subroutine39_0 & 0xFFFF
   2558                  osal_start_timerEx(bdb_TaskID,BDB_CHANGE_COMMISSIONING_STATE,50);
   \                     ??CrossCallReturnLabel_92:
   \   00004B   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   00004E   7A04         MOV       R2,#0x4
   \   000050   7B00         MOV       R3,#0x0
   \   000052   90....       MOV       DPTR,#bdb_TaskID
   \   000055   E0           MOVX      A,@DPTR
   \   000056   F9           MOV       R1,A
   \   000057   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   00005A   7404         MOV       A,#0x4
   \   00005C   12....       LCALL     ?DEALLOC_XSTACK8
   2559                break;
   2560                
   2561              }
   2562              return (events ^ BDB_CHANGE_COMMISSIONING_STATE);
   \                     ??bdb_event_loop_5:
   \   00005F   EE           MOV       A,R6
   \   000060   6404         XRL       A,#0x4
   \   000062   02....       LJMP      ??bdb_event_loop_6 & 0xFFFF
   2563            }
   2564          
   2565            if ( events & SYS_EVENT_MSG )
   \                     ??bdb_event_loop_0:
   \   000065   EF           MOV       A,R7
   \   000066   5480         ANL       A,#0x80
   \   000068   706E         JNZ       ??bdb_event_loop_7
   2566            {
   2567              uint8 *msg_ptr;
   2568              
   2569              while ( (msg_ptr = osal_msg_receive( bdb_TaskID )) )
   2570              {
   2571                //Process the Incomming ZDO messages used by BDB commissioning methods
   2572                if(((bdbInMsg_t*)msg_ptr)->hdr.event == BDB_ZDO_CB_MSG)
   2573                {
   2574                  bdb_processZDOMgs((zdoIncomingMsg_t *)msg_ptr);
   2575                }
   2576                
   2577                //Validate the is receive on the right process
   2578                else if(((bdbInMsg_t*)msg_ptr)->hdr.event == bdbCommissioningProcedureState.bdbCommissioningState)
   2579                {
   2580                  bdb_ProcessOSALMsg( (bdbInMsg_t *)msg_ptr );
   2581                }
   2582                //Notify the user
   2583                else if(((bdbInMsg_t*)msg_ptr)->hdr.event == BDB_NOTIFY_USER)
   2584                {
   2585                  ((bdbCommissioningModeMsg_t*) ((bdbInMsg_t*)msg_ptr)->buf)->bdbRemainingCommissioningModes = bdbAttributes.bdbCommissioningMode;
   2586                  if(pfnCommissioningStatusCB)
   2587                  {
   2588                    pfnCommissioningStatusCB((bdbCommissioningModeMsg_t*) (((bdbInMsg_t*)msg_ptr)->buf));
   2589                  }
   2590          #ifdef MT_APP_CNF_FUNC
   2591                  //Notify the host processor about the event
   2592                  MT_AppCnfCommissioningNotification((bdbCommissioningModeMsg_t*) (((bdbInMsg_t*)msg_ptr)->buf));
   2593          #endif
   2594                }
   2595          #if (ZG_BUILD_COORDINATOR_TYPE)
   2596                else
   2597                {
   2598                  if(ZG_DEVICE_COORDINATOR_TYPE)
   2599                  {
   2600                    //Notify the status 
   2601                    if(((bdbInMsg_t*)msg_ptr)->hdr.event == BDB_TC_LINK_KEY_EXCHANGE_PROCESS)
   2602                    {
   2603                      pfnTCLinkKeyExchangeProcessCB( (bdb_TCLinkKeyExchProcess_t*) ((bdbInMsg_t*)msg_ptr)->buf);
   2604                    }
   2605                  }
   2606                }
   2607          #endif
   2608                // Release the memory
   2609                osal_msg_deallocate( msg_ptr );
   2610              }
   2611          
   2612              // Return unprocessed events
   2613              return (events ^ SYS_EVENT_MSG);
   2614            }
   2615            
   2616          
   2617            if(events & BDB_PROCESS_TIMEOUT)
   \   00006A   EF           MOV       A,R7
   \   00006B   5410         ANL       A,#0x10
   \   00006D   7003         JNZ       $+5
   \   00006F   02....       LJMP      ??bdb_event_loop_8 & 0xFFFF
   2618            {
   2619              bdb_processTimeout();
   \   000072   90....       MOV       DPTR,#zgDeviceLogicalType
   \   000075   E0           MOVX      A,@DPTR
   \   000076   6401         XRL       A,#0x1
   \   000078   6008         JZ        ??bdb_event_loop_9
   \   00007A   E0           MOVX      A,@DPTR
   \   00007B   6402         XRL       A,#0x2
   \   00007D   6003         JZ        $+5
   \   00007F   02....       LJMP      ??bdb_event_loop_10 & 0xFFFF
   \                     ??bdb_event_loop_9:
   \   000082   90....       MOV       DPTR,#bdbCommissioningProcedureState
   \   000085   E0           MOVX      A,@DPTR
   \   000086   14           DEC       A
   \   000087   7003         JNZ       $+5
   \   000089   02....       LJMP      ??bdb_event_loop_11 & 0xFFFF
   \   00008C   24FE         ADD       A,#-0x2
   \   00008E   6003         JZ        $+5
   \   000090   02....       LJMP      ??bdb_event_loop_10 & 0xFFFF
   \   000093   90....       MOV       DPTR,#bdbCommissioningProcedureState + 2
   \   000096   E0           MOVX      A,@DPTR
   \   000097   6402         XRL       A,#0x2
   \   000099   6003         JZ        $+5
   \   00009B   02....       LJMP      ??bdb_event_loop_10 & 0xFFFF
   \   00009E   7401         MOV       A,#0x1
   \   0000A0   F0           MOVX      @DPTR,A
   \   0000A1                ; Setup parameters for call to function bdb_nwkAssocAttemt
   \   0000A1   7900         MOV       R1,#0x0
   \   0000A3   12....       LCALL     `??bdb_nwkAssocAttemt::?relay`; Banked call to: bdb_nwkAssocAttemt
   \   0000A6   02....       LJMP      ??bdb_event_loop_10 & 0xFFFF
   \                     ??bdb_event_loop_12:
   \   0000A9   740A         MOV       A,#0xa
   \   0000AB   68           XRL       A,R0
   \   0000AC   7023         JNZ       ??bdb_event_loop_13
   \   0000AE   90....       MOV       DPTR,#bdbAttributes + 11
   \   0000B1   E0           MOVX      A,@DPTR
   \   0000B2   8A82         MOV       DPL,R2
   \   0000B4   8B83         MOV       DPH,R3
   \   0000B6   A3           INC       DPTR
   \   0000B7   A3           INC       DPTR
   \   0000B8   A3           INC       DPTR
   \   0000B9   A3           INC       DPTR
   \   0000BA   F0           MOVX      @DPTR,A
   \   0000BB   90....       MOV       DPTR,#pfnCommissioningStatusCB
   \   0000BE   12....       LCALL     ??Subroutine36_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_80:
   \   0000C1   600E         JZ        ??bdb_event_loop_13
   \   0000C3                ; Setup parameters for indirect call
   \   0000C3   EA           MOV       A,R2
   \   0000C4   2402         ADD       A,#0x2
   \   0000C6   FA           MOV       R2,A
   \   0000C7   E4           CLR       A
   \   0000C8   35..         ADDC      A,?V1
   \   0000CA   FB           MOV       R3,A
   \   0000CB   12....       LCALL     ??Subroutine34_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_62:
   \   0000CE   12....       LCALL     ?CALL_IND
   \                     ??bdb_event_loop_13:
   \   0000D1                ; Setup parameters for call to function osal_msg_deallocate
   \   0000D1   AA..         MOV       R2,?V0
   \   0000D3   AB..         MOV       R3,?V1
   \   0000D5   12....       LCALL     `??osal_msg_deallocate::?relay`; Banked call to: osal_msg_deallocate
   \                     ??bdb_event_loop_7:
   \   0000D8                ; Setup parameters for call to function osal_msg_receive
   \   0000D8   90....       MOV       DPTR,#bdb_TaskID
   \   0000DB   E0           MOVX      A,@DPTR
   \   0000DC   F9           MOV       R1,A
   \   0000DD   12....       LCALL     `??osal_msg_receive::?relay`; Banked call to: osal_msg_receive
   \   0000E0   8A..         MOV       ?V0,R2
   \   0000E2   8B..         MOV       ?V1,R3
   \   0000E4   EA           MOV       A,R2
   \   0000E5   45..         ORL       A,?V1
   \   0000E7   604C         JZ        ??bdb_event_loop_14
   \   0000E9   8A82         MOV       DPL,R2
   \   0000EB   8B83         MOV       DPH,R3
   \   0000ED   E0           MOVX      A,@DPTR
   \   0000EE   F8           MOV       R0,A
   \   0000EF   74D3         MOV       A,#-0x2d
   \   0000F1   68           XRL       A,R0
   \   0000F2   7032         JNZ       ??bdb_event_loop_15
   \   0000F4   EA           MOV       A,R2
   \   0000F5   240C         ADD       A,#0xc
   \   0000F7   F582         MOV       DPL,A
   \   0000F9   E4           CLR       A
   \   0000FA   35..         ADDC      A,?V1
   \   0000FC   F583         MOV       DPH,A
   \   0000FE   E0           MOVX      A,@DPTR
   \   0000FF   F5..         MOV       ?V2,A
   \   000101   A3           INC       DPTR
   \   000102   E0           MOVX      A,@DPTR
   \   000103   F5..         MOV       ?V3,A
   \   000105   78..         MOV       R0,#?V2
   \   000107   12....       LCALL     ?US_SWITCH_DENSE
   \                     `?<Jumptable for bdb_event_loop>_0`:
   \   00010A   0180         DW        32769
   \   00010C   03           DB        3
   \   00010D   ....         DW        ??bdb_event_loop_13
   \   00010F   ....         DW        ??bdb_event_loop_16
   \   000111   ....         DW        ??bdb_event_loop_17
   \   000113   ....         DW        ??bdb_event_loop_13
   \   000115   ....         DW        ??bdb_event_loop_18
   \                     ??bdb_event_loop_17:
   \   000117                ; Setup parameters for call to function bdb_ProcessNodeDescRsp
   \   000117   12....       LCALL     `??bdb_ProcessNodeDescRsp::?relay`; Banked call to: bdb_ProcessNodeDescRsp
   \   00011A   80B5         SJMP      ??bdb_event_loop_13
   \                     ??bdb_event_loop_18:
   \   00011C                ; Setup parameters for call to function bdb_ProcessSimpleDesc
   \   00011C   12....       LCALL     `??bdb_ProcessSimpleDesc::?relay`; Banked call to: bdb_ProcessSimpleDesc
   \   00011F   80B0         SJMP      ??bdb_event_loop_13
   \                     ??bdb_event_loop_16:
   \   000121                ; Setup parameters for call to function bdb_ProcessIEEEAddrRsp
   \   000121   12....       LCALL     `??bdb_ProcessIEEEAddrRsp::?relay`; Banked call to: bdb_ProcessIEEEAddrRsp
   \   000124   80AB         SJMP      ??bdb_event_loop_13
   \                     ??bdb_event_loop_15:
   \   000126   90....       MOV       DPTR,#bdbCommissioningProcedureState
   \   000129   E0           MOVX      A,@DPTR
   \   00012A   68           XRL       A,R0
   \   00012B   6003         JZ        $+5
   \   00012D   02....       LJMP      ??bdb_event_loop_12 & 0xFFFF
   \   000130                ; Setup parameters for call to function bdb_ProcessOSALMsg
   \   000130   12....       LCALL     `??bdb_ProcessOSALMsg::?relay`; Banked call to: bdb_ProcessOSALMsg
   \   000133   809C         SJMP      ??bdb_event_loop_13
   \                     ??bdb_event_loop_14:
   \   000135   EE           MOV       A,R6
   \   000136   FA           MOV       R2,A
   \   000137   EF           MOV       A,R7
   \   000138   6480         XRL       A,#0x80
   \   00013A   02....       LJMP      ??bdb_event_loop_19 & 0xFFFF
   \                     ??bdb_event_loop_11:
   \   00013D                ; Setup parameters for call to function bdb_tcLinkKeyExchangeAttempt
   \   00013D   A3           INC       DPTR
   \   00013E   E0           MOVX      A,@DPTR
   \   00013F   FA           MOV       R2,A
   \   000140   7900         MOV       R1,#0x0
   \   000142   12....       LCALL     `??bdb_tcLinkKeyExchangeAttempt::?relay`; Banked call to: bdb_tcLinkKeyExchangeAttempt
   2620              // Return unprocessed events
   2621              return (events ^ BDB_PROCESS_TIMEOUT);
   \                     ??bdb_event_loop_10:
   \   000145   EE           MOV       A,R6
   \   000146   FA           MOV       R2,A
   \   000147   EF           MOV       A,R7
   \   000148   6410         XRL       A,#0x10
   \   00014A   02....       LJMP      ??bdb_event_loop_19 & 0xFFFF
   2622            }
   2623            
   2624            if(events &  BDB_REPORT_TIMEOUT){
   \                     ??bdb_event_loop_8:
   \   00014D   EE           MOV       A,R6
   \   00014E   5480         ANL       A,#0x80
   \   000150   6009         JZ        ??bdb_event_loop_20
   2625          #ifdef BDB_REPORTING    
   2626              bdb_RepProcessEvent();
   \   000152                ; Setup parameters for call to function bdb_RepProcessEvent
   \   000152   12....       LCALL     `??bdb_RepProcessEvent::?relay`; Banked call to: bdb_RepProcessEvent
   2627          #endif
   2628              // Return unprocessed events
   2629              return (events ^ BDB_REPORT_TIMEOUT);
   \   000155   EE           MOV       A,R6
   \   000156   6480         XRL       A,#0x80
   \   000158   02....       LJMP      ??bdb_event_loop_6 & 0xFFFF
   2630            }
   2631            
   2632          #if (ZG_BUILD_JOINING_TYPE)
   2633            if(events & BDB_TC_LINK_KEY_EXCHANGE_FAIL)
   \                     ??bdb_event_loop_20:
   \   00015B   EE           MOV       A,R6
   \   00015C   5402         ANL       A,#0x2
   \   00015E   603A         JZ        ??bdb_event_loop_21
   2634            {
   2635              if(ZG_DEVICE_JOINING_TYPE)
   \   000160   90....       MOV       DPTR,#zgDeviceLogicalType
   \   000163   E0           MOVX      A,@DPTR
   \   000164   6401         XRL       A,#0x1
   \   000166   6005         JZ        ??bdb_event_loop_22
   \   000168   E0           MOVX      A,@DPTR
   \   000169   6402         XRL       A,#0x2
   \   00016B   7028         JNZ       ??bdb_event_loop_23
   2636              {
   2637                NLME_LeaveReq_t leaveReq;
   2638                // Set every field to 0
   2639                osal_memset( &leaveReq, 0, sizeof( NLME_LeaveReq_t ) );
   \                     ??bdb_event_loop_22:
   \   00016D                ; Setup parameters for call to function osal_memset
   \   00016D   7C05         MOV       R4,#0x5
   \   00016F   7D00         MOV       R5,#0x0
   \   000171   7900         MOV       R1,#0x0
   \   000173   AA..         MOV       R2,?XSP + 0
   \   000175   AB..         MOV       R3,?XSP + 1
   \   000177   12....       LCALL     `??osal_memset::?relay`; Banked call to: osal_memset
   2640                
   2641                bdb_setNodeIsOnANetwork(FALSE);
   \   00017A                ; Setup parameters for call to function bdb_setNodeIsOnANetwork
   \   00017A   7900         MOV       R1,#0x0
   \   00017C   12....       LCALL     `??bdb_setNodeIsOnANetwork::?relay`; Banked call to: bdb_setNodeIsOnANetwork
   2642          
   2643                if ( NLME_LeaveReq( &leaveReq ) != ZSuccess )
   \   00017F                ; Setup parameters for call to function NLME_LeaveReq
   \   00017F   AA..         MOV       R2,?XSP + 0
   \   000181   AB..         MOV       R3,?XSP + 1
   \   000183   12....       LCALL     `??NLME_LeaveReq::?relay`; Banked call to: NLME_LeaveReq
   \   000186   E9           MOV       A,R1
   \   000187   600C         JZ        ??bdb_event_loop_23
   2644                {
   2645                  osal_set_event( bdb_TaskID,BDB_TC_LINK_KEY_EXCHANGE_FAIL);
   \   000189                ; Setup parameters for call to function osal_set_event
   \   000189   7A02         MOV       R2,#0x2
   \   00018B   7B00         MOV       R3,#0x0
   \   00018D   90....       MOV       DPTR,#bdb_TaskID
   \   000190   E0           MOVX      A,@DPTR
   \   000191   F9           MOV       R1,A
   \   000192   12....       LCALL     `??osal_set_event::?relay`; Banked call to: osal_set_event
   2646                }
   2647              }
   2648              // Return unprocessed events
   2649              return (events ^ BDB_TC_LINK_KEY_EXCHANGE_FAIL);
   \                     ??bdb_event_loop_23:
   \   000195   EE           MOV       A,R6
   \   000196   6402         XRL       A,#0x2
   \   000198   8076         SJMP      ??bdb_event_loop_6
   2650            }
   2651          #endif
   2652            
   2653            if(events & BDB_TC_JOIN_TIMEOUT)
   \                     ??bdb_event_loop_21:
   \   00019A   EF           MOV       A,R7
   \   00019B   5408         ANL       A,#0x8
   \   00019D   6006         JZ        ??bdb_event_loop_24
   2654            {     
   2655          #if (ZG_BUILD_COORDINATOR_TYPE)
   2656              if(ZG_DEVICE_COORDINATOR_TYPE)
   2657              {
   2658                bdb_TCProcessJoiningList();
   2659              }
   2660          #endif    
   2661              return (events ^ BDB_TC_JOIN_TIMEOUT);
   \   00019F   EF           MOV       A,R7
   \   0001A0   6408         XRL       A,#0x8
   \   0001A2   02....       LJMP      ??bdb_event_loop_19 & 0xFFFF
   2662            }
   2663          
   2664          #if (BDB_FINDING_BINDING_CAPABILITY_ENABLED==1)  
   2665            
   2666            if(events & BDB_FINDING_AND_BINDING_PERIOD_TIMEOUT)
   \                     ??bdb_event_loop_24:
   \   0001A5   EE           MOV       A,R6
   \   0001A6   5440         ANL       A,#0x40
   \   0001A8   606B         JZ        ??bdb_event_loop_25
   2667            {
   2668              if ( FINDING_AND_BINDING_PERIODIC_ENABLE == TRUE )
   2669              {
   2670                bdb_CurrEpDescriptor = bdb_setEpDescListToActiveEndpoint();
   \   0001AA                ; Setup parameters for call to function bdb_setEpDescListToActiveEndpoint
   \   0001AA   12....       LCALL     `??bdb_setEpDescListToActiveEndpoint::?relay`; Banked call to: bdb_setEpDescListToActiveEndpoint
   \   0001AD   8A..         MOV       ?V0,R2
   \   0001AF   8B..         MOV       ?V1,R3
   2671                
   2672                //If we have endpoint from which to send the identify command, then proceed, otherwise finish
   2673                if(bdb_CurrEpDescriptor != NULL) //just a safty check. The fact that we got to this functuon at all means that this cannot be NULL
   \   0001B1   EA           MOV       A,R2
   \   0001B2   45..         ORL       A,?V1
   \   0001B4   604C         JZ        ??bdb_event_loop_26
   2674                {
   2675                  //Substract an attempt
   2676                  bdb_FB_InitiatorCurrentCyclesNumber--;
   2677                  
   2678                  if(bdb_FB_InitiatorCurrentCyclesNumber > 0)
   \   0001B6   90....       MOV       DPTR,#bdb_FB_InitiatorCurrentCyclesNumber
   \   0001B9   E0           MOVX      A,@DPTR
   \   0001BA   14           DEC       A
   \   0001BB   F0           MOVX      @DPTR,A
   \   0001BC   604A         JZ        ??bdb_event_loop_27
   2679                  {
   2680                    //Only send Identify Query if there is no pending responses from a previous identify query
   2681                    if ((osal_get_timeoutEx(bdb_TaskID, BDB_RESPONDENT_PROCESS_TIMEOUT) == 0) && (bdb_getRespondentRetry(pRespondentHead) == NULL))
   \   0001BE                ; Setup parameters for call to function osal_get_timeoutEx
   \   0001BE   7A00         MOV       R2,#0x0
   \   0001C0   7B40         MOV       R3,#0x40
   \   0001C2   90....       MOV       DPTR,#bdb_TaskID
   \   0001C5   E0           MOVX      A,@DPTR
   \   0001C6   F9           MOV       R1,A
   \   0001C7   12....       LCALL     `??osal_get_timeoutEx::?relay`; Banked call to: osal_get_timeoutEx
   \   0001CA   EA           MOV       A,R2
   \   0001CB   4B           ORL       A,R3
   \   0001CC   4C           ORL       A,R4
   \   0001CD   4D           ORL       A,R5
   \   0001CE   701B         JNZ       ??bdb_event_loop_28
   \   0001D0                ; Setup parameters for call to function bdb_getRespondentRetry
   \   0001D0   90....       MOV       DPTR,#pRespondentHead
   \   0001D3   12....       LCALL     ??Subroutine42_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_97:
   \   0001D6   12....       LCALL     `??bdb_getRespondentRetry::?relay`; Banked call to: bdb_getRespondentRetry
   \   0001D9   8B..         MOV       ?V3,R3
   \   0001DB   EA           MOV       A,R2
   \   0001DC   45..         ORL       A,?V3
   \   0001DE   700B         JNZ       ??bdb_event_loop_28
   2682                    {
   2683                      //Send identify query with the endpoint requested
   2684                      bdb_SendIdentifyQuery(bdb_CurrEpDescriptor->endPoint);
   \   0001E0                ; Setup parameters for call to function bdb_SendIdentifyQuery
   \   0001E0   85..82       MOV       DPL,?V0
   \   0001E3   85..83       MOV       DPH,?V1
   \   0001E6   E0           MOVX      A,@DPTR
   \   0001E7   F9           MOV       R1,A
   \   0001E8   12....       LCALL     `??bdb_SendIdentifyQuery::?relay`; Banked call to: bdb_SendIdentifyQuery
   2685                    }
   2686                    osal_start_timerEx(bdb_TaskID, BDB_FINDING_AND_BINDING_PERIOD_TIMEOUT, FINDING_AND_BINDING_PERIODIC_TIME * 1000);
   \                     ??bdb_event_loop_28:
   \   0001EB                ; Setup parameters for call to function osal_start_timerEx
   \   0001EB   90....       MOV       DPTR,#__Constant_3a98
   \   0001EE   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   0001F1   7A40         MOV       R2,#0x40
   \   0001F3   7B00         MOV       R3,#0x0
   \   0001F5   90....       MOV       DPTR,#bdb_TaskID
   \   0001F8   E0           MOVX      A,@DPTR
   \   0001F9   F9           MOV       R1,A
   \   0001FA   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   0001FD   7404         MOV       A,#0x4
   \   0001FF   12....       LCALL     ?DEALLOC_XSTACK8
   2687                  }
   2688                }
   2689              }
   2690          
   2691              if (bdb_FB_InitiatorCurrentCyclesNumber == 0)
   \                     ??bdb_event_loop_26:
   \   000202   90....       MOV       DPTR,#bdb_FB_InitiatorCurrentCyclesNumber
   \   000205   E0           MOVX      A,@DPTR
   \   000206   7005         JNZ       ??bdb_event_loop_29
   2692              {
   2693                bdb_exitFindingBindingWStatus( BDB_COMMISSIONING_FB_NO_IDENTIFY_QUERY_RESPONSE );
   \                     ??bdb_event_loop_27:
   \   000208                ; Setup parameters for call to function bdb_exitFindingBindingWStatus
   \   000208   790B         MOV       R1,#0xb
   \   00020A   12....       LCALL     `??bdb_exitFindingBindingWStatus::?relay`; Banked call to: bdb_exitFindingBindingWStatus
   2694              }
   2695              
   2696              return (events ^ BDB_FINDING_AND_BINDING_PERIOD_TIMEOUT);
   \                     ??bdb_event_loop_29:
   \   00020D   EE           MOV       A,R6
   \   00020E   6440         XRL       A,#0x40
   \                     ??bdb_event_loop_6:
   \   000210   FA           MOV       R2,A
   \   000211   EF           MOV       A,R7
   \   000212   02....       LJMP      ??bdb_event_loop_19 & 0xFFFF
   2697            }
   2698            
   2699            if(events & BDB_IDENTIFY_TIMEOUT)
   \                     ??bdb_event_loop_25:
   \   000215   EF           MOV       A,R7
   \   000216   5420         ANL       A,#0x20
   \   000218   7003         JNZ       $+5
   \   00021A   02....       LJMP      ??bdb_event_loop_30 & 0xFFFF
   2700            {
   2701              zclAttrRec_t identifyAttrRec;
   2702              epList_t *bdb_CurrEpDescriptorNextInList = NULL;
   2703              bdb_CurrEpDescriptorNextInList = bdb_HeadEpDescriptorList;
   \   00021D   90....       MOV       DPTR,#bdb_HeadEpDescriptorList
   \   000220   12....       LCALL     ?Subroutine21 & 0xFFFF
   \                     ??CrossCallReturnLabel_37:
   \   000223   88..         MOV       ?V0,R0
   \   000225   89..         MOV       ?V1,R1
   2704              
   2705              bool KeepIdentifyTimerRunning = FALSE;
   \   000227   75..00       MOV       ?V4,#0x0
   \   00022A   8024         SJMP      ??CrossCallReturnLabel_28
   2706              
   2707              while(bdb_CurrEpDescriptorNextInList != NULL )
   2708              {
   2709                endPointDesc_t *bdb_EpDescriptor = NULL;
   2710                bdb_EpDescriptor = bdb_CurrEpDescriptorNextInList->epDesc;
   2711              
   2712                //Do not check ZDO or Zigbee reserved endpoints
   2713                if((bdb_CurrEpDescriptorNextInList->epDesc->endPoint == 0) || (bdb_CurrEpDescriptorNextInList->epDesc->endPoint >= BDB_ZIGBEE_RESERVED_ENDPOINTS_START))
   2714                {
   2715                  bdb_CurrEpDescriptorNextInList = bdb_CurrEpDescriptorNextInList->nextDesc;
   2716                  continue;
   2717                }
   2718                
   2719                if ( zclFindAttrRec( bdb_EpDescriptor->endPoint, ZCL_CLUSTER_ID_GEN_IDENTIFY,
   2720                                  ATTRID_IDENTIFY_TIME, &identifyAttrRec ) )
   2721                {
   2722                  if(*((uint16*)identifyAttrRec.attr.dataPtr) > 0)
   2723                  {
   2724                    (uint16)(*((uint16*)identifyAttrRec.attr.dataPtr))--;
   2725                    KeepIdentifyTimerRunning = TRUE;
   2726                  }
   2727                  else
   2728                  {
   2729                    // Use bdb success main state
   2730                    bdbAttributes.bdbCommissioningStatus = BDB_COMMISSIONING_SUCCESS;
   \                     ??bdb_event_loop_31:
   \   00022C   90....       MOV       DPTR,#bdbAttributes + 10
   \   00022F   E4           CLR       A
   \   000230   F0           MOVX      @DPTR,A
   2731                    if(pfnIdentifyTimeChangeCB != NULL)
   \   000231   90....       MOV       DPTR,#pfnIdentifyTimeChangeCB
   \   000234   12....       LCALL     ??Subroutine36_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_81:
   \   000237   600E         JZ        ??bdb_event_loop_32
   2732                    {
   2733                      pfnIdentifyTimeChangeCB(bdb_EpDescriptor->endPoint);
   \   000239                ; Setup parameters for indirect call
   \   000239   85..82       MOV       DPL,?V2
   \   00023C   85..83       MOV       DPH,?V3
   \   00023F   E0           MOVX      A,@DPTR
   \   000240   F9           MOV       R1,A
   \   000241   12....       LCALL     ?Subroutine18 & 0xFFFF
   2734                    }
   2735                  }
   \                     ??CrossCallReturnLabel_65:
   \   000244   12....       LCALL     ?CALL_IND
   2736                }
   2737                bdb_CurrEpDescriptorNextInList = bdb_CurrEpDescriptorNextInList->nextDesc;
   \                     ??bdb_event_loop_32:
   \   000247   85..82       MOV       DPL,?V0
   \   00024A   85..83       MOV       DPH,?V1
   \   00024D   12....       LCALL     ?Subroutine19 & 0xFFFF
   \                     ??CrossCallReturnLabel_28:
   \   000250   E5..         MOV       A,?V0
   \   000252   45..         ORL       A,?V1
   \   000254   6063         JZ        ??bdb_event_loop_33
   \   000256   85..82       MOV       DPL,?V0
   \   000259   85..83       MOV       DPH,?V1
   \   00025C   A3           INC       DPTR
   \   00025D   A3           INC       DPTR
   \   00025E   12....       LCALL     ?Subroutine16 & 0xFFFF
   \                     ??CrossCallReturnLabel_24:
   \   000261   8582..       MOV       ?V2,DPL
   \   000264   8583..       MOV       ?V3,DPH
   \   000267   E0           MOVX      A,@DPTR
   \   000268   60DD         JZ        ??bdb_event_loop_32
   \   00026A   C3           CLR       C
   \   00026B   94F1         SUBB      A,#-0xf
   \   00026D   50D8         JNC       ??bdb_event_loop_32
   \   00026F                ; Setup parameters for call to function zclFindAttrRec
   \   00026F   7405         MOV       A,#0x5
   \   000271   12....       LCALL     ?XSTACK_DISP100_8
   \   000274   88..         MOV       ?V6,R0
   \   000276   89..         MOV       ?V7,R1
   \   000278   78..         MOV       R0,#?V6
   \   00027A   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00027D   7C00         MOV       R4,#0x0
   \   00027F   7D00         MOV       R5,#0x0
   \   000281   7A03         MOV       R2,#0x3
   \   000283   7B00         MOV       R3,#0x0
   \   000285   85..82       MOV       DPL,?V2
   \   000288   85..83       MOV       DPH,?V3
   \   00028B   E0           MOVX      A,@DPTR
   \   00028C   F9           MOV       R1,A
   \   00028D   12....       LCALL     `??zclFindAttrRec::?relay`; Banked call to: zclFindAttrRec
   \   000290   7402         MOV       A,#0x2
   \   000292   12....       LCALL     ?DEALLOC_XSTACK8
   \   000295   E9           MOV       A,R1
   \   000296   60AF         JZ        ??bdb_event_loop_32
   \   000298   740B         MOV       A,#0xb
   \   00029A   12....       LCALL     ?XSTACK_DISP0_8
   \   00029D   12....       LCALL     ?Subroutine16 & 0xFFFF
   \                     ??CrossCallReturnLabel_25:
   \   0002A0   12....       LCALL     ?Subroutine14 & 0xFFFF
   \                     ??CrossCallReturnLabel_20:
   \   0002A3   6087         JZ        ??bdb_event_loop_31
   \   0002A5   EA           MOV       A,R2
   \   0002A6   24FF         ADD       A,#-0x1
   \   0002A8   1A           DEC       R2
   \   0002A9   EB           MOV       A,R3
   \   0002AA   34FF         ADDC      A,#-0x1
   \   0002AC   FB           MOV       R3,A
   \   0002AD   8882         MOV       DPL,R0
   \   0002AF   8983         MOV       DPH,R1
   \   0002B1   12....       LCALL     ?Subroutine10 & 0xFFFF
   \                     ??CrossCallReturnLabel_12:
   \   0002B4   75..01       MOV       ?V4,#0x1
   \   0002B7   808E         SJMP      ??bdb_event_loop_32
   2738              }
   2739              
   2740              //If any endpoint has identify running, keep the timer on
   2741              if(KeepIdentifyTimerRunning)
   \                     ??bdb_event_loop_33:
   \   0002B9   E5..         MOV       A,?V4
   \   0002BB   6019         JZ        ??bdb_event_loop_34
   2742              {
   2743                osal_start_timerEx( bdb_TaskID, BDB_IDENTIFY_TIMEOUT, 1000 );
   \   0002BD                ; Setup parameters for call to function osal_start_timerEx
   \   0002BD   90....       MOV       DPTR,#__Constant_3e8
   \   0002C0   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   0002C3   7A00         MOV       R2,#0x0
   \   0002C5   7B20         MOV       R3,#0x20
   \   0002C7   90....       MOV       DPTR,#bdb_TaskID
   \   0002CA   E0           MOVX      A,@DPTR
   \   0002CB   F9           MOV       R1,A
   \   0002CC   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   0002CF   7404         MOV       A,#0x4
   \   0002D1   12....       LCALL     ?DEALLOC_XSTACK8
   \   0002D4   800C         SJMP      ??bdb_event_loop_35
   2744              }
   2745              else
   2746              {
   2747                osal_stop_timerEx( bdb_TaskID, BDB_IDENTIFY_TIMEOUT );
   \                     ??bdb_event_loop_34:
   \   0002D6                ; Setup parameters for call to function osal_stop_timerEx
   \   0002D6   7A00         MOV       R2,#0x0
   \   0002D8   7B20         MOV       R3,#0x20
   \   0002DA   90....       MOV       DPTR,#bdb_TaskID
   \   0002DD   E0           MOVX      A,@DPTR
   \   0002DE   F9           MOV       R1,A
   \   0002DF   12....       LCALL     `??osal_stop_timerEx::?relay`; Banked call to: osal_stop_timerEx
   2748              }
   2749              
   2750              // Return unprocessed events
   2751              return (events ^ BDB_IDENTIFY_TIMEOUT);
   \                     ??bdb_event_loop_35:
   \   0002E2   EE           MOV       A,R6
   \   0002E3   FA           MOV       R2,A
   \   0002E4   EF           MOV       A,R7
   \   0002E5   6420         XRL       A,#0x20
   \   0002E7   800D         SJMP      ??bdb_event_loop_19
   2752            }
   2753            
   2754            if(events & BDB_RESPONDENT_PROCESS_TIMEOUT)
   \                     ??bdb_event_loop_30:
   \   0002E9   EF           MOV       A,R7
   \   0002EA   5440         ANL       A,#0x40
   \   0002EC   600B         JZ        ??bdb_event_loop_36
   2755            {
   2756              // Send Simple Descriptor request to a respondent node
   2757              bdb_ProcessRespondentList();
   \   0002EE                ; Setup parameters for call to function bdb_ProcessRespondentList
   \   0002EE   12....       LCALL     `??bdb_ProcessRespondentList::?relay`; Banked call to: bdb_ProcessRespondentList
   2758          
   2759              return (events ^ BDB_RESPONDENT_PROCESS_TIMEOUT);
   \   0002F1   EE           MOV       A,R6
   \   0002F2   FA           MOV       R2,A
   \   0002F3   EF           MOV       A,R7
   \   0002F4   6440         XRL       A,#0x40
   \                     ??bdb_event_loop_19:
   \   0002F6   FB           MOV       R3,A
   \   0002F7   8004         SJMP      ??bdb_event_loop_37
   2760            }
   2761          #endif
   2762            
   2763            return 0;
   \                     ??bdb_event_loop_36:
   \   0002F9   7A00         MOV       R2,#0x0
   \   0002FB   7B00         MOV       R3,#0x0
   \                     ??bdb_event_loop_37:
   \   0002FD   740D         MOV       A,#0xd
   \   0002FF   12....       LCALL     ?DEALLOC_XSTACK8
   \   000302   7F08         MOV       R7,#0x8
   \   000304   02....       LJMP      ?BANKED_LEAVE_XDATA
   2764          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine19:
   \   000000   E0           MOVX      A,@DPTR
   \   000001   F5..         MOV       ?V0,A
   \   000003   A3           INC       DPTR
   \   000004   E0           MOVX      A,@DPTR
   \   000005   F5..         MOV       ?V1,A
   \   000007   22           RET
   2765          
   2766          /*********************************************************************
   2767           * @fn          bdb_processZDOMgs
   2768           *
   2769           * @brief       Process ZDO messages used as part of BDB commissioning methods
   2770           *
   2771           * @param       zdoIncomingMsg_t - ZDO message
   2772           *
   2773           * @return      
   2774           */
   2775          static void bdb_processZDOMgs(zdoIncomingMsg_t *pMsg)
   2776          {
   2777            switch ( pMsg->clusterID )
   2778            {
   2779          #if (BDB_FINDING_BINDING_CAPABILITY_ENABLED==1)      
   2780              case IEEE_addr_rsp:
   2781                 bdb_ProcessIEEEAddrRsp(pMsg);
   2782              break;
   2783              case Simple_Desc_rsp:
   2784                bdb_ProcessSimpleDesc(pMsg);
   2785              break;
   2786          #endif
   2787          
   2788          #if (ZG_BUILD_JOINING_TYPE)    
   2789              case Node_Desc_rsp:
   2790                bdb_ProcessNodeDescRsp(pMsg);
   2791              break;
   2792          #endif
   2793              
   2794              default:
   2795              break;
   2796            }
   2797          }
   2798          
   2799          
   2800          /*********************************************************************
   2801           * @fn      bdb_ProcessNodeDescRsp
   2802           *
   2803           * @brief   Process Node Descriptor response to validate the stack version of the
   2804           *
   2805           * @param   zdoIncomingMsg_t *pMsg
   2806           *
   2807           * @return  none
   2808           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2809          void bdb_ProcessNodeDescRsp(zdoIncomingMsg_t *pMsg)
   \                     bdb_ProcessNodeDescRsp:
   2810          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV       A,#-0xa
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 35
   \   000005   74DD         MOV       A,#-0x23
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   \   00000A   EA           MOV       A,R2
   \   00000B   FE           MOV       R6,A
   \   00000C   EB           MOV       A,R3
   \   00000D   FF           MOV       R7,A
   2811            //Avoid processing unintended messages
   2812            if(requestNewTrustCenterLinkKey && 
   2813              (bdbCommissioningProcedureState.bdbCommissioningState == BDB_COMMISSIONING_STATE_TC_LINK_KEY_EXCHANGE))
   \   00000E   90....       MOV       DPTR,#requestNewTrustCenterLinkKey
   \   000011   E0           MOVX      A,@DPTR
   \   000012   7003         JNZ       $+5
   \   000014   02....       LJMP      ??bdb_ProcessNodeDescRsp_0 & 0xFFFF
   \   000017   90....       MOV       DPTR,#bdbCommissioningProcedureState
   \   00001A   E0           MOVX      A,@DPTR
   \   00001B   6401         XRL       A,#0x1
   \   00001D   6003         JZ        $+5
   \   00001F   02....       LJMP      ??bdb_ProcessNodeDescRsp_0 & 0xFFFF
   2814            {
   2815              if(!APSME_IsDistributedSecurity())
   \   000022                ; Setup parameters for call to function APSME_IsDistributedSecurity
   \   000022   12....       LCALL     `??APSME_IsDistributedSecurity::?relay`; Banked call to: APSME_IsDistributedSecurity
   \   000025   E9           MOV       A,R1
   \   000026   6003         JZ        $+5
   \   000028   02....       LJMP      ??bdb_ProcessNodeDescRsp_0 & 0xFFFF
   2816              {
   2817                //Is this from the coordinator?
   2818                if(pMsg->srcAddr.addr.shortAddr == 0x0000)
   \   00002B   8E82         MOV       DPL,R6
   \   00002D   8F83         MOV       DPH,R7
   \   00002F   A3           INC       DPTR
   \   000030   A3           INC       DPTR
   \   000031   12....       LCALL     ??Subroutine36_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_82:
   \   000034   7077         JNZ       ??bdb_ProcessNodeDescRsp_0
   2819                {
   2820                  ZDO_NodeDescRsp_t NDRsp;
   2821                  uint8 StackComplianceRev;
   2822          
   2823                  //Stop timer to avoid unintended resets
   2824                  osal_stop_timerEx( bdb_TaskID, BDB_PROCESS_TIMEOUT);
   \   000036                ; Setup parameters for call to function osal_stop_timerEx
   \   000036   7A00         MOV       R2,#0x0
   \   000038   7B10         MOV       R3,#0x10
   \   00003A   90....       MOV       DPTR,#bdb_TaskID
   \   00003D   E0           MOVX      A,@DPTR
   \   00003E   F9           MOV       R1,A
   \   00003F   12....       LCALL     `??osal_stop_timerEx::?relay`; Banked call to: osal_stop_timerEx
   2825                  
   2826                  ZDO_ParseNodeDescRsp(pMsg, &NDRsp);
   \   000042                ; Setup parameters for call to function ZDO_ParseNodeDescRsp
   \   000042   7413         MOV       A,#0x13
   \   000044   12....       LCALL     ?XSTACK_DISP102_8
   \   000047   EE           MOV       A,R6
   \   000048   FA           MOV       R2,A
   \   000049   EF           MOV       A,R7
   \   00004A   FB           MOV       R3,A
   \   00004B   12....       LCALL     `??ZDO_ParseNodeDescRsp::?relay`; Banked call to: ZDO_ParseNodeDescRsp
   2827                  
   2828                  StackComplianceRev = NDRsp.nodeDesc.ServerMask >> STACK_COMPLIANCE_CURRENT_REV_POS;
   2829                  
   2830                  if( StackComplianceRev >= STACK_COMPL_REV_21 )
   \   00004E   741E         MOV       A,#0x1e
   \   000050   12....       LCALL     ?XSTACK_DISP0_8
   \   000053   12....       LCALL     ?Subroutine19 & 0xFFFF
   \                     ??CrossCallReturnLabel_29:
   \   000056   7409         MOV       A,#0x9
   \   000058   78..         MOV       R0,#?V0
   \   00005A   12....       LCALL     ?US_SHR
   \   00005D   C3           CLR       C
   \   00005E   E5..         MOV       A,?V0
   \   000060   9415         SUBB      A,#0x15
   \   000062   95E0         SUBB      A,0xE0 /* A   */
   \   000064   C3           CLR       C
   \   000065   65D0         XRL       A,PSW
   \   000067   33           RLC       A
   \   000068   4009         JC        ??bdb_ProcessNodeDescRsp_1
   2831                  {
   2832                    bdb_tcLinkKeyExchangeAttempt(TRUE,BDB_REQ_TC_LINK_KEY);
   \   00006A                ; Setup parameters for call to function bdb_tcLinkKeyExchangeAttempt
   \   00006A   7A02         MOV       R2,#0x2
   \   00006C   7901         MOV       R1,#0x1
   \   00006E   12....       LCALL     `??bdb_tcLinkKeyExchangeAttempt::?relay`; Banked call to: bdb_tcLinkKeyExchangeAttempt
   \   000071   803A         SJMP      ??bdb_ProcessNodeDescRsp_0
   2833                  }
   2834                  else
   2835                  {
   2836                    APSME_TCLKDevEntry_t TCLKDevEntry;
   2837                    
   2838                    //Save the KeyAttribute for joining device that it has joined non-R21 nwk
   2839                    TCLKDevEntry.keyAttributes = ZG_NON_R21_NWK_JOINED;
   \                     ??bdb_ProcessNodeDescRsp_1:
   \   000073   7410         MOV       A,#0x10
   \   000075   12....       LCALL     ?XSTACK_DISP0_8
   \   000078   74FD         MOV       A,#-0x3
   \   00007A   F0           MOVX      @DPTR,A
   2840                    osal_nv_write(ZCD_NV_TCLK_TABLE_START,osal_offsetof(APSME_TCLKDevEntry_t,keyAttributes),sizeof(uint8),&TCLKDevEntry.keyAttributes);
   \   00007B                ; Setup parameters for call to function osal_nv_write
   \   00007B   8582..       MOV       ?V0,DPL
   \   00007E   8583..       MOV       ?V1,DPH
   \   000081   78..         MOV       R0,#?V0
   \   000083   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000086   75..01       MOV       ?V0,#0x1
   \   000089   75..00       MOV       ?V1,#0x0
   \   00008C   78..         MOV       R0,#?V0
   \   00008E   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000091   7C10         MOV       R4,#0x10
   \   000093   7D00         MOV       R5,#0x0
   \   000095   7A11         MOV       R2,#0x11
   \   000097   7B01         MOV       R3,#0x1
   \   000099   12....       LCALL     `??osal_nv_write::?relay`; Banked call to: osal_nv_write
   \   00009C   7404         MOV       A,#0x4
   \   00009E   12....       LCALL     ?DEALLOC_XSTACK8
   2841                    
   2842                    bdb_setNodeJoinLinkKeyType(BDB_DEFAULT_GLOBAL_TRUST_CENTER_LINK_KEY);
   \   0000A1                ; Setup parameters for call to function bdb_setNodeJoinLinkKeyType
   \   0000A1   7900         MOV       R1,#0x0
   \   0000A3   12....       LCALL     `??bdb_setNodeJoinLinkKeyType::?relay`; Banked call to: bdb_setNodeJoinLinkKeyType
   2843                    bdb_reportCommissioningState(BDB_COMMISSIONING_STATE_TC_LINK_KEY_EXCHANGE, TRUE);
   \   0000A6                ; Setup parameters for call to function bdb_reportCommissioningState
   \   0000A6   7A01         MOV       R2,#0x1
   \   0000A8   7901         MOV       R1,#0x1
   \   0000AA   12....       LCALL     `??bdb_reportCommissioningState::?relay`; Banked call to: bdb_reportCommissioningState
   2844                  }
   2845                }
   2846              }
   2847            }
   2848          }
   \                     ??bdb_ProcessNodeDescRsp_0:
   \   0000AD   7423         MOV       A,#0x23
   \   0000AF   80..         SJMP      ??Subroutine40_0
   2849          
   2850          
   2851          /*********************************************************************
   2852           * @fn          bdb_touchlinkSendFNReset
   2853           *
   2854           * @brief       Starts the Factory New Procedure for Initiator
   2855           *
   2856           * @param       isOnANetwork - TRUE if the devices is not FN, FALSE otherwise
   2857           *
   2858           * @return      none
   2859           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2860          void bdb_touchlinkSendFNReset( void )
   \                     bdb_touchlinkSendFNReset:
   2861          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2862          #ifdef BDB_TL_INITIATOR
   2863            touchLinkInitiator_ResetToFNProcedure( );
   2864          #endif
   2865          }
   \   000000   02....       LJMP      ?BRET
   2866          
   2867          
   2868          /*********************************************************************
   2869           * @fn          bdb_setNodeIsOnANetwork
   2870           *
   2871           * @brief       Sets and saves in Nv bdbNodeIsOnANetwork attribute
   2872           *
   2873           * @param       isOnANetwork - TRUE if the devices is not FN, FALSE otherwise
   2874           *
   2875           * @return      none
   2876           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2877          void bdb_setNodeIsOnANetwork(bool isOnANetwork)
   \                     bdb_setNodeIsOnANetwork:
   2878          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV       A,#-0xa
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   E9           MOV       A,R1
   \   000006   FE           MOV       R6,A
   2879            if((bdbAttributes.bdbNodeIsOnANetwork != isOnANetwork) || (!bdb_initialization))
   \   000007   90....       MOV       DPTR,#bdbAttributes + 14
   \   00000A   E0           MOVX      A,@DPTR
   \   00000B   6E           XRL       A,R6
   \   00000C   7006         JNZ       ??bdb_setNodeIsOnANetwork_0
   \   00000E   90....       MOV       DPTR,#bdb_initialization
   \   000011   E0           MOVX      A,@DPTR
   \   000012   7033         JNZ       ??bdb_setNodeIsOnANetwork_1
   2880            {
   2881              //We lose our network
   2882              if(!isOnANetwork)
   \                     ??bdb_setNodeIsOnANetwork_0:
   \   000014   EE           MOV       A,R6
   \   000015   7005         JNZ       ??bdb_setNodeIsOnANetwork_2
   2883              {
   2884                bdbAttributes.bdbCommissioningMode = 0;
   \   000017   90....       MOV       DPTR,#bdbAttributes + 11
   \   00001A   E4           CLR       A
   \   00001B   F0           MOVX      @DPTR,A
   2885              }
   2886              
   2887              bdbAttributes.bdbNodeIsOnANetwork = isOnANetwork;
   \                     ??bdb_setNodeIsOnANetwork_2:
   \   00001C   EE           MOV       A,R6
   \   00001D   90....       MOV       DPTR,#bdbAttributes + 14
   \   000020   F0           MOVX      @DPTR,A
   2888              
   2889              osal_nv_write(ZCD_NV_BDBNODEISONANETWORK,0,sizeof(bdbAttributes.bdbNodeIsOnANetwork),&bdbAttributes.bdbNodeIsOnANetwork);
   \   000021                ; Setup parameters for call to function osal_nv_write
   \   000021   75....       MOV       ?V0,#(bdbAttributes + 14) & 0xff
   \   000024   75....       MOV       ?V1,#((bdbAttributes + 14) >> 8) & 0xff
   \   000027   78..         MOV       R0,#?V0
   \   000029   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00002C   75..01       MOV       ?V0,#0x1
   \   00002F   75..00       MOV       ?V1,#0x0
   \   000032   78..         MOV       R0,#?V0
   \   000034   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000037   7C00         MOV       R4,#0x0
   \   000039   7D00         MOV       R5,#0x0
   \   00003B   7A55         MOV       R2,#0x55
   \   00003D   7B00         MOV       R3,#0x0
   \   00003F   12....       LCALL     `??osal_nv_write::?relay`; Banked call to: osal_nv_write
   \   000042   7404         MOV       A,#0x4
   \   000044   12....       LCALL     ?DEALLOC_XSTACK8
   2890            }
   2891          }
   \                     ??bdb_setNodeIsOnANetwork_1:
   \   000047   80..         SJMP      ??Subroutine41_0
   2892          
   2893          /*********************************************************************
   2894           * @fn          bdb_setCommissioningGroupID
   2895           *
   2896           * @brief       Sets the commissioning groupd ID
   2897           *
   2898           * @param       groupID
   2899           *
   2900           * @return      none
   2901           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   EA           MOV       A,R2
   \   000001   F0           MOVX      @DPTR,A
   \   000002   A3           INC       DPTR
   \   000003   EB           MOV       A,R3
   \   000004                REQUIRE ??Subroutine30_0
   \   000004                ; // Fall through to label ??Subroutine30_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2902          void bdb_setCommissioningGroupID(uint16 groupID)
   \                     bdb_setCommissioningGroupID:
   2903          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2904            bdbAttributes.bdbCommissioningGroupID = groupID;
   \   000004   90....       MOV       DPTR,#bdbAttributes + 8
   \   000007   02....       LJMP      ?Subroutine3 & 0xFFFF
   2905          }
   2906          
   2907          /*********************************************************************
   2908           * @fn      bdb_CreateRespondentList
   2909           *
   2910           * @brief   Create respondent list for finding and binding if empty
   2911           *
   2912           * @param   pHead - pointer to a pointer of the list head
   2913           *
   2914           * @return  none
   2915           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine12:
   \   000000   EA           MOV       A,R2
   \   000001   FE           MOV       R6,A
   \   000002   EB           MOV       A,R3
   \   000003                REQUIRE ??Subroutine35_0
   \   000003                ; // Fall through to label ??Subroutine35_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine35_0:
   \   000000   FF           MOV       R7,A
   \   000001   8E82         MOV       DPL,R6
   \   000003   8F83         MOV       DPH,R7
   \   000005                REQUIRE ??Subroutine36_0
   \   000005                ; // Fall through to label ??Subroutine36_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2916          void bdb_CreateRespondentList( bdbFindingBindingRespondent_t **pHead )
   \                     bdb_CreateRespondentList:
   2917          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV       A,#-0xa
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   12....       LCALL     ?Subroutine12 & 0xFFFF
   2918          
   2919            // Create the list if empty
   2920            if ( *pHead == NULL )
   \                     ??CrossCallReturnLabel_66:
   \   000008   701F         JNZ       ??CrossCallReturnLabel_41
   2921            {
   2922              *pHead = ( bdbFindingBindingRespondent_t* )osal_mem_alloc( sizeof( bdbFindingBindingRespondent_t ) );
   \   00000A                ; Setup parameters for call to function osal_mem_alloc
   \   00000A   7A11         MOV       R2,#0x11
   \   00000C   7B00         MOV       R3,#0x0
   \   00000E   12....       LCALL     `??osal_mem_alloc::?relay`; Banked call to: osal_mem_alloc
   \   000011   8A..         MOV       ?V0,R2
   \   000013   8B..         MOV       ?V1,R3
   \   000015   A8..         MOV       R0,?V0
   \   000017   A9..         MOV       R1,?V1
   \   000019   8E82         MOV       DPL,R6
   \   00001B   8F83         MOV       DPH,R7
   \   00001D   E8           MOV       A,R0
   \   00001E   F0           MOVX      @DPTR,A
   \   00001F   A3           INC       DPTR
   \   000020   E9           MOV       A,R1
   \   000021   F0           MOVX      @DPTR,A
   2923              
   2924              if ( *pHead != NULL )
   \   000022   E8           MOV       A,R0
   \   000023   49           ORL       A,R1
   \   000024   6003         JZ        ??CrossCallReturnLabel_41
   2925              {
   2926                (*pHead)->pNext = NULL;
   \   000026   12....       LCALL     ?Subroutine23 & 0xFFFF
   2927              }
   2928            }
   2929            return;
   \                     ??CrossCallReturnLabel_41:
   \   000029   02....       LJMP      ??Subroutine41_0 & 0xFFFF
   2930          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine23:
   \   000000   12....       LCALL     ?Subroutine28 & 0xFFFF
   \                     ??CrossCallReturnLabel_54:
   \   000003   E4           CLR       A
   \   000004   F0           MOVX      @DPTR,A
   \   000005   A3           INC       DPTR
   \   000006   F0           MOVX      @DPTR,A
   \   000007   22           RET
   2931          
   2932          /*********************************************************************
   2933           * @fn      bdb_AddRespondentNode
   2934           *
   2935           * @brief   Add node to respondent list for finding and binding
   2936           *
   2937           * @param   pHead - pointer to a pointer of the list head
   2938           *
   2939           * @return  pointer to new node
   2940           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2941          bdbFindingBindingRespondent_t* bdb_AddRespondentNode( bdbFindingBindingRespondent_t **pHead, zclIdentifyQueryRsp_t *pCmd )
   \                     bdb_AddRespondentNode:
   2942          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV       A,#-0xa
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   12....       LCALL     ?Subroutine12 & 0xFFFF
   2943            bdbFindingBindingRespondent_t **pCurr;
   2944            bdbFindingBindingRespondent_t *temp;
   2945            
   2946              // Create respondent list if empty
   2947            if ( *pHead == NULL )
   \                     ??CrossCallReturnLabel_67:
   \   000008   7006         JNZ       ??bdb_AddRespondentNode_0
   2948            {
   2949              bdb_CreateRespondentList( pHead );
   \   00000A                ; Setup parameters for call to function bdb_CreateRespondentList
   \   00000A   12....       LCALL     `??bdb_CreateRespondentList::?relay`; Banked call to: bdb_CreateRespondentList
   2950              return *pHead;
   \   00000D   02....       LJMP      ??CrossCallReturnLabel_42 & 0xFFFF
   2951            }
   2952            else
   2953            {
   2954              // if pCmd is equal to NULL, don't look for duplucates
   2955              if( pCmd != NULL )
   \                     ??bdb_AddRespondentNode_0:
   \   000010   EC           MOV       A,R4
   \   000011   4D           ORL       A,R5
   \   000012   606D         JZ        ??bdb_AddRespondentNode_1
   2956              {
   2957                //Find if any duplicate in the list
   2958                temp = *pHead;
   \   000014   E8           MOV       A,R0
   \   000015   FA           MOV       R2,A
   \   000016   E9           MOV       A,R1
   \   000017   FB           MOV       R3,A
   \   000018   8C82         MOV       DPL,R4
   \   00001A   8D83         MOV       DPH,R5
   \   00001C   12....       LCALL     ?Subroutine20 & 0xFFFF
   2959                
   2960                while(temp != NULL)
   2961                {
   2962                  if((temp->data.endPoint == pCmd->srcAddr->endPoint) && (temp->data.panId == pCmd->srcAddr->panId))
   \                     ??CrossCallReturnLabel_33:
   \   00001F   8A82         MOV       DPL,R2
   \   000021   8B83         MOV       DPH,R3
   \   000023   A3           INC       DPTR
   \   000024   A3           INC       DPTR
   \   000025   A3           INC       DPTR
   \   000026   A3           INC       DPTR
   \   000027   A3           INC       DPTR
   \   000028   A3           INC       DPTR
   \   000029   A3           INC       DPTR
   \   00002A   A3           INC       DPTR
   \   00002B   A3           INC       DPTR
   \   00002C   E0           MOVX      A,@DPTR
   \   00002D   FE           MOV       R6,A
   \   00002E   8C82         MOV       DPL,R4
   \   000030   8D83         MOV       DPH,R5
   \   000032   A3           INC       DPTR
   \   000033   A3           INC       DPTR
   \   000034   A3           INC       DPTR
   \   000035   A3           INC       DPTR
   \   000036   A3           INC       DPTR
   \   000037   A3           INC       DPTR
   \   000038   A3           INC       DPTR
   \   000039   A3           INC       DPTR
   \   00003A   A3           INC       DPTR
   \   00003B   E0           MOVX      A,@DPTR
   \   00003C   6E           XRL       A,R6
   \   00003D   7034         JNZ       ??bdb_AddRespondentNode_2
   \   00003F   8A82         MOV       DPL,R2
   \   000041   8B83         MOV       DPH,R3
   \   000043   A3           INC       DPTR
   \   000044   A3           INC       DPTR
   \   000045   A3           INC       DPTR
   \   000046   A3           INC       DPTR
   \   000047   A3           INC       DPTR
   \   000048   A3           INC       DPTR
   \   000049   A3           INC       DPTR
   \   00004A   A3           INC       DPTR
   \   00004B   A3           INC       DPTR
   \   00004C   A3           INC       DPTR
   \   00004D   12....       LCALL     ?Subroutine22 & 0xFFFF
   \                     ??CrossCallReturnLabel_39:
   \   000050   A3           INC       DPTR
   \   000051   A3           INC       DPTR
   \   000052   A3           INC       DPTR
   \   000053   A3           INC       DPTR
   \   000054   A3           INC       DPTR
   \   000055   A3           INC       DPTR
   \   000056   A3           INC       DPTR
   \   000057   A3           INC       DPTR
   \   000058   A3           INC       DPTR
   \   000059   A3           INC       DPTR
   \   00005A   E0           MOVX      A,@DPTR
   \   00005B   6E           XRL       A,R6
   \   00005C   7003         JNZ       ??bdb_AddRespondentNode_3
   \   00005E   A3           INC       DPTR
   \   00005F   E0           MOVX      A,@DPTR
   \   000060   6F           XRL       A,R7
   \                     ??bdb_AddRespondentNode_3:
   \   000061   7010         JNZ       ??bdb_AddRespondentNode_2
   2963                  {
   2964                    //Duplicate
   2965                    if(temp->data.addr.shortAddr == pCmd->srcAddr->addr.shortAddr)
   \   000063   8A82         MOV       DPL,R2
   \   000065   8B83         MOV       DPH,R3
   \   000067   12....       LCALL     ?Subroutine22 & 0xFFFF
   2966                    {
   2967                      return NULL;
   2968                    }
   2969                  }
   \                     ??CrossCallReturnLabel_40:
   \   00006A   E0           MOVX      A,@DPTR
   \   00006B   6E           XRL       A,R6
   \   00006C   7003         JNZ       ??bdb_AddRespondentNode_4
   \   00006E   A3           INC       DPTR
   \   00006F   E0           MOVX      A,@DPTR
   \   000070   6F           XRL       A,R7
   \                     ??bdb_AddRespondentNode_4:
   \   000071   6035         JZ        ??bdb_AddRespondentNode_5
   2970                  temp = temp->pNext;
   \                     ??bdb_AddRespondentNode_2:
   \   000073   EA           MOV       A,R2
   \   000074   240F         ADD       A,#0xf
   \   000076   F582         MOV       DPL,A
   \   000078   E4           CLR       A
   \   000079   3B           ADDC      A,R3
   \   00007A   F583         MOV       DPH,A
   \   00007C   12....       LCALL     ?Subroutine14 & 0xFFFF
   2971                }
   2972              }
   \                     ??CrossCallReturnLabel_18:
   \   00007F   709E         JNZ       ??CrossCallReturnLabel_33
   2973              
   2974              pCurr = &((*pHead)->pNext);
   2975              
   2976              while ( *pCurr != NULL )
   2977              {
   2978                pCurr = &((*pCurr)->pNext);
   \                     ??bdb_AddRespondentNode_1:
   \   000081   E8           MOV       A,R0
   \   000082   240F         ADD       A,#0xf
   \   000084   FE           MOV       R6,A
   \   000085   E4           CLR       A
   \   000086   39           ADDC      A,R1
   \   000087   12....       LCALL     ??Subroutine35_0 & 0xFFFF
   2979              }
   \                     ??CrossCallReturnLabel_69:
   \   00008A   70F5         JNZ       ??bdb_AddRespondentNode_1
   2980          
   2981              *pCurr = ( bdbFindingBindingRespondent_t* )osal_mem_alloc( sizeof( bdbFindingBindingRespondent_t ) );
   \   00008C                ; Setup parameters for call to function osal_mem_alloc
   \   00008C   7A11         MOV       R2,#0x11
   \   00008E   7B00         MOV       R3,#0x0
   \   000090   12....       LCALL     `??osal_mem_alloc::?relay`; Banked call to: osal_mem_alloc
   \   000093   8A..         MOV       ?V0,R2
   \   000095   8B..         MOV       ?V1,R3
   \   000097   A8..         MOV       R0,?V0
   \   000099   A9..         MOV       R1,?V1
   \   00009B   8E82         MOV       DPL,R6
   \   00009D   8F83         MOV       DPH,R7
   \   00009F   E8           MOV       A,R0
   \   0000A0   F0           MOVX      @DPTR,A
   \   0000A1   A3           INC       DPTR
   \   0000A2   E9           MOV       A,R1
   \   0000A3   F0           MOVX      @DPTR,A
   2982              
   2983              if(*pCurr == NULL)
   \   0000A4   E8           MOV       A,R0
   \   0000A5   49           ORL       A,R1
   \   0000A6   7006         JNZ       ??bdb_AddRespondentNode_6
   2984              {
   2985                //No memory
   2986                return NULL;
   \                     ??bdb_AddRespondentNode_5:
   \   0000A8   7A00         MOV       R2,#0x0
   \   0000AA   7B00         MOV       R3,#0x0
   \   0000AC   800A         SJMP      ??CrossCallReturnLabel_98
   2987              }
   2988              
   2989              (*pCurr)->pNext = NULL;
   \                     ??bdb_AddRespondentNode_6:
   \   0000AE   12....       LCALL     ?Subroutine23 & 0xFFFF
   2990            }
   2991            
   2992            return *pCurr;
   \                     ??CrossCallReturnLabel_42:
   \   0000B1   8E82         MOV       DPL,R6
   \   0000B3   8F83         MOV       DPH,R7
   \   0000B5   12....       LCALL     ??Subroutine42_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_98:
   \   0000B8   02....       LJMP      ??Subroutine41_0 & 0xFFFF
   2993          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine22:
   \   000000   12....       LCALL     ?Subroutine27 & 0xFFFF
   \                     ??CrossCallReturnLabel_52:
   \   000003   8C82         MOV       DPL,R4
   \   000005   8D83         MOV       DPH,R5
   \   000007   22           RET
   2994          
   2995          /*********************************************************************
   2996           * @fn      bdb_zclRespondentListClean
   2997           *
   2998           * @brief   This function free reserved memory for respondent list
   2999           *
   3000           * @param   pHead - begin of the respondent list
   3001           *
   3002           * @return  status
   3003           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3004          void bdb_zclRespondentListClean( bdbFindingBindingRespondent_t **pHead )
   \                     bdb_zclRespondentListClean:
   3005          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000   74F4         MOV       A,#-0xc
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   12....       LCALL     ?Subroutine12 & 0xFFFF
   3006            bdbFindingBindingRespondent_t **pCurr;
   3007            bdbFindingBindingRespondent_t **pNext;
   3008            
   3009            if ( *pHead == NULL )
   \                     ??CrossCallReturnLabel_68:
   \   000008   6035         JZ        ??bdb_zclRespondentListClean_0
   3010            {
   3011              return;
   3012            }
   3013            
   3014            pCurr = pHead;
   \   00000A   8E..         MOV       ?V0,R6
   \   00000C   8F..         MOV       ?V1,R7
   \   00000E   801C         SJMP      ??bdb_zclRespondentListClean_1
   3015            
   3016            while( *pCurr != NULL )
   3017            {
   3018              pNext = &((*pCurr)->pNext);
   \                     ??bdb_zclRespondentListClean_2:
   \   000010   EA           MOV       A,R2
   \   000011   240F         ADD       A,#0xf
   \   000013   F5..         MOV       ?V2,A
   \   000015   E4           CLR       A
   \   000016   3B           ADDC      A,R3
   \   000017   F5..         MOV       ?V3,A
   3019              osal_mem_free( *pCurr );
   \   000019                ; Setup parameters for call to function osal_mem_free
   \   000019   12....       LCALL     `??osal_mem_free::?relay`; Banked call to: osal_mem_free
   3020              *pCurr = ( bdbFindingBindingRespondent_t* )NULL;
   \   00001C   85..82       MOV       DPL,?V0
   \   00001F   85..83       MOV       DPH,?V1
   \   000022   E4           CLR       A
   \   000023   F0           MOVX      @DPTR,A
   \   000024   A3           INC       DPTR
   \   000025   F0           MOVX      @DPTR,A
   3021              pCurr = pNext;
   \   000026   85....       MOV       ?V0,?V2
   \   000029   85....       MOV       ?V1,?V3
   3022            }
   \                     ??bdb_zclRespondentListClean_1:
   \   00002C   85..82       MOV       DPL,?V0
   \   00002F   85..83       MOV       DPH,?V1
   \   000032   12....       LCALL     ?Subroutine14 & 0xFFFF
   \                     ??CrossCallReturnLabel_21:
   \   000035   70D9         JNZ       ??bdb_zclRespondentListClean_2
   3023            *pHead = NULL;
   \   000037   8E82         MOV       DPL,R6
   \   000039   8F83         MOV       DPH,R7
   \   00003B   E4           CLR       A
   \   00003C   F0           MOVX      @DPTR,A
   \   00003D   A3           INC       DPTR
   \   00003E   F0           MOVX      @DPTR,A
   3024          }
   \                     ??bdb_zclRespondentListClean_0:
   \   00003F   02....       LJMP      ??Subroutine33_0 & 0xFFFF
   3025          
   3026           /*********************************************************************
   3027           * PRIVATE FUNCTIONS
   3028           *********************************************************************/
   3029          
   3030          /*********************************************************************
   3031           * @fn      bdb_ProcessOSALMsg
   3032           *
   3033           * @brief   Process the incoming task message.
   3034           *
   3035           * @param   msgPtr - message to process
   3036           *
   3037           * @return  none
   3038           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3039          void bdb_ProcessOSALMsg( bdbInMsg_t *msgPtr )
   \                     bdb_ProcessOSALMsg:
   3040          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV       A,#-0xa
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 26
   \   000005   74E6         MOV       A,#-0x1a
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   3041            
   3042            switch(msgPtr->hdr.event)
   \   00000A   8A82         MOV       DPL,R2
   \   00000C   8B83         MOV       DPH,R3
   \   00000E   E0           MOVX      A,@DPTR
   \   00000F   14           DEC       A
   \   000010   7003         JNZ       $+5
   \   000012   02....       LJMP      ??bdb_ProcessOSALMsg_0 & 0xFFFF
   \   000015   24FE         ADD       A,#-0x2
   \   000017   6003         JZ        $+5
   \   000019   02....       LJMP      ??bdb_ProcessOSALMsg_1 & 0xFFFF
   3043            {
   3044          #if (ZG_BUILD_JOINING_TYPE)
   3045              case BDB_COMMISSIONING_STATE_JOINING:
   3046                if(ZG_DEVICE_JOINING_TYPE)
   \   00001C   90....       MOV       DPTR,#zgDeviceLogicalType
   \   00001F   E0           MOVX      A,@DPTR
   \   000020   6401         XRL       A,#0x1
   \   000022   6008         JZ        ??bdb_ProcessOSALMsg_2
   \   000024   E0           MOVX      A,@DPTR
   \   000025   6402         XRL       A,#0x2
   \   000027   6003         JZ        $+5
   \   000029   02....       LJMP      ??bdb_ProcessOSALMsg_1 & 0xFFFF
   3047                {
   3048                  switch(msgPtr->buf[0])
   \                     ??bdb_ProcessOSALMsg_2:
   \   00002C   8A82         MOV       DPL,R2
   \   00002E   8B83         MOV       DPH,R3
   \   000030   A3           INC       DPTR
   \   000031   A3           INC       DPTR
   \   000032   E0           MOVX      A,@DPTR
   \   000033   6006         JZ        ??bdb_ProcessOSALMsg_3
   \   000035   14           DEC       A
   \   000036   6018         JZ        ??bdb_ProcessOSALMsg_4
   \   000038   02....       LJMP      ??bdb_ProcessOSALMsg_1 & 0xFFFF
   3049                  {
   3050                    case BDB_JOIN_EVENT_NWK_DISCOVERY:
   3051                      if(msgPtr->hdr.status == BDB_MSG_EVENT_SUCCESS)
   \                     ??bdb_ProcessOSALMsg_3:
   \   00003B   8A82         MOV       DPL,R2
   \   00003D   8B83         MOV       DPH,R3
   \   00003F   A3           INC       DPTR
   \   000040   E0           MOVX      A,@DPTR
   \   000041   7005         JNZ       ??bdb_ProcessOSALMsg_5
   3052                      {
   3053                        bdb_filterNwkDisc();
   \   000043                ; Setup parameters for call to function bdb_filterNwkDisc
   \   000043   12....       LCALL     `??bdb_filterNwkDisc::?relay`; Banked call to: bdb_filterNwkDisc
   3054                        bdb_tryNwkAssoc();
   \   000046                ; Setup parameters for call to function bdb_tryNwkAssoc
   \   000046   8064         SJMP      ??bdb_ProcessOSALMsg_6
   3055                      }
   3056                      else
   3057                      {
   3058                        bdb_nwkDiscoveryAttempt(FALSE);
   \                     ??bdb_ProcessOSALMsg_5:
   \   000048                ; Setup parameters for call to function bdb_nwkDiscoveryAttempt
   \   000048   7900         MOV       R1,#0x0
   \   00004A   12....       LCALL     `??bdb_nwkDiscoveryAttempt::?relay`; Banked call to: bdb_nwkDiscoveryAttempt
   \   00004D   02....       LJMP      ??bdb_ProcessOSALMsg_1 & 0xFFFF
   3059                      }
   3060                    break;
   3061                    
   3062                    case BDB_JOIN_EVENT_ASSOCIATION:
   3063                      if(msgPtr->hdr.status == BDB_MSG_EVENT_SUCCESS)
   \                     ??bdb_ProcessOSALMsg_4:
   \   000050   8A82         MOV       DPL,R2
   \   000052   8B83         MOV       DPH,R3
   \   000054   A3           INC       DPTR
   \   000055   E0           MOVX      A,@DPTR
   \   000056   700C         JNZ       ??bdb_ProcessOSALMsg_7
   3064                      {
   3065                        bdbCommissioningProcedureState.bdbJoinState = BDB_JOIN_STATE_WAITING_NWK_KEY;
   \   000058   90....       MOV       DPTR,#bdbCommissioningProcedureState + 2
   \   00005B   7402         MOV       A,#0x2
   \   00005D   F0           MOVX      @DPTR,A
   3066                        //Nwk key timeout get right timing
   3067                        osal_start_timerEx(bdb_TaskID,BDB_PROCESS_TIMEOUT, BDB_DEFAULT_DEVICE_UNAUTH_TIMEOUT);
   \   00005E                ; Setup parameters for call to function osal_start_timerEx
   \   00005E   90....       MOV       DPTR,#__Constant_bb8
   \   000061   02....       LJMP      ??bdb_ProcessOSALMsg_8 & 0xFFFF
   3068                      }
   3069                      else
   3070                      {
   3071                        if ( (NLME_GetShortAddr() != INVALID_NODE_ADDR) ||
   3072                             (_NIB.nwkDevAddress != INVALID_NODE_ADDR) )
   \                     ??bdb_ProcessOSALMsg_7:
   \   000064                ; Setup parameters for call to function NLME_GetShortAddr
   \   000064   12....       LCALL     `??NLME_GetShortAddr::?relay`; Banked call to: NLME_GetShortAddr
   \   000067   8A..         MOV       ?V0,R2
   \   000069   8B..         MOV       ?V1,R3
   \   00006B   74FE         MOV       A,#-0x2
   \   00006D   65..         XRL       A,?V0
   \   00006F   7004         JNZ       ??bdb_ProcessOSALMsg_9
   \   000071   74FF         MOV       A,#-0x1
   \   000073   65..         XRL       A,?V1
   \                     ??bdb_ProcessOSALMsg_9:
   \   000075   700D         JNZ       ??bdb_ProcessOSALMsg_10
   \   000077   90....       MOV       DPTR,#_NIB + 20
   \   00007A   E0           MOVX      A,@DPTR
   \   00007B   64FE         XRL       A,#0xfe
   \   00007D   7003         JNZ       ??bdb_ProcessOSALMsg_11
   \   00007F   A3           INC       DPTR
   \   000080   E0           MOVX      A,@DPTR
   \   000081   F4           CPL       A
   \                     ??bdb_ProcessOSALMsg_11:
   \   000082   601D         JZ        ??bdb_ProcessOSALMsg_12
   3073                        {
   3074                          uint16 addr = INVALID_NODE_ADDR;
   \                     ??bdb_ProcessOSALMsg_10:
   \   000084   7407         MOV       A,#0x7
   \   000086   12....       LCALL     ?XSTACK_DISP0_8
   \   000089   74FE         MOV       A,#-0x2
   \   00008B   F0           MOVX      @DPTR,A
   \   00008C   A3           INC       DPTR
   \   00008D   04           INC       A
   \   00008E   F0           MOVX      @DPTR,A
   3075                          // Invalidate nwk addr so end device does not use in its data reqs.
   3076                          _NIB.nwkDevAddress = INVALID_NODE_ADDR;
   \   00008F   90....       MOV       DPTR,#_NIB + 20
   \   000092   14           DEC       A
   \   000093   F0           MOVX      @DPTR,A
   \   000094   A3           INC       DPTR
   \   000095   04           INC       A
   \   000096   F0           MOVX      @DPTR,A
   3077                          ZMacSetReq( ZMacShortAddress, (uint8 *)&addr );
   \   000097                ; Setup parameters for call to function ZMacSetReq
   \   000097   7407         MOV       A,#0x7
   \   000099   12....       LCALL     ?XSTACK_DISP101_8
   \   00009C   7953         MOV       R1,#0x53
   \   00009E   12....       LCALL     `??ZMacSetReq::?relay`; Banked call to: ZMacSetReq
   3078                        }
   3079          
   3080                        //Clear the neighbor Table and network discovery tables.
   3081                        nwkNeighborInitTable();
   \                     ??bdb_ProcessOSALMsg_12:
   \   0000A1                ; Setup parameters for call to function nwkNeighborInitTable
   \   0000A1   12....       LCALL     `??nwkNeighborInitTable::?relay`; Banked call to: nwkNeighborInitTable
   3082                        NLME_NwkDiscTerm();
   \   0000A4                ; Setup parameters for call to function NLME_NwkDiscTerm
   \   0000A4   12....       LCALL     `??NLME_NwkDiscTerm::?relay`; Banked call to: NLME_NwkDiscTerm
   3083                        _NIB.nwkState = NWK_INIT;
   \   0000A7   90....       MOV       DPTR,#_NIB + 35
   \   0000AA   E4           CLR       A
   \   0000AB   F0           MOVX      @DPTR,A
   3084                        
   3085                        bdb_tryNwkAssoc();
   \   0000AC                ; Setup parameters for call to function bdb_tryNwkAssoc
   \                     ??bdb_ProcessOSALMsg_6:
   \   0000AC   12....       LCALL     `??bdb_tryNwkAssoc::?relay`; Banked call to: bdb_tryNwkAssoc
   \   0000AF   02....       LJMP      ??bdb_ProcessOSALMsg_1 & 0xFFFF
   3086                      }
   3087                    break;
   3088                  }
   3089                }
   3090              break;
   3091              
   3092              case BDB_COMMISSIONING_STATE_TC_LINK_KEY_EXCHANGE:
   3093                if(ZG_DEVICE_JOINING_TYPE)
   \                     ??bdb_ProcessOSALMsg_0:
   \   0000B2   90....       MOV       DPTR,#zgDeviceLogicalType
   \   0000B5   E0           MOVX      A,@DPTR
   \   0000B6   6401         XRL       A,#0x1
   \   0000B8   6008         JZ        ??bdb_ProcessOSALMsg_13
   \   0000BA   E0           MOVX      A,@DPTR
   \   0000BB   6402         XRL       A,#0x2
   \   0000BD   6003         JZ        $+5
   \   0000BF   02....       LJMP      ??bdb_ProcessOSALMsg_1 & 0xFFFF
   3094                {
   3095                  if(msgPtr->hdr.status != BDB_MSG_EVENT_SUCCESS)
   \                     ??bdb_ProcessOSALMsg_13:
   \   0000C2   8A82         MOV       DPL,R2
   \   0000C4   8B83         MOV       DPH,R3
   \   0000C6   A3           INC       DPTR
   \   0000C7   E0           MOVX      A,@DPTR
   \   0000C8   6011         JZ        ??bdb_ProcessOSALMsg_14
   3096                  {
   3097                    bdbAttributes.bdbTCLinkKeyExchangeAttempts++;
   \   0000CA   90....       MOV       DPTR,#bdbAttributes + 16
   \   0000CD   E0           MOVX      A,@DPTR
   \   0000CE   04           INC       A
   \   0000CF   F0           MOVX      @DPTR,A
   3098                    if(bdbAttributes.bdbTCLinkKeyExchangeAttempts > bdbAttributes.bdbTCLinkKeyExchangeAttemptsMax)
   \   0000D0   F8           MOV       R0,A
   \   0000D1   A3           INC       DPTR
   \   0000D2   E0           MOVX      A,@DPTR
   \   0000D3   C3           CLR       C
   \   0000D4   98           SUBB      A,R0
   \   0000D5   5004         JNC       ??bdb_ProcessOSALMsg_14
   3099                    {
   3100                      //TCLK process fail due to many attempts fails
   3101                      bdb_reportCommissioningState(BDB_COMMISSIONING_STATE_TC_LINK_KEY_EXCHANGE, FALSE);
   \   0000D7                ; Setup parameters for call to function bdb_reportCommissioningState
   \   0000D7   7A00         MOV       R2,#0x0
   \   0000D9   8071         SJMP      ??bdb_ProcessOSALMsg_15
   3102                      return;
   3103                    }
   3104                  }
   3105                  switch(bdbCommissioningProcedureState.bdbTCExchangeState)
   \                     ??bdb_ProcessOSALMsg_14:
   \   0000DB   90....       MOV       DPTR,#bdbCommissioningProcedureState + 1
   \   0000DE   E0           MOVX      A,@DPTR
   \   0000DF   14           DEC       A
   \   0000E0   600C         JZ        ??bdb_ProcessOSALMsg_16
   \   0000E2   14           DEC       A
   \   0000E3   606E         JZ        ??bdb_ProcessOSALMsg_17
   \   0000E5   14           DEC       A
   \   0000E6   7003         JNZ       $+5
   \   0000E8   02....       LJMP      ??bdb_ProcessOSALMsg_18 & 0xFFFF
   \   0000EB   02....       LJMP      ??bdb_ProcessOSALMsg_1 & 0xFFFF
   3106                  {
   3107                    case BDB_REQ_TC_STACK_VERSION:
   3108                      bdb_requestTCStackVersion();
   \                     ??bdb_ProcessOSALMsg_16:
   \   0000EE   90....       MOV       DPTR,#requestNewTrustCenterLinkKey
   \   0000F1   E0           MOVX      A,@DPTR
   \   0000F2   6051         JZ        ??bdb_ProcessOSALMsg_19
   \   0000F4                ; Setup parameters for call to function APSME_IsDistributedSecurity
   \   0000F4   12....       LCALL     `??APSME_IsDistributedSecurity::?relay`; Banked call to: APSME_IsDistributedSecurity
   \   0000F7   E9           MOV       A,R1
   \   0000F8   7047         JNZ       ??bdb_ProcessOSALMsg_20
   \   0000FA   90....       MOV       DPTR,#bdbAttributes + 18
   \   0000FD   E0           MOVX      A,@DPTR
   \   0000FE   702D         JNZ       ??bdb_ProcessOSALMsg_21
   \   000100   7419         MOV       A,#0x19
   \   000102   12....       LCALL     ?XSTACK_DISP0_8
   \   000105   7402         MOV       A,#0x2
   \   000107   F0           MOVX      @DPTR,A
   \   000108   7411         MOV       A,#0x11
   \   00010A   12....       LCALL     ?XSTACK_DISP0_8
   \   00010D   E4           CLR       A
   \   00010E   F0           MOVX      @DPTR,A
   \   00010F   A3           INC       DPTR
   \   000110   F0           MOVX      @DPTR,A
   \   000111                ; Setup parameters for call to function ZDP_NWKAddrOfInterestReq
   \   000111   F5..         MOV       ?V0,A
   \   000113   78..         MOV       R0,#?V0
   \   000115   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   000118   7902         MOV       R1,#0x2
   \   00011A   7C00         MOV       R4,#0x0
   \   00011C   7D00         MOV       R5,#0x0
   \   00011E   7412         MOV       A,#0x12
   \   000120   12....       LCALL     ?XSTACK_DISP101_8
   \   000123   12....       LCALL     `??ZDP_NWKAddrOfInterestReq::?relay`; Banked call to: ZDP_NWKAddrOfInterestReq
   \   000126   7401         MOV       A,#0x1
   \   000128   12....       LCALL     ?DEALLOC_XSTACK8
   \   00012B                ; Setup parameters for call to function osal_stop_timerEx
   \   00012B   807A         SJMP      ??bdb_ProcessOSALMsg_22
   \                     ??bdb_ProcessOSALMsg_21:
   \   00012D   90....       MOV       DPTR,#pfnCBKETCLinkKeyExchange
   \   000130   12....       LCALL     ??Subroutine36_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_83:
   \   000133   7003         JNZ       $+5
   \   000135   02....       LJMP      ??bdb_ProcessOSALMsg_1 & 0xFFFF
   \   000138                ; Setup parameters for indirect call
   \   000138   12....       LCALL     ??Subroutine34_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_63:
   \   00013B   12....       LCALL     ?CALL_IND
   \   00013E   02....       LJMP      ??bdb_ProcessOSALMsg_1 & 0xFFFF
   \                     ??bdb_ProcessOSALMsg_20:
   \   000141                ; Setup parameters for call to function bdb_setNodeJoinLinkKeyType
   \   000141   7901         MOV       R1,#0x1
   \   000143   8002         SJMP      ??bdb_ProcessOSALMsg_23
   \                     ??bdb_ProcessOSALMsg_19:
   \   000145                ; Setup parameters for call to function bdb_setNodeJoinLinkKeyType
   \   000145   7900         MOV       R1,#0x0
   \                     ??bdb_ProcessOSALMsg_23:
   \   000147   12....       LCALL     `??bdb_setNodeJoinLinkKeyType::?relay`; Banked call to: bdb_setNodeJoinLinkKeyType
   \   00014A                ; Setup parameters for call to function bdb_reportCommissioningState
   \   00014A   7A01         MOV       R2,#0x1
   \                     ??bdb_ProcessOSALMsg_15:
   \   00014C   7901         MOV       R1,#0x1
   \   00014E   12....       LCALL     `??bdb_reportCommissioningState::?relay`; Banked call to: bdb_reportCommissioningState
   \   000151   8077         SJMP      ??bdb_ProcessOSALMsg_1
   3109                    break;
   3110                    case BDB_REQ_TC_LINK_KEY:
   3111                      bdb_requestTCLinkKey();
   \                     ??bdb_ProcessOSALMsg_17:
   \   000153   7403         MOV       A,#0x3
   \   000155   12....       LCALL     ?XSTACK_DISP0_8
   \   000158   E4           CLR       A
   \   000159   F0           MOVX      @DPTR,A
   \   00015A   7404         MOV       A,#0x4
   \   00015C   12....       LCALL     ?XSTACK_DISP0_8
   \   00015F   7404         MOV       A,#0x4
   \   000161   F0           MOVX      @DPTR,A
   \   000162                ; Setup parameters for call to function APSME_RequestKeyReq
   \   000162   14           DEC       A
   \   000163   12....       LCALL     ?XSTACK_DISP101_8
   \   000166   12....       LCALL     `??APSME_RequestKeyReq::?relay`; Banked call to: APSME_RequestKeyReq
   \   000169                ; Setup parameters for call to function osal_stop_timerEx
   \   000169   7A00         MOV       R2,#0x0
   \   00016B   7B10         MOV       R3,#0x10
   \   00016D   90....       MOV       DPTR,#bdb_TaskID
   \   000170   E0           MOVX      A,@DPTR
   \   000171   F9           MOV       R1,A
   \   000172   12....       LCALL     `??osal_stop_timerEx::?relay`; Banked call to: osal_stop_timerEx
   \   000175                ; Setup parameters for call to function osal_start_timerEx
   \   000175   90....       MOV       DPTR,#requestLinkKeyTimeout
   \   000178   803C         SJMP      ??bdb_ProcessOSALMsg_8
   3112                    break;
   3113                    case BDB_REQ_VERIFY_TC_LINK_KEY:
   3114                      bdb_requestVerifyTCLinkKey();
   \                     ??bdb_ProcessOSALMsg_18:
   \   00017A                ; Setup parameters for call to function APSME_GetRequest
   \   00017A   7409         MOV       A,#0x9
   \   00017C   12....       LCALL     ?XSTACK_DISP102_8
   \   00017F   7A00         MOV       R2,#0x0
   \   000181   7B00         MOV       R3,#0x0
   \   000183   79AB         MOV       R1,#-0x55
   \   000185   12....       LCALL     `??APSME_GetRequest::?relay`; Banked call to: APSME_GetRequest
   \   000188   7409         MOV       A,#0x9
   \   00018A   12....       LCALL     ?XSTACK_DISP100_8
   \   00018D   85..82       MOV       DPL,?XSP + 0
   \   000190   85..83       MOV       DPH,?XSP + 1
   \   000193   E8           MOV       A,R0
   \   000194   F0           MOVX      @DPTR,A
   \   000195   A3           INC       DPTR
   \   000196   E9           MOV       A,R1
   \   000197   F0           MOVX      @DPTR,A
   \   000198   7402         MOV       A,#0x2
   \   00019A   12....       LCALL     ?XSTACK_DISP0_8
   \   00019D   7404         MOV       A,#0x4
   \   00019F   F0           MOVX      @DPTR,A
   \   0001A0                ; Setup parameters for call to function APSME_VerifyKeyReq
   \   0001A0   AA..         MOV       R2,?XSP + 0
   \   0001A2   AB..         MOV       R3,?XSP + 1
   \   0001A4   12....       LCALL     `??APSME_VerifyKeyReq::?relay`; Banked call to: APSME_VerifyKeyReq
   \   0001A7                ; Setup parameters for call to function osal_stop_timerEx
   \                     ??bdb_ProcessOSALMsg_22:
   \   0001A7   7A00         MOV       R2,#0x0
   \   0001A9   7B10         MOV       R3,#0x10
   \   0001AB   90....       MOV       DPTR,#bdb_TaskID
   \   0001AE   E0           MOVX      A,@DPTR
   \   0001AF   F9           MOV       R1,A
   \   0001B0   12....       LCALL     `??osal_stop_timerEx::?relay`; Banked call to: osal_stop_timerEx
   \   0001B3                ; Setup parameters for call to function osal_start_timerEx
   \   0001B3   90....       MOV       DPTR,#__Constant_1388
   \                     ??bdb_ProcessOSALMsg_8:
   \   0001B6   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   0001B9   7A00         MOV       R2,#0x0
   \   0001BB   7B10         MOV       R3,#0x10
   \   0001BD   90....       MOV       DPTR,#bdb_TaskID
   \   0001C0   E0           MOVX      A,@DPTR
   \   0001C1   F9           MOV       R1,A
   \   0001C2   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   0001C5   7404         MOV       A,#0x4
   \   0001C7   12....       LCALL     ?DEALLOC_XSTACK8
   3115                    break;
   3116                  }
   3117                }
   3118             break;
   3119          #endif
   3120             }
   3121          }
   \                     ??bdb_ProcessOSALMsg_1:
   \   0001CA   741A         MOV       A,#0x1a
   \   0001CC   02....       LJMP      ??Subroutine40_0 & 0xFFFF
   3122          
   3123          
   3124          /*********************************************************************
   3125           * @fn      bdb_processTimeout
   3126           *
   3127           * @brief   Handles timeout of the bdb process
   3128           *
   3129           * @param   msgPtr - message to process
   3130           *
   3131           * @return  none
   3132           */
   3133          void bdb_processTimeout(void)
   3134          {
   3135          #if (ZG_BUILD_JOINING_TYPE)
   3136            if(ZG_DEVICE_JOINING_TYPE)
   3137            {
   3138              switch(bdbCommissioningProcedureState.bdbCommissioningState)
   3139              {
   3140                case BDB_COMMISSIONING_STATE_TC_LINK_KEY_EXCHANGE:
   3141                  
   3142                  bdb_tcLinkKeyExchangeAttempt(FALSE,bdbCommissioningProcedureState.bdbTCExchangeState);
   3143                break;
   3144                case BDB_COMMISSIONING_STATE_JOINING:
   3145                  if(bdbCommissioningProcedureState.bdbJoinState == BDB_JOIN_STATE_WAITING_NWK_KEY)
   3146                  {
   3147                    //If nwk key fails, then try association again
   3148                    bdbCommissioningProcedureState.bdbJoinState = BDB_JOIN_STATE_ASSOC;
   3149                    bdb_nwkAssocAttemt(FALSE);
   3150                  }
   3151                break;
   3152              }
   3153            }
   3154          #endif
   3155            
   3156          }
   3157          
   3158          
   3159          /*********************************************************************
   3160           * @fn      bdb_SendMsg
   3161           *
   3162           * @brief   Send messages to bdb processing with the expected format
   3163           *
   3164           * @param   msgPtr - message to process
   3165           *
   3166           * @return  none
   3167           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3168          void bdb_SendMsg(uint8 taskID, uint8 toCommissioningState,uint8 status, uint8 len, uint8 *buf)
   \                     bdb_SendMsg:
   3169          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000                REQUIRE ?V4
   \   000000                REQUIRE ?V5
   \   000000                REQUIRE ?V6
   \   000000                REQUIRE ?V7
   \   000000                REQUIRE ?V8
   \   000000   74EF         MOV       A,#-0x11
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 17
   \   000005                ; Auto size: 0
   \   000005   89..         MOV       ?V2,R1
   \   000007   8A..         MOV       ?V7,R2
   \   000009   8B..         MOV       ?V8,R3
   \   00000B   8C..         MOV       ?V3,R4
   3170            bdbInMsg_t *msgPtr = NULL;
   3171          
   3172            if ( (len > 0) && (buf != NULL) )
   \   00000D   EC           MOV       A,R4
   \   00000E   6058         JZ        ??bdb_SendMsg_0
   \   000010   7411         MOV       A,#0x11
   \   000012   12....       LCALL     ?XSTACK_DISP0_8
   \   000015   12....       LCALL     ?Subroutine19 & 0xFFFF
   \                     ??CrossCallReturnLabel_30:
   \   000018   E5..         MOV       A,?V0
   \   00001A   45..         ORL       A,?V1
   \   00001C   604A         JZ        ??bdb_SendMsg_0
   3173            {
   3174              uint8 tmpLength;
   3175              tmpLength = len;
   3176              tmpLength += sizeof(osal_event_hdr_t);
   3177              
   3178              msgPtr = (bdbInMsg_t *)osal_msg_allocate( tmpLength );
   \   00001E                ; Setup parameters for call to function osal_msg_allocate
   \   00001E   7402         MOV       A,#0x2
   \   000020   2C           ADD       A,R4
   \   000021   FA           MOV       R2,A
   \   000022   7B00         MOV       R3,#0x0
   \   000024   12....       LCALL     `??osal_msg_allocate::?relay`; Banked call to: osal_msg_allocate
   \   000027   8A..         MOV       ?V4,R2
   \   000029   8B..         MOV       ?V5,R3
   \   00002B   AE..         MOV       R6,?V4
   \   00002D   AF..         MOV       R7,?V5
   3179              
   3180              if ( msgPtr )
   \   00002F   EE           MOV       A,R6
   \   000030   4F           ORL       A,R7
   \   000031   6035         JZ        ??bdb_SendMsg_0
   3181              {
   3182                osal_memcpy( msgPtr->buf, buf, len );
   \   000033                ; Setup parameters for call to function osal_memcpy
   \   000033   85....       MOV       ?V4,?V0
   \   000036   85....       MOV       ?V5,?V1
   \   000039   75..00       MOV       ?V6,#0x0
   \   00003C   78..         MOV       R0,#?V4
   \   00003E   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   000041   AC..         MOV       R4,?V3
   \   000043   7D00         MOV       R5,#0x0
   \   000045   EE           MOV       A,R6
   \   000046   2402         ADD       A,#0x2
   \   000048   FA           MOV       R2,A
   \   000049   E4           CLR       A
   \   00004A   3F           ADDC      A,R7
   \   00004B   FB           MOV       R3,A
   \   00004C   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   00004F   7403         MOV       A,#0x3
   \   000051   12....       LCALL     ?DEALLOC_XSTACK8
   3183              
   3184                msgPtr->hdr.event = toCommissioningState;
   \   000054   8E82         MOV       DPL,R6
   \   000056   8F83         MOV       DPH,R7
   \   000058   E5..         MOV       A,?V7
   \   00005A   F0           MOVX      @DPTR,A
   3185                msgPtr->hdr.status = status;
   \   00005B   A3           INC       DPTR
   \   00005C   E5..         MOV       A,?V8
   \   00005E   F0           MOVX      @DPTR,A
   3186                osal_msg_send( taskID, (uint8 *)msgPtr );
   \   00005F                ; Setup parameters for call to function osal_msg_send
   \   00005F   EE           MOV       A,R6
   \   000060   FA           MOV       R2,A
   \   000061   EF           MOV       A,R7
   \   000062   FB           MOV       R3,A
   \   000063   A9..         MOV       R1,?V2
   \   000065   12....       LCALL     `??osal_msg_send::?relay`; Banked call to: osal_msg_send
   3187              }
   3188            }
   3189          }
   \                     ??bdb_SendMsg_0:
   \   000068   7F09         MOV       R7,#0x9
   \   00006A   02....       LJMP      ?BANKED_LEAVE_XDATA
   3190          
   3191          
   3192          /*********************************************************************
   3193           * @fn      bdb_RegisterCommissioningStatusCB
   3194           *
   3195           * @brief   Register a callback in which the status of the procedures done in
   3196           *          BDB commissioning process will be reported
   3197           *
   3198           * @param   bdbGCB_CommissioningStatus - application callback
   3199           *
   3200           * @return  none
   3201           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3202          void bdb_RegisterCommissioningStatusCB(bdbGCB_CommissioningStatus_t bdbGCB_CommissioningStatus)
   \                     bdb_RegisterCommissioningStatusCB:
   3203          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   3204            pfnCommissioningStatusCB = bdbGCB_CommissioningStatus;
   \   000004   90....       MOV       DPTR,#pfnCommissioningStatusCB
   \   000007   02....       LJMP      ?Subroutine3 & 0xFFFF
   3205          }
   3206          
   3207          /*********************************************************************
   3208           * @fn      bdb_ClearNetworkParams
   3209           *
   3210           * @brief   Restore nwk parameters to invalid if the device is not on a network
   3211           *
   3212           * @param   void
   3213           *
   3214           * @return  void
   3215           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3216          void bdb_ClearNetworkParams(void)
   \                     bdb_ClearNetworkParams:
   3217          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   3218          #if (BDB_TOUCHLINK_CAPABILITY_ENABLED == TRUE)
   3219            if ( bdbAttributes.bdbNodeIsOnANetwork == FALSE )
   3220            {
   3221              //Clear the event
   3222              _NIB.nwkPanId = INVALID_NODE_ADDR;
   3223              _NIB.nwkLogicalChannel = 0;
   3224              _NIB.nwkDevAddress = INVALID_NODE_ADDR;
   3225              touchLink_SetMacNwkParams( _NIB.nwkDevAddress, _NIB.nwkPanId, _NIB.nwkLogicalChannel );
   3226            }
   3227          #endif
   3228          }
   \   000000   02....       LJMP      ?BRET
   3229          
   3230          /*********************************************************************
   3231           * @fn      bdb_getZCLFrameCounter
   3232           *
   3233           * @brief   Get the next ZCL Frame Counter for packet sequence number
   3234           *
   3235           * @param   none
   3236           *
   3237           * @return  next ZCL frame counter
   3238           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3239          uint8 bdb_getZCLFrameCounter(void)
   \                     bdb_getZCLFrameCounter:
   3240          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   3241            bdb_ZclTransactionSequenceNumber++;
   \   000004   90....       MOV       DPTR,#bdb_ZclTransactionSequenceNumber
   \   000007   E0           MOVX      A,@DPTR
   \   000008   04           INC       A
   \   000009   F0           MOVX      @DPTR,A
   3242            return bdb_ZclTransactionSequenceNumber;
   \   00000A   F9           MOV       R1,A
   \   00000B   02....       LJMP      ??Subroutine31_0 & 0xFFFF
   3243          
   3244          }
   3245          
   3246          
   3247          #if (ZG_BUILD_JOINING_TYPE)
   3248          /*********************************************************************
   3249           * @fn      bdb_RegisterCBKETCLinkKeyExchangeCB
   3250           *
   3251           * @brief   Register a callback in which the TC link key exchange procedure will 
   3252           *          be performed by application.
   3253           *          Upon fail or success bdb must be notified, see bdb_CBKETCLinkKeyExchangeAttempt
   3254           *
   3255           * @param   bdbGCB_TCLinkKeyExchangeMethod - application callback
   3256           *
   3257           * @return  none
   3258           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3259          void bdb_RegisterCBKETCLinkKeyExchangeCB(bdbGCB_CBKETCLinkKeyExchange_t bdbGCB_CBKETCLinkKeyExchange)
   \                     bdb_RegisterCBKETCLinkKeyExchangeCB:
   3260          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   3261            if(bdbGCB_CBKETCLinkKeyExchange)
   \   000004   EA           MOV       A,R2
   \   000005   4B           ORL       A,R3
   \   000006   90....       MOV       DPTR,#pfnCBKETCLinkKeyExchange
   \   000009   600A         JZ        ??bdb_RegisterCBKETCLinkKeyExchangeCB_0
   3262            {
   3263              pfnCBKETCLinkKeyExchange = bdbGCB_CBKETCLinkKeyExchange;
   \   00000B   12....       LCALL     ?Subroutine10 & 0xFFFF
   3264              bdbAttributes.bdbTCLinkKeyExchangeMethod = BDB_TC_LINK_KEY_EXCHANGE_CBKE;
   \                     ??CrossCallReturnLabel_13:
   \   00000E   90....       MOV       DPTR,#bdbAttributes + 18
   \   000011   7401         MOV       A,#0x1
   \   000013   8007         SJMP      ??bdb_RegisterCBKETCLinkKeyExchangeCB_1
   3265            }
   3266            else
   3267            {
   3268              pfnCBKETCLinkKeyExchange = NULL;
   \                     ??bdb_RegisterCBKETCLinkKeyExchangeCB_0:
   \   000015   E4           CLR       A
   \   000016   F0           MOVX      @DPTR,A
   \   000017   A3           INC       DPTR
   \   000018   F0           MOVX      @DPTR,A
   3269              bdbAttributes.bdbTCLinkKeyExchangeMethod = BDB_TC_LINK_KEY_EXCHANGE_APS_KEY;
   \   000019   90....       MOV       DPTR,#bdbAttributes + 18
   3270            }
   \                     ??bdb_RegisterCBKETCLinkKeyExchangeCB_1:
   \   00001C   02....       LJMP      ??Subroutine30_0 & 0xFFFF
   3271          }
   3272          
   3273          /*********************************************************************
   3274           * @fn      bdb_RegisterForFilterNwkDescCB
   3275           *
   3276           * @brief   Register a callback in which the application gets the list of network
   3277           *          descriptors got from active scan.
   3278           *          Use bdb_nwkDescFree to release the network descriptors that are not 
   3279           *          of interest and leave those which are to be attempted.
   3280           *
   3281           * @param   bdbGCB_FilterNwkDesc - application callback
   3282           *
   3283           * @return  none
   3284           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3285          void bdb_RegisterForFilterNwkDescCB(bdbGCB_FilterNwkDesc_t bdbGCB_FilterNwkDesc)
   \                     bdb_RegisterForFilterNwkDescCB:
   3286          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   3287            if(bdbGCB_FilterNwkDesc)
   \   000004   EA           MOV       A,R2
   \   000005   4B           ORL       A,R3
   \   000006   6006         JZ        ??CrossCallReturnLabel_14
   3288            {
   3289              pfnFilterNwkDesc = bdbGCB_FilterNwkDesc;
   \   000008   90....       MOV       DPTR,#pfnFilterNwkDesc
   \   00000B   12....       LCALL     ?Subroutine10 & 0xFFFF
   3290            }
   3291          }
   \                     ??CrossCallReturnLabel_14:
   \   00000E   02....       LJMP      ??Subroutine31_0 & 0xFFFF
   3292          
   3293          
   3294          /*********************************************************************
   3295           * @fn          bdb_CBKETCLinkKeyExchangeAttempt
   3296           *
   3297           * @brief       Tell BDB module the result of the TC link key exchange, to try
   3298           *              the default process or to keep going with the joining process.
   3299           *
   3300           * @param       didSuccess - TRUE if the process was succes, False otherwise
   3301           *
   3302           * @return      unprocessed events
   3303           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3304          void bdb_CBKETCLinkKeyExchangeAttempt(bool didSuccess)
   \                     bdb_CBKETCLinkKeyExchangeAttempt:
   3305          {
   \   000000   74F7         MOV       A,#-0x9
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV       A,R1
   3306            if(didSuccess)
   \   000006   600E         JZ        ??bdb_CBKETCLinkKeyExchangeAttempt_0
   3307            {
   3308              bdb_setNodeJoinLinkKeyType(BDB_DEFAULT_GLOBAL_TRUST_CENTER_LINK_KEY);
   \   000008                ; Setup parameters for call to function bdb_setNodeJoinLinkKeyType
   \   000008   7900         MOV       R1,#0x0
   \   00000A   12....       LCALL     `??bdb_setNodeJoinLinkKeyType::?relay`; Banked call to: bdb_setNodeJoinLinkKeyType
   3309              bdb_reportCommissioningState(BDB_COMMISSIONING_STATE_TC_LINK_KEY_EXCHANGE, TRUE);
   \   00000D                ; Setup parameters for call to function bdb_reportCommissioningState
   \   00000D   7A01         MOV       R2,#0x1
   \   00000F   7901         MOV       R1,#0x1
   \   000011   12....       LCALL     `??bdb_reportCommissioningState::?relay`; Banked call to: bdb_reportCommissioningState
   \   000014   8012         SJMP      ??bdb_CBKETCLinkKeyExchangeAttempt_1
   3310            }
   3311            else
   3312            {
   3313              bdbAttributes.bdbTCLinkKeyExchangeMethod = BDB_TC_LINK_KEY_EXCHANGE_APS_KEY;
   \                     ??bdb_CBKETCLinkKeyExchangeAttempt_0:
   \   000016   90....       MOV       DPTR,#bdbAttributes + 18
   \   000019   E4           CLR       A
   \   00001A   F0           MOVX      @DPTR,A
   3314              //We are going back one state to try it again
   3315              bdbCommissioningProcedureState.bdbTCExchangeState -= BDB_TC_EXCHANGE_NEXT_STATE;
   \   00001B   90....       MOV       DPTR,#bdbCommissioningProcedureState + 1
   \   00001E   E0           MOVX      A,@DPTR
   \   00001F   14           DEC       A
   \   000020   F0           MOVX      @DPTR,A
   3316              bdb_tcLinkKeyExchangeAttempt(TRUE,BDB_REQ_TC_STACK_VERSION);
   \   000021                ; Setup parameters for call to function bdb_tcLinkKeyExchangeAttempt
   \   000021   7A01         MOV       R2,#0x1
   \   000023   7901         MOV       R1,#0x1
   \   000025   12....       LCALL     `??bdb_tcLinkKeyExchangeAttempt::?relay`; Banked call to: bdb_tcLinkKeyExchangeAttempt
   3317            }
   3318          
   3319          }
   \                     ??bdb_CBKETCLinkKeyExchangeAttempt_1:
   \   000028   02....       LJMP      ?Subroutine0 & 0xFFFF
   3320          #endif
   3321          
   3322          #if !defined (DISABLE_GREENPOWER_BASIC_PROXY) && (ZG_BUILD_RTR_TYPE)
   3323          
   3324          /*********************************************************************
   3325           * @fn      gp_ChangeChannelReq
   3326           *
   3327           * @brief   Callback function to notify the BDB about a GP commissioning 
   3328           * request that will change the current channel for at most 
   3329           * gpBirectionalCommissioningChangeChannelTimeout ms
   3330           *
   3331           * @param   channel - Channel in which the commissioning will take place
   3332           *
   3333           * @return  TRUE to allow change channel, FALSE to do not allow
   3334           */
   3335          static uint8 gp_ChangeChannelReq(void)
   3336          {
   3337            uint8 allowChangeChannel = TRUE;
   3338            
   3339            //Do not allow changes of channel if any process is in place
   3340            if(bdbAttributes.bdbCommissioningMode)
   3341            {
   3342              allowChangeChannel = FALSE;
   3343            }
   3344            
   3345            //Check application state to decide if allow change channel or not
   3346            
   3347            return allowChangeChannel;
   3348          }
   3349          
   3350          
   3351          /*********************************************************************
   3352           * @fn          gp_CBInit
   3353           *
   3354           * @brief       Register the callbacks for GP endpoint
   3355           *
   3356           * @param       none
   3357           *
   3358           * @return      none
   3359           */
   3360          void gp_CBInit(void)
   3361          {
   3362            GP_DataCnfGCB = GP_DataCnf;
   3363            GP_endpointInitGCB = gp_endpointInit;  
   3364            GP_expireDuplicateFilteringGCB = gp_expireDuplicateFiltering;
   3365            GP_stopCommissioningModeGCB = gp_stopCommissioningMode;
   3366            GP_returnOperationalChannelGCB = gp_returnOperationalChannel;
   3367            GP_DataIndGCB = GP_DataInd;
   3368            GP_SecReqGCB = GP_SecReq;   
   3369            GP_CheckAnnouncedDeviceGCB = gp_CheckAnnouncedDevice;
   3370              
   3371            GP_aliasConflictAnnce = &aliasConflictAnnce;
   3372            
   3373            GP_endpointInitGCB();
   3374          }
   3375          
   3376          #endif
   3377          
   3378          /*********************************************************************
   3379          *********************************************************************/
   3380          
   3381          
   3382          /******************************************************************************
   3383           * @fn          bdb_GenerateInstallCodeCRC
   3384           *
   3385           * @brief       Creates a CRC for the install code passed.
   3386           *
   3387           * @param       installCode - install code from which CRC will be generated
   3388           *
   3389           * @return      CRC
   3390           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3391          uint16 bdb_GenerateInstallCodeCRC(uint8 *installCode)
   \                     bdb_GenerateInstallCodeCRC:
   3392          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 2
   \   000004   74FE         MOV       A,#-0x2
   \   000006   12....       LCALL     ?ALLOC_XSTACK8
   3393            uint16 CRC;
   3394            
   3395            bdb_calculateCCITT_CRC(installCode, INSTALL_CODE_LEN, &CRC);
   \   000009                ; Setup parameters for call to function bdb_calculateCCITT_CRC
   \   000009   90....       MOV       DPTR,#__Constant_10
   \   00000C   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   00000F   7404         MOV       A,#0x4
   \   000011   12....       LCALL     ?XSTACK_DISP102_8
   \   000014   12....       LCALL     `??bdb_calculateCCITT_CRC::?relay`; Banked call to: bdb_calculateCCITT_CRC
   \   000017   7404         MOV       A,#0x4
   \   000019   12....       LCALL     ?DEALLOC_XSTACK8
   3396          
   3397            return CRC;
   \   00001C   85..82       MOV       DPL,?XSP + 0
   \   00001F   85..83       MOV       DPH,?XSP + 1
   \   000022   12....       LCALL     ??Subroutine42_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_99:
   \   000025   7402         MOV       A,#0x2
   \   000027   02....       LJMP      ?Subroutine4 & 0xFFFF
   3398          }
   3399          
   3400          /******************************************************************************
   3401           * @fn          bdb_calculateCCITT_CRC
   3402           *
   3403           * @brief       Creates a CRC for the install code passed.
   3404           *
   3405           * @param       Mb - install code from which CRC will be generated
   3406           * @param       msglen - install code length
   3407           * @param       crc - 
   3408           *
   3409           * @return      none
   3410           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3411          void bdb_calculateCCITT_CRC (uint8 *Mb, uint32 msglen, uint16 *crc)
   \                     bdb_calculateCCITT_CRC:
   3412          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000   74F4         MOV       A,#-0xc
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 4
   \   000005   74FC         MOV       A,#-0x4
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   \   00000A   EA           MOV       A,R2
   \   00000B   FE           MOV       R6,A
   \   00000C   EB           MOV       A,R3
   \   00000D   FF           MOV       R7,A
   \   00000E   8C..         MOV       ?V0,R4
   \   000010   8D..         MOV       ?V1,R5
   3413            uint16 crcinit_direct; 
   3414            uint16 crcinit_nondirect;
   3415            bdb_crcInit(crc, &crcinit_direct, &crcinit_nondirect);
   \   000012                ; Setup parameters for call to function bdb_crcInit
   \   000012   A8..         MOV       R0,?XSP + 0
   \   000014   A9..         MOV       R1,?XSP + 1
   \   000016   88..         MOV       ?V2,R0
   \   000018   89..         MOV       ?V3,R1
   \   00001A   78..         MOV       R0,#?V2
   \   00001C   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00001F   7404         MOV       A,#0x4
   \   000021   12....       LCALL     ?XSTACK_DISP102_8
   \   000024   AA..         MOV       R2,?V0
   \   000026   AB..         MOV       R3,?V1
   \   000028   12....       LCALL     `??bdb_crcInit::?relay`; Banked call to: bdb_crcInit
   \   00002B   7402         MOV       A,#0x2
   \   00002D   12....       LCALL     ?DEALLOC_XSTACK8
   3416            *crc = bdb_crcBitByBitFast(Mb, msglen, crcinit_direct, crcinit_nondirect);
   \   000030                ; Setup parameters for call to function bdb_crcBitByBitFast
   \   000030   85..82       MOV       DPL,?XSP + 0
   \   000033   85..83       MOV       DPH,?XSP + 1
   \   000036   12....       LCALL     ?PUSH_XSTACK8_X_TWO
   \   000039   7412         MOV       A,#0x12
   \   00003B   12....       LCALL     ?XSTACK_DISP0_8
   \   00003E   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   000041   7408         MOV       A,#0x8
   \   000043   12....       LCALL     ?XSTACK_DISP0_8
   \   000046   12....       LCALL     ?Subroutine20 & 0xFFFF
   \                     ??CrossCallReturnLabel_34:
   \   000049   EE           MOV       A,R6
   \   00004A   FA           MOV       R2,A
   \   00004B   EF           MOV       A,R7
   \   00004C   FB           MOV       R3,A
   \   00004D   12....       LCALL     `??bdb_crcBitByBitFast::?relay`; Banked call to: bdb_crcBitByBitFast
   \   000050   7406         MOV       A,#0x6
   \   000052   12....       LCALL     ?DEALLOC_XSTACK8
   \   000055   85..82       MOV       DPL,?V0
   \   000058   85..83       MOV       DPH,?V1
   \   00005B   12....       LCALL     ?Subroutine10 & 0xFFFF
   3417          }
   \                     ??CrossCallReturnLabel_15:
   \   00005E   02....       LJMP      ?Subroutine2 & 0xFFFF
   3418          
   3419          
   3420          /******************************************************************************
   3421           * @fn          bdb_crcInit
   3422           *
   3423           * @brief       Initialize CRC calculation
   3424           *
   3425           * @param       crc - 
   3426           * @param       crcinit_direct -
   3427           * @param       crcinit_nondirect - 
   3428           *
   3429           * @return      none
   3430           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3431          void bdb_crcInit(uint16 *crc, uint16 *crcinit_direct, uint16 *crcinit_nondirect)
   \                     bdb_crcInit:
   3432          {
   \   000000   74F7         MOV       A,#-0x9
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   3433          
   3434            uint16 i;
   3435            uint16 bit;
   3436          
   3437            *crcinit_direct = CRC_INIT;
   \   000005   8C82         MOV       DPL,R4
   \   000007   8D83         MOV       DPH,R5
   \   000009   74FF         MOV       A,#-0x1
   \   00000B   F0           MOVX      @DPTR,A
   \   00000C   A3           INC       DPTR
   \   00000D   F0           MOVX      @DPTR,A
   3438            *crc = CRC_INIT;
   \   00000E   8A82         MOV       DPL,R2
   \   000010   8B83         MOV       DPH,R3
   \   000012   F0           MOVX      @DPTR,A
   \   000013   A3           INC       DPTR
   \   000014   F0           MOVX      @DPTR,A
   3439            for (i=0; i<CRC_ORDER; i++) 
   \   000015   7E10         MOV       R6,#0x10
   3440            {
   3441              bit = *crc & 1;
   \                     ??bdb_crcInit_0:
   \   000017   8A82         MOV       DPL,R2
   \   000019   8B83         MOV       DPH,R3
   \   00001B   E0           MOVX      A,@DPTR
   \   00001C   F8           MOV       R0,A
   3442              if (bit) *crc^= CRC_POLYNOM;
   \   00001D   A2E0         MOV       C,0xE0 /* A   */.0
   \   00001F   5008         JNC       ??bdb_crcInit_1
   \   000021   6421         XRL       A,#0x21
   \   000023   F0           MOVX      @DPTR,A
   \   000024   A3           INC       DPTR
   \   000025   E0           MOVX      A,@DPTR
   \   000026   6410         XRL       A,#0x10
   \   000028   F0           MOVX      @DPTR,A
   3443              *crc >>= 1;
   \                     ??bdb_crcInit_1:
   \   000029   8A82         MOV       DPL,R2
   \   00002B   8B83         MOV       DPH,R3
   \   00002D   E0           MOVX      A,@DPTR
   \   00002E   FC           MOV       R4,A
   \   00002F   A3           INC       DPTR
   \   000030   E0           MOVX      A,@DPTR
   \   000031   C3           CLR       C
   \   000032   13           RRC       A
   \   000033   FD           MOV       R5,A
   \   000034   EC           MOV       A,R4
   \   000035   13           RRC       A
   \   000036   8A82         MOV       DPL,R2
   \   000038   8B83         MOV       DPH,R3
   \   00003A   F0           MOVX      @DPTR,A
   \   00003B   A3           INC       DPTR
   \   00003C   ED           MOV       A,R5
   \   00003D   F0           MOVX      @DPTR,A
   3444              if (bit) *crc|= CRC_HIGHBIT;
   \   00003E   E8           MOV       A,R0
   \   00003F   A2E0         MOV       C,0xE0 /* A   */.0
   \   000041   5009         JNC       ??bdb_crcInit_2
   \   000043   8A82         MOV       DPL,R2
   \   000045   8B83         MOV       DPH,R3
   \   000047   A3           INC       DPTR
   \   000048   E0           MOVX      A,@DPTR
   \   000049   4480         ORL       A,#0x80
   \   00004B   F0           MOVX      @DPTR,A
   3445            }	
   \                     ??bdb_crcInit_2:
   \   00004C   1E           DEC       R6
   \   00004D   EE           MOV       A,R6
   \   00004E   70C7         JNZ       ??bdb_crcInit_0
   3446            *crcinit_nondirect = *crc;
   \   000050   8A82         MOV       DPL,R2
   \   000052   8B83         MOV       DPH,R3
   \   000054   12....       LCALL     ?Subroutine21 & 0xFFFF
   \                     ??CrossCallReturnLabel_38:
   \   000057   7409         MOV       A,#0x9
   \   000059   12....       LCALL     ?XSTACK_DISP0_8
   \   00005C   E0           MOVX      A,@DPTR
   \   00005D   FA           MOV       R2,A
   \   00005E   A3           INC       DPTR
   \   00005F   E0           MOVX      A,@DPTR
   \   000060   F583         MOV       DPH,A
   \   000062   8A82         MOV       DPL,R2
   \   000064   E8           MOV       A,R0
   \   000065   F0           MOVX      @DPTR,A
   \   000066   A3           INC       DPTR
   \   000067   E9           MOV       A,R1
   \   000068   F0           MOVX      @DPTR,A
   3447          
   3448          }
   \   000069   02....       LJMP      ?Subroutine0 & 0xFFFF
   3449          
   3450          
   3451          /******************************************************************************
   3452           * @fn          bdb_crcReflect
   3453           *
   3454           * @brief       
   3455           *
   3456           * @param       crc - 
   3457           * @param       bitnum -
   3458           *
   3459           * @return      none
   3460           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3461          uint16 bdb_crcReflect (uint16 crc, uint16 bitnum)
   \                     bdb_crcReflect:
   3462          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000   74F4         MOV       A,#-0xc
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   3463          
   3464            // reflects the lower 'bitnum' bits of 'crc'
   3465          
   3466            uint16 i, j=1, crcout=0;
   \   000005   7E01         MOV       R6,#0x1
   \   000007   7F00         MOV       R7,#0x0
   \   000009   8F..         MOV       ?V0,R7
   \   00000B   8F..         MOV       ?V1,R7
   3467          
   3468            for (i=(uint16)1<<(bitnum-1); i; i>>=1) {
   \   00000D   8E..         MOV       ?V2,R6
   \   00000F   8F..         MOV       ?V3,R7
   \   000011   EC           MOV       A,R4
   \   000012   14           DEC       A
   \   000013   78..         MOV       R0,#?V2
   \   000015   12....       LCALL     ?S_SHL
   \   000018   A8..         MOV       R0,?V2
   \   00001A   A9..         MOV       R1,?V3
   \   00001C   8022         SJMP      ??bdb_crcReflect_0
   3469              if (crc & i) crcout|=j;
   \                     ??bdb_crcReflect_1:
   \   00001E   EA           MOV       A,R2
   \   00001F   58           ANL       A,R0
   \   000020   FC           MOV       R4,A
   \   000021   EB           MOV       A,R3
   \   000022   59           ANL       A,R1
   \   000023   FD           MOV       R5,A
   \   000024   EC           MOV       A,R4
   \   000025   4D           ORL       A,R5
   \   000026   600A         JZ        ??bdb_crcReflect_2
   \   000028   EE           MOV       A,R6
   \   000029   45..         ORL       A,?V0
   \   00002B   F5..         MOV       ?V0,A
   \   00002D   EF           MOV       A,R7
   \   00002E   45..         ORL       A,?V1
   \   000030   F5..         MOV       ?V1,A
   3470              j<<= 1;
   \                     ??bdb_crcReflect_2:
   \   000032   EE           MOV       A,R6
   \   000033   25E0         ADD       A,0xE0 /* A   */
   \   000035   FE           MOV       R6,A
   \   000036   EF           MOV       A,R7
   \   000037   33           RLC       A
   \   000038   FF           MOV       R7,A
   3471            }
   \   000039   E9           MOV       A,R1
   \   00003A   C3           CLR       C
   \   00003B   13           RRC       A
   \   00003C   F9           MOV       R1,A
   \   00003D   E8           MOV       A,R0
   \   00003E   13           RRC       A
   \   00003F   F8           MOV       R0,A
   \                     ??bdb_crcReflect_0:
   \   000040   E8           MOV       A,R0
   \   000041   49           ORL       A,R1
   \   000042   70DA         JNZ       ??bdb_crcReflect_1
   3472            return (crcout);
   \   000044   AA..         MOV       R2,?V0
   \   000046   AB..         MOV       R3,?V1
   \   000048   02....       LJMP      ??Subroutine33_0 & 0xFFFF
   3473          }
   3474          
   3475          
   3476          /******************************************************************************
   3477           * @fn          bdb_crcBitByBitFast
   3478           *
   3479           * @brief       
   3480           *
   3481           * @param       p - 
   3482           * @param       len -
   3483           * @param       crcinit_direct - 
   3484           * @param       crcinit_nondirect -
   3485           *
   3486           * @return      crc
   3487           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3488          uint16 bdb_crcBitByBitFast(uint8 * p, uint32 len, uint16 crcinit_direct, uint16 crcinit_nondirect) 
   \                     bdb_crcBitByBitFast:
   3489          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000                REQUIRE ?V4
   \   000000                REQUIRE ?V5
   \   000000                REQUIRE ?V6
   \   000000                REQUIRE ?V7
   \   000000                REQUIRE ?V8
   \   000000                REQUIRE ?V9
   \   000000                REQUIRE ?V10
   \   000000                REQUIRE ?V11
   \   000000   74EC         MOV       A,#-0x14
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 20
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV       ?V2,R2
   \   000007   8B..         MOV       ?V3,R3
   3490            // fast bit by bit algorithm without augmented zero bytes.
   3491            // does not use lookup table, suited for polynom orders between 1...32.
   3492          
   3493            uint16 i, j, c, bit;
   3494            uint16 crc = crcinit_direct;
   \   000009   EC           MOV       A,R4
   \   00000A   FE           MOV       R6,A
   \   00000B   ED           MOV       A,R5
   \   00000C   FF           MOV       R7,A
   3495          
   3496            for (i=0; i<len; i++) {
   \   00000D   75..00       MOV       ?V0,#0x0
   \   000010   75..00       MOV       ?V1,#0x0
   \   000013   7414         MOV       A,#0x14
   \   000015   12....       LCALL     ?XSTACK_DISP0_8
   \   000018   78..         MOV       R0,#?V8
   \   00001A   12....       LCALL     ?L_MOV_X
   \   00001D   8046         SJMP      ??bdb_crcBitByBitFast_0
   3497          
   3498              c = (uint16)*p++;
   \                     ??bdb_crcBitByBitFast_1:
   \   00001F   85..82       MOV       DPL,?V2
   \   000022   85..83       MOV       DPH,?V3
   \   000025   E0           MOVX      A,@DPTR
   \   000026   FA           MOV       R2,A
   \   000027   7B00         MOV       R3,#0x0
   \   000029   A3           INC       DPTR
   \   00002A   8582..       MOV       ?V2,DPL
   \   00002D   8583..       MOV       ?V3,DPH
   3499              c = bdb_crcReflect(c, 8);
   \   000030                ; Setup parameters for call to function bdb_crcReflect
   \   000030   7C08         MOV       R4,#0x8
   \   000032   7D00         MOV       R5,#0x0
   \   000034   12....       LCALL     `??bdb_crcReflect::?relay`; Banked call to: bdb_crcReflect
   3500          
   3501              for (j=0x80; j; j>>=1) {
   \   000037   7880         MOV       R0,#-0x80
   3502          
   3503                bit = crc & CRC_HIGHBIT;
   \                     ??bdb_crcBitByBitFast_2:
   \   000039   EF           MOV       A,R7
   \   00003A   5480         ANL       A,#0x80
   \   00003C   FD           MOV       R5,A
   3504                crc<<= 1;
   \   00003D   EE           MOV       A,R6
   \   00003E   25E0         ADD       A,0xE0 /* A   */
   \   000040   FE           MOV       R6,A
   \   000041   EF           MOV       A,R7
   \   000042   33           RLC       A
   \   000043   FF           MOV       R7,A
   3505                if (c & j) bit^= CRC_HIGHBIT;
   \   000044   EA           MOV       A,R2
   \   000045   58           ANL       A,R0
   \   000046   6004         JZ        ??bdb_crcBitByBitFast_3
   \   000048   7480         MOV       A,#-0x80
   \   00004A   6D           XRL       A,R5
   \   00004B   FD           MOV       R5,A
   3506                if (bit) crc^= CRC_POLYNOM;
   \                     ??bdb_crcBitByBitFast_3:
   \   00004C   ED           MOV       A,R5
   \   00004D   6008         JZ        ??bdb_crcBitByBitFast_4
   \   00004F   7421         MOV       A,#0x21
   \   000051   6E           XRL       A,R6
   \   000052   FE           MOV       R6,A
   \   000053   7410         MOV       A,#0x10
   \   000055   6F           XRL       A,R7
   \   000056   FF           MOV       R7,A
   3507              }
   \                     ??bdb_crcBitByBitFast_4:
   \   000057   C3           CLR       C
   \   000058   E8           MOV       A,R0
   \   000059   13           RRC       A
   \   00005A   F8           MOV       R0,A
   \   00005B   70DC         JNZ       ??bdb_crcBitByBitFast_2
   3508            }	
   \   00005D   05..         INC       ?V0
   \   00005F   E5..         MOV       A,?V0
   \   000061   7002         JNZ       ??bdb_crcBitByBitFast_0
   \   000063   05..         INC       ?V1
   \                     ??bdb_crcBitByBitFast_0:
   \   000065   85....       MOV       ?V4,?V0
   \   000068   85....       MOV       ?V5,?V1
   \   00006B   E4           CLR       A
   \   00006C   F5..         MOV       ?V6,A
   \   00006E   F5..         MOV       ?V7,A
   \   000070   78..         MOV       R0,#?V8
   \   000072   79..         MOV       R1,#?V4
   \   000074   12....       LCALL     ?UL_GT
   \   000077   40A6         JC        ??bdb_crcBitByBitFast_1
   3509          
   3510            crc=bdb_crcReflect(crc, CRC_ORDER);
   3511            crc^= CRC_XOR;
   3512          
   3513            return(crc);
   \   000079                ; Setup parameters for call to function bdb_crcReflect
   \   000079   7C10         MOV       R4,#0x10
   \   00007B   7D00         MOV       R5,#0x0
   \   00007D   EE           MOV       A,R6
   \   00007E   FA           MOV       R2,A
   \   00007F   EF           MOV       A,R7
   \   000080   FB           MOV       R3,A
   \   000081   12....       LCALL     `??bdb_crcReflect::?relay`; Banked call to: bdb_crcReflect
   \   000084   EA           MOV       A,R2
   \   000085   F4           CPL       A
   \   000086   FA           MOV       R2,A
   \   000087   EB           MOV       A,R3
   \   000088   F4           CPL       A
   \   000089   FB           MOV       R3,A
   \   00008A   7F0C         MOV       R7,#0xc
   \   00008C   02....       LJMP      ?BANKED_LEAVE_XDATA
   3514          }

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for bdbAttributes>`:
   \   000000   00F8EF07     DD 133167104
   \   000004   00001000     DD 1048576
   \   000008   FFFF         DW 65535
   \   00000A   00           DB 0
   \   00000B   00           DB 0
   \   00000C   05           DB 5
   \   00000D   04           DB 4
   \   00000E   00           DB 0
   \   00000F   00           DB 0
   \   000010   00           DB 0
   \   000011   03           DB 3
   \   000012   00           DB 0

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for vDoPrimaryScan>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgBdbInstallCodeCRC>`:
   \   000000   83           DB 131
   \   000001   FE           DB 254
   \   000002   D3           DB 211
   \   000003   40           DB 64
   \   000004   7A           DB 122
   \   000005   93           DB 147
   \   000006   97           DB 151
   \   000007   23           DB 35
   \   000008   A5           DB 165
   \   000009   C6           DB 198
   \   00000A   39           DB 57
   \   00000B   B2           DB 178
   \   00000C   69           DB 105
   \   00000D   16           DB 22
   \   00000E   D5           DB 213
   \   00000F   05           DB 5
   \   000010   C3           DB 195
   \   000011   B5           DB 181

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_Init::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_RegisterSimpleDescriptor::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_RegisterSimpleDescriptor

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_ZclIdentifyCmdInd::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_ZclIdentifyCmdInd

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_setActiveCentralizedLinkKey::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_setActiveCentralizedLinkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_addInstallCode::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_addInstallCode

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_StartCommissioning::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_StartCommissioning

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_NotifyCommissioningModeStart::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_NotifyCommissioningModeStart

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_setNodeJoinLinkKeyType::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_setNodeJoinLinkKeyType

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_setFN::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_setFN

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_resetLocalAction::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_resetLocalAction

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_parentLost::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_parentLost

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_NetworkRestoredResumeState::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_NetworkRestoredResumeState

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_ZedAttemptRecoverNwk::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_ZedAttemptRecoverNwk

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_reportCommissioningState::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_reportCommissioningState

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_nwkFormationAttempt::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_nwkFormationAttempt

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_isDeviceNonFactoryNew::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_isDeviceNonFactoryNew

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_doTrustCenterRequireKeyExchange::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_doTrustCenterRequireKeyExchange

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_rejoinNwk::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_rejoinNwk

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_nwkDiscoveryAttempt::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_nwkDiscoveryAttempt

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_filterNwkDisc::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_filterNwkDisc

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_tryNwkAssoc::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_tryNwkAssoc

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_nwkAssocAttemt::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_nwkAssocAttemt

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_nwkDescFree::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_nwkDescFree

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_joinProcess::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_joinProcess

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_setChannelAttribute::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_setChannelAttribute

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_setChannel::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_setChannel

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_nwkJoiningFormation::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_nwkJoiningFormation

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_tcLinkKeyExchangeAttempt::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_tcLinkKeyExchangeAttempt

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_nwkSteeringDeviceOnNwk::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_nwkSteeringDeviceOnNwk

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_startResumeCommissioningProcess::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_startResumeCommissioningProcess

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_event_loop::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_event_loop

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_ProcessNodeDescRsp::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_ProcessNodeDescRsp

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_touchlinkSendFNReset::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_touchlinkSendFNReset

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_setNodeIsOnANetwork::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_setNodeIsOnANetwork

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_setCommissioningGroupID::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_setCommissioningGroupID

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_CreateRespondentList::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_CreateRespondentList

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_AddRespondentNode::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_AddRespondentNode

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_zclRespondentListClean::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_zclRespondentListClean

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_ProcessOSALMsg::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_ProcessOSALMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_SendMsg::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_SendMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_RegisterCommissioningStatusCB::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_RegisterCommissioningStatusCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_ClearNetworkParams::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_ClearNetworkParams

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_getZCLFrameCounter::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_getZCLFrameCounter

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_RegisterCBKETCLinkKeyExchangeCB::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_RegisterCBKETCLinkKeyExchangeCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_RegisterForFilterNwkDescCB::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_RegisterForFilterNwkDescCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_CBKETCLinkKeyExchangeAttempt::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_CBKETCLinkKeyExchangeAttempt

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_GenerateInstallCodeCRC::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_GenerateInstallCodeCRC

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_calculateCCITT_CRC::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_calculateCCITT_CRC

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_crcInit::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_crcInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_crcReflect::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_crcReflect

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??bdb_crcBitByBitFast::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bdb_crcBitByBitFast

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "NV read: ">`:
   \   000000   4E562072     DB "NV read: "
   \            6561643A
   \            2000    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "bdbCommissioningMode ...">`:
   \   000000   62646243     DB 62H, 64H, 62H, 43H, 6FH, 6DH, 6DH, 69H
   \            6F6D6D69
   \   000008   7373696F     DB 73H, 73H, 69H, 6FH, 6EH, 69H, 6EH, 67H
   \            6E696E67
   \   000010   4D6F6465     DB 4DH, 6FH, 64H, 65H, 20H, 3DH, 3DH, 20H
   \            203D3D20
   \   000018   302C20E5     DB 30H, 2CH, 20H, 0E5H, 8FH, 0AAH, 0E5H, 88H
   \            8FAAE588
   \   000020   9DE5A78B     DB 9DH, 0E5H, 0A7H, 8BH, 0E5H, 8CH, 96H, 0E4H
   \            E58C96E4
   \   000028   B88DE7BB     DB 0B8H, 8DH, 0E7H, 0BBH, 84H, 0E7H, 0BDH, 91H
   \            84E7BD91
   \   000030   0D0A00       DB 0DH, 0AH, 0

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3e8:
   \   000000   E8030000     DD 1000

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_32:
   \   000000   32000000     DD 50

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_1388:
   \   000000   88130000     DD 5000

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_c8:
   \   000000   C8000000     DD 200

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_0:
   \   000000   00000000     DD 0

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3a98:
   \   000000   983A0000     DD 15000

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_bb8:
   \   000000   B80B0000     DD 3000

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_10:
   \   000000   10000000     DD 16
   3515          
   3516          

   Maximum stack usage in bytes:

   ISTACK XSTACK Function
   ------ ------ --------
      0     10   bdb_AddRespondentNode
        0     10   -> bdb_CreateRespondentList
        0     10   -> osal_mem_alloc
      0      9   bdb_CBKETCLinkKeyExchangeAttempt
        0      9   -> bdb_reportCommissioningState
        0      9   -> bdb_setNodeJoinLinkKeyType
        0      9   -> bdb_tcLinkKeyExchangeAttempt
      0      0   bdb_ClearNetworkParams
      0     20   bdb_CreateRespondentList
        0     10   -> osal_mem_alloc
      2     36   bdb_GenerateInstallCodeCRC
        2      6   -> bdb_calculateCCITT_CRC
      0      9   bdb_Init
        0      9   -> ZDO_RegisterForZDOMsg
        0      9   -> bdb_RepInit
      2     18   bdb_NetworkRestoredResumeState
        2      4   -> osal_start_timerEx
      1     36   bdb_NotifyCommissioningModeStart
        0     15   -> bdb_SendMsg
      0     78   bdb_ProcessNodeDescRsp
        0     45   -> APSME_IsDistributedSecurity
        0     45   -> ZDO_ParseNodeDescRsp
        0     45   -> bdb_reportCommissioningState
        0     45   -> bdb_setNodeJoinLinkKeyType
        0     45   -> bdb_tcLinkKeyExchangeAttempt
        0     49   -> osal_nv_write
        0     45   -> osal_stop_timerEx
      0     69   bdb_ProcessOSALMsg
        0     36   -> APSME_GetRequest
        0     36   -> APSME_IsDistributedSecurity
        0     36   -> APSME_RequestKeyReq
        0     36   -> APSME_VerifyKeyReq
        0     36   -> NLME_GetShortAddr
        0     36   -> NLME_NwkDiscTerm
        0     37   -> ZDP_NWKAddrOfInterestReq
        0     36   -> ZMacSetReq
        0     36   -> bdb_filterNwkDisc
        0     36   -> bdb_nwkDiscoveryAttempt
        0     36   -> bdb_reportCommissioningState
        0     36   -> bdb_setNodeJoinLinkKeyType
        0     36   -> bdb_tryNwkAssoc
        0     36   -> nwkNeighborInitTable
        0     40   -> osal_start_timerEx
        0     36   -> osal_stop_timerEx
      2      0   bdb_RegisterCBKETCLinkKeyExchangeCB
      2      0   bdb_RegisterCommissioningStatusCB
      2      0   bdb_RegisterForFilterNwkDescCB
      1     10   bdb_RegisterSimpleDescriptor
        0     10   -> afRegister
        0     10   -> osal_mem_alloc
      1     43   bdb_SendMsg
        0     20   -> osal_memcpy
        0     17   -> osal_msg_allocate
        0     17   -> osal_msg_send
      1    101   bdb_StartCommissioning
        0     97   -> APSME_IsDistributedSecurity
        0     97   -> HalUARTWrite
        0     97   -> ZDApp_ReadNetworkRestoreState
        0     97   -> ZDOInitDeviceEx
        0     97   -> bdb_RepConstructReportingData
        0     97   -> bdb_RepUpdateMarkBindings
        0     97   -> bdb_nwkSteeringDeviceOnNwk
        0     97   -> bdb_reportCommissioningState
        0     97   -> bdb_setNodeIsOnANetwork
        0     97   -> osal_get_timeoutEx
        0     97   -> osal_isbufset
        0     97   -> osal_memset
        0     97   -> osal_nv_delete
        0     97   -> osal_nv_item_len
        0    101   -> osal_nv_read
        0    101   -> osal_nv_write
        0     97   -> osal_set_event
        0     97   -> zgWriteStartupOptions
      0     24   bdb_ZclIdentifyCmdInd
        0     24   -> osal_start_timerEx
        0     20   -> osal_stop_timerEx
        0     22   -> zclFindAttrRec
      2      0   bdb_ZedAttemptRecoverNwk
        2      0   -> ZDOInitDeviceEx
      0     51   bdb_addInstallCode
        0     30   -> APSME_AddTCLinkKey
        0     30   -> bdb_GenerateInstallCodeCRC
        0     30   -> osal_build_uint16
        0     34   -> sspMMOHash
      0     28   bdb_calculateCCITT_CRC
        0     22   -> bdb_crcBitByBitFast
        0     18   -> bdb_crcInit
      0     42   bdb_crcBitByBitFast
        0     20   -> bdb_crcReflect
      0     27   bdb_crcInit
      0     32   bdb_crcReflect
      0      0   bdb_doTrustCenterRequireKeyExchange
      1     33   bdb_event_loop
        0     29   -> NLME_LeaveReq
        0     29   -> bdb_ProcessIEEEAddrRsp
        0     29   -> bdb_ProcessNodeDescRsp
        0     29   -> bdb_ProcessOSALMsg
        0     29   -> bdb_ProcessRespondentList
        0     29   -> bdb_ProcessSimpleDesc
        0     29   -> bdb_RepProcessEvent
        0     29   -> bdb_SendIdentifyQuery
        0     29   -> bdb_exitFindingBindingWStatus
        0     29   -> bdb_getRespondentRetry
        0     29   -> bdb_nwkAssocAttemt
        0     29   -> bdb_nwkSteeringDeviceOnNwk
        0     29   -> bdb_reportCommissioningState
        0     29   -> bdb_setEpDescListToActiveEndpoint
        0     29   -> bdb_setNodeIsOnANetwork
        0     29   -> bdb_startResumeCommissioningProcess
        0     29   -> bdb_tcLinkKeyExchangeAttempt
        0     29   -> osal_get_timeoutEx
        0     29   -> osal_memset
        0     29   -> osal_msg_deallocate
        0     29   -> osal_msg_receive
        0     29   -> osal_set_event
        0     33   -> osal_start_timerEx
        0     29   -> osal_stop_timerEx
        0     31   -> zclFindAttrRec
      0     47   bdb_filterNwkDisc
        0     11   -> bdb_nwkDescFree
        0     11   -> nwk_ExtPANIDValid
        0     11   -> nwk_desc_list_release
        0     11   -> nwk_getNwkDescList
        0     11   -> sAddrExtCmp
      2      0   bdb_getZCLFrameCounter
      2      0   bdb_isDeviceNonFactoryNew
      0     25   bdb_joinProcess
        0     14   -> NLME_JoinRequest
        0     10   -> NLME_SetPollRate
        0     10   -> NLME_SetQueuedPollRate
        0     10   -> NLME_SetResponseRate
        0     10   -> ZDApp_ChangeState
        0     10   -> ZDApp_NodeProfileSync
      0     42   bdb_nwkAssocAttemt
        0     13   -> bdb_SendMsg
        0     11   -> bdb_nwkDescFree
      2     14   bdb_nwkDescFree
        2      0   -> osal_mem_free
      0     49   bdb_nwkDiscoveryAttempt
        0     11   -> ZDApp_NetworkInit
        0     13   -> bdb_SendMsg
        0     11   -> bdb_reportCommissioningState
        0     11   -> bdb_setChannel
      0      9   bdb_nwkFormationAttempt
        0      9   -> bdb_nwkJoiningFormation
        0      9   -> bdb_reportCommissioningState
      0     33   bdb_nwkJoiningFormation
        0     12   -> ZDOInitDeviceEx
        0     12   -> bdb_reportCommissioningState
        0     12   -> bdb_setChannel
      2    106   bdb_nwkSteeringDeviceOnNwk
        2      9   -> ZDP_MgmtPermitJoinReq
      2      1   bdb_parentLost
        2      1   -> NLME_OrphanStateSet
        2      1   -> ZDApp_ChangeState
        2      1   -> ZMacSetReq
        2      1   -> bdb_nwkDescFree
        2      1   -> bdb_reportCommissioningState
        2      1   -> nwk_desc_list_free
      0     15   bdb_rejoinNwk
        0     11   -> NLME_ReJoinRequest
        0     11   -> NLME_ReJoinRequestUnsecure
        0     11   -> ZDApp_ChangeState
        0     11   -> ZDApp_RestoreNwkKey
        0     11   -> ZMacSetReq
        0     15   -> osal_nv_write
      1    115   bdb_reportCommissioningState
        0     14   -> NLME_ResetRequest
        0     14   -> NLME_SetPollRate
        0     14   -> ZDApp_ChangeState
        0     14   -> ZDApp_RestoreNwkSecMaterial
        0     14   -> ZMacSetReq
        0     14   -> bdb_NetworkRestoredResumeState
        0     16   -> bdb_SendMsg
        0     14   -> bdb_getRespondentRetry
        0     14   -> bdb_nwkDescFree
        0     14   -> bdb_setFN
        0     14   -> bdb_zclRespondentListClean
        0     14   -> nwk_setStateIdle
        0     14   -> osal_get_timeoutEx
        0     18   -> osal_start_timerEx
        0     14   -> osal_stop_timerEx
        0     14   -> zgWriteStartupOptions
      2      5   bdb_resetLocalAction
        2      5   -> NLME_LeaveReq
        2      5   -> ZDApp_ResetTimerStart
        2      5   -> bdb_setFN
        2      5   -> osal_memset
      0     17   bdb_setActiveCentralizedLinkKey
        0     17   -> APSME_AddTCLinkKey
        0     17   -> APSME_SetDefaultKey
        0     17   -> bdb_addInstallCode
        0     17   -> osal_memset
      0     28   bdb_setChannel
        0     16   -> osal_nv_write
      0     12   bdb_setChannelAttribute
      2      0   bdb_setCommissioningGroupID
      2     14   bdb_setFN
        2      0   -> bdb_setNodeIsOnANetwork
        2      0   -> zgWriteStartupOptions
      0    111   bdb_setNodeIsOnANetwork
        0     14   -> osal_nv_write
      2     45   bdb_setNodeJoinLinkKeyType
      0     54   bdb_startResumeCommissioningProcess
        0     21   -> bdb_NotifyCommissioningModeStart
        0     21   -> bdb_SendIdentifyQuery
        0     23   -> bdb_SendMsg
        0     21   -> bdb_exitFindingBindingWStatus
        0     21   -> bdb_nwkJoiningFormation
        0     21   -> bdb_nwkSteeringDeviceOnNwk
        0     21   -> bdb_reportCommissioningState
        0     21   -> bdb_setEpDescListToActiveEndpoint
        0     21   -> osal_memset
        0     25   -> osal_start_timerEx
        0     23   -> zclFindAttrRec
      0     60   bdb_tcLinkKeyExchangeAttempt
        0     15   -> bdb_SendMsg
        0     13   -> osal_stop_timerEx
      0      0   bdb_touchlinkSendFNReset
      0     49   bdb_tryNwkAssoc
        0     13   -> bdb_SendMsg
        0     11   -> bdb_joinProcess
        0     11   -> bdb_nwkDescFree
      0     26   bdb_zclRespondentListClean
        0     12   -> osal_mem_free


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
      10  ?<Constant "NV read: ">
      51  ?<Constant "bdbCommissioningMode ...">
      19  ?<Initializer for bdbAttributes>
       1  ?<Initializer for vDoPrimaryScan>
      18  ?<Initializer for zgBdbInstallCodeCRC>
       1  ??Subroutine30_0
       7  ??Subroutine31_0
       3  ??Subroutine32_0
       5  ??Subroutine33_0
       6  ??Subroutine34_0
       5  ??Subroutine35_0
       8  ??Subroutine36_0
       8  ??Subroutine37_0
       1  ??Subroutine38_0
       5  ??Subroutine39_0
       3  ??Subroutine40_0
       5  ??Subroutine41_0
       6  ??Subroutine42_0
       5  ?Subroutine0
       2  ?Subroutine1
       6  ?Subroutine10
       3  ?Subroutine11
       3  ?Subroutine12
      15  ?Subroutine13
       8  ?Subroutine14
       3  ?Subroutine15
      10  ?Subroutine16
       4  ?Subroutine17
       3  ?Subroutine18
       8  ?Subroutine19
       2  ?Subroutine2
       6  ?Subroutine20
       6  ?Subroutine21
       8  ?Subroutine22
       8  ?Subroutine23
       8  ?Subroutine24
       8  ?Subroutine25
      15  ?Subroutine26
       6  ?Subroutine27
      10  ?Subroutine28
       6  ?Subroutine29
       4  ?Subroutine3
       6  ?Subroutine4
      12  ?Subroutine5
      10  ?Subroutine6
      10  ?Subroutine7
       2  ?Subroutine8
      12  ?Subroutine9
       4  __Constant_0
       4  __Constant_10
       4  __Constant_1388
       4  __Constant_32
       4  __Constant_3a98
       4  __Constant_3e8
       4  __Constant_bb8
       4  __Constant_c8
      19  bdbAttributes
       4  bdbCommissioningProcedureState
     187  bdb_AddRespondentNode
       6  bdb_AddRespondentNode::?relay
      43  bdb_CBKETCLinkKeyExchangeAttempt
       6  bdb_CBKETCLinkKeyExchangeAttempt::?relay
       3  bdb_ClearNetworkParams
       6  bdb_ClearNetworkParams::?relay
      44  bdb_CreateRespondentList
       6  bdb_CreateRespondentList::?relay
       2  bdb_CurrEpDescriptorList
       1  bdb_FBStateSuccessLatch
       1  bdb_FB_InitiatorCurrentCyclesNumber
      42  bdb_GenerateInstallCodeCRC
       6  bdb_GenerateInstallCodeCRC::?relay
       2  bdb_HeadEpDescriptorList
      44  bdb_Init
       6  bdb_Init::?relay
      86  bdb_NetworkRestoredResumeState
       6  bdb_NetworkRestoredResumeState::?relay
      49  bdb_NotifyCommissioningModeStart
       6  bdb_NotifyCommissioningModeStart::?relay
     177  bdb_ProcessNodeDescRsp
       6  bdb_ProcessNodeDescRsp::?relay
     463  bdb_ProcessOSALMsg
       6  bdb_ProcessOSALMsg::?relay
      31  bdb_RegisterCBKETCLinkKeyExchangeCB
       6  bdb_RegisterCBKETCLinkKeyExchangeCB::?relay
      10  bdb_RegisterCommissioningStatusCB
       6  bdb_RegisterCommissioningStatusCB::?relay
      17  bdb_RegisterForFilterNwkDescCB
       6  bdb_RegisterForFilterNwkDescCB::?relay
      58  bdb_RegisterSimpleDescriptor
       6  bdb_RegisterSimpleDescriptor::?relay
     109  bdb_SendMsg
       6  bdb_SendMsg::?relay
     629  bdb_StartCommissioning
       6  bdb_StartCommissioning::?relay
       1  bdb_TaskID
     141  bdb_ZclIdentifyCmdInd
       6  bdb_ZclIdentifyCmdInd::?relay
       1  bdb_ZclTransactionSequenceNumber
      38  bdb_ZedAttemptRecoverNwk
       6  bdb_ZedAttemptRecoverNwk::?relay
     121  bdb_addInstallCode
       6  bdb_addInstallCode::?relay
      97  bdb_calculateCCITT_CRC
       6  bdb_calculateCCITT_CRC::?relay
     143  bdb_crcBitByBitFast
       6  bdb_crcBitByBitFast::?relay
     108  bdb_crcInit
       6  bdb_crcInit::?relay
      75  bdb_crcReflect
       6  bdb_crcReflect::?relay
       5  bdb_doTrustCenterRequireKeyExchange
       6  bdb_doTrustCenterRequireKeyExchange::?relay
     775  bdb_event_loop
       6  bdb_event_loop::?relay
     289  bdb_filterNwkDisc
       6  bdb_filterNwkDisc::?relay
      14  bdb_getZCLFrameCounter
       6  bdb_getZCLFrameCounter::?relay
       1  bdb_initialization
      12  bdb_isDeviceNonFactoryNew
       6  bdb_isDeviceNonFactoryNew::?relay
     199  bdb_joinProcess
       6  bdb_joinProcess::?relay
      87  bdb_nwkAssocAttemt
       6  bdb_nwkAssocAttemt::?relay
       1  bdb_nwkAssocRetriesCount
      88  bdb_nwkDescFree
       6  bdb_nwkDescFree::?relay
     108  bdb_nwkDiscoveryAttempt
       6  bdb_nwkDiscoveryAttempt::?relay
      48  bdb_nwkFormationAttempt
       6  bdb_nwkFormationAttempt::?relay
     109  bdb_nwkJoiningFormation
       6  bdb_nwkJoiningFormation::?relay
      45  bdb_nwkSteeringDeviceOnNwk
       6  bdb_nwkSteeringDeviceOnNwk::?relay
      95  bdb_parentLost
       6  bdb_parentLost::?relay
     168  bdb_rejoinNwk
       6  bdb_rejoinNwk::?relay
     956  bdb_reportCommissioningState
       6  bdb_reportCommissioningState::?relay
      63  bdb_resetLocalAction
       6  bdb_resetLocalAction::?relay
     105  bdb_setActiveCentralizedLinkKey
       6  bdb_setActiveCentralizedLinkKey::?relay
      65  bdb_setChannel
       6  bdb_setChannel::?relay
      32  bdb_setChannelAttribute
       6  bdb_setChannelAttribute::?relay
      10  bdb_setCommissioningGroupID
       6  bdb_setCommissioningGroupID::?relay
      19  bdb_setFN
       6  bdb_setFN::?relay
      73  bdb_setNodeIsOnANetwork
       6  bdb_setNodeIsOnANetwork::?relay
      11  bdb_setNodeJoinLinkKeyType
       6  bdb_setNodeJoinLinkKeyType::?relay
     494  bdb_startResumeCommissioningProcess
       6  bdb_startResumeCommissioningProcess::?relay
      79  bdb_tcLinkKeyExchangeAttempt
       6  bdb_tcLinkKeyExchangeAttempt::?relay
       3  bdb_touchlinkSendFNReset
       6  bdb_touchlinkSendFNReset::?relay
      84  bdb_tryNwkAssoc
       6  bdb_tryNwkAssoc::?relay
      66  bdb_zclRespondentListClean
       6  bdb_zclRespondentListClean::?relay
       2  pBDBListNwk
       2  pRespondentCurr
       2  pRespondentHead
       2  pRespondentNext
       2  pfnCBKETCLinkKeyExchange
       2  pfnCommissioningStatusCB
       2  pfnFilterNwkDesc
       1  touchLinkTargetEnabled
       1  vDoPrimaryScan
      18  zgBdbInstallCodeCRC

 
 7 089 bytes in segment BANKED_CODE
   306 bytes in segment BANK_RELAYS
    38 bytes in segment XDATA_I
    38 bytes in segment XDATA_ID
    93 bytes in segment XDATA_ROM_C
    29 bytes in segment XDATA_Z
 
   344 bytes of CODE     memory
    61 bytes of CONST    memory (+ 32 bytes shared)
 7 089 bytes of HUGECODE memory
    67 bytes of XDATA    memory

Errors: none
Warnings: 1

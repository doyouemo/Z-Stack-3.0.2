###############################################################################
#
# IAR C/C++ Compiler V10.10.1.4655 for 8051               12/Nov/2024  16:36:10
# Copyright 2004-2017 IAR Systems AB.
# Standalone license - IAR Embedded Workbench for 8051
#
#    Core               =  plain
#    Code model         =  banked
#    Data model         =  large
#    Calling convention =  xdata reentrant
#    Constant location  =  data_rom
#    Dptr setup         =  1,16
#                          
#    Source file        =  
#        D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\Source\zcl_samplesw.c
#    Command line       =  
#        -f C:\Users\ASUS\AppData\Local\Temp\EW352A.tmp ("D:\Z-Stack
#        3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\Source\zcl_samplesw.c"
#        -D SECURE=1 -D TC_LINKKEY_JOIN -D NV_INIT -D NV_RESTORE -D xZTOOL_P1
#        -D xMT_TASK -D xMT_APP_FUNC -D xMT_SYS_FUNC -D xMT_ZDO_FUNC -D
#        xMT_ZDO_MGMT -D xMT_APP_CNF_FUNC -D LCD_SUPPORTED=DEBUG -D
#        MULTICAST_ENABLED=FALSE -D ZCL_READ -D ZCL_DISCOVER -D ZCL_WRITE -D
#        ZCL_BASIC -D ZCL_IDENTIFY -D ZCL_ON_OFF -D ZCL_GROUPS -D
#        ZCL_REPORT_DESTINATION_DEVICE -D ZCL_REPORT -lC "D:\Z-Stack
#        3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\CoordinatorEB\List"
#        -lA "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\CoordinatorEB\List"
#        --diag_suppress Pe001,Pa010 -o "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\CoordinatorEB\Obj"
#        -e --debug --core=plain --dptr=16,1 --data_model=large
#        --code_model=banked --calling_convention=xdata_reentrant
#        --place_constants=data_rom --nr_virtual_regs 16 -f "D:\Z-Stack
#        3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\..\Tools\CC2530DB\f8wCoord.cfg"
#        (-DCPU32MHZ -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRUE
#        -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8 -DMAC_CFG_RX_MAX=5
#        -DZDO_COORDINATOR -DRTR_NWK) -f "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\..\Tools\CC2530DB\f8wConfig.cfg"
#        (-DZIGBEEPRO -DSECURE=1 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR
#        -DDEFAULT_CHANLIST=0x00000800 -DZDAPP_CONFIG_PAN_ID=0x1234
#        -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MASK=0x007F
#        -DBEACON_REQUEST_DELAY=100 -DBEACON_REQ_DELAY_MASK=0x00FF
#        -DLINK_STATUS_JITTER_MASK=0x007F -DROUTE_EXPIRY_TIME=30
#        -DAPSC_ACK_WAIT_DURATION_POLLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7
#        -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3
#        -DNWK_MAX_DATA_RETRIES=2 -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9
#        -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40 -DNWK_MAX_BINDING_ENTRIES=4
#        -DMAX_BINDING_CLUSTER_IDS=4 -DDEFAULT_KEY={0} -DMAC_MAX_FRAME_SIZE=116
#        -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const __code"
#        -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000
#        -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100 -DREJOIN_POLL_RATE=440
#        -DREJOIN_BACKOFF=900000 -DREJOIN_SCAN=900000 -DENABLE_LED4_DISABLE_S1)
#        -f "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\..\Tools\CC2530DB\f8wZCL.cfg"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\" -I
#        "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\Source\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\Source\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\..\ZMain\TI2530DB\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\..\Components\hal\include\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\..\Components\hal\target\CC2530EB\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\..\Components\mac\include\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\..\Components\mac\high_level\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\..\Components\mac\low_level\srf04\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\..\Components\mac\low_level\srf04\single_chip\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\..\Components\mt\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\..\Components\osal\include\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\..\Components\services\saddr\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\..\Components\services\sdata\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\..\Components\stack\af\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\..\Components\stack\bdb\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\..\Components\stack\gp\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\..\Components\stack\nwk\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\..\Components\stack\sapi\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\..\Components\stack\sec\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\..\Components\stack\sys\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\..\Components\stack\zcl\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\..\Components\stack\zdo\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\..\Components\zmac\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\..\Components\zmac\f8w\"
#        -Ohz --require_prototypes)
#    Locale             =  Chinese (Simplified)_China.936
#    List file          =  
#        D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\CoordinatorEB\List\zcl_samplesw.lst
#    Object file        =  
#        D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\CC2530DB\CoordinatorEB\Obj\zcl_samplesw.r51
#
###############################################################################

D:\Z-Stack 3.0.2\Z-Stack 3.0.2\Projects\zstack\HomeAutomation\SampleSwitch\Source\zcl_samplesw.c
      1          /**************************************************************************************************
      2            Filename:       zcl_samplesw.c
      3            Revised:        $Date: 2015-08-19 17:11:00 -0700 (Wed, 19 Aug 2015) $
      4            Revision:       $Revision: 44460 $
      5          
      6            Description:    Zigbee Cluster Library - sample switch application.
      7          
      8          
      9            Copyright 2006-2013 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED AS IS? WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /*********************************************************************
     41            This application implements a ZigBee On/Off Switch, based on Z-Stack 3.0.
     42          
     43            This application is based on the common sample-application user interface. Please see the main
     44            comment in zcl_sampleapp_ui.c. The rest of this comment describes only the content specific for
     45            this sample applicetion.
     46            
     47            Application-specific UI peripherals being used:
     48          
     49            - none (LED1 is currently unused by this application).
     50          
     51            Application-specific menu system:
     52          
     53              <TOGGLE LIGHT> Send an On, Off or Toggle command targeting appropriate devices from the binding table.
     54                Pressing / releasing [OK] will have the following functionality, depending on the value of the 
     55                zclSampleSw_OnOffSwitchActions attribute:
     56                - OnOffSwitchActions == 0: pressing [OK] will send ON command, releasing it will send OFF command;
     57                - OnOffSwitchActions == 1: pressing [OK] will send OFF command, releasing it will send ON command;
     58                - OnOffSwitchActions == 2: pressing [OK] will send TOGGLE command, releasing it will not send any command.
     59          
     60          *********************************************************************/
     61          
     62          #if ! defined ZCL_ON_OFF
     63          #error ZCL_ON_OFF must be defined for this project.
     64          #endif
     65          
     66          /*********************************************************************
     67           * INCLUDES
     68           */
     69          #include <stdio.h>
     70          #include "ZComDef.h"
     71          #include "OSAL.h"
     72          #include "AF.h"
     73          #include "ZDApp.h"
     74          #include "ZDObject.h"
     75          #include "ZDProfile.h"
     76          #include "MT_SYS.h"
     77          
     78          #include "zcl.h"
     79          #include "zcl_general.h"
     80          #include "zcl_ha.h"
     81          #include "zcl_samplesw.h"
     82          #include "zcl_diagnostic.h"
     83          
     84          #include "onboard.h"
     85          
     86          /* HAL */
     87          #include "hal_lcd.h"
     88          #include "hal_led.h"
     89          #include "hal_key.h"
     90          
     91          #if defined (OTA_CLIENT) && (OTA_CLIENT == TRUE)
     92          #include "zcl_ota.h"
     93          #include "hal_ota.h"
     94          #endif
     95          
     96          #include "bdb.h"
     97          #include "bdb_interface.h"
     98          
     99          #include "zcl_sampleapps_ui.h"
    100          
    101          /*********************************************************************
    102           * MACROS
    103           */
    104          #define UI_STATE_TOGGLE_LIGHT 1 //UI_STATE_BACK_FROM_APP_MENU is item #0, so app item numbers should start from 1
    105          
    106          #define APP_TITLE "TI Sample Switch"
    107          
    108          /*********************************************************************
    109           * TYPEDEFS
    110           */
    111          #define CLUSTER_P2P             0
    112          #define CLUSTER_BROADCAST       1
    113          #define CLUSTER_GROUPCAST       2
    114          /*********************************************************************
    115           * GLOBAL VARIABLES
    116           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    117          byte zclSampleSw_TaskID;
   \                     zclSampleSw_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    118          
    119          // 在适当的头文件或源文件中添加

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    120          uint16 zclSampleSw_TestAddr;  // 确保定义类型与实际使用一致
   \                     zclSampleSw_TestAddr:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    121          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    122          uint8 zclSampleSwSeqNum;
   \                     zclSampleSwSeqNum:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    123          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    124          uint8 zclSampleSw_OnOffSwitchType = ON_OFF_SWITCH_TYPE_MOMENTARY;
   \                     zclSampleSw_OnOffSwitchType:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zclSampleSw_OnOffSwitchType>`
   \   000001                REQUIRE __INIT_XDATA_I
    125          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    126          uint8 zclSampleSw_OnOffSwitchActions;
   \                     zclSampleSw_OnOffSwitchActions:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    127          
    128          /*********************************************************************
    129           * GLOBAL FUNCTIONS
    130           */
    131          
    132          /*********************************************************************
    133           * LOCAL VARIABLES
    134           */
    135          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    136          afAddrType_t zclSampleSw_DstAddr;
   \                     zclSampleSw_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z
    137          // GroupId
    138          #define GROUP_ID                21
    139          // Endpoint to allow SYS_APP_MSGs

   \                                 In  segment XDATA_I, align 1, keep-with-next
    140          static endPointDesc_t sampleSw_TestEp =
   \                     sampleSw_TestEp:
   \   000000                DS 7
   \   000007                REQUIRE `?<Initializer for sampleSw_TestEp>`
   \   000007                REQUIRE __INIT_XDATA_I
    141          {
    142            SAMPLESW_ENDPOINT,                  // endpoint
    143            0,
    144            &zclSampleSw_TaskID,
    145            (SimpleDescriptionFormat_t *)NULL,  // No Simple description for this test endpoint
    146            (afNetworkLatencyReq_t)0            // No Network Latency req
    147          };
    148          
    149          
    150          /*
    151          * @param destNwkAddr 目标设备的网络地址
    152          * @param cid Cluster ID，后续课程将会详细讲解
    153          * @param len 数据长度
    154          * @param data 数据内容
    155          */
    156          static void zclSampleSw_AF_P2P(
                             ^
Warning[Pe177]: function "zclSampleSw_AF_P2P" was declared but never referenced
    157          	uint16 destNwkAddr, 
    158          	uint16 cid, 
    159          	uint8 len, 
    160          	uint8 *data)
    161          {    
    162          	afAddrType_t dstAddr; //寻址信息配置 
    163          	static uint8 transferId = 0;//传输ID，是数据包的标识符
    164          
    165          	/* Destination */    
    166          	dstAddr.addrMode = afAddr16Bit;// 设置目标地址模式为16位网络地址，表示使用P2P的通信方式
    167          	dstAddr.addr.shortAddr = destNwkAddr;//目标设备的网络地址  
    168          	dstAddr.endPoint = SAMPLESW_ENDPOINT;//目标设备的端点号
    169          
    170          	 transferId++;    
    171          	AF_DataRequest(&dstAddr, 
    172          		&sampleSw_TestEp,//已经创建好的简单描述符
    173          		cid,    
    174          		len, 
    175          		data,    
    176          		&transferId,
    177          		AF_DISCV_ROUTE,//进行路由扫描操作，用于建立发送数据报文的通信路径。关于这个参数，暂时保持例程默认的代码就可以了
    178          		AF_DEFAULT_RADIUS);//指定最大的路由跳转级数
    179          }
    180          
    181          /*
    182          * @param cid Cluster ID
    183          * @param len 待发送数据的长度
    184          * @param *data 待发送数据的内容
    185          */
    186          static void zclSampleSw_AF_Broadcast(
    187          	uint16 cid,
    188          	uint8 len,
    189          	uint8 *data)
    190          {
    191          	afAddrType_t dstAddr;  

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    192          	static uint8 transferId = 0;  
   \                     ??transferId:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    193          
    194          	/* Destination */  
    195          	dstAddr.addrMode = afAddrBroadcast;   // 使用广播模式
    196          	dstAddr.addr.shortAddr = 0xFFFF; // 广播地址
    197          	dstAddr.endPoint = SAMPLESW_ENDPOINT; // 目标设备的端点号
    198          	
    199          	 /* Transfer id */  
    200          	transferId++;  
    201          	
    202          	/* Send */  
    203          	AF_DataRequest(
    204          		&dstAddr, 
    205          		&sampleSw_TestEp,//已经创建好的简单描述符
    206          		cid,  
    207          		len, 
    208          		data,  
    209          		&transferId,
    210          		AF_TX_OPTIONS_NONE,
    211          		AF_DEFAULT_RADIUS );//指定了最大的路由跳转级数
    212          }
    213          
    214          /*
    215          * @param groupId 组ID
    216          * @param cid ClusterID，后续章节将会详细讲解
    217          * @param len 待发送数据的长度
    218          * @param data 待发送数据的内容
    219          */
    220          static void zclSampleSw_AF_Groupcast(
    221          	uint16 groupId,
    222          	uint16 cid,
    223          	uint8 len,
    224          	uint8 *data)
    225          {    
    226          	afAddrType_t dstAddr;    

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    227          	static uint8 transferId = 0;    
   \                     ??transferId_1:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    228          
    229          	/* Destination */    
    230              dstAddr.addrMode = afAddrGroup;//使用组播通信模式
    231          	dstAddr.addr.shortAddr = groupId;
    232          	dstAddr.endPoint = SAMPLESW_ENDPOINT;//组中的设备的端点号
    233          	
    234          	/* Transfer id */    
    235          	transferId++;   
    236           
    237          	/* Send */    
    238          	AF_DataRequest(&dstAddr, 
    239          		&sampleSw_TestEp,//已经创建好的简单描述符
    240          		cid, 
    241          		len, 
    242          		data,    
    243          		&transferId, 
    244          		AF_TX_OPTIONS_NONE,
    245          		AF_DEFAULT_RADIUS );//指定最大的路由跳转级数，暂时可忽略
    246          }
    247          
    248          /*
    249          * @param MSGpkt 接收到数据
    250          */
    251          static void zclSampleSw_AF_RxProc(afIncomingMSGPacket_t *MSGpkt)
    252          {
    253          	/*计数器，记录接收到的点对点通信数据包个数*/

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    254          	static uint8 p2pCnt = 0;
   \                     ??p2pCnt:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    255          
    256          	/*计数器，记录接收到的广播通信数据包个数*/

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    257          	static uint8 bcCnt = 0;
   \                     ??bcCnt:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    258          
    259          	/*计数器，记录接收到的组播通信数据包个数*/

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    260          	static uint8 gcCnt = 0;  
   \                     ??gcCnt:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    261          	
    262          	switch( MSGpkt->clusterId )  // 判断接收到的数据包的Cluster ID，后续章节将会详细讲解Cluster ID
    263          	{  
    264          		case CLUSTER_P2P:
    265          			p2pCnt++;  // 接收到P2P数据包，进行计数
    266          		
    267          			// 把接收到的数据和计数器的值显示在屏幕上
    268          			HalLcdWriteStringValue((char *)MSGpkt->cmd.Data,p2pCnt,10,3);
    269          			break;  
    270          		 
    271          		case CLUSTER_BROADCAST:  
    272          			bcCnt++;  // 接收到广播数据包，进行计数
    273          			HalLcdWriteStringValue((char *)MSGpkt->cmd.Data,bcCnt,10,3);  
    274          			break;  
    275          		 
    276          		case CLUSTER_GROUPCAST:  
    277          			gcCnt++;  // 接收到组播数据包，进行计数
    278          			HalLcdWriteStringValue((char *)MSGpkt->cmd.Data,gcCnt,10,4);  
    279          			break;  
    280          		
    281          		default:  
    282          			break;  
    283          	}  
    284          }
    285          static void zclSampleSw_ReadTest(void)  
    286          {  
    287              afAddrType_t destAddr;  
    288              zclReadCmd_t *readCmd;  

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    289              static uint8 txID = 0;  
   \                     ??txID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    290                
    291              destAddr.endPoint = SAMPLESW_ENDPOINT;  
    292              destAddr.addrMode = afAddr16Bit;  
    293              destAddr.addr.shortAddr = zclSampleSw_TestAddr;  
    294            
    295               //申请一个动态内存
    296             readCmd = (zclReadCmd_t *)osal_mem_alloc(sizeof(zclReadCmd_t) +                                                sizeof(uint16));
    297          
    298             if(readCmd == NULL)//判断是否成功申请到内存
    299                return;  
    300          
    301              readCmd->numAttr = 1;//待读取的属性数量为1
    302              readCmd->attrID[0] = ATTRID_ON_OFF_SWITCH_ACTIONS;//待读取的属性ID
    303                
    304              zcl_SendRead(SAMPLESW_ENDPOINT,  
    305                           &destAddr,  
    306                           ZCL_CLUSTER_ID_GEN_ON_OFF_SWITCH_CONFIG,//Cluster ID  
    307                           readCmd,  
    308                           ZCL_FRAME_CLIENT_SERVER_DIR,//通信方向是由客户端到服务器端
    309                           TRUE,
    310                           txID++);  
    311               osal_mem_free(readCmd);//释放内存
    312          }
    313          
    314          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    315          static void zclSampleSw_WriteTest(void)  
   \                     zclSampleSw_WriteTest:
    316          {  
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000   74F4         MOV       A,#-0xc
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 12
   \   000005   74F4         MOV       A,#-0xc
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
    317              afAddrType_t destAddr;  
    318              zclWriteCmd_t *writeCmd;  
    319              static uint8 txID = 0;  
    320                
    321              destAddr.endPoint = SAMPLESW_ENDPOINT;  
   \   00000A   7409         MOV       A,#0x9
   \   00000C   12....       LCALL     ?XSTACK_DISP0_8
   \   00000F   7408         MOV       A,#0x8
   \   000011   F0           MOVX      @DPTR,A
    322              destAddr.addrMode = afAddr16Bit;  
   \   000012   12....       LCALL     ?XSTACK_DISP0_8
   \   000015   12....       LCALL     ?Subroutine3 & 0xFFFF
    323              destAddr.addr.shortAddr = zclSampleSw_TestAddr;  
    324                
    325              writeCmd=(zclWriteCmd_t *)osal_mem_alloc(sizeof(zclWriteCmd_t) +                                             sizeof(zclWriteRec_t));//申请一个动态内存
   \                     ??CrossCallReturnLabel_0:
   \   000018                ; Setup parameters for call to function osal_mem_alloc
   \   000018   7A06         MOV       R2,#0x6
   \   00001A   7B00         MOV       R3,#0x0
   \   00001C   12....       LCALL     `??osal_mem_alloc::?relay`; Banked call to: osal_mem_alloc
   \   00001F   8A..         MOV       ?V0,R2
   \   000021   8B..         MOV       ?V1,R3
    326              if(writeCmd == NULL)//判断动态内存是否申请成功
   \   000023   EA           MOV       A,R2
   \   000024   45..         ORL       A,?V1
   \   000026   7003         JNZ       $+5
   \   000028   02....       LJMP      ??zclSampleSw_WriteTest_0 & 0xFFFF
    327                  return;  
    328                
    329              writeCmd->attrList[0].attrData=(uint8*)osal_mem_alloc(sizeof(uint8));//申请一个动态内存    
   \   00002B                ; Setup parameters for call to function osal_mem_alloc
   \   00002B   7A01         MOV       R2,#0x1
   \   00002D   7B00         MOV       R3,#0x0
   \   00002F   12....       LCALL     `??osal_mem_alloc::?relay`; Banked call to: osal_mem_alloc
   \   000032   E5..         MOV       A,?V0
   \   000034   2404         ADD       A,#0x4
   \   000036   F8           MOV       R0,A
   \   000037   E4           CLR       A
   \   000038   35..         ADDC      A,?V1
   \   00003A   F9           MOV       R1,A
   \   00003B   E8           MOV       A,R0
   \   00003C   FE           MOV       R6,A
   \   00003D   E9           MOV       A,R1
   \   00003E   FF           MOV       R7,A
   \   00003F   EA           MOV       A,R2
   \   000040   F8           MOV       R0,A
   \   000041   EB           MOV       A,R3
   \   000042   F9           MOV       R1,A
   \   000043   8E82         MOV       DPL,R6
   \   000045   8F83         MOV       DPH,R7
   \   000047   E8           MOV       A,R0
   \   000048   F0           MOVX      @DPTR,A
   \   000049   A3           INC       DPTR
   \   00004A   E9           MOV       A,R1
   \   00004B   F0           MOVX      @DPTR,A
    330              if(writeCmd->attrList[0].attrData == NULL)//判断动态内存是否申请成功  
   \   00004C   EA           MOV       A,R2
   \   00004D   4B           ORL       A,R3
   \   00004E   7003         JNZ       $+5
   \   000050   02....       LJMP      ??zclSampleSw_WriteTest_0 & 0xFFFF
    331                  return;  
    332                
    333              writeCmd->numAttr = 1;//待写入的属性数量
   \   000053   85..82       MOV       DPL,?V0
   \   000056   85..83       MOV       DPH,?V1
   \   000059   12....       LCALL     ?Subroutine4 & 0xFFFF
    334              writeCmd->attrList[0].attrID =ATTRID_ON_OFF_SWITCH_ACTIONS;//待写入的属性的ID
    335              writeCmd->attrList[0].dataType = ZCL_DATATYPE_ENUM8;//属性值的类型
   \                     ??CrossCallReturnLabel_2:
   \   00005C   85..82       MOV       DPL,?V0
   \   00005F   85..83       MOV       DPH,?V1
   \   000062   A3           INC       DPTR
   \   000063   A3           INC       DPTR
   \   000064   A3           INC       DPTR
   \   000065   7430         MOV       A,#0x30
   \   000067   F0           MOVX      @DPTR,A
    336              *(writeCmd->attrList[0].attrData) = txID;//属性值
   \   000068   90....       MOV       DPTR,#??txID_1
   \   00006B   E0           MOVX      A,@DPTR
   \   00006C   C0E0         PUSH      A
   \   00006E   8E82         MOV       DPL,R6
   \   000070   8F83         MOV       DPH,R7
   \   000072   12....       LCALL     ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_16:
   \   000075   D0E0         POP       A
   \   000077   F0           MOVX      @DPTR,A
    337          
    338              HalLcdWriteStringValue("Write:", txID, 10, 4);  
   \   000078                ; Setup parameters for call to function HalLcdWriteStringValue
   \   000078   75..04       MOV       ?V2,#0x4
   \   00007B   78..         MOV       R0,#?V2
   \   00007D   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   000080   790A         MOV       R1,#0xa
   \   000082   90....       MOV       DPTR,#??txID_1
   \   000085   E0           MOVX      A,@DPTR
   \   000086   FC           MOV       R4,A
   \   000087   7D00         MOV       R5,#0x0
   \   000089   7A..         MOV       R2,#`?<Constant "Write:">` & 0xff
   \   00008B   7B..         MOV       R3,#(`?<Constant "Write:">` >> 8) & 0xff
   \   00008D   12....       LCALL     `??HalLcdWriteStringValue::?relay`; Banked call to: HalLcdWriteStringValue
   \   000090   7401         MOV       A,#0x1
   \   000092   12....       LCALL     ?DEALLOC_XSTACK8
    339              
    340              zcl_SendWrite(SAMPLESW_ENDPOINT,  
    341                  &destAddr,  
    342                  ZCL_CLUSTER_ID_GEN_ON_OFF_SWITCH_CONFIG,//Cluster ID 
    343                  writeCmd,  
    344                  ZCL_FRAME_CLIENT_SERVER_DIR,//通信方向是由客户端到服务器端
    345                  TRUE,
    346                  txID++);  
   \   000095   90....       MOV       DPTR,#??txID_1
   \   000098   12....       LCALL     ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_6:
   \   00009B   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   00009E   75..01       MOV       ?V2,#0x1
   \   0000A1   78..         MOV       R0,#?V2
   \   0000A3   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   0000A6   75..00       MOV       ?V2,#0x0
   \   0000A9   78..         MOV       R0,#?V2
   \   0000AB   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   0000AE   75..02       MOV       ?V2,#0x2
   \   0000B1   78..         MOV       R0,#?V2
   \   0000B3   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   0000B6   78..         MOV       R0,#?V0
   \   0000B8   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000BB   7C07         MOV       R4,#0x7
   \   0000BD   7D00         MOV       R5,#0x0
   \   0000BF   7406         MOV       A,#0x6
   \   0000C1   12....       LCALL     ?XSTACK_DISP101_8
   \   0000C4   7908         MOV       R1,#0x8
   \   0000C6   12....       LCALL     `??zcl_SendWriteRequest::?relay`; Banked call to: zcl_SendWriteRequest
   \   0000C9   7406         MOV       A,#0x6
   \   0000CB   12....       LCALL     ?DEALLOC_XSTACK8
    347          
    348              osal_mem_free(writeCmd->attrList[0].attrData); // 释放内存
   \   0000CE                ; Setup parameters for call to function osal_mem_free
   \   0000CE   8E82         MOV       DPL,R6
   \   0000D0   8F83         MOV       DPH,R7
   \   0000D2   E0           MOVX      A,@DPTR
   \   0000D3   FA           MOV       R2,A
   \   0000D4   A3           INC       DPTR
   \   0000D5   E0           MOVX      A,@DPTR
   \   0000D6   FB           MOV       R3,A
   \   0000D7   12....       LCALL     `??osal_mem_free::?relay`; Banked call to: osal_mem_free
    349              osal_mem_free(writeCmd);  // 释放内存 
   \   0000DA                ; Setup parameters for call to function osal_mem_free
   \   0000DA   AA..         MOV       R2,?V0
   \   0000DC   AB..         MOV       R3,?V1
   \   0000DE   12....       LCALL     `??osal_mem_free::?relay`; Banked call to: osal_mem_free
    350          }
   \                     ??zclSampleSw_WriteTest_0:
   \   0000E1                REQUIRE ?Subroutine0
   \   0000E1                ; // Fall through to label ?Subroutine0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   740C         MOV       A,#0xc
   \   000002   12....       LCALL     ?DEALLOC_XSTACK8
   \   000005   7F04         MOV       R7,#0x4
   \   000007   02....       LJMP      ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   E0           MOVX      A,@DPTR
   \   000001   F8           MOV       R0,A
   \   000002   7401         MOV       A,#0x1
   \   000004   28           ADD       A,R0
   \   000005   F0           MOVX      @DPTR,A
   \   000006                ; Setup parameters for call to function zcl_SendWriteRequest
   \   000006                ; Setup parameters for call to function zcl_SendRead
   \   000006   E8           MOV       A,R0
   \   000007   F5..         MOV       ?V2,A
   \   000009   78..         MOV       R0,#?V2
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   7401         MOV       A,#0x1
   \   000002   F0           MOVX      @DPTR,A
   \   000003   A3           INC       DPTR
   \   000004   7410         MOV       A,#0x10
   \   000006   F0           MOVX      @DPTR,A
   \   000007   A3           INC       DPTR
   \   000008   E4           CLR       A
   \   000009   F0           MOVX      @DPTR,A
   \   00000A   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   7402         MOV       A,#0x2
   \   000002   F0           MOVX      @DPTR,A
   \   000003   90....       MOV       DPTR,#zclSampleSw_TestAddr
   \   000006   E0           MOVX      A,@DPTR
   \   000007   F8           MOV       R0,A
   \   000008   A3           INC       DPTR
   \   000009   E0           MOVX      A,@DPTR
   \   00000A   F9           MOV       R1,A
   \   00000B   85..82       MOV       DPL,?XSP + 0
   \   00000E   85..83       MOV       DPH,?XSP + 1
   \   000011   E8           MOV       A,R0
   \   000012   F0           MOVX      @DPTR,A
   \   000013   A3           INC       DPTR
   \   000014   E9           MOV       A,R1
   \   000015   F0           MOVX      @DPTR,A
   \   000016   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine12:
   \   000000   E0           MOVX      A,@DPTR
   \   000001   F8           MOV       R0,A
   \   000002   A3           INC       DPTR
   \   000003   E0           MOVX      A,@DPTR
   \   000004   F583         MOV       DPH,A
   \   000006   8882         MOV       DPL,R0
   \   000008   22           RET

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   \                     ??txID_1:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    351          
    352          #ifdef ZDO_COORDINATOR
    353          static void zclSampleSw_processZDOMgs(zdoIncomingMsg_t *pMsg)
                             ^
Warning[Pe177]: function "zclSampleSw_processZDOMgs" was declared but never
          referenced
    354          {
    355            switch (pMsg->clusterID)
    356            {
    357              case Device_annce:
    358              {
    359                zclSampleSw_TestAddr = pMsg->srcAddr.addr.shortAddr;
    360                HalLcdWriteStringValue("Node:",pMsg->srcAddr.addr.shortAddr,10,0);
    361                HalLcdWriteString("Test...",4);
    362          
    363                osal_start_timerEx(zclSampleSw_TaskID,
    364                                    SAMPLEAPP_READ_EVT,
    365                                    SAMPLEAPP_READ_PERIOD);
    366              }
    367              break;
    368              default:
    369              break;
    370            }
    371          }
    372          #endif
    373          
    374          /*
    375           * 数据上报事件的处理函数，用于上报数据
    376           */
    377          static void zclSampleSw_ReportTest(void)
                             ^
Warning[Pe177]: function "zclSampleSw_ReportTest" was declared but never
          referenced
    378          {  
    379              static uint8 seqNum = 0;  
    380              zclReportCmd_t *reportCmd;  
    381          
    382              //目标设备的地址信息
    383              afAddrType_t destAddr;  
    384              destAddr.addrMode = afAddr16Bit;
    385              destAddr.endPoint = SAMPLESW_ENDPOINT;
    386              destAddr.addr.shortAddr = 0x0000;//0x0000表示协调器的网络地址
    387          
    388          reportCmd = (zclReportCmd_t *)osal_mem_alloc(sizeof(zclReportCmd_t)+sizeof(zclReport_t));//申请内存空间
    389          
    390              if(reportCmd == NULL)//判断内存空间是否申请成功
    391                   return;  
    392          
    393              reportCmd->attrList[0].attrData = (uint8 *)osal_mem_alloc(sizeof(uint8));//申请内存空间
    394          
    395              if(reportCmd->attrList[0].attrData == NULL)//判断内存空间是否申请成功
    396                  return;  
    397          
    398              reportCmd->numAttr = 1;//属性数量为1
    399              reportCmd->attrList[0].attrID = ATTRID_ON_OFF_SWITCH_TYPE;//属性ID
    400              reportCmd->attrList[0].dataType = ZCL_DATATYPE_ENUM8;//数据类型
    401              *((uint8 *)(reportCmd->attrList[0].attrData)) = seqNum;//属性值
    402          
    403              //上报数据
    404              zcl_SendReportCmd(SAMPLESW_ENDPOINT,//源端点号
    405                  &destAddr,//地址信息
    406                  ZCL_CLUSTER_ID_GEN_ON_OFF_SWITCH_CONFIG,//Cluster ID
    407                  reportCmd,
    408                  ZCL_FRAME_CLIENT_SERVER_DIR,//通信方向为从客户端到服务端
    409                  TRUE,//关闭默认响应（目标设备的响应）
    410                   seqNum++ );//数据包标号，每上报一次数据seqNum的值就会增加1
    411          
    412              HalLcdWriteStringValue("Report: ", (seqNum-1), 10, 4);//显示
    413          
    414              // 释放内存空间！
    415              osal_mem_free(reportCmd->attrList[0].attrData);  
    416              osal_mem_free(reportCmd);
    417          }
    418          
    419          
    420          //static uint8 aProcessCmd[] = { 1, 0, 0, 0 }; // used for reset command, { length + cmd0 + cmd1 + data }
    421          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    422          devStates_t zclSampleSw_NwkState = DEV_INIT;
   \                     zclSampleSw_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zclSampleSw_NwkState>`
   \   000001                REQUIRE __INIT_XDATA_I
    423          
    424          #if defined (OTA_CLIENT) && (OTA_CLIENT == TRUE)
    425          #define DEVICE_POLL_RATE                 8000   // Poll rate for end device
    426          #endif
    427          
    428          #define SAMPLESW_TOGGLE_TEST_EVT   0x1000
    429          /*********************************************************************
    430           * LOCAL FUNCTIONS
    431           */
    432          static void zclSampleSw_HandleKeys( byte shift, byte keys );
    433          static void zclSampleSw_BasicResetCB( void );
    434          
    435          static void zclSampleSw_ProcessCommissioningStatus(bdbCommissioningModeMsg_t *bdbCommissioningModeMsg);
    436          
    437          
    438          // Functions to process ZCL Foundation incoming Command/Response messages
    439          static void zclSampleSw_ProcessIncomingMsg( zclIncomingMsg_t *msg );
    440          #ifdef ZCL_READ
    441          static uint8 zclSampleSw_ProcessInReadRspCmd( zclIncomingMsg_t *pInMsg );
    442          #endif
    443          #ifdef ZCL_WRITE
    444          static uint8 zclSampleSw_ProcessInWriteRspCmd( zclIncomingMsg_t *pInMsg );
    445          #endif
    446          static uint8 zclSampleSw_ProcessInDefaultRspCmd( zclIncomingMsg_t *pInMsg );
    447          #ifdef ZCL_DISCOVER
    448          static uint8 zclSampleSw_ProcessInDiscCmdsRspCmd( zclIncomingMsg_t *pInMsg );
    449          static uint8 zclSampleSw_ProcessInDiscAttrsRspCmd( zclIncomingMsg_t *pInMsg );
    450          static uint8 zclSampleSw_ProcessInDiscAttrsExtRspCmd( zclIncomingMsg_t *pInMsg );
    451          #endif
    452          
    453          #if defined (OTA_CLIENT) && (OTA_CLIENT == TRUE)
    454          static void zclSampleSw_ProcessOTAMsgs( zclOTA_CallbackMsg_t* pMsg );
    455          #endif
    456          
    457          void zclSampleSw_UiActionToggleLight(uint16 keys);
    458          void zclSampleSw_UiUpdateLcd(uint8 uiCurrentState, char * line[3]);
    459          
    460          static void zclSampleApp_BatteryWarningCB( uint8 voltLevel);
    461          
    462          
    463          /*********************************************************************
    464           * CONSTANTS
    465           */

   \                                 In  segment XDATA_ROM_C, align 1
    466            const uiState_t zclSampleSw_UiStatesMain[] = 
   \                     zclSampleSw_UiStatesMain:
   \   000000   FE           DB 254
   \   000001   01           DB 1
   \   000002   0400         DW 4
   \   000004   ....         DW `??UI_ActionBackFromAppMenu::?relay`
   \   000006   00           DB 0
   \   000007   FE           DB 254
   \   000008   0404         DW 1028
   \   00000A   ....         DW `??zclSampleSw_UiActionToggleLight::?relay`
    467            {
    468              /*  UI_STATE_BACK_FROM_APP_MENU  */   {UI_STATE_DEFAULT_MOVE,       UI_STATE_TOGGLE_LIGHT,  UI_KEY_SW_5_PRESSED, &UI_ActionBackFromAppMenu}, //do not change this line, except for the second item, which should point to the last entry in this menu
    469              /*  UI_STATE_TOGGLE_LIGHT        */   {UI_STATE_BACK_FROM_APP_MENU, UI_STATE_DEFAULT_MOVE,  UI_KEY_SW_5_PRESSED | UI_KEY_SW_5_RELEASED, &zclSampleSw_UiActionToggleLight},
    470            };
    471            
    472          /*********************************************************************
    473           * REFERENCED EXTERNALS
    474           */
    475          extern int16 zdpExternalStateTaskID;
    476          
    477          /*********************************************************************
    478           * ZCL General Profile Callback table
    479           */

   \                                 In  segment XDATA_I, align 1, keep-with-next
    480          static zclGeneral_AppCallbacks_t zclSampleSw_CmdCallbacks =
   \                     zclSampleSw_CmdCallbacks:
   \   000000                DS 18
   \   000012                REQUIRE `?<Initializer for zclSampleSw_CmdCallbacks>`
   \   000012                REQUIRE __INIT_XDATA_I
    481          {
    482            zclSampleSw_BasicResetCB,               // Basic Cluster Reset command
    483            NULL,                                   // Identify Trigger Effect command
    484            NULL,                                   // On/Off cluster commands
    485            NULL,                                   // On/Off cluster enhanced command Off with Effect
    486            NULL,                                   // On/Off cluster enhanced command On with Recall Global Scene
    487            NULL,                                   // On/Off cluster enhanced command On with Timed Off
    488          #ifdef ZCL_LEVEL_CTRL
    489            NULL,                                   // Level Control Move to Level command
    490            NULL,                                   // Level Control Move command
    491            NULL,                                   // Level Control Step command
    492            NULL,                                   // Level Control Stop command
    493          #endif
    494          #ifdef ZCL_GROUPS
    495            NULL,                                   // Group Response commands
    496          #endif
    497          #ifdef ZCL_SCENES
    498            NULL,                                   // Scene Store Request command
    499            NULL,                                   // Scene Recall Request command
    500            NULL,                                   // Scene Response command
    501          #endif
    502          #ifdef ZCL_ALARMS
    503            NULL,                                   // Alarm (Response) commands
    504          #endif
    505          #ifdef SE_UK_EXT
    506            NULL,                                   // Get Event Log command
    507            NULL,                                   // Publish Event Log command
    508          #endif
    509            NULL,                                   // RSSI Location command
    510            NULL                                    // RSSI Location Response command
    511          };
    512          
    513          
    514          
    515          /*********************************************************************
    516           * @fn          zclSampleSw_Init
    517           *
    518           * @brief       Initialization function for the zclGeneral layer.
    519           *
    520           * @param       none
    521           *
    522           * @return      none
    523           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    524          void zclSampleSw_Init( byte task_id )
   \                     zclSampleSw_Init:
    525          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV       A,#-0xa
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   E9           MOV       A,R1
   \   000006   FE           MOV       R6,A
    526          #ifdef ZDO_COORDINATOR
    527            bdb_StartCommissioning( BDB_COMMISSIONING_MODE_NWK_FORMATION |
    528                                    BDB_COMMISSIONING_MODE_FINDING_BINDING );
   \   000007                ; Setup parameters for call to function bdb_StartCommissioning
   \   000007   790C         MOV       R1,#0xc
   \   000009   12....       LCALL     `??bdb_StartCommissioning::?relay`; Banked call to: bdb_StartCommissioning
    529          
    530            NLME_PermitJoiningRequest(255);
   \   00000C                ; Setup parameters for call to function NLME_PermitJoiningRequest
   \   00000C   79FF         MOV       R1,#-0x1
   \   00000E   12....       LCALL     `??NLME_PermitJoiningRequest::?relay`; Banked call to: NLME_PermitJoiningRequest
    531          #else
    532            bdb_StartCommissioning( BDB_COMMISSIONING_MODE_NWK_STEERING |
    533                                    BDB_COMMISSIONING_MODE_FINDING_BINDING );
    534          #endif
    535            zclSampleSw_TaskID = task_id;
   \   000011   EE           MOV       A,R6
   \   000012   90....       MOV       DPTR,#zclSampleSw_TaskID
   \   000015   F0           MOVX      @DPTR,A
    536          
    537            // Set destination address to indirect
    538            zclSampleSw_DstAddr.addrMode = (afAddrMode_t)AddrNotPresent;
   \   000016   90....       MOV       DPTR,#zclSampleSw_DstAddr + 8
   \   000019   E4           CLR       A
   \   00001A   F0           MOVX      @DPTR,A
    539            zclSampleSw_DstAddr.endPoint = 0;
   \   00001B   A3           INC       DPTR
   \   00001C   F0           MOVX      @DPTR,A
    540            zclSampleSw_DstAddr.addr.shortAddr = 0;
   \   00001D   90....       MOV       DPTR,#zclSampleSw_DstAddr
   \   000020   F0           MOVX      @DPTR,A
   \   000021   A3           INC       DPTR
   \   000022   F0           MOVX      @DPTR,A
    541          
    542            // Register the Simple Descriptor for this application
    543            bdb_RegisterSimpleDescriptor( &zclSampleSw_SimpleDesc );
   \   000023                ; Setup parameters for call to function bdb_RegisterSimpleDescriptor
   \   000023   7A..         MOV       R2,#zclSampleSw_SimpleDesc & 0xff
   \   000025   7B..         MOV       R3,#(zclSampleSw_SimpleDesc >> 8) & 0xff
   \   000027   12....       LCALL     `??bdb_RegisterSimpleDescriptor::?relay`; Banked call to: bdb_RegisterSimpleDescriptor
    544          
    545            // Register the ZCL General Cluster Library callback functions
    546            zclGeneral_RegisterCmdCallbacks( SAMPLESW_ENDPOINT, &zclSampleSw_CmdCallbacks );
   \   00002A                ; Setup parameters for call to function zclGeneral_RegisterCmdCallbacks
   \   00002A   7A..         MOV       R2,#zclSampleSw_CmdCallbacks & 0xff
   \   00002C   7B..         MOV       R3,#(zclSampleSw_CmdCallbacks >> 8) & 0xff
   \   00002E   7908         MOV       R1,#0x8
   \   000030   12....       LCALL     `??zclGeneral_RegisterCmdCallbacks::?relay`; Banked call to: zclGeneral_RegisterCmdCallbacks
    547          
    548            zclSampleSw_ResetAttributesToDefaultValues();
   \   000033                ; Setup parameters for call to function zclSampleSw_ResetAttributesToDefaultValues
   \   000033   12....       LCALL     `??zclSampleSw_ResetAttributesToDefaultValues::?`; Banked call to: zclSampleSw_ResetAttributesToDefaultValues
    549            
    550            // Register the application's attribute list
    551            zcl_registerAttrList( SAMPLESW_ENDPOINT, zclSampleSw_NumAttributes, zclSampleSw_Attrs );
   \   000036                ; Setup parameters for call to function zcl_registerAttrList
   \   000036   7C..         MOV       R4,#zclSampleSw_Attrs & 0xff
   \   000038   7D..         MOV       R5,#(zclSampleSw_Attrs >> 8) & 0xff
   \   00003A   90....       MOV       DPTR,#zclSampleSw_NumAttributes
   \   00003D   E4           CLR       A
   \   00003E   93           MOVC      A,@A+DPTR
   \   00003F   FA           MOV       R2,A
   \   000040   7908         MOV       R1,#0x8
   \   000042   12....       LCALL     `??zcl_registerAttrList::?relay`; Banked call to: zcl_registerAttrList
    552          
    553            // Register the Application to receive the unprocessed Foundation command/response messages
    554            zcl_registerForMsg( zclSampleSw_TaskID );
   \   000045                ; Setup parameters for call to function zcl_registerForMsg
   \   000045   90....       MOV       DPTR,#zclSampleSw_TaskID
   \   000048   E0           MOVX      A,@DPTR
   \   000049   F9           MOV       R1,A
   \   00004A   12....       LCALL     `??zcl_registerForMsg::?relay`; Banked call to: zcl_registerForMsg
    555            
    556            // Register low voltage NV memory protection application callback
    557            RegisterVoltageWarningCB( zclSampleApp_BatteryWarningCB );
   \   00004D                ; Setup parameters for call to function RegisterVoltageWarningCB
   \   00004D   7A..         MOV       R2,#`??zclSampleApp_BatteryWarningCB::?relay` & 0xff
   \   00004F   7B..         MOV       R3,#(`??zclSampleApp_BatteryWarningCB::?relay` >> 8) & 0xff
   \   000051   12....       LCALL     `??RegisterVoltageWarningCB::?relay`; Banked call to: RegisterVoltageWarningCB
    558          
    559            // Register for all key events - This app will handle all key events
    560            RegisterForKeys( zclSampleSw_TaskID );
   \   000054                ; Setup parameters for call to function RegisterForKeys
   \   000054   90....       MOV       DPTR,#zclSampleSw_TaskID
   \   000057   E0           MOVX      A,@DPTR
   \   000058   F9           MOV       R1,A
   \   000059   12....       LCALL     `??RegisterForKeys::?relay`; Banked call to: RegisterForKeys
    561            
    562            bdb_RegisterCommissioningStatusCB( zclSampleSw_ProcessCommissioningStatus );
   \   00005C                ; Setup parameters for call to function bdb_RegisterCommissioningStatusCB
   \   00005C   7A..         MOV       R2,#`??zclSampleSw_ProcessCommissioningStatus::?rela` & 0xff
   \   00005E   7B..         MOV       R3,#(`??zclSampleSw_ProcessCommissioningStatus::?rela` >> 8) & 0xff
   \   000060   12....       LCALL     `??bdb_RegisterCommissioningStatusCB::?relay`; Banked call to: bdb_RegisterCommissioningStatusCB
    563          
    564            // Register for a test endpoint
    565            afRegister( &sampleSw_TestEp );
   \   000063                ; Setup parameters for call to function afRegister
   \   000063   7A..         MOV       R2,#sampleSw_TestEp & 0xff
   \   000065   7B..         MOV       R3,#(sampleSw_TestEp >> 8) & 0xff
   \   000067   12....       LCALL     `??afRegister::?relay`; Banked call to: afRegister
    566            
    567            osal_start_timerEx(zclSampleSw_TaskID, 
    568              SAMPLEAPP_REPORT_EVT,//事件
    569              SAMPLEAPP_REPORT_PERIOD);//延迟处理事件的时间长度
   \   00006A                ; Setup parameters for call to function osal_start_timerEx
   \   00006A   90....       MOV       DPTR,#__Constant_bb8
   \   00006D   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   000070   7A40         MOV       R2,#0x40
   \   000072   7B00         MOV       R3,#0x0
   \   000074   90....       MOV       DPTR,#zclSampleSw_TaskID
   \   000077   E0           MOVX      A,@DPTR
   \   000078   F9           MOV       R1,A
   \   000079   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   00007C   7404         MOV       A,#0x4
   \   00007E   12....       LCALL     ?DEALLOC_XSTACK8
    570            
    571          #ifdef ZCL_DIAGNOSTIC
    572            // Register the application's callback function to read/write attribute data.
    573            // This is only required when the attribute data format is unknown to ZCL.
    574            zcl_registerReadWriteCB( SAMPLESW_ENDPOINT, zclDiagnostic_ReadWriteAttrCB, NULL );
    575          
    576            if ( zclDiagnostic_InitStats() == ZSuccess )
    577            {
    578              // Here the user could start the timer to save Diagnostics to NV
    579            }
    580          #endif
    581          
    582          #if defined (OTA_CLIENT) && (OTA_CLIENT == TRUE)
    583            // Register for callback events from the ZCL OTA
    584            zclOTA_Register(zclSampleSw_TaskID);
    585          #endif
    586          
    587            zdpExternalStateTaskID = zclSampleSw_TaskID;
   \   000081   90....       MOV       DPTR,#zclSampleSw_TaskID
   \   000084   E0           MOVX      A,@DPTR
   \   000085   90....       MOV       DPTR,#zdpExternalStateTaskID
   \   000088   F0           MOVX      @DPTR,A
   \   000089   A3           INC       DPTR
   \   00008A   E4           CLR       A
   \   00008B   F0           MOVX      @DPTR,A
    588          
    589            UI_Init(zclSampleSw_TaskID, SAMPLEAPP_LCD_AUTO_UPDATE_EVT, SAMPLEAPP_KEY_AUTO_REPEAT_EVT, &zclSampleSw_IdentifyTime, APP_TITLE, &zclSampleSw_UiUpdateLcd, zclSampleSw_UiStatesMain);
   \   00008C                ; Setup parameters for call to function UI_Init
   \   00008C   75....       MOV       ?V0,#zclSampleSw_UiStatesMain & 0xff
   \   00008F   75....       MOV       ?V1,#(zclSampleSw_UiStatesMain >> 8) & 0xff
   \   000092   78..         MOV       R0,#?V0
   \   000094   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000097   75....       MOV       ?V0,#`??zclSampleSw_UiUpdateLcd::?relay` & 0xff
   \   00009A   75....       MOV       ?V1,#(`??zclSampleSw_UiUpdateLcd::?relay` >> 8) & 0xff
   \   00009D   78..         MOV       R0,#?V0
   \   00009F   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000A2   75....       MOV       ?V0,#`?<Constant "TI Sample Switch">` & 0xff
   \   0000A5   75....       MOV       ?V1,#(`?<Constant "TI Sample Switch">` >> 8) & 0xff
   \   0000A8   78..         MOV       R0,#?V0
   \   0000AA   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000AD   75....       MOV       ?V0,#zclSampleSw_IdentifyTime & 0xff
   \   0000B0   75....       MOV       ?V1,#(zclSampleSw_IdentifyTime >> 8) & 0xff
   \   0000B3   78..         MOV       R0,#?V0
   \   0000B5   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000B8   7C20         MOV       R4,#0x20
   \   0000BA   7D00         MOV       R5,#0x0
   \   0000BC   7A10         MOV       R2,#0x10
   \   0000BE   7B00         MOV       R3,#0x0
   \   0000C0   90....       MOV       DPTR,#zclSampleSw_TaskID
   \   0000C3   E0           MOVX      A,@DPTR
   \   0000C4   F9           MOV       R1,A
   \   0000C5   12....       LCALL     `??UI_Init::?relay`; Banked call to: UI_Init
   \   0000C8   7408         MOV       A,#0x8
   \   0000CA   12....       LCALL     ?DEALLOC_XSTACK8
    590          
    591            UI_UpdateLcd();
   \   0000CD                ; Setup parameters for call to function UI_UpdateLcd
   \   0000CD   12....       LCALL     `??UI_UpdateLcd::?relay`; Banked call to: UI_UpdateLcd
    592          
    593          #ifdef ZDO_COORDINATOR
    594            bdb_StartCommissioning( BDB_COMMISSIONING_MODE_NWK_FORMATION |
    595                                    BDB_COMMISSIONING_MODE_FINDING_BINDING );
   \   0000D0                ; Setup parameters for call to function bdb_StartCommissioning
   \   0000D0   790C         MOV       R1,#0xc
   \   0000D2   12....       LCALL     `??bdb_StartCommissioning::?relay`; Banked call to: bdb_StartCommissioning
    596            
    597            NLME_PermitJoiningRequest(255);
   \   0000D5                ; Setup parameters for call to function NLME_PermitJoiningRequest
   \   0000D5   79FF         MOV       R1,#-0x1
   \   0000D7   12....       LCALL     `??NLME_PermitJoiningRequest::?relay`; Banked call to: NLME_PermitJoiningRequest
    598            
    599            // Broadcast
    600            osal_start_timerEx(zclSampleSw_TaskID, 
    601                               SAMPLEAPP_BROADCAST_EVT, 
    602                               SAMPLEAPP_BROADCAST_PERIOD);
   \   0000DA                ; Setup parameters for call to function osal_start_timerEx
   \   0000DA   90....       MOV       DPTR,#__Constant_3e8
   \   0000DD   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   0000E0   7A80         MOV       R2,#-0x80
   \   0000E2   7B00         MOV       R3,#0x0
   \   0000E4   90....       MOV       DPTR,#zclSampleSw_TaskID
   \   0000E7   E0           MOVX      A,@DPTR
   \   0000E8   F9           MOV       R1,A
   \   0000E9   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   0000EC   7404         MOV       A,#0x4
   \   0000EE   12....       LCALL     ?DEALLOC_XSTACK8
    603            // groupcast
    604            osal_start_timerEx(zclSampleSw_TaskID, 
    605                               SAMPLEAPP_GROUPCAST_EVT, 
    606                               SAMPLEAPP_GROUPCAST_PERIOD);
   \   0000F1                ; Setup parameters for call to function osal_start_timerEx
   \   0000F1   90....       MOV       DPTR,#__Constant_3e8
   \   0000F4   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   0000F7   7A00         MOV       R2,#0x0
   \   0000F9   7B01         MOV       R3,#0x1
   \   0000FB   90....       MOV       DPTR,#zclSampleSw_TaskID
   \   0000FE   E0           MOVX      A,@DPTR
   \   0000FF   F9           MOV       R1,A
   \   000100   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   000103   7404         MOV       A,#0x4
   \   000105   12....       LCALL     ?DEALLOC_XSTACK8
    607          #else
    608            bdb_StartCommissioning( BDB_COMMISSIONING_MODE_NWK_STEERING |
    609                                    BDB_COMMISSIONING_MODE_FINDING_BINDING );
    610            // Add group
    611            aps_Group_t group = {
    612              .ID = GROUP_ID,
    613              .name = "",
    614            };
    615            aps_AddGroup(SAMPLESW_ENDPOINT, &group);
    616            
    617            // P2P
    618            osal_start_timerEx(zclSampleSw_TaskID, 
    619                               SAMPLEAPP_P2P_EVT, 
    620                               SAMPLEAPP_P2P_PERIOD);
    621          #endif
    622          }
   \   000108                REQUIRE ?Subroutine1
   \   000108                ; // Fall through to label ?Subroutine1

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7F02         MOV       R7,#0x2
   \   000002   02....       LJMP      ?BANKED_LEAVE_XDATA
    623          
    624          /*********************************************************************
    625           * @fn          zclSample_event_loop
    626           *
    627           * @brief       Event Loop Processor for zclGeneral.
    628           *
    629           * @param       none
    630           *
    631           * @return      none
    632           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    633          uint16 zclSampleSw_event_loop( uint8 task_id, uint16 events )
   \                     zclSampleSw_event_loop:
    634          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000   74F4         MOV       A,#-0xc
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 12
   \   000005   74F4         MOV       A,#-0xc
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   \   00000A   EA           MOV       A,R2
   \   00000B   FE           MOV       R6,A
   \   00000C   EB           MOV       A,R3
   \   00000D   FF           MOV       R7,A
    635            afIncomingMSGPacket_t *MSGpkt;
    636            (void)task_id;  // Intentionally unreferenced parameter
    637          
    638            //Send toggle every 500ms
    639            if( events & SAMPLESW_TOGGLE_TEST_EVT )
   \   00000E   5410         ANL       A,#0x10
   \   000010   6064         JZ        ??zclSampleSw_event_loop_0
    640            {
    641              osal_start_timerEx(zclSampleSw_TaskID,SAMPLESW_TOGGLE_TEST_EVT,500);
   \   000012                ; Setup parameters for call to function osal_start_timerEx
   \   000012   90....       MOV       DPTR,#__Constant_1f4
   \   000015   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   000018   7A00         MOV       R2,#0x0
   \   00001A   7B10         MOV       R3,#0x10
   \   00001C   90....       MOV       DPTR,#zclSampleSw_TaskID
   \   00001F   E0           MOVX      A,@DPTR
   \   000020   F9           MOV       R1,A
   \   000021   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   000024   7404         MOV       A,#0x4
   \   000026   12....       LCALL     ?DEALLOC_XSTACK8
    642              zclGeneral_SendOnOff_CmdToggle( SAMPLESW_ENDPOINT, &zclSampleSw_DstAddr, FALSE, 0 );
   \   000029                ; Setup parameters for call to function zcl_SendCommand
   \   000029   E4           CLR       A
   \   00002A   F5..         MOV       ?V0,A
   \   00002C   F5..         MOV       ?V1,A
   \   00002E   78..         MOV       R0,#?V0
   \   000030   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000033   78..         MOV       R0,#?V0
   \   000035   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000038   78..         MOV       R0,#?V0
   \   00003A   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   00003D   78..         MOV       R0,#?V0
   \   00003F   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000042   78..         MOV       R0,#?V0
   \   000044   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   000047   78..         MOV       R0,#?V0
   \   000049   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   00004C   75..01       MOV       ?V0,#0x1
   \   00004F   78..         MOV       R0,#?V0
   \   000051   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   000054   75..02       MOV       ?V0,#0x2
   \   000057   78..         MOV       R0,#?V0
   \   000059   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   00005C   7C06         MOV       R4,#0x6
   \   00005E   7D00         MOV       R5,#0x0
   \   000060   7A..         MOV       R2,#zclSampleSw_DstAddr & 0xff
   \   000062   7B..         MOV       R3,#(zclSampleSw_DstAddr >> 8) & 0xff
   \   000064   7908         MOV       R1,#0x8
   \   000066   12....       LCALL     `??zcl_SendCommand::?relay`; Banked call to: zcl_SendCommand
   \   000069   740B         MOV       A,#0xb
   \   00006B   12....       LCALL     ?DEALLOC_XSTACK8
    643              
    644              // return unprocessed events
    645              return (events ^ SAMPLESW_TOGGLE_TEST_EVT);
   \   00006E   EE           MOV       A,R6
   \   00006F   FA           MOV       R2,A
   \   000070   EF           MOV       A,R7
   \   000071   6410         XRL       A,#0x10
   \   000073   02....       LJMP      ??zclSampleSw_event_loop_1 & 0xFFFF
    646            }
    647            
    648            
    649            if ( events & SYS_EVENT_MSG )
   \                     ??zclSampleSw_event_loop_0:
   \   000076   EF           MOV       A,R7
   \   000077   5480         ANL       A,#0x80
   \   000079   701E         JNZ       ??zclSampleSw_event_loop_2
    650            {
    651              while ( (MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( zclSampleSw_TaskID )) )
    652              {
    653                switch ( MSGpkt->hdr.event )
    654                {
    655                  case AF_INCOMING_MSG_CMD:
    656                  zclSampleSw_AF_RxProc(MSGpkt);
    657                  break;
    658          
    659                  case ZCL_INCOMING_MSG:
    660                    // Incoming ZCL Foundation command/response messages
    661                    zclSampleSw_ProcessIncomingMsg( (zclIncomingMsg_t *)MSGpkt );
    662                    break;
    663          
    664                  case KEY_CHANGE:
    665                    zclSampleSw_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    666                    break;
    667          
    668                  case ZDO_STATE_CHANGE:
    669                    UI_DeviceStateUpdated((devStates_t)(MSGpkt->hdr.status));
    670                    break;
    671          
    672          #if defined (OTA_CLIENT) && (OTA_CLIENT == TRUE)
    673                  case ZCL_OTA_CALLBACK_IND:
    674                    zclSampleSw_ProcessOTAMsgs( (zclOTA_CallbackMsg_t*)MSGpkt  );
    675                    break;
    676          #endif
    677          
    678                  default:
    679                    break;
    680                }
    681          
    682                // Release the memory
    683                osal_msg_deallocate( (uint8 *)MSGpkt );
    684              }
    685          
    686              // return unprocessed events
    687              return (events ^ SYS_EVENT_MSG);
    688            }
    689          
    690          #if ZG_BUILD_ENDDEVICE_TYPE    
    691            if ( events & SAMPLEAPP_END_DEVICE_REJOIN_EVT )
    692            {
    693              bdb_ZedAttemptRecoverNwk();
    694              return ( events ^ SAMPLEAPP_END_DEVICE_REJOIN_EVT );
    695            }
    696          #endif
    697            
    698            if ( events & SAMPLEAPP_LCD_AUTO_UPDATE_EVT )
   \   00007B   EE           MOV       A,R6
   \   00007C   5410         ANL       A,#0x10
   \   00007E   7003         JNZ       $+5
   \   000080   02....       LJMP      ??zclSampleSw_event_loop_3 & 0xFFFF
    699            {
    700              UI_UpdateLcd();
   \   000083                ; Setup parameters for call to function UI_UpdateLcd
   \   000083   12....       LCALL     `??UI_UpdateLcd::?relay`; Banked call to: UI_UpdateLcd
    701              return ( events ^ SAMPLEAPP_LCD_AUTO_UPDATE_EVT );
   \   000086   EE           MOV       A,R6
   \   000087   6410         XRL       A,#0x10
   \   000089   02....       LJMP      ??zclSampleSw_event_loop_4 & 0xFFFF
    702            }
   \                     ??zclSampleSw_event_loop_5:
   \   00008C                ; Setup parameters for call to function UI_DeviceStateUpdated
   \   00008C   A3           INC       DPTR
   \   00008D   E0           MOVX      A,@DPTR
   \   00008E   F9           MOV       R1,A
   \   00008F   12....       LCALL     `??UI_DeviceStateUpdated::?relay`; Banked call to: UI_DeviceStateUpdated
   \                     ??zclSampleSw_event_loop_6:
   \   000092                ; Setup parameters for call to function osal_msg_deallocate
   \   000092   AA..         MOV       R2,?V0
   \   000094   AB..         MOV       R3,?V1
   \   000096   12....       LCALL     `??osal_msg_deallocate::?relay`; Banked call to: osal_msg_deallocate
   \                     ??zclSampleSw_event_loop_2:
   \   000099                ; Setup parameters for call to function osal_msg_receive
   \   000099   90....       MOV       DPTR,#zclSampleSw_TaskID
   \   00009C   E0           MOVX      A,@DPTR
   \   00009D   F9           MOV       R1,A
   \   00009E   12....       LCALL     `??osal_msg_receive::?relay`; Banked call to: osal_msg_receive
   \   0000A1   8A..         MOV       ?V0,R2
   \   0000A3   8B..         MOV       ?V1,R3
   \   0000A5   EA           MOV       A,R2
   \   0000A6   45..         ORL       A,?V1
   \   0000A8   7003         JNZ       $+5
   \   0000AA   02....       LJMP      ??zclSampleSw_event_loop_7 & 0xFFFF
   \   0000AD   8A82         MOV       DPL,R2
   \   0000AF   8B83         MOV       DPH,R3
   \   0000B1   E0           MOVX      A,@DPTR
   \   0000B2   24E6         ADD       A,#-0x1a
   \   0000B4   600E         JZ        ??zclSampleSw_event_loop_8
   \   0000B6   24E6         ADD       A,#-0x1a
   \   0000B8   6075         JZ        ??zclSampleSw_event_loop_9
   \   0000BA   2474         ADD       A,#0x74
   \   0000BC   6077         JZ        ??zclSampleSw_event_loop_10
   \   0000BE   24EF         ADD       A,#-0x11
   \   0000C0   60CA         JZ        ??zclSampleSw_event_loop_5
   \   0000C2   80CE         SJMP      ??zclSampleSw_event_loop_6
   \                     ??zclSampleSw_event_loop_8:
   \   0000C4   A3           INC       DPTR
   \   0000C5   A3           INC       DPTR
   \   0000C6   A3           INC       DPTR
   \   0000C7   A3           INC       DPTR
   \   0000C8   E0           MOVX      A,@DPTR
   \   0000C9   F5..         MOV       ?V2,A
   \   0000CB   A3           INC       DPTR
   \   0000CC   E0           MOVX      A,@DPTR
   \   0000CD   F5..         MOV       ?V3,A
   \   0000CF   78..         MOV       R0,#?V2
   \   0000D1   12....       LCALL     ?US_SWITCH_DENSE
   \                     `?<Jumptable for zclSampleSw_event_loop>_0`:
   \   0000D4   0000         DW        0
   \   0000D6   02           DB        2
   \   0000D7   ....         DW        ??zclSampleSw_event_loop_6
   \   0000D9   ....         DW        ??zclSampleSw_event_loop_11
   \   0000DB   ....         DW        ??zclSampleSw_event_loop_12
   \   0000DD   ....         DW        ??zclSampleSw_event_loop_13
   \                     ??zclSampleSw_event_loop_13:
   \   0000DF   90....       MOV       DPTR,#??gcCnt
   \   0000E2   E0           MOVX      A,@DPTR
   \   0000E3   04           INC       A
   \   0000E4   F0           MOVX      @DPTR,A
   \   0000E5                ; Setup parameters for call to function HalLcdWriteStringValue
   \   0000E5   75..04       MOV       ?V2,#0x4
   \   0000E8   78..         MOV       R0,#?V2
   \   0000EA   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   0000ED   790A         MOV       R1,#0xa
   \   0000EF   90....       MOV       DPTR,#??gcCnt
   \                     ??zclSampleSw_event_loop_14:
   \   0000F2   E0           MOVX      A,@DPTR
   \   0000F3   FC           MOV       R4,A
   \   0000F4   7D00         MOV       R5,#0x0
   \   0000F6   EA           MOV       A,R2
   \   0000F7   2422         ADD       A,#0x22
   \   0000F9   F582         MOV       DPL,A
   \   0000FB   E4           CLR       A
   \   0000FC   35..         ADDC      A,?V1
   \   0000FE   F583         MOV       DPH,A
   \   000100   E0           MOVX      A,@DPTR
   \   000101   FA           MOV       R2,A
   \   000102   A3           INC       DPTR
   \   000103   E0           MOVX      A,@DPTR
   \   000104   FB           MOV       R3,A
   \   000105   12....       LCALL     `??HalLcdWriteStringValue::?relay`; Banked call to: HalLcdWriteStringValue
   \   000108   7401         MOV       A,#0x1
   \   00010A   12....       LCALL     ?DEALLOC_XSTACK8
   \   00010D   8083         SJMP      ??zclSampleSw_event_loop_6
   \                     ??zclSampleSw_event_loop_12:
   \   00010F   90....       MOV       DPTR,#??bcCnt
   \   000112   12....       LCALL     ?Subroutine10 & 0xFFFF
   \                     ??CrossCallReturnLabel_12:
   \   000115   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   000118   790A         MOV       R1,#0xa
   \   00011A   90....       MOV       DPTR,#??bcCnt
   \   00011D   80D3         SJMP      ??zclSampleSw_event_loop_14
   \                     ??zclSampleSw_event_loop_11:
   \   00011F   90....       MOV       DPTR,#??p2pCnt
   \   000122   12....       LCALL     ?Subroutine10 & 0xFFFF
   \                     ??CrossCallReturnLabel_13:
   \   000125   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   000128   790A         MOV       R1,#0xa
   \   00012A   90....       MOV       DPTR,#??p2pCnt
   \   00012D   80C3         SJMP      ??zclSampleSw_event_loop_14
   \                     ??zclSampleSw_event_loop_9:
   \   00012F                ; Setup parameters for call to function zclSampleSw_ProcessIncomingMsg
   \   00012F   12....       LCALL     `??zclSampleSw_ProcessIncomingMsg::?relay`; Banked call to: zclSampleSw_ProcessIncomingMsg
   \   000132   02....       LJMP      ??zclSampleSw_event_loop_6 & 0xFFFF
   \                     ??zclSampleSw_event_loop_10:
   \   000135                ; Setup parameters for call to function UI_MainStateMachine
   \   000135   A3           INC       DPTR
   \   000136   A3           INC       DPTR
   \   000137   A3           INC       DPTR
   \   000138   E0           MOVX      A,@DPTR
   \   000139   FA           MOV       R2,A
   \   00013A   7B00         MOV       R3,#0x0
   \   00013C   12....       LCALL     `??UI_MainStateMachine::?relay`; Banked call to: UI_MainStateMachine
   \   00013F   02....       LJMP      ??zclSampleSw_event_loop_6 & 0xFFFF
   \                     ??zclSampleSw_event_loop_7:
   \   000142   EE           MOV       A,R6
   \   000143   FA           MOV       R2,A
   \   000144   EF           MOV       A,R7
   \   000145   6480         XRL       A,#0x80
   \   000147   02....       LJMP      ??zclSampleSw_event_loop_1 & 0xFFFF
    703          
    704            if ( events & SAMPLEAPP_KEY_AUTO_REPEAT_EVT )
   \                     ??zclSampleSw_event_loop_3:
   \   00014A   EE           MOV       A,R6
   \   00014B   5420         ANL       A,#0x20
   \   00014D   600D         JZ        ??zclSampleSw_event_loop_15
    705            {
    706              UI_MainStateMachine(UI_KEY_AUTO_PRESSED);
   \   00014F                ; Setup parameters for call to function UI_MainStateMachine
   \   00014F   7AFF         MOV       R2,#-0x1
   \   000151   7BFF         MOV       R3,#-0x1
   \   000153   12....       LCALL     `??UI_MainStateMachine::?relay`; Banked call to: UI_MainStateMachine
    707              return ( events ^ SAMPLEAPP_KEY_AUTO_REPEAT_EVT );
   \   000156   EE           MOV       A,R6
   \   000157   6420         XRL       A,#0x20
   \   000159   02....       LJMP      ??zclSampleSw_event_loop_4 & 0xFFFF
    708            }
    709            // Discard unknown events
    710            
    711          #ifdef ZDO_COORDINATOR
    712            if ( events & SAMPLEAPP_READ_EVT )//如是读命令事件
   \                     ??zclSampleSw_event_loop_15:
   \   00015C   EE           MOV       A,R6
   \   00015D   A2E0         MOV       C,0xE0 /* A   */.0
   \   00015F   507A         JNC       ??zclSampleSw_event_loop_16
    713            {
    714              zclSampleSw_ReadTest();//读命令事件处理函数
   \   000161   7409         MOV       A,#0x9
   \   000163   12....       LCALL     ?XSTACK_DISP0_8
   \   000166   7408         MOV       A,#0x8
   \   000168   F0           MOVX      @DPTR,A
   \   000169   12....       LCALL     ?XSTACK_DISP0_8
   \   00016C   12....       LCALL     ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   00016F                ; Setup parameters for call to function osal_mem_alloc
   \   00016F   7A03         MOV       R2,#0x3
   \   000171   7B00         MOV       R3,#0x0
   \   000173   12....       LCALL     `??osal_mem_alloc::?relay`; Banked call to: osal_mem_alloc
   \   000176   8A..         MOV       ?V0,R2
   \   000178   8B..         MOV       ?V1,R3
   \   00017A   EA           MOV       A,R2
   \   00017B   45..         ORL       A,?V1
   \   00017D   603F         JZ        ??zclSampleSw_event_loop_17
   \   00017F   8A82         MOV       DPL,R2
   \   000181   8B83         MOV       DPH,R3
   \   000183   12....       LCALL     ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_3:
   \   000186   90....       MOV       DPTR,#??txID
   \   000189   12....       LCALL     ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   00018C   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   00018F   75..01       MOV       ?V2,#0x1
   \   000192   78..         MOV       R0,#?V2
   \   000194   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   000197   75..00       MOV       ?V2,#0x0
   \   00019A   78..         MOV       R0,#?V2
   \   00019C   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   00019F   78..         MOV       R0,#?V0
   \   0001A1   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0001A4   7C07         MOV       R4,#0x7
   \   0001A6   7D00         MOV       R5,#0x0
   \   0001A8   7405         MOV       A,#0x5
   \   0001AA   12....       LCALL     ?XSTACK_DISP101_8
   \   0001AD   7908         MOV       R1,#0x8
   \   0001AF   12....       LCALL     `??zcl_SendRead::?relay`; Banked call to: zcl_SendRead
   \   0001B2   7405         MOV       A,#0x5
   \   0001B4   12....       LCALL     ?DEALLOC_XSTACK8
   \   0001B7                ; Setup parameters for call to function osal_mem_free
   \   0001B7   AA..         MOV       R2,?V0
   \   0001B9   AB..         MOV       R3,?V1
   \   0001BB   12....       LCALL     `??osal_mem_free::?relay`; Banked call to: osal_mem_free
    715              
    716              //启动一个写命令事件
    717              osal_start_timerEx(zclSampleSw_TaskID, 
    718                                 SAMPLEAPP_WRITE_EVT, 
    719                                 SAMPLEAPP_WRITE_PERIOD);
   \                     ??zclSampleSw_event_loop_17:
   \   0001BE                ; Setup parameters for call to function osal_start_timerEx
   \   0001BE   90....       MOV       DPTR,#__Constant_3e8
   \   0001C1   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   0001C4   7A02         MOV       R2,#0x2
   \   0001C6   7B00         MOV       R3,#0x0
   \   0001C8   90....       MOV       DPTR,#zclSampleSw_TaskID
   \   0001CB   E0           MOVX      A,@DPTR
   \   0001CC   F9           MOV       R1,A
   \   0001CD   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   0001D0   7404         MOV       A,#0x4
   \   0001D2   12....       LCALL     ?DEALLOC_XSTACK8
    720              
    721              return ( events ^ SAMPLEAPP_READ_EVT );
   \   0001D5   EE           MOV       A,R6
   \   0001D6   6401         XRL       A,#0x1
   \   0001D8   02....       LJMP      ??zclSampleSw_event_loop_4 & 0xFFFF
    722            }
    723            if ( events & SAMPLEAPP_WRITE_EVT )//如果是写命令事件
   \                     ??zclSampleSw_event_loop_16:
   \   0001DB   5402         ANL       A,#0x2
   \   0001DD   601F         JZ        ??zclSampleSw_event_loop_18
    724            {
    725              zclSampleSw_WriteTest();//写命令处理函数
   \   0001DF                ; Setup parameters for call to function zclSampleSw_WriteTest
   \   0001DF   12....       LCALL     `??zclSampleSw_WriteTest::?relay`; Banked call to: zclSampleSw_WriteTest
    726              
    727              osal_start_timerEx(zclSampleSw_TaskID,//启动一个读命令事件
    728                                 SAMPLEAPP_READ_EVT, 
    729                                 SAMPLEAPP_READ_PERIOD);
   \   0001E2                ; Setup parameters for call to function osal_start_timerEx
   \   0001E2   90....       MOV       DPTR,#__Constant_3e8
   \   0001E5   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   0001E8   7A01         MOV       R2,#0x1
   \   0001EA   7B00         MOV       R3,#0x0
   \   0001EC   90....       MOV       DPTR,#zclSampleSw_TaskID
   \   0001EF   E0           MOVX      A,@DPTR
   \   0001F0   F9           MOV       R1,A
   \   0001F1   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   0001F4   7404         MOV       A,#0x4
   \   0001F6   12....       LCALL     ?DEALLOC_XSTACK8
    730              
    731              return ( events ^ SAMPLEAPP_WRITE_EVT );
   \   0001F9   EE           MOV       A,R6
   \   0001FA   6402         XRL       A,#0x2
   \   0001FC   807F         SJMP      ??zclSampleSw_event_loop_4
    732            }
    733            // Broadcast event
    734            if ( events & SAMPLEAPP_BROADCAST_EVT )
   \                     ??zclSampleSw_event_loop_18:
   \   0001FE   EE           MOV       A,R6
   \   0001FF   5480         ANL       A,#0x80
   \   000201   607F         JZ        ??zclSampleSw_event_loop_19
    735            {
    736              zclSampleSw_AF_Broadcast(CLUSTER_BROADCAST,
    737                                       10, "Broadcast");
   \   000203   7408         MOV       A,#0x8
   \   000205   12....       LCALL     ?XSTACK_DISP0_8
   \   000208   740F         MOV       A,#0xf
   \   00020A   F0           MOVX      @DPTR,A
   \   00020B   85..82       MOV       DPL,?XSP + 0
   \   00020E   85..83       MOV       DPH,?XSP + 1
   \   000211   74FF         MOV       A,#-0x1
   \   000213   F0           MOVX      @DPTR,A
   \   000214   A3           INC       DPTR
   \   000215   F0           MOVX      @DPTR,A
   \   000216   7409         MOV       A,#0x9
   \   000218   12....       LCALL     ?XSTACK_DISP0_8
   \   00021B   7408         MOV       A,#0x8
   \   00021D   F0           MOVX      @DPTR,A
   \   00021E   90....       MOV       DPTR,#??transferId
   \   000221   12....       LCALL     ?Subroutine11 & 0xFFFF
   \                     ??CrossCallReturnLabel_14:
   \   000224   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   000227   75....       MOV       ?V0,#??transferId & 0xff
   \   00022A   75....       MOV       ?V1,#(??transferId >> 8) & 0xff
   \   00022D   78..         MOV       R0,#?V0
   \   00022F   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000232   75....       MOV       ?V0,#`?<Constant "Broadcast">` & 0xff
   \   000235   75....       MOV       ?V1,#(`?<Constant "Broadcast">` >> 8) & 0xff
   \   000238   78..         MOV       R0,#?V0
   \   00023A   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00023D   75..0A       MOV       ?V0,#0xa
   \   000240   75..00       MOV       ?V1,#0x0
   \   000243   78..         MOV       R0,#?V0
   \   000245   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000248   75..01       MOV       ?V0,#0x1
   \   00024B   78..         MOV       R0,#?V0
   \   00024D   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000250   7900         MOV       R1,#0x0
   \   000252   7C..         MOV       R4,#sampleSw_TestEp & 0xff
   \   000254   7D..         MOV       R5,#(sampleSw_TestEp >> 8) & 0xff
   \   000256   7409         MOV       A,#0x9
   \   000258   12....       LCALL     ?XSTACK_DISP101_8
   \   00025B   12....       LCALL     `??AF_DataRequest::?relay`; Banked call to: AF_DataRequest
   \   00025E   7409         MOV       A,#0x9
   \   000260   12....       LCALL     ?DEALLOC_XSTACK8
    738              
    739              osal_start_timerEx(zclSampleSw_TaskID, 
    740                               SAMPLEAPP_BROADCAST_EVT, 
    741                               SAMPLEAPP_BROADCAST_PERIOD);
   \   000263                ; Setup parameters for call to function osal_start_timerEx
   \   000263   90....       MOV       DPTR,#__Constant_3e8
   \   000266   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   000269   7A80         MOV       R2,#-0x80
   \   00026B   7B00         MOV       R3,#0x0
   \   00026D   90....       MOV       DPTR,#zclSampleSw_TaskID
   \   000270   E0           MOVX      A,@DPTR
   \   000271   F9           MOV       R1,A
   \   000272   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   000275   7404         MOV       A,#0x4
   \   000277   12....       LCALL     ?DEALLOC_XSTACK8
    742              
    743              return ( events ^ SAMPLEAPP_BROADCAST_EVT );
   \   00027A   EE           MOV       A,R6
   \   00027B   6480         XRL       A,#0x80
   \                     ??zclSampleSw_event_loop_4:
   \   00027D   FA           MOV       R2,A
   \   00027E   EF           MOV       A,R7
   \   00027F   02....       LJMP      ??zclSampleSw_event_loop_1 & 0xFFFF
    744            }
    745            
    746            // Groupcast event
    747            if ( events & SAMPLEAPP_GROUPCAST_EVT )
   \                     ??zclSampleSw_event_loop_19:
   \   000282   EF           MOV       A,R7
   \   000283   5401         ANL       A,#0x1
   \   000285   7003         JNZ       $+5
   \   000287   02....       LJMP      ??zclSampleSw_event_loop_20 & 0xFFFF
    748            {
    749              zclSampleSw_AF_Groupcast(GROUP_ID,
    750                                       CLUSTER_GROUPCAST,
    751                                       10, "Groupcast");
   \   00028A   7408         MOV       A,#0x8
   \   00028C   12....       LCALL     ?XSTACK_DISP0_8
   \   00028F   7401         MOV       A,#0x1
   \   000291   F0           MOVX      @DPTR,A
   \   000292   85..82       MOV       DPL,?XSP + 0
   \   000295   85..83       MOV       DPH,?XSP + 1
   \   000298   7415         MOV       A,#0x15
   \   00029A   F0           MOVX      @DPTR,A
   \   00029B   A3           INC       DPTR
   \   00029C   E4           CLR       A
   \   00029D   F0           MOVX      @DPTR,A
   \   00029E   7409         MOV       A,#0x9
   \   0002A0   12....       LCALL     ?XSTACK_DISP0_8
   \   0002A3   7408         MOV       A,#0x8
   \   0002A5   F0           MOVX      @DPTR,A
   \   0002A6   90....       MOV       DPTR,#??transferId_1
   \   0002A9   12....       LCALL     ?Subroutine11 & 0xFFFF
   \                     ??CrossCallReturnLabel_15:
   \   0002AC   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   0002AF   75....       MOV       ?V0,#??transferId_1 & 0xff
   \   0002B2   75....       MOV       ?V1,#(??transferId_1 >> 8) & 0xff
   \   0002B5   78..         MOV       R0,#?V0
   \   0002B7   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0002BA   75....       MOV       ?V0,#`?<Constant "Groupcast">` & 0xff
   \   0002BD   75....       MOV       ?V1,#(`?<Constant "Groupcast">` >> 8) & 0xff
   \   0002C0   78..         MOV       R0,#?V0
   \   0002C2   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0002C5   75..0A       MOV       ?V0,#0xa
   \   0002C8   75..00       MOV       ?V1,#0x0
   \   0002CB   78..         MOV       R0,#?V0
   \   0002CD   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0002D0   75..02       MOV       ?V0,#0x2
   \   0002D3   78..         MOV       R0,#?V0
   \   0002D5   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0002D8   7900         MOV       R1,#0x0
   \   0002DA   7C..         MOV       R4,#sampleSw_TestEp & 0xff
   \   0002DC   7D..         MOV       R5,#(sampleSw_TestEp >> 8) & 0xff
   \   0002DE   7409         MOV       A,#0x9
   \   0002E0   12....       LCALL     ?XSTACK_DISP101_8
   \   0002E3   12....       LCALL     `??AF_DataRequest::?relay`; Banked call to: AF_DataRequest
   \   0002E6   7409         MOV       A,#0x9
   \   0002E8   12....       LCALL     ?DEALLOC_XSTACK8
    752              
    753              osal_start_timerEx(zclSampleSw_TaskID, 
    754                               SAMPLEAPP_GROUPCAST_EVT, 
    755                               SAMPLEAPP_GROUPCAST_PERIOD);
   \   0002EB                ; Setup parameters for call to function osal_start_timerEx
   \   0002EB   90....       MOV       DPTR,#__Constant_3e8
   \   0002EE   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   0002F1   7A00         MOV       R2,#0x0
   \   0002F3   7B01         MOV       R3,#0x1
   \   0002F5   90....       MOV       DPTR,#zclSampleSw_TaskID
   \   0002F8   E0           MOVX      A,@DPTR
   \   0002F9   F9           MOV       R1,A
   \   0002FA   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   0002FD   7404         MOV       A,#0x4
   \   0002FF   12....       LCALL     ?DEALLOC_XSTACK8
    756              
    757              return ( events ^ SAMPLEAPP_GROUPCAST_EVT );
   \   000302   EE           MOV       A,R6
   \   000303   FA           MOV       R2,A
   \   000304   EF           MOV       A,R7
   \   000305   6401         XRL       A,#0x1
   \                     ??zclSampleSw_event_loop_1:
   \   000307   FB           MOV       R3,A
   \   000308   8004         SJMP      ??zclSampleSw_event_loop_21
    758            }
    759          
    760          #else
    761            if ( events & SAMPLEAPP_REJOIN_EVT )//如果事件类型为重新加入网络事件
    762            {
    763                 /* 重新加入网络 */
    764                 bdb_StartCommissioning(BDB_COMMISSIONING_MODE_NWK_STEERING |
    765                                             BDB_COMMISSIONING_MODE_FINDING_BINDING );
    766              
    767              return ( events ^ SAMPLEAPP_REJOIN_EVT );
    768            }
    769              // P2P Event
    770            if ( events & SAMPLEAPP_P2P_EVT )
    771            {
    772              zclSampleSw_AF_P2P(0x0000,
    773                                 CLUSTER_P2P,
    774                                 4, "P2P");
    775              
    776              osal_start_timerEx(zclSampleSw_TaskID, 
    777                               SAMPLEAPP_P2P_EVT, 
    778                               SAMPLEAPP_P2P_PERIOD);
    779              
    780              return ( events ^ SAMPLEAPP_P2P_EVT );
    781            }
    782            if ( events & SAMPLEAPP_REPORT_EVT )
    783              {
    784                  zclSampleSw_ReportTest();//属性上报事件的处理函数
    785              
    786                  //启动下一个属性上报事件
    787                  osal_start_timerEx(zclSampleSw_TaskID,
    788                               SAMPLEAPP_REPORT_EVT, 
    789                               SAMPLEAPP_REPORT_PERIOD);
    790                
    791                return ( events ^ SAMPLEAPP_REPORT_EVT );
    792            }
    793          #endif
    794            return 0;
   \                     ??zclSampleSw_event_loop_20:
   \   00030A   7A00         MOV       R2,#0x0
   \   00030C   7B00         MOV       R3,#0x0
   \                     ??zclSampleSw_event_loop_21:
   \   00030E   02....       LJMP      ?Subroutine0 & 0xFFFF
    795          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine10:
   \   000000   E0           MOVX      A,@DPTR
   \   000001   04           INC       A
   \   000002   F0           MOVX      @DPTR,A
   \   000003                ; Setup parameters for call to function HalLcdWriteStringValue
   \   000003                ; Setup parameters for call to function HalLcdWriteStringValue
   \   000003   75..03       MOV       ?V2,#0x3
   \   000006   78..         MOV       R0,#?V2
   \   000008   22           RET
    796          
    797          /*********************************************************************
    798           * @fn      zclSampleSw_HandleKeys
    799           *
    800           * @brief   Handles all key events for this device.
    801           *
    802           * @param   shift - true if in shift/alt.
    803           * @param   keys - bit field for key events. Valid entries:
    804           *                 HAL_KEY_SW_5
    805           *                 HAL_KEY_SW_4
    806           *                 HAL_KEY_SW_2
    807           *                 HAL_KEY_SW_1
    808           *
    809           * @return  none
    810           */
    811          static void zclSampleSw_HandleKeys( byte shift, byte keys )
    812          {
    813            UI_MainStateMachine(keys);
    814          }
    815          
    816          
    817          /*********************************************************************
    818           * @fn      zclSampleSw_ProcessCommissioningStatus
    819           *
    820           * @brief   Callback in which the status of the commissioning process are reported
    821           *
    822           * @param   bdbCommissioningModeMsg - Context message of the status of a commissioning process
    823           *
    824           * @return  none
    825           */
    826          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    827          static void zclSampleSw_ProcessCommissioningStatus(bdbCommissioningModeMsg_t *bdbCommissioningModeMsg)
   \                     zclSampleSw_ProcessCommissioningStatus:
    828          {
   \   000000   74F7         MOV       A,#-0x9
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV       A,R2
   \   000006   FE           MOV       R6,A
   \   000007   EB           MOV       A,R3
   \   000008   FF           MOV       R7,A
    829            switch(bdbCommissioningModeMsg->bdbCommissioningMode)
   \   000009   8E82         MOV       DPL,R6
   \   00000B   8F83         MOV       DPH,R7
   \   00000D   A3           INC       DPTR
   \   00000E   E0           MOVX      A,@DPTR
   \   00000F   14           DEC       A
   \   000010   601F         JZ        ??zclSampleSw_ProcessCommissioningStatus_0
   \   000012   14           DEC       A
   \   000013   702A         JNZ       ??zclSampleSw_ProcessCommissioningStatus_1
    830            {
    831              case BDB_COMMISSIONING_FORMATION:
    832                if(bdbCommissioningModeMsg->bdbCommissioningStatus == BDB_COMMISSIONING_SUCCESS)
   \   000015   8E82         MOV       DPL,R6
   \   000017   8F83         MOV       DPH,R7
   \   000019   E0           MOVX      A,@DPTR
   \   00001A   700F         JNZ       ??zclSampleSw_ProcessCommissioningStatus_2
    833                {
    834                  //After formation, perform nwk steering again plus the remaining commissioning modes that has not been processed yet
    835                  bdb_StartCommissioning(BDB_COMMISSIONING_MODE_NWK_STEERING | bdbCommissioningModeMsg->bdbRemainingCommissioningModes);
   \   00001C                ; Setup parameters for call to function bdb_StartCommissioning
   \   00001C   A3           INC       DPTR
   \   00001D   A3           INC       DPTR
   \   00001E   E0           MOVX      A,@DPTR
   \   00001F   4402         ORL       A,#0x2
   \   000021   F9           MOV       R1,A
   \   000022   12....       LCALL     `??bdb_StartCommissioning::?relay`; Banked call to: bdb_StartCommissioning
    836                  printf("I have beem form 2332\n");
   \   000025                ; Setup parameters for call to function printf
   \   000025   7A..         MOV       R2,#`?<Constant "I have beem form 2332\\n">` & 0xff
   \   000027   7B..         MOV       R3,#(`?<Constant "I have beem form 2332\\n">` >> 8) & 0xff
   \   000029   8011         SJMP      ??zclSampleSw_ProcessCommissioningStatus_3
    837                }
    838                else
    839                {
    840                  //printf("faild");
    841                  /* 协调器 */
    842                  #ifdef ZDO_COORDINATOR
    843                  printf("faild\n");
   \                     ??zclSampleSw_ProcessCommissioningStatus_2:
   \   00002B                ; Setup parameters for call to function printf
   \   00002B   7A..         MOV       R2,#`?<Constant "faild\\n">` & 0xff
   \   00002D   7B..         MOV       R3,#(`?<Constant "faild\\n">` >> 8) & 0xff
   \   00002F   800B         SJMP      ??zclSampleSw_ProcessCommissioningStatus_3
    844                  /* 路由器或者终端 */
    845                  #else
    846                      /* 启动重新加入事件 */
    847                  osal_start_timerEx(zclSampleSw_TaskID, 
    848                                             SAMPLEAPP_REJOIN_EVT, 
    849                                             SAMPLEAPP_REJOIN_PERIOD);
    850                  #endif
    851          
    852                  //Want to try other channels?
    853                  //try with bdb_setChannelAttribute
    854                }
    855              break;
    856              case BDB_COMMISSIONING_NWK_STEERING:
    857                if(bdbCommissioningModeMsg->bdbCommissioningStatus == BDB_COMMISSIONING_SUCCESS)
   \                     ??zclSampleSw_ProcessCommissioningStatus_0:
   \   000031   8E82         MOV       DPL,R6
   \   000033   8F83         MOV       DPH,R7
   \   000035   E0           MOVX      A,@DPTR
   \   000036   7007         JNZ       ??zclSampleSw_ProcessCommissioningStatus_1
    858                {
    859                  printf("i have been join 2332");
   \   000038                ; Setup parameters for call to function printf
   \   000038   7A..         MOV       R2,#`?<Constant "i have been join 2332">` & 0xff
   \   00003A   7B..         MOV       R3,#(`?<Constant "i have been join 2332">` >> 8) & 0xff
   \                     ??zclSampleSw_ProcessCommissioningStatus_3:
   \   00003C   12....       LCALL     `??printf::?relay`; Banked call to: printf
    860                  //YOUR JOB:
    861                  //We are on the nwk, what now?
    862                }
    863                else
    864                {
    865                  /* 协调器 */
    866                  #ifdef ZDO_COORDINATOR
    867                  /* 路由器或者终端 */
    868                  #else
    869                  /* 启动重新加入事件 */
    870                  osal_start_timerEx(zclSampleSw_TaskID, 
    871                                     SAMPLEAPP_REJOIN_EVT, 
    872                                     SAMPLEAPP_REJOIN_PERIOD);
    873                  #endif
    874          
    875                  //See the possible errors for nwk steering procedure
    876                  //No suitable networks found
    877                  //Want to try other channels?
    878                  //try with bdb_setChannelAttribute
    879                }
    880              break;
    881              case BDB_COMMISSIONING_FINDING_BINDING:
    882                if(bdbCommissioningModeMsg->bdbCommissioningStatus == BDB_COMMISSIONING_SUCCESS)
    883                {
    884                  //YOUR JOB:
    885                }
    886                else
    887                {
    888                  /* 协调器 */
    889                  #ifdef ZDO_COORDINATOR
    890                  /* 路由器或者终端 */
    891                  #else
    892                      /* 启动重新加入事件 */
    893                  osal_start_timerEx(zclSampleSw_TaskID, 
    894                                             SAMPLEAPP_REJOIN_EVT, 
    895                                             SAMPLEAPP_REJOIN_PERIOD);
    896                  #endif
    897          
    898                  //YOUR JOB:
    899                  //retry?, wait for user interaction?
    900                }
    901              break;
    902              case BDB_COMMISSIONING_INITIALIZATION:
    903                //Initialization notification can only be successful. Failure on initialization 
    904                //only happens for ZED and is notified as BDB_COMMISSIONING_PARENT_LOST notification
    905                
    906                //YOUR JOB:
    907                //We are on a network, what now?
    908                
    909              break;
    910          #if ZG_BUILD_ENDDEVICE_TYPE    
    911              case BDB_COMMISSIONING_PARENT_LOST:
    912                if(bdbCommissioningModeMsg->bdbCommissioningStatus == BDB_COMMISSIONING_NETWORK_RESTORED)
    913                {
    914                  //We did recover from losing parent
    915                }
    916                else
    917                {
    918                  //Parent not found, attempt to rejoin again after a fixed delay
    919                  osal_start_timerEx(zclSampleSw_TaskID, SAMPLEAPP_END_DEVICE_REJOIN_EVT, SAMPLEAPP_END_DEVICE_REJOIN_DELAY);
    920                }
    921              break;
    922          #endif 
    923            }
    924            
    925            UI_UpdateComissioningStatus(bdbCommissioningModeMsg);
   \                     ??zclSampleSw_ProcessCommissioningStatus_1:
   \   00003F                ; Setup parameters for call to function UI_UpdateComissioningStatus
   \   00003F   EE           MOV       A,R6
   \   000040   FA           MOV       R2,A
   \   000041   EF           MOV       A,R7
   \   000042   FB           MOV       R3,A
   \   000043   12....       LCALL     `??UI_UpdateComissioningStatus::?relay`; Banked call to: UI_UpdateComissioningStatus
    926          }
   \   000046   7F01         MOV       R7,#0x1
   \   000048   02....       LJMP      ?BANKED_LEAVE_XDATA
    927          
    928          /*********************************************************************
    929           * @fn      zclSampleSw_BasicResetCB
    930           *
    931           * @brief   Callback from the ZCL General Cluster Library
    932           *          to set all the Basic Cluster attributes to  default values.
    933           *
    934           * @param   none
    935           *
    936           * @return  none
    937           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    938          static void zclSampleSw_BasicResetCB( void )
   \                     zclSampleSw_BasicResetCB:
    939          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    940            zclSampleSw_ResetAttributesToDefaultValues();
   \   000004                ; Setup parameters for call to function zclSampleSw_ResetAttributesToDefaultValues
   \   000004   12....       LCALL     `??zclSampleSw_ResetAttributesToDefaultValues::?`; Banked call to: zclSampleSw_ResetAttributesToDefaultValues
    941          
    942            // update the display
    943            UI_UpdateLcd( ); 
   \   000007                ; Setup parameters for call to function UI_UpdateLcd
   \   000007   12....       LCALL     `??UI_UpdateLcd::?relay`; Banked call to: UI_UpdateLcd
    944          }
   \   00000A                REQUIRE ?Subroutine2
   \   00000A                ; // Fall through to label ?Subroutine2

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   D083         POP       DPH
   \   000002   D082         POP       DPL
   \   000004   02....       LJMP      ?BRET
    945          
    946          /*********************************************************************
    947           * @fn      zclSampleApp_BatteryWarningCB
    948           *
    949           * @brief   Called to handle battery-low situation.
    950           *
    951           * @param   voltLevel - level of severity
    952           *
    953           * @return  none
    954           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    955          void zclSampleApp_BatteryWarningCB( uint8 voltLevel )
   \                     zclSampleApp_BatteryWarningCB:
    956          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    957            if ( voltLevel == VOLT_LEVEL_CAUTIOUS )
    958            {
    959              // Send warning message to the gateway and blink LED
    960            }
    961            else if ( voltLevel == VOLT_LEVEL_BAD )
    962            {
    963              // Shut down the system
    964            }
    965          }
   \   000000   02....       LJMP      ?BRET
    966          
    967          /******************************************************************************
    968           *
    969           *  Functions for processing ZCL Foundation incoming Command/Response messages
    970           *
    971           *****************************************************************************/
    972          
    973          /*********************************************************************
    974           * @fn      zclSampleSw_ProcessIncomingMsg
    975           *
    976           * @brief   Process ZCL Foundation incoming message
    977           *
    978           * @param   pInMsg - pointer to the received message
    979           *
    980           * @return  none
    981           */
    982          #ifdef ZCL_REPORT  
    983          static uint8 zclSampleSw_ProcessInReportCmd( zclIncomingMsg_t *pInMsg )  
    984          {  
    985              zclReportCmd_t *reportCmd;  
    986              uint8 i;  
    987          
    988              reportCmd = (zclReportCmd_t *)pInMsg->attrCmd;  
    989          
    990              for ( i = 0; i < reportCmd->numAttr; i++ )//reportCmd->numAttr为属性数量
    991              {  
    992                   if( pInMsg->clusterId == ZCL_CLUSTER_ID_GEN_ON_OFF_SWITCH_CONFIG//Cluster ID
    993          && reportCmd->attrList[i].attrID == ATTRID_ON_OFF_SWITCH_TYPE)//属性ID
    994                  {  
    995                      int8 attrDat = *(reportCmd->attrList[i].attrData);//读取属性值
    996                      HalLcdWriteStringValue("Rx Value:", attrDat, 10, 4);//显示属性值
    997                  }  
    998              }  
    999              return ( TRUE );  
   1000          }  
   1001          #endif // ZCL_REPORT

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1002          static void zclSampleSw_ProcessIncomingMsg( zclIncomingMsg_t *pInMsg )
   \                     zclSampleSw_ProcessIncomingMsg:
   1003          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000                REQUIRE ?V4
   \   000000                REQUIRE ?V5
   \   000000   74F2         MOV       A,#-0xe
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   1004            switch ( pInMsg->zclHdr.commandID )
   \   000005   EA           MOV       A,R2
   \   000006   2408         ADD       A,#0x8
   \   000008   F5..         MOV       ?V2,A
   \   00000A   E4           CLR       A
   \   00000B   3B           ADDC      A,R3
   \   00000C   F5..         MOV       ?V3,A
   \   00000E   EA           MOV       A,R2
   \   00000F   2417         ADD       A,#0x17
   \   000011   FE           MOV       R6,A
   \   000012   E4           CLR       A
   \   000013   3B           ADDC      A,R3
   \   000014   FF           MOV       R7,A
   \   000015   8A82         MOV       DPL,R2
   \   000017   8B83         MOV       DPH,R3
   \   000019   A3           INC       DPTR
   \   00001A   A3           INC       DPTR
   \   00001B   A3           INC       DPTR
   \   00001C   A3           INC       DPTR
   \   00001D   A3           INC       DPTR
   \   00001E   A3           INC       DPTR
   \   00001F   A3           INC       DPTR
   \   000020   E0           MOVX      A,@DPTR
   \   000021   14           DEC       A
   \   000022   602A         JZ        ??zclSampleSw_ProcessIncomingMsg_0
   \   000024   24FD         ADD       A,#-0x3
   \   000026   607D         JZ        ??zclSampleSw_ProcessIncomingMsg_1
   \   000028   24FA         ADD       A,#-0x6
   \   00002A   7003         JNZ       $+5
   \   00002C   02....       LJMP      ??zclSampleSw_ProcessIncomingMsg_2 & 0xFFFF
   \   00002F   24FD         ADD       A,#-0x3
   \   000031   7003         JNZ       $+5
   \   000033   02....       LJMP      ??zclSampleSw_ProcessIncomingMsg_3 & 0xFFFF
   \   000036   24FB         ADD       A,#-0x5
   \   000038   7003         JNZ       $+5
   \   00003A   02....       LJMP      ??zclSampleSw_ProcessIncomingMsg_4 & 0xFFFF
   \   00003D   24FE         ADD       A,#-0x2
   \   00003F   7003         JNZ       $+5
   \   000041   02....       LJMP      ??zclSampleSw_ProcessIncomingMsg_4 & 0xFFFF
   \   000044   24FE         ADD       A,#-0x2
   \   000046   7003         JNZ       $+5
   \   000048   02....       LJMP      ??zclSampleSw_ProcessIncomingMsg_5 & 0xFFFF
   \   00004B   02....       LJMP      ??zclSampleSw_ProcessIncomingMsg_6 & 0xFFFF
   1005            {
   1006          #ifdef ZCL_READ
   1007              case ZCL_CMD_READ_RSP:
   1008                zclSampleSw_ProcessInReadRspCmd( pInMsg );
   \                     ??zclSampleSw_ProcessIncomingMsg_0:
   \   00004E   12....       LCALL     ?Subroutine9 & 0xFFFF
   \                     ??CrossCallReturnLabel_10:
   \   000051   85..82       MOV       DPL,?V0
   \   000054   85..83       MOV       DPH,?V1
   \   000057   E0           MOVX      A,@DPTR
   \   000058   F8           MOV       R0,A
   \   000059   E5..         MOV       A,?V4
   \   00005B   C3           CLR       C
   \   00005C   98           SUBB      A,R0
   \   00005D   4003         JC        $+5
   \   00005F   02....       LJMP      ??zclSampleSw_ProcessIncomingMsg_6 & 0xFFFF
   \   000062   85..82       MOV       DPL,?V2
   \   000065   85..83       MOV       DPH,?V3
   \   000068   E0           MOVX      A,@DPTR
   \   000069   6407         XRL       A,#0x7
   \   00006B   7002         JNZ       ??zclSampleSw_ProcessIncomingMsg_7
   \   00006D   A3           INC       DPTR
   \   00006E   E0           MOVX      A,@DPTR
   \                     ??zclSampleSw_ProcessIncomingMsg_7:
   \   00006F   7030         JNZ       ??zclSampleSw_ProcessIncomingMsg_8
   \   000071   E5..         MOV       A,?V4
   \   000073   75F006       MOV       B,#0x6
   \   000076   12....       LCALL     ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   000079   6410         XRL       A,#0x10
   \   00007B   7002         JNZ       ??zclSampleSw_ProcessIncomingMsg_9
   \   00007D   A3           INC       DPTR
   \   00007E   E0           MOVX      A,@DPTR
   \                     ??zclSampleSw_ProcessIncomingMsg_9:
   \   00007F   7020         JNZ       ??zclSampleSw_ProcessIncomingMsg_8
   \   000081                ; Setup parameters for call to function HalLcdWriteStringValue
   \   000081   75..04       MOV       ?V5,#0x4
   \   000084   78..         MOV       R0,#?V5
   \   000086   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   000089   790A         MOV       R1,#0xa
   \   00008B   8A82         MOV       DPL,R2
   \   00008D   8B83         MOV       DPH,R3
   \   00008F   A3           INC       DPTR
   \   000090   12....       LCALL     ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   000093   7D00         MOV       R5,#0x0
   \   000095   7A..         MOV       R2,#`?<Constant "Read:">` & 0xff
   \   000097   7B..         MOV       R3,#(`?<Constant "Read:">` >> 8) & 0xff
   \   000099   12....       LCALL     `??HalLcdWriteStringValue::?relay`; Banked call to: HalLcdWriteStringValue
   \   00009C   7401         MOV       A,#0x1
   \   00009E   12....       LCALL     ?DEALLOC_XSTACK8
   \                     ??zclSampleSw_ProcessIncomingMsg_8:
   \   0000A1   05..         INC       ?V4
   \   0000A3   80AC         SJMP      ??CrossCallReturnLabel_10
   1009                break;
   1010          #endif
   1011          #ifdef ZCL_WRITE
   1012              case ZCL_CMD_WRITE_RSP:
   1013                zclSampleSw_ProcessInWriteRspCmd( pInMsg );
   \                     ??zclSampleSw_ProcessIncomingMsg_1:
   \   0000A5   8E82         MOV       DPL,R6
   \   0000A7   8F83         MOV       DPH,R7
   \   0000A9   E0           MOVX      A,@DPTR
   \   0000AA   F8           MOV       R0,A
   \   0000AB   A3           INC       DPTR
   \   0000AC   E0           MOVX      A,@DPTR
   \   0000AD   F9           MOV       R1,A
   \   0000AE   8882         MOV       DPL,R0
   \   0000B0   8983         MOV       DPH,R1
   \   0000B2   7800         MOV       R0,#0x0
   \                     ??zclSampleSw_ProcessIncomingMsg_10:
   \   0000B4   E0           MOVX      A,@DPTR
   \   0000B5   F9           MOV       R1,A
   \   0000B6   E8           MOV       A,R0
   \   0000B7   C3           CLR       C
   \   0000B8   99           SUBB      A,R1
   \   0000B9   4003         JC        $+5
   \   0000BB   02....       LJMP      ??zclSampleSw_ProcessIncomingMsg_6 & 0xFFFF
   \   0000BE   08           INC       R0
   \   0000BF   80F3         SJMP      ??zclSampleSw_ProcessIncomingMsg_10
   1014                break;
   1015          #endif
   1016          #ifdef ZCL_REPORT
   1017          
   1018              // See ZCL Test Applicaiton (zcl_testapp.c) for sample code on Attribute Reporting
   1019              case ZCL_CMD_CONFIG_REPORT:
   1020                //zclSampleSw_ProcessInConfigReportCmd( pInMsg );
   1021                break;
   1022          
   1023              case ZCL_CMD_CONFIG_REPORT_RSP:
   1024                //zclSampleSw_ProcessInConfigReportRspCmd( pInMsg );
   1025                break;
   1026          
   1027              case ZCL_CMD_READ_REPORT_CFG:
   1028                //zclSampleSw_ProcessInReadReportCfgCmd( pInMsg );
   1029                break;
   1030          
   1031              case ZCL_CMD_READ_REPORT_CFG_RSP:
   1032                //zclSampleSw_ProcessInReadReportCfgRspCmd( pInMsg );
   1033                break;
   1034          
   1035              case ZCL_CMD_REPORT:
   1036                zclSampleSw_ProcessInReportCmd( pInMsg );
   \                     ??zclSampleSw_ProcessIncomingMsg_2:
   \   0000C1   12....       LCALL     ?Subroutine9 & 0xFFFF
   \                     ??CrossCallReturnLabel_11:
   \   0000C4   85..82       MOV       DPL,?V0
   \   0000C7   85..83       MOV       DPH,?V1
   \   0000CA   E0           MOVX      A,@DPTR
   \   0000CB   F8           MOV       R0,A
   \   0000CC   E5..         MOV       A,?V4
   \   0000CE   C3           CLR       C
   \   0000CF   98           SUBB      A,R0
   \   0000D0   506D         JNC       ??zclSampleSw_ProcessIncomingMsg_6
   \   0000D2   85..82       MOV       DPL,?V2
   \   0000D5   85..83       MOV       DPH,?V3
   \   0000D8   E0           MOVX      A,@DPTR
   \   0000D9   6407         XRL       A,#0x7
   \   0000DB   7002         JNZ       ??zclSampleSw_ProcessIncomingMsg_11
   \   0000DD   A3           INC       DPTR
   \   0000DE   E0           MOVX      A,@DPTR
   \                     ??zclSampleSw_ProcessIncomingMsg_11:
   \   0000DF   7031         JNZ       ??zclSampleSw_ProcessIncomingMsg_12
   \   0000E1   E5..         MOV       A,?V4
   \   0000E3   75F005       MOV       B,#0x5
   \   0000E6   12....       LCALL     ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   0000E9   F8           MOV       R0,A
   \   0000EA   A3           INC       DPTR
   \   0000EB   E0           MOVX      A,@DPTR
   \   0000EC   F9           MOV       R1,A
   \   0000ED   E8           MOV       A,R0
   \   0000EE   49           ORL       A,R1
   \   0000EF   7021         JNZ       ??zclSampleSw_ProcessIncomingMsg_12
   \   0000F1                ; Setup parameters for call to function HalLcdWriteStringValue
   \   0000F1   75..04       MOV       ?V5,#0x4
   \   0000F4   78..         MOV       R0,#?V5
   \   0000F6   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   0000F9   790A         MOV       R1,#0xa
   \   0000FB   8A82         MOV       DPL,R2
   \   0000FD   8B83         MOV       DPH,R3
   \   0000FF   12....       LCALL     ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_9:
   \   000102   33           RLC       A
   \   000103   95E0         SUBB      A,0xE0 /* A   */
   \   000105   FD           MOV       R5,A
   \   000106   7A..         MOV       R2,#`?<Constant "Rx Value:">` & 0xff
   \   000108   7B..         MOV       R3,#(`?<Constant "Rx Value:">` >> 8) & 0xff
   \   00010A   12....       LCALL     `??HalLcdWriteStringValue::?relay`; Banked call to: HalLcdWriteStringValue
   \   00010D   7401         MOV       A,#0x1
   \   00010F   12....       LCALL     ?DEALLOC_XSTACK8
   \                     ??zclSampleSw_ProcessIncomingMsg_12:
   \   000112   05..         INC       ?V4
   \   000114   80AE         SJMP      ??CrossCallReturnLabel_11
   1037                break;
   1038          #endif
   1039              case ZCL_CMD_DEFAULT_RSP:
   1040                zclSampleSw_ProcessInDefaultRspCmd( pInMsg );
   1041                break;
   1042          
   1043          #ifdef ZCL_DISCOVER
   1044              case ZCL_CMD_DISCOVER_CMDS_RECEIVED_RSP:
   1045                zclSampleSw_ProcessInDiscCmdsRspCmd( pInMsg );
   \                     ??zclSampleSw_ProcessIncomingMsg_4:
   \   000116                ; Setup parameters for call to function zclSampleSw_ProcessInDiscCmdsRspCmd
   1046                break;
   1047          
   1048              case ZCL_CMD_DISCOVER_CMDS_GEN_RSP:
   1049                zclSampleSw_ProcessInDiscCmdsRspCmd( pInMsg );
   \   000116                ; Setup parameters for call to function zclSampleSw_ProcessInDiscCmdsRspCmd
   \   000116   12....       LCALL     `??zclSampleSw_ProcessInDiscCmdsRspCmd::?relay`; Banked call to: zclSampleSw_ProcessInDiscCmdsRspCmd
   1050                break;
   \   000119   8024         SJMP      ??zclSampleSw_ProcessIncomingMsg_6
   1051          
   1052              case ZCL_CMD_DISCOVER_ATTRS_RSP:
   1053                zclSampleSw_ProcessInDiscAttrsRspCmd( pInMsg );
   \                     ??zclSampleSw_ProcessIncomingMsg_3:
   \   00011B   12....       LCALL     ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_19:
   \   00011E   8882         MOV       DPL,R0
   \   000120   8983         MOV       DPH,R1
   \   000122   A3           INC       DPTR
   \   000123   E0           MOVX      A,@DPTR
   \   000124   FB           MOV       R3,A
   \   000125   EA           MOV       A,R2
   \   000126   C3           CLR       C
   \   000127   9B           SUBB      A,R3
   \   000128   5015         JNC       ??zclSampleSw_ProcessIncomingMsg_6
   \   00012A   0A           INC       R2
   \   00012B   80F1         SJMP      ??CrossCallReturnLabel_19
   1054                break;
   1055          
   1056              case ZCL_CMD_DISCOVER_ATTRS_EXT_RSP:
   1057                zclSampleSw_ProcessInDiscAttrsExtRspCmd( pInMsg );
   \                     ??zclSampleSw_ProcessIncomingMsg_5:
   \   00012D   12....       LCALL     ?Subroutine6 & 0xFFFF
   1058                break;
   1059          #endif
   1060              default:
   1061                break;
   1062            }
   \                     ??CrossCallReturnLabel_20:
   \   000130   8001         SJMP      ??zclSampleSw_ProcessIncomingMsg_13
   \                     ??zclSampleSw_ProcessIncomingMsg_14:
   \   000132   0A           INC       R2
   \                     ??zclSampleSw_ProcessIncomingMsg_13:
   \   000133   8882         MOV       DPL,R0
   \   000135   8983         MOV       DPH,R1
   \   000137   A3           INC       DPTR
   \   000138   E0           MOVX      A,@DPTR
   \   000139   FB           MOV       R3,A
   \   00013A   EA           MOV       A,R2
   \   00013B   C3           CLR       C
   \   00013C   9B           SUBB      A,R3
   \   00013D   40F3         JC        ??zclSampleSw_ProcessIncomingMsg_14
   1063          
   1064            if ( pInMsg->attrCmd )
   \                     ??zclSampleSw_ProcessIncomingMsg_6:
   \   00013F   8E82         MOV       DPL,R6
   \   000141   8F83         MOV       DPH,R7
   \   000143   E0           MOVX      A,@DPTR
   \   000144   FA           MOV       R2,A
   \   000145   A3           INC       DPTR
   \   000146   E0           MOVX      A,@DPTR
   \   000147   FB           MOV       R3,A
   \   000148   EA           MOV       A,R2
   \   000149   4B           ORL       A,R3
   \   00014A   6003         JZ        ??zclSampleSw_ProcessIncomingMsg_15
   1065              osal_mem_free( pInMsg->attrCmd );
   \   00014C                ; Setup parameters for call to function osal_mem_free
   \   00014C   12....       LCALL     `??osal_mem_free::?relay`; Banked call to: osal_mem_free
   1066          }
   \                     ??zclSampleSw_ProcessIncomingMsg_15:
   \   00014F   7F06         MOV       R7,#0x6
   \   000151   02....       LJMP      ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine9:
   \   000000   8E82         MOV       DPL,R6
   \   000002   8F83         MOV       DPH,R7
   \   000004   E0           MOVX      A,@DPTR
   \   000005   F5..         MOV       ?V0,A
   \   000007   A3           INC       DPTR
   \   000008   E0           MOVX      A,@DPTR
   \   000009   F5..         MOV       ?V1,A
   \   00000B   75..00       MOV       ?V4,#0x0
   \   00000E   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine8:
   \   000000   A3           INC       DPTR
   \   000001   A3           INC       DPTR
   \   000002   A3           INC       DPTR
   \   000003   A3           INC       DPTR
   \   000004   12....       LCALL     ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_17:
   \   000007   E0           MOVX      A,@DPTR
   \   000008   FC           MOV       R4,A
   \   000009   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   8E82         MOV       DPL,R6
   \   000002   8F83         MOV       DPH,R7
   \   000004                REQUIRE ??Subroutine13_0
   \   000004                ; // Fall through to label ??Subroutine13_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine13_0:
   \   000000   E0           MOVX      A,@DPTR
   \   000001   F8           MOV       R0,A
   \   000002   A3           INC       DPTR
   \   000003   E0           MOVX      A,@DPTR
   \   000004   F9           MOV       R1,A
   \   000005   7A00         MOV       R2,#0x0
   \   000007   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   A4           MUL       AB
   \   000001   F8           MOV       R0,A
   \   000002   A9F0         MOV       R1,B
   \   000004   E5..         MOV       A,?V0
   \   000006   28           ADD       A,R0
   \   000007   F8           MOV       R0,A
   \   000008   E5..         MOV       A,?V1
   \   00000A   39           ADDC      A,R1
   \   00000B   F9           MOV       R1,A
   \   00000C   E8           MOV       A,R0
   \   00000D   FA           MOV       R2,A
   \   00000E   E9           MOV       A,R1
   \   00000F   FB           MOV       R3,A
   \   000010   8A82         MOV       DPL,R2
   \   000012   8B83         MOV       DPH,R3
   \   000014   A3           INC       DPTR
   \   000015   E0           MOVX      A,@DPTR
   \   000016   22           RET
   1067          
   1068          #ifdef ZCL_READ
   1069          /*********************************************************************
   1070           * @fn      zclSampleSw_ProcessInReadRspCmd
   1071           *
   1072           * @brief   Process the "Profile" Read Response Command
   1073           *
   1074           * @param   pInMsg - incoming message to process
   1075           *
   1076           * @return  none
   1077           */
   1078          static uint8 zclSampleSw_ProcessInReadRspCmd( zclIncomingMsg_t *pInMsg )
   1079          {
   1080            zclReadRspCmd_t *readRspCmd;
   1081            uint8 i;
   1082          
   1083            readRspCmd = (zclReadRspCmd_t *)pInMsg->attrCmd;
   1084            for (i = 0; i < readRspCmd->numAttr; i++)
   1085            {
   1086              // Notify the originator of the results of the original read attributes
   1087              // attempt and, for each successfull request, the value of the requested
   1088              // attribute
   1089              if( pInMsg->clusterId == ZCL_CLUSTER_ID_GEN_ON_OFF_SWITCH_CONFIG &&//如果该消息是关于指定的Cluster
   1090                  readRspCmd->attrList[i].attrID == ATTRID_ON_OFF_SWITCH_ACTIONS )//如果该属性的ID是指定的属性ID
   1091              {
   1092                  uint8 val;
   1093                  val = *(readRspCmd->attrList[i].data);//读取属性值
   1094                  
   1095                  HalLcdWriteStringValue("Read:", val, 10, 4);//显示信息到屏幕中
   1096              }
   1097            }
   1098          
   1099            return TRUE;
   1100          }
   1101          #endif // ZCL_READ
   1102          
   1103          #ifdef ZCL_WRITE
   1104          /*********************************************************************
   1105           * @fn      zclSampleSw_ProcessInWriteRspCmd
   1106           *
   1107           * @brief   Process the "Profile" Write Response Command
   1108           *
   1109           * @param   pInMsg - incoming message to process
   1110           *
   1111           * @return  none
   1112           */
   1113          static uint8 zclSampleSw_ProcessInWriteRspCmd( zclIncomingMsg_t *pInMsg )
   1114          {
   1115            zclWriteRspCmd_t *writeRspCmd;
   1116            uint8 i;
   1117          
   1118            writeRspCmd = (zclWriteRspCmd_t *)pInMsg->attrCmd;
   1119            for (i = 0; i < writeRspCmd->numAttr; i++)
   1120            {
   1121              // Notify the device of the results of the its original write attributes
   1122              // command.
   1123            }
   1124          
   1125            return TRUE;
   1126          }
   1127          #endif // ZCL_WRITE
   1128          
   1129          /*********************************************************************
   1130           * @fn      zclSampleSw_ProcessInDefaultRspCmd
   1131           *
   1132           * @brief   Process the "Profile" Default Response Command
   1133           *
   1134           * @param   pInMsg - incoming message to process
   1135           *
   1136           * @return  none
   1137           */
   1138          static uint8 zclSampleSw_ProcessInDefaultRspCmd( zclIncomingMsg_t *pInMsg )
   1139          {
   1140            // zclDefaultRspCmd_t *defaultRspCmd = (zclDefaultRspCmd_t *)pInMsg->attrCmd;
   1141            // Device is notified of the Default Response command.
   1142            (void)pInMsg;
   1143            return TRUE;
   1144          }
   1145          
   1146          #ifdef ZCL_DISCOVER
   1147          /*********************************************************************
   1148           * @fn      zclSampleSw_ProcessInDiscCmdsRspCmd
   1149           *
   1150           * @brief   Process the Discover Commands Response Command
   1151           *
   1152           * @param   pInMsg - incoming message to process
   1153           *
   1154           * @return  none
   1155           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1156          static uint8 zclSampleSw_ProcessInDiscCmdsRspCmd( zclIncomingMsg_t *pInMsg )
   \                     zclSampleSw_ProcessInDiscCmdsRspCmd:
   1157          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1158            zclDiscoverCmdsCmdRsp_t *discoverRspCmd;
   1159            uint8 i;
   1160          
   1161            discoverRspCmd = (zclDiscoverCmdsCmdRsp_t *)pInMsg->attrCmd;
   \   000004   EA           MOV       A,R2
   \   000005   2417         ADD       A,#0x17
   \   000007   F582         MOV       DPL,A
   \   000009   E4           CLR       A
   \   00000A   3B           ADDC      A,R3
   \   00000B   F583         MOV       DPH,A
   \   00000D   12....       LCALL     ??Subroutine13_0 & 0xFFFF
   1162            for ( i = 0; i < discoverRspCmd->numCmd; i++ )
   \                     ??CrossCallReturnLabel_18:
   \   000010   8001         SJMP      ??zclSampleSw_ProcessInDiscCmdsRspCmd_0
   \                     ??zclSampleSw_ProcessInDiscCmdsRspCmd_1:
   \   000012   0A           INC       R2
   \                     ??zclSampleSw_ProcessInDiscCmdsRspCmd_0:
   \   000013   8882         MOV       DPL,R0
   \   000015   8983         MOV       DPH,R1
   \   000017   A3           INC       DPTR
   \   000018   A3           INC       DPTR
   \   000019   E0           MOVX      A,@DPTR
   \   00001A   FB           MOV       R3,A
   \   00001B   EA           MOV       A,R2
   \   00001C   C3           CLR       C
   \   00001D   9B           SUBB      A,R3
   \   00001E   40F2         JC        ??zclSampleSw_ProcessInDiscCmdsRspCmd_1
   1163            {
   1164              // Device is notified of the result of its attribute discovery command.
   1165            }
   1166          
   1167            return TRUE;
   \   000020   7901         MOV       R1,#0x1
   \   000022   02....       LJMP      ?Subroutine2 & 0xFFFF
   1168          }
   1169          
   1170          /*********************************************************************
   1171           * @fn      zclSampleSw_ProcessInDiscAttrsRspCmd
   1172           *
   1173           * @brief   Process the "Profile" Discover Attributes Response Command
   1174           *
   1175           * @param   pInMsg - incoming message to process
   1176           *
   1177           * @return  none
   1178           */
   1179          static uint8 zclSampleSw_ProcessInDiscAttrsRspCmd( zclIncomingMsg_t *pInMsg )
   1180          {
   1181            zclDiscoverAttrsRspCmd_t *discoverRspCmd;
   1182            uint8 i;
   1183          
   1184            discoverRspCmd = (zclDiscoverAttrsRspCmd_t *)pInMsg->attrCmd;
   1185            for ( i = 0; i < discoverRspCmd->numAttr; i++ )
   1186            {
   1187              // Device is notified of the result of its attribute discovery command.
   1188            }
   1189          
   1190            return TRUE;
   1191          }
   1192          
   1193          /*********************************************************************
   1194           * @fn      zclSampleSw_ProcessInDiscAttrsExtRspCmd
   1195           *
   1196           * @brief   Process the "Profile" Discover Attributes Extended Response Command
   1197           *
   1198           * @param   pInMsg - incoming message to process
   1199           *
   1200           * @return  none
   1201           */
   1202          static uint8 zclSampleSw_ProcessInDiscAttrsExtRspCmd( zclIncomingMsg_t *pInMsg )
   1203          {
   1204            zclDiscoverAttrsExtRsp_t *discoverRspCmd;
   1205            uint8 i;
   1206          
   1207            discoverRspCmd = (zclDiscoverAttrsExtRsp_t *)pInMsg->attrCmd;
   1208            for ( i = 0; i < discoverRspCmd->numAttr; i++ )
   1209            {
   1210              // Device is notified of the result of its attribute discovery command.
   1211            }
   1212          
   1213            return TRUE;
   1214          }
   1215          #endif // ZCL_DISCOVER
   1216          
   1217          #if defined (OTA_CLIENT) && (OTA_CLIENT == TRUE)
   1218          /*********************************************************************
   1219           * @fn      zclSampleSw_ProcessOTAMsgs
   1220           *
   1221           * @brief   Called to process callbacks from the ZCL OTA.
   1222           *
   1223           * @param   none
   1224           *
   1225           * @return  none
   1226           */
   1227          static void zclSampleSw_ProcessOTAMsgs( zclOTA_CallbackMsg_t* pMsg )
   1228          {
   1229            uint8 RxOnIdle;
   1230          
   1231            switch(pMsg->ota_event)
   1232            {
   1233            case ZCL_OTA_START_CALLBACK:
   1234              if (pMsg->hdr.status == ZSuccess)
   1235              {
   1236                // Speed up the poll rate
   1237                RxOnIdle = TRUE;
   1238                ZMacSetReq( ZMacRxOnIdle, &RxOnIdle );
   1239                NLME_SetPollRate( 2000 );
   1240              }
   1241              break;
   1242          
   1243            case ZCL_OTA_DL_COMPLETE_CALLBACK:
   1244              if (pMsg->hdr.status == ZSuccess)
   1245              {
   1246                // Reset the CRC Shadow and reboot.  The bootloader will see the
   1247                // CRC shadow has been cleared and switch to the new image
   1248                HalOTAInvRC();
   1249                SystemReset();
   1250              }
   1251              else
   1252              {
   1253          #if (ZG_BUILD_ENDDEVICE_TYPE)    
   1254                // slow the poll rate back down.
   1255                RxOnIdle = FALSE;
   1256                ZMacSetReq( ZMacRxOnIdle, &RxOnIdle );
   1257                NLME_SetPollRate(DEVICE_POLL_RATE);
   1258          #endif
   1259              }
   1260              break;
   1261          
   1262            default:
   1263              break;
   1264            }
   1265          }
   1266          #endif // defined (OTA_CLIENT) && (OTA_CLIENT == TRUE)
   1267          
   1268          /****************************************************************************
   1269          ****************************************************************************/
   1270          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1271          void zclSampleSw_UiActionToggleLight(uint16 keys)
   \                     zclSampleSw_UiActionToggleLight:
   1272          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV       A,#-0xa
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1273            if (zclSampleSw_OnOffSwitchActions == ON_OFF_SWITCH_ACTIONS_TOGGLE)
   \   000005   EA           MOV       A,R2
   \   000006   5404         ANL       A,#0x4
   \   000008   F8           MOV       R0,A
   \   000009   90....       MOV       DPTR,#zclSampleSw_OnOffSwitchActions
   \   00000C   E0           MOVX      A,@DPTR
   \   00000D   6402         XRL       A,#0x2
   \   00000F   7042         JNZ       ??zclSampleSw_UiActionToggleLight_0
   1274            {
   1275              if (keys & UI_KEY_SW_5_PRESSED)
   \   000011   E8           MOV       A,R0
   \   000012   7003         JNZ       $+5
   \   000014   02....       LJMP      ??zclSampleSw_UiActionToggleLight_1 & 0xFFFF
   1276              {
   1277                zclGeneral_SendOnOff_CmdToggle( SAMPLESW_ENDPOINT, &zclSampleSw_DstAddr, FALSE, bdb_getZCLFrameCounter() );
   \   000017                ; Setup parameters for call to function bdb_getZCLFrameCounter
   \   000017   12....       LCALL     `??bdb_getZCLFrameCounter::?relay`; Banked call to: bdb_getZCLFrameCounter
   \   00001A   E9           MOV       A,R1
   \   00001B   F9           MOV       R1,A
   \   00001C                ; Setup parameters for call to function zcl_SendCommand
   \   00001C   E4           CLR       A
   \   00001D   F5..         MOV       ?V0,A
   \   00001F   F5..         MOV       ?V1,A
   \   000021   78..         MOV       R0,#?V0
   \   000023   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000026   78..         MOV       R0,#?V0
   \   000028   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00002B   E9           MOV       A,R1
   \   00002C   F5..         MOV       ?V0,A
   \   00002E   78..         MOV       R0,#?V0
   \   000030   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   000033   E4           CLR       A
   \   000034   F5..         MOV       ?V0,A
   \   000036   78..         MOV       R0,#?V0
   \   000038   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00003B   78..         MOV       R0,#?V0
   \   00003D   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   000040   78..         MOV       R0,#?V0
   \   000042   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   000045   75..01       MOV       ?V0,#0x1
   \   000048   78..         MOV       R0,#?V0
   \   00004A   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   00004D   75..02       MOV       ?V0,#0x2
   \   000050   02....       LJMP      ??zclSampleSw_UiActionToggleLight_2 & 0xFFFF
   1278              }
   1279            }
   1280            else if (((keys & UI_KEY_SW_5_PRESSED) && (zclSampleSw_OnOffSwitchActions == ON_OFF_SWITCH_ACTIONS_ON))
   1281              || ((keys & UI_KEY_SW_5_RELEASED) && (zclSampleSw_OnOffSwitchActions == ON_OFF_SWITCH_ACTIONS_OFF)))
   \                     ??zclSampleSw_UiActionToggleLight_0:
   \   000053   E8           MOV       A,R0
   \   000054   6003         JZ        ??zclSampleSw_UiActionToggleLight_3
   \   000056   E0           MOVX      A,@DPTR
   \   000057   600A         JZ        ??zclSampleSw_UiActionToggleLight_4
   \                     ??zclSampleSw_UiActionToggleLight_3:
   \   000059   EB           MOV       A,R3
   \   00005A   5404         ANL       A,#0x4
   \   00005C   603D         JZ        ??zclSampleSw_UiActionToggleLight_5
   \   00005E   E0           MOVX      A,@DPTR
   \   00005F   6401         XRL       A,#0x1
   \   000061   7038         JNZ       ??zclSampleSw_UiActionToggleLight_5
   1282            {
   1283              zclGeneral_SendOnOff_CmdOn( SAMPLESW_ENDPOINT, &zclSampleSw_DstAddr, FALSE, bdb_getZCLFrameCounter() );
   \                     ??zclSampleSw_UiActionToggleLight_4:
   \   000063                ; Setup parameters for call to function bdb_getZCLFrameCounter
   \   000063   12....       LCALL     `??bdb_getZCLFrameCounter::?relay`; Banked call to: bdb_getZCLFrameCounter
   \   000066   E9           MOV       A,R1
   \   000067   F9           MOV       R1,A
   \   000068                ; Setup parameters for call to function zcl_SendCommand
   \   000068   E4           CLR       A
   \   000069   F5..         MOV       ?V0,A
   \   00006B   F5..         MOV       ?V1,A
   \   00006D   78..         MOV       R0,#?V0
   \   00006F   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000072   78..         MOV       R0,#?V0
   \   000074   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000077   E9           MOV       A,R1
   \   000078   F5..         MOV       ?V0,A
   \   00007A   78..         MOV       R0,#?V0
   \   00007C   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   00007F   E4           CLR       A
   \   000080   F5..         MOV       ?V0,A
   \   000082   78..         MOV       R0,#?V0
   \   000084   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000087   78..         MOV       R0,#?V0
   \   000089   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   00008C   78..         MOV       R0,#?V0
   \   00008E   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   000091   75..01       MOV       ?V0,#0x1
   \   000094   78..         MOV       R0,#?V0
   \   000096   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   000099   8039         SJMP      ??zclSampleSw_UiActionToggleLight_2
   1284            }
   1285            else
   1286            {
   1287              zclGeneral_SendOnOff_CmdOff( SAMPLESW_ENDPOINT, &zclSampleSw_DstAddr, FALSE, bdb_getZCLFrameCounter() );
   \                     ??zclSampleSw_UiActionToggleLight_5:
   \   00009B                ; Setup parameters for call to function bdb_getZCLFrameCounter
   \   00009B   12....       LCALL     `??bdb_getZCLFrameCounter::?relay`; Banked call to: bdb_getZCLFrameCounter
   \   00009E   E9           MOV       A,R1
   \   00009F   F9           MOV       R1,A
   \   0000A0                ; Setup parameters for call to function zcl_SendCommand
   \   0000A0   E4           CLR       A
   \   0000A1   F5..         MOV       ?V0,A
   \   0000A3   F5..         MOV       ?V1,A
   \   0000A5   78..         MOV       R0,#?V0
   \   0000A7   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000AA   78..         MOV       R0,#?V0
   \   0000AC   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000AF   E9           MOV       A,R1
   \   0000B0   F5..         MOV       ?V0,A
   \   0000B2   78..         MOV       R0,#?V0
   \   0000B4   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   0000B7   E4           CLR       A
   \   0000B8   F5..         MOV       ?V0,A
   \   0000BA   78..         MOV       R0,#?V0
   \   0000BC   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000BF   78..         MOV       R0,#?V0
   \   0000C1   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   0000C4   78..         MOV       R0,#?V0
   \   0000C6   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   0000C9   75..01       MOV       ?V0,#0x1
   \   0000CC   78..         MOV       R0,#?V0
   \   0000CE   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   0000D1   75..00       MOV       ?V0,#0x0
   \                     ??zclSampleSw_UiActionToggleLight_2:
   \   0000D4   78..         MOV       R0,#?V0
   \   0000D6   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   0000D9   7C06         MOV       R4,#0x6
   \   0000DB   7D00         MOV       R5,#0x0
   \   0000DD   7A..         MOV       R2,#zclSampleSw_DstAddr & 0xff
   \   0000DF   7B..         MOV       R3,#(zclSampleSw_DstAddr >> 8) & 0xff
   \   0000E1   7908         MOV       R1,#0x8
   \   0000E3   12....       LCALL     `??zcl_SendCommand::?relay`; Banked call to: zcl_SendCommand
   \   0000E6   740B         MOV       A,#0xb
   \   0000E8   12....       LCALL     ?DEALLOC_XSTACK8
   1288            }
   1289          }
   \                     ??zclSampleSw_UiActionToggleLight_1:
   \   0000EB   02....       LJMP      ?Subroutine1 & 0xFFFF
   1290          
   1291          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1292          void zclSampleSw_UiUpdateLcd(uint8 gui_state, char * line[3])
   \                     zclSampleSw_UiUpdateLcd:
   1293          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1294            line[2] = "< TOGGLE LIGHT >";
   \   000004   8A82         MOV       DPL,R2
   \   000006   8B83         MOV       DPH,R3
   \   000008   A3           INC       DPTR
   \   000009   A3           INC       DPTR
   \   00000A   A3           INC       DPTR
   \   00000B   A3           INC       DPTR
   \   00000C   74..         MOV       A,#`?<Constant "< TOGGLE LIGHT >">` & 0xff
   \   00000E   F0           MOVX      @DPTR,A
   \   00000F   A3           INC       DPTR
   \   000010   74..         MOV       A,#(`?<Constant "< TOGGLE LIGHT >">` >> 8) & 0xff
   \   000012   F0           MOVX      @DPTR,A
   1295          }
   \   000013   02....       LJMP      ?Subroutine2 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine11:
   \   000000   E0           MOVX      A,@DPTR
   \   000001   04           INC       A
   \   000002   F0           MOVX      @DPTR,A
   \   000003                ; Setup parameters for call to function AF_DataRequest
   \   000003                ; Setup parameters for call to function AF_DataRequest
   \   000003   75..1E       MOV       ?V0,#0x1e
   \   000006   78..         MOV       R0,#?V0
   \   000008   22           RET

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zclSampleSw_OnOffSwitchType>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for sampleSw_TestEp>`:
   \   000000   08           DB 8
   \   000001   00           DB 0
   \   000002   ....         DW zclSampleSw_TaskID
   \   000004   0000         DW 0H
   \   000006   00           DB 0

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zclSampleSw_NwkState>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zclSampleSw_CmdCallbacks>`:
   \   000000   ....         DW `??zclSampleSw_BasicResetCB::?relay`
   \   000002   0000         DW 0H
   \   000004   0000         DW 0H
   \   000006   0000         DW 0H
   \   000008   0000         DW 0H
   \   00000A   0000         DW 0H
   \   00000C   0000         DW 0H
   \   00000E   0000         DW 0H
   \   000010   0000         DW 0H

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleSw_WriteTest::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleSw_WriteTest

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleSw_Init::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleSw_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleSw_event_loop::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleSw_event_loop

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleSw_ProcessCommissioningStatus::?rela`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleSw_ProcessCommissioningStatus

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleSw_BasicResetCB::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleSw_BasicResetCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleApp_BatteryWarningCB::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleApp_BatteryWarningCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleSw_ProcessIncomingMsg::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleSw_ProcessIncomingMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleSw_ProcessInDiscCmdsRspCmd::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleSw_ProcessInDiscCmdsRspCmd

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleSw_UiActionToggleLight::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleSw_UiActionToggleLight

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleSw_UiUpdateLcd::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleSw_UiUpdateLcd

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Write:">`:
   \   000000   57726974     DB "Write:"
   \            653A00  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "TI Sample Switch">`:
   \   000000   54492053     DB "TI Sample Switch"
   \            616D706C
   \            65205377
   \            69746368
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Broadcast">`:
   \   000000   42726F61     DB "Broadcast"
   \            64636173
   \            7400    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Groupcast">`:
   \   000000   47726F75     DB "Groupcast"
   \            70636173
   \            7400    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "I have beem form 2332\\n">`:
   \   000000   49206861     DB "I have beem form 2332\012"
   \            76652062
   \            65656D20
   \            666F726D
   \            20323333
   \            320A00  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "faild\\n">`:
   \   000000   6661696C     DB "faild\012"
   \            640A00  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "i have been join 2332">`:
   \   000000   69206861     DB "i have been join 2332"
   \            76652062
   \            65656E20
   \            6A6F696E
   \            20323333
   \            3200    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Rx Value:">`:
   \   000000   52782056     DB "Rx Value:"
   \            616C7565
   \            3A00    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Read:">`:
   \   000000   52656164     DB "Read:"
   \            3A00    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "< TOGGLE LIGHT >">`:
   \   000000   3C20544F     DB "< TOGGLE LIGHT >"
   \            47474C45
   \            204C4947
   \            4854203E
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_bb8:
   \   000000   B80B0000     DD 3000

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3e8:
   \   000000   E8030000     DD 1000

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_1f4:
   \   000000   F4010000     DD 500
   1296          

   Maximum stack usage in bytes:

   ISTACK XSTACK Function
   ------ ------ --------
      0      0   zclSampleApp_BatteryWarningCB
      2      0   zclSampleSw_BasicResetCB
        2      0   -> UI_UpdateLcd
        2      0   -> zclSampleSw_ResetAttributesToDefaultValues
      0     18   zclSampleSw_Init
        0     10   -> NLME_PermitJoiningRequest
        0     10   -> RegisterForKeys
        0     10   -> RegisterVoltageWarningCB
        0     18   -> UI_Init
        0     10   -> UI_UpdateLcd
        0     10   -> afRegister
        0     10   -> bdb_RegisterCommissioningStatusCB
        0     10   -> bdb_RegisterSimpleDescriptor
        0     10   -> bdb_StartCommissioning
        0     14   -> osal_start_timerEx
        0     10   -> zclGeneral_RegisterCmdCallbacks
        0     10   -> zclSampleSw_ResetAttributesToDefaultValues
        0     10   -> zcl_registerAttrList
        0     10   -> zcl_registerForMsg
      0      9   zclSampleSw_ProcessCommissioningStatus
        0      9   -> UI_UpdateComissioningStatus
        0      9   -> bdb_StartCommissioning
        0      9   -> printf
      2     14   zclSampleSw_ProcessInDiscCmdsRspCmd
      0     39   zclSampleSw_ProcessIncomingMsg
        0     15   -> HalLcdWriteStringValue
        0     14   -> osal_mem_free
        0     14   -> zclSampleSw_ProcessInDiscCmdsRspCmd
      0     21   zclSampleSw_UiActionToggleLight
        0     10   -> bdb_getZCLFrameCounter
        0     21   -> zcl_SendCommand
      2      0   zclSampleSw_UiUpdateLcd
      1     54   zclSampleSw_WriteTest
        0     25   -> HalLcdWriteStringValue
        0     24   -> osal_mem_alloc
        0     24   -> osal_mem_free
        0     30   -> zcl_SendWriteRequest
      0     35   zclSampleSw_event_loop
        0     33   -> AF_DataRequest
        0     25   -> HalLcdWriteStringValue
        0     24   -> UI_DeviceStateUpdated
        0     24   -> UI_MainStateMachine
        0     24   -> UI_UpdateLcd
        0     24   -> osal_mem_alloc
        0     24   -> osal_mem_free
        0     24   -> osal_msg_deallocate
        0     24   -> osal_msg_receive
        0     28   -> osal_start_timerEx
        0     24   -> zclSampleSw_ProcessIncomingMsg
        0     24   -> zclSampleSw_WriteTest
        0     35   -> zcl_SendCommand
        0     29   -> zcl_SendRead


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
      17  ?<Constant "< TOGGLE LIGHT >">
      10  ?<Constant "Broadcast">
      10  ?<Constant "Groupcast">
      23  ?<Constant "I have beem form 2332\n">
       6  ?<Constant "Read:">
      10  ?<Constant "Rx Value:">
      17  ?<Constant "TI Sample Switch">
       7  ?<Constant "Write:">
       7  ?<Constant "faild\n">
      22  ?<Constant "i have been join 2332">
       7  ?<Initializer for sampleSw_TestEp>
      18  ?<Initializer for zclSampleSw_CmdCallbacks>
       1  ?<Initializer for zclSampleSw_NwkState>
       1  ?<Initializer for zclSampleSw_OnOffSwitchType>
       8  ??Subroutine13_0
      10  ?Subroutine0
       5  ?Subroutine1
       9  ?Subroutine10
       9  ?Subroutine11
       9  ?Subroutine12
       7  ?Subroutine2
      23  ?Subroutine3
      11  ?Subroutine4
      23  ?Subroutine5
       4  ?Subroutine6
      12  ?Subroutine7
      10  ?Subroutine8
      15  ?Subroutine9
       4  __Constant_1f4
       4  __Constant_3e8
       4  __Constant_bb8
       1  bcCnt
       1  gcCnt
       1  p2pCnt
       7  sampleSw_TestEp
       1  transferId
       1  transferId
       1  txID
       1  txID
       3  zclSampleApp_BatteryWarningCB
       6  zclSampleApp_BatteryWarningCB::?relay
       1  zclSampleSwSeqNum
      10  zclSampleSw_BasicResetCB
       6  zclSampleSw_BasicResetCB::?relay
      18  zclSampleSw_CmdCallbacks
      12  zclSampleSw_DstAddr
     264  zclSampleSw_Init
       6  zclSampleSw_Init::?relay
       1  zclSampleSw_NwkState
       1  zclSampleSw_OnOffSwitchActions
       1  zclSampleSw_OnOffSwitchType
      75  zclSampleSw_ProcessCommissioningStatus
       6  zclSampleSw_ProcessCommissioningStatus::?relay
      37  zclSampleSw_ProcessInDiscCmdsRspCmd
       6  zclSampleSw_ProcessInDiscCmdsRspCmd::?relay
     340  zclSampleSw_ProcessIncomingMsg
       6  zclSampleSw_ProcessIncomingMsg::?relay
       1  zclSampleSw_TaskID
       2  zclSampleSw_TestAddr
     238  zclSampleSw_UiActionToggleLight
       6  zclSampleSw_UiActionToggleLight::?relay
      12  zclSampleSw_UiStatesMain
      22  zclSampleSw_UiUpdateLcd
       6  zclSampleSw_UiUpdateLcd::?relay
     225  zclSampleSw_WriteTest
       6  zclSampleSw_WriteTest::?relay
     785  zclSampleSw_event_loop
       6  zclSampleSw_event_loop::?relay

 
 2 154 bytes in segment BANKED_CODE
    60 bytes in segment BANK_RELAYS
    27 bytes in segment XDATA_I
    27 bytes in segment XDATA_ID
   153 bytes in segment XDATA_ROM_C
    24 bytes in segment XDATA_Z
 
    87 bytes of CODE     memory
   141 bytes of CONST    memory (+ 12 bytes shared)
 2 154 bytes of HUGECODE memory
    51 bytes of XDATA    memory

Errors: none
Warnings: 3

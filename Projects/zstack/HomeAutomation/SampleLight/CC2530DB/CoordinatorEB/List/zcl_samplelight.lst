###############################################################################
#
# IAR C/C++ Compiler V10.10.1.4655 for 8051               30/Sep/2024  10:48:42
# Copyright 2004-2017 IAR Systems AB.
# Standalone license - IAR Embedded Workbench for 8051
#
#    Core               =  plain
#    Code model         =  banked
#    Data model         =  large
#    Calling convention =  xdata reentrant
#    Constant location  =  data_rom
#    Dptr setup         =  1,16
#                          
#    Source file        =  
#        D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\Source\zcl_samplelight.c
#    Command line       =  
#        -f C:\Users\ASUS\AppData\Local\Temp\EWFAA5.tmp ("D:\Z-Stack
#        3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\Source\zcl_samplelight.c"
#        -D BDB_REPORTING -D SECURE=1 -D TC_LINKKEY_JOIN -D NV_INIT -D
#        NV_RESTORE -D xZTOOL_P1 -D xMT_TASK -D xMT_APP_FUNC -D xMT_SYS_FUNC -D
#        xMT_ZDO_FUNC -D xMT_ZDO_MGMT -D xMT_APP_CNF_FUNC -D
#        LCD_SUPPORTED=DEBUG -D MULTICAST_ENABLED=FALSE -D ZCL_READ -D
#        ZCL_DISCOVER -D ZCL_WRITE -D ZCL_BASIC -D ZCL_IDENTIFY -D ZCL_ON_OFF
#        -D ZCL_SCENES -D ZCL_GROUPS -D ZCL_LEVEL_CTRL -lC "D:\Z-Stack
#        3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\CoordinatorEB\List"
#        -lA "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\CoordinatorEB\List"
#        --diag_suppress Pe001,Pa010 -o "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\CoordinatorEB\Obj"
#        -e --debug --core=plain --dptr=16,1 --data_model=large
#        --code_model=banked --calling_convention=xdata_reentrant
#        --place_constants=data_rom --nr_virtual_regs 16 -f "D:\Z-Stack
#        3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\..\..\..\Tools\CC2530DB\f8wCoord.cfg"
#        (-DCPU32MHZ -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRUE
#        -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8 -DMAC_CFG_RX_MAX=5
#        -DZDO_COORDINATOR -DRTR_NWK) -f "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\..\..\..\Tools\CC2530DB\f8wConfig.cfg"
#        (-DZIGBEEPRO -DSECURE=1 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR
#        -DDEFAULT_CHANLIST=0x00000800 -DZDAPP_CONFIG_PAN_ID=0xFFFF
#        -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MASK=0x007F
#        -DBEACON_REQUEST_DELAY=100 -DBEACON_REQ_DELAY_MASK=0x00FF
#        -DLINK_STATUS_JITTER_MASK=0x007F -DROUTE_EXPIRY_TIME=30
#        -DAPSC_ACK_WAIT_DURATION_POLLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7
#        -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3
#        -DNWK_MAX_DATA_RETRIES=2 -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9
#        -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40 -DNWK_MAX_BINDING_ENTRIES=4
#        -DMAX_BINDING_CLUSTER_IDS=4 -DDEFAULT_KEY={0} -DMAC_MAX_FRAME_SIZE=116
#        -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const __code"
#        -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000
#        -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100 -DREJOIN_POLL_RATE=440
#        -DREJOIN_BACKOFF=900000 -DREJOIN_SCAN=900000 -DENABLE_LED4_DISABLE_S1)
#        -f "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\..\..\..\Tools\CC2530DB\f8wZCL.cfg"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\" -I
#        "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\..\Source\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\..\..\Source\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\..\..\..\ZMain\TI2530DB\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\..\..\..\..\..\Components\hal\include\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\..\..\..\..\..\Components\hal\target\CC2530EB\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\..\..\..\..\..\Components\mac\include\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\..\..\..\..\..\Components\mac\high_level\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\..\..\..\..\..\Components\mac\low_level\srf04\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\..\..\..\..\..\Components\mac\low_level\srf04\single_chip\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\..\..\..\..\..\Components\mt\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\..\..\..\..\..\Components\osal\include\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\..\..\..\..\..\Components\services\saddr\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\..\..\..\..\..\Components\services\sdata\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\..\..\..\..\..\Components\stack\af\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\..\..\..\..\..\Components\stack\bdb\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\..\..\..\..\..\Components\stack\gp\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\..\..\..\..\..\Components\stack\nwk\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\..\..\..\..\..\Components\stack\sapi\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\..\..\..\..\..\Components\stack\sec\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\..\..\..\..\..\Components\stack\sys\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\..\..\..\..\..\Components\stack\zcl\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\..\..\..\..\..\Components\stack\zdo\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\..\..\..\..\..\Components\zmac\"
#        -I "D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\..\..\..\..\..\Components\zmac\f8w\"
#        -Ohz --require_prototypes)
#    Locale             =  Chinese (Simplified)_China.936
#    List file          =  
#        D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\CoordinatorEB\List\zcl_samplelight.lst
#    Object file        =  
#        D:\Z-Stack 3.0.2\Z-Stack
#        3.0.2\Projects\zstack\HomeAutomation\SampleLight\CC2530DB\CoordinatorEB\Obj\zcl_samplelight.r51
#
###############################################################################

D:\Z-Stack 3.0.2\Z-Stack 3.0.2\Projects\zstack\HomeAutomation\SampleLight\Source\zcl_samplelight.c
      1          /**************************************************************************************************
      2            Filename:       zcl_sampleLight.c
      3            Revised:        $Date: 2014-10-24 16:04:46 -0700 (Fri, 24 Oct 2014) $
      4            Revision:       $Revision: 40796 $
      5          
      6          
      7            Description:    Zigbee Cluster Library - sample light application.
      8          
      9          
     10            Copyright 2006-2014 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com.
     39          **************************************************************************************************/
     40          
     41          /*********************************************************************
     42            This application implements a ZigBee Light, based on Z-Stack 3.0. It can be configured as an
     43            On/Off light or as a dimmable light, by undefining or defining ZCL_LEVEL_CTRL, respectively.
     44          
     45            This application is based on the common sample-application user interface. Please see the main
     46            comment in zcl_sampleapp_ui.c. The rest of this comment describes only the content specific for
     47            this sample applicetion.
     48            
     49            Application-specific UI peripherals being used:
     50          
     51            - LEDs:
     52              LED1 reflect the current light state (On / Off accordingly).
     53          
     54            Application-specific menu system:
     55          
     56              <TOGGLE LIGHT> Toggle the local light and display its status and level
     57                Press OK to toggle the local light on and off.
     58                This screen shows the following information
     59                  Line1: (only populated if ZCL_LEVEL_CTRL is defined)
     60                    LEVEL XXX - xxx is the current level of the light if the light state is ON, or the target level
     61                      of the light when the light state is off. The target level is the level that the light will be
     62                      set to when it is switched from off to on using the on or the toggle commands.
     63                  Line2:
     64                    LIGHT OFF / ON: shows the current state of the light.
     65                Note when ZCL_LEVEL_CTRL is enabled:
     66                  - If the light state is ON and the light level is X, and then the light receives the OFF or TOGGLE 
     67                    commands: The level will decrease gradually until it reaches 1, and only then the light state will
     68                    be changed to OFF. The level then will be restored to X, with the state staying OFF. At this stage
     69                    the light is not lighting, and the level represent the target level for the next ON or TOGGLE 
     70                    commands.
     71                  - If the light state is OFF and the light level is X, and then the light receives the ON or TOGGLE
     72                    commands; The level will be set to 1, the light state will be set to ON, and then the level will
     73                    increase gradually until it reaches level X.
     74                  - Any level-setting command will affect the level directly, and may also affect the on/off state,
     75                    depending on the command's arguments.       
     76          
     77          *********************************************************************/
     78          
     79          /*********************************************************************
     80           * INCLUDES
     81           */
     82          #include "ZComDef.h"
     83          #include "OSAL.h"
     84          #include "AF.h"
     85          #include "ZDApp.h"
     86          #include "ZDObject.h"
     87          #include "MT_SYS.h"
     88          
     89          #include "nwk_util.h"
     90          
     91          #include "zcl.h"
     92          #include "zcl_general.h"
     93          #include "zcl_ha.h"
     94          #include "zcl_diagnostic.h"
     95          
     96          #include "zcl_samplelight.h"
     97             
     98          #include "bdb.h"
     99          #include "bdb_interface.h"
    100          
    101           //GP_UPDATE
    102          #include "gp_interface.h"
    103             
    104          #include "onboard.h"
    105          
    106          /* HAL */
    107          #include "hal_lcd.h"
    108          #include "hal_led.h"
    109          #include "hal_key.h"
    110          
    111          #include "NLMEDE.h"
    112          
    113          // Added to include TouchLink initiator functionality 
    114          #if defined ( BDB_TL_INITIATOR )
    115            #include "bdb_touchlink_initiator.h"
    116          #endif // BDB_TL_INITIATOR
    117          
    118          #if defined ( BDB_TL_TARGET )
    119            #include "bdb_touchlink_target.h"
    120          #endif // BDB_TL_TARGET
    121          
    122          #if defined ( BDB_TL_INITIATOR ) || defined ( BDB_TL_TARGET )
    123            #include "bdb_touchlink.h"
    124          #endif
    125          
    126          #include "zcl_sampleapps_ui.h"
    127          
    128          /*********************************************************************
    129           * MACROS
    130           */
    131          #define UI_STATE_TOGGLE_LIGHT 1 //UI_STATE_BACK_FROM_APP_MENU is item #0, so app item numbers should start from 1
    132          
    133          #define APP_TITLE "TI Sample Light"
    134          
    135          /*********************************************************************
    136           * TYPEDEFS
    137           */
    138          
    139          /*********************************************************************
    140           * GLOBAL VARIABLES
    141           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    142          byte zclSampleLight_TaskID;
   \                     zclSampleLight_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    143          uint8 zclSampleLightSeqNum;
   \                     zclSampleLightSeqNum:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    144          
    145          /*********************************************************************
    146           * GLOBAL FUNCTIONS
    147           */
    148          
    149          /*********************************************************************
    150           * LOCAL VARIABLES
    151           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    152          afAddrType_t zclSampleLight_DstAddr;
   \                     zclSampleLight_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z
    153          
    154          // Test Endpoint to allow SYS_APP_MSGs

   \                                 In  segment XDATA_I, align 1, keep-with-next
    155          static endPointDesc_t sampleLight_TestEp =
   \                     sampleLight_TestEp:
   \   000000                DS 7
   \   000007                REQUIRE `?<Initializer for sampleLight_TestEp>`
   \   000007                REQUIRE __INIT_XDATA_I
    156          {
    157            SAMPLELIGHT_ENDPOINT,
    158            0,
    159            &zclSampleLight_TaskID,
    160            (SimpleDescriptionFormat_t *)NULL,  // No Simple description for this test endpoint
    161            (afNetworkLatencyReq_t)0            // No Network Latency req
    162          };
    163          
    164          #ifdef ZCL_LEVEL_CTRL

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    165          uint8 zclSampleLight_WithOnOff;       // set to TRUE if state machine should set light on/off
   \                     zclSampleLight_WithOnOff:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    166          uint8 zclSampleLight_NewLevel;        // new level when done moving
   \                     zclSampleLight_NewLevel:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    167          uint8 zclSampleLight_LevelChangeCmd; // current level change was triggered by an on/off command
   \                     zclSampleLight_LevelChangeCmd:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    168          bool  zclSampleLight_NewLevelUp;      // is direction to new level up or down?
   \                     zclSampleLight_NewLevelUp:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    169          int32 zclSampleLight_CurrentLevel32;  // current level, fixed point (e.g. 192.456)
   \                     zclSampleLight_CurrentLevel32:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    170          int32 zclSampleLight_Rate32;          // rate in units, fixed point (e.g. 16.123)
   \                     zclSampleLight_Rate32:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    171          uint8 zclSampleLight_LevelLastLevel;  // to save the Current Level before the light was turned OFF
   \                     zclSampleLight_LevelLastLevel:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    172          #endif
    173          
    174          /*********************************************************************
    175           * LOCAL FUNCTIONS
    176           */
    177          static void zclSampleLight_HandleKeys( byte shift, byte keys );
    178          static void zclSampleLight_BasicResetCB( void );
    179          static void zclSampleLight_OnOffCB( uint8 cmd );
    180          //GP_UPDATE
    181          #if (ZG_BUILD_RTR_TYPE)
    182          static void gp_CommissioningMode(bool isEntering);
    183          static uint8 gp_ChangeChannelReq(void);
    184          #endif
    185          
    186          
    187          static void zclSampleLight_ProcessCommissioningStatus(bdbCommissioningModeMsg_t *bdbCommissioningModeMsg);
    188          
    189          
    190          #ifdef ZCL_LEVEL_CTRL
    191          static void zclSampleLight_LevelControlMoveToLevelCB( zclLCMoveToLevel_t *pCmd );
    192          static void zclSampleLight_LevelControlMoveCB( zclLCMove_t *pCmd );
    193          static void zclSampleLight_LevelControlStepCB( zclLCStep_t *pCmd );
    194          static void zclSampleLight_LevelControlStopCB( void );
    195          static void zclSampleLight_DefaultMove( uint8 OnOff );
    196          static uint32 zclSampleLight_TimeRateHelper( uint8 newLevel );
    197          static uint16 zclSampleLight_GetTime ( uint8 level, uint16 time );
    198          static void zclSampleLight_MoveBasedOnRate( uint8 newLevel, uint32 rate );
    199          static void zclSampleLight_MoveBasedOnTime( uint8 newLevel, uint16 time );
    200          static void zclSampleLight_AdjustLightLevel( void );
    201          #endif
    202          
    203          // Functions to process ZCL Foundation incoming Command/Response messages
    204          static void zclSampleLight_ProcessIncomingMsg( zclIncomingMsg_t *msg );
    205          #ifdef ZCL_READ
    206          static uint8 zclSampleLight_ProcessInReadRspCmd( zclIncomingMsg_t *pInMsg );
    207          #endif
    208          #ifdef ZCL_WRITE
    209          static uint8 zclSampleLight_ProcessInWriteRspCmd( zclIncomingMsg_t *pInMsg );
    210          #endif
    211          static uint8 zclSampleLight_ProcessInDefaultRspCmd( zclIncomingMsg_t *pInMsg );
    212          #ifdef ZCL_DISCOVER
    213          static uint8 zclSampleLight_ProcessInDiscCmdsRspCmd( zclIncomingMsg_t *pInMsg );
    214          static uint8 zclSampleLight_ProcessInDiscAttrsRspCmd( zclIncomingMsg_t *pInMsg );
    215          static uint8 zclSampleLight_ProcessInDiscAttrsExtRspCmd( zclIncomingMsg_t *pInMsg );
    216          #endif
    217          
    218          static void zclSampleApp_BatteryWarningCB( uint8 voltLevel);
    219          
    220          void zclSampleLight_UiActionToggleLight(uint16 keys);
    221          void zclSampleLight_UiUpdateLcd(uint8 uiCurrentState, char * line[3]);
    222          void zclSampleLight_UpdateLedState(void);
    223          
    224          /*********************************************************************
    225           * CONSTANTS
    226           */

   \                                 In  segment XDATA_ROM_C, align 1
    227          const uiState_t zclSampleLight_UiStatesMain[] = 
   \                     zclSampleLight_UiStatesMain:
   \   000000   FE           DB 254
   \   000001   01           DB 1
   \   000002   0400         DW 4
   \   000004   ....         DW `??UI_ActionBackFromAppMenu::?relay`
   \   000006   00           DB 0
   \   000007   FE           DB 254
   \   000008   0400         DW 4
   \   00000A   ....         DW `??zclSampleLight_UiActionToggleLight::?relay`
    228          {
    229            /*  UI_STATE_BACK_FROM_APP_MENU  */   {UI_STATE_DEFAULT_MOVE,       UI_STATE_TOGGLE_LIGHT,  UI_KEY_SW_5_PRESSED, &UI_ActionBackFromAppMenu}, //do not change this line, except for the second item, which should point to the last entry in this menu
    230            /*  UI_STATE_TOGGLE_LIGHT        */   {UI_STATE_BACK_FROM_APP_MENU, UI_STATE_DEFAULT_MOVE,  UI_KEY_SW_5_PRESSED, &zclSampleLight_UiActionToggleLight},
    231          };
    232          
    233          #define LEVEL_CHANGED_BY_LEVEL_CMD  0
    234          #define LEVEL_CHANGED_BY_ON_CMD     1
    235          #define LEVEL_CHANGED_BY_OFF_CMD    2
    236          
    237          /*********************************************************************
    238           * STATUS STRINGS
    239           */
    240          #ifdef LCD_SUPPORTED

   \                                 In  segment XDATA_ROM_C, align 1
    241            const char sLightOn[]      = "   LIGHT ON     ";
   \                     sLightOn:
   \   000000   2020204C     DB "   LIGHT ON     "
   \            49474854
   \            204F4E20
   \            20202020
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
    242            const char sLightOff[]     = "   LIGHT OFF    ";
   \                     sLightOff:
   \   000000   2020204C     DB "   LIGHT OFF    "
   \            49474854
   \            204F4646
   \            20202020
   \            00      
    243            #ifdef ZCL_LEVEL_CTRL

   \                                 In  segment XDATA_I, align 1, keep-with-next
    244              char sLightLevel[]        = "   LEVEL ###    "; // displays level 1-254
   \                     sLightLevel:
   \   000000                DS 17
   \   000011                REQUIRE `?<Initializer for sLightLevel>`
   \   000011                REQUIRE __INIT_XDATA_I
    245            #endif
    246          #endif
    247          
    248          /*********************************************************************
    249           * REFERENCED EXTERNALS
    250           */
    251          extern int16 zdpExternalStateTaskID;
    252          
    253          /*********************************************************************
    254           * ZCL General Profile Callback table
    255           */

   \                                 In  segment XDATA_I, align 1, keep-with-next
    256          static zclGeneral_AppCallbacks_t zclSampleLight_CmdCallbacks =
   \                     zclSampleLight_CmdCallbacks:
   \   000000                DS 32
   \   000020                REQUIRE `?<Initializer for zclSampleLight_CmdCallbacks>`
   \   000020                REQUIRE __INIT_XDATA_I
    257          {
    258            zclSampleLight_BasicResetCB,            // Basic Cluster Reset command
    259            NULL,                                   // Identify Trigger Effect command
    260            zclSampleLight_OnOffCB,                 // On/Off cluster commands
    261            NULL,                                   // On/Off cluster enhanced command Off with Effect
    262            NULL,                                   // On/Off cluster enhanced command On with Recall Global Scene
    263            NULL,                                   // On/Off cluster enhanced command On with Timed Off
    264          #ifdef ZCL_LEVEL_CTRL
    265            zclSampleLight_LevelControlMoveToLevelCB, // Level Control Move to Level command
    266            zclSampleLight_LevelControlMoveCB,        // Level Control Move command
    267            zclSampleLight_LevelControlStepCB,        // Level Control Step command
    268            zclSampleLight_LevelControlStopCB,        // Level Control Stop command
    269          #endif
    270          #ifdef ZCL_GROUPS
    271            NULL,                                   // Group Response commands
    272          #endif
    273          #ifdef ZCL_SCENES
    274            NULL,                                  // Scene Store Request command
    275            NULL,                                  // Scene Recall Request command
    276            NULL,                                  // Scene Response command
    277          #endif
    278          #ifdef ZCL_ALARMS
    279            NULL,                                  // Alarm (Response) commands
    280          #endif
    281          #ifdef SE_UK_EXT
    282            NULL,                                  // Get Event Log command
    283            NULL,                                  // Publish Event Log command
    284          #endif
    285            NULL,                                  // RSSI Location command
    286            NULL                                   // RSSI Location Response command
    287          };
    288          
    289          /*********************************************************************
    290           * @fn          zclSampleLight_Init
    291           *
    292           * @brief       Initialization function for the zclGeneral layer.
    293           *
    294           * @param       none
    295           *
    296           * @return      none
    297           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    298          void zclSampleLight_Init( byte task_id )
   \                     zclSampleLight_Init:
    299          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV       A,#-0xa
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   E9           MOV       A,R1
    300            zclSampleLight_TaskID = task_id;
   \   000006   90....       MOV       DPTR,#zclSampleLight_TaskID
   \   000009   F0           MOVX      @DPTR,A
    301          
    302            // Set destination address to indirect
    303            zclSampleLight_DstAddr.addrMode = (afAddrMode_t)AddrNotPresent;
   \   00000A   90....       MOV       DPTR,#zclSampleLight_DstAddr + 8
   \   00000D   E4           CLR       A
   \   00000E   F0           MOVX      @DPTR,A
    304            zclSampleLight_DstAddr.endPoint = 0;
   \   00000F   A3           INC       DPTR
   \   000010   F0           MOVX      @DPTR,A
    305            zclSampleLight_DstAddr.addr.shortAddr = 0;
   \   000011   90....       MOV       DPTR,#zclSampleLight_DstAddr
   \   000014   F0           MOVX      @DPTR,A
   \   000015   A3           INC       DPTR
   \   000016   F0           MOVX      @DPTR,A
    306          
    307            // Register the Simple Descriptor for this application
    308            bdb_RegisterSimpleDescriptor( &zclSampleLight_SimpleDesc );
   \   000017                ; Setup parameters for call to function bdb_RegisterSimpleDescriptor
   \   000017   7A..         MOV       R2,#zclSampleLight_SimpleDesc & 0xff
   \   000019   7B..         MOV       R3,#(zclSampleLight_SimpleDesc >> 8) & 0xff
   \   00001B   12....       LCALL     `??bdb_RegisterSimpleDescriptor::?relay`; Banked call to: bdb_RegisterSimpleDescriptor
    309          
    310            // Register the ZCL General Cluster Library callback functions
    311            zclGeneral_RegisterCmdCallbacks( SAMPLELIGHT_ENDPOINT, &zclSampleLight_CmdCallbacks );
   \   00001E                ; Setup parameters for call to function zclGeneral_RegisterCmdCallbacks
   \   00001E   7A..         MOV       R2,#zclSampleLight_CmdCallbacks & 0xff
   \   000020   7B..         MOV       R3,#(zclSampleLight_CmdCallbacks >> 8) & 0xff
   \   000022   7908         MOV       R1,#0x8
   \   000024   12....       LCALL     `??zclGeneral_RegisterCmdCallbacks::?relay`; Banked call to: zclGeneral_RegisterCmdCallbacks
    312          
    313            // Register the application's attribute list
    314            zclSampleLight_ResetAttributesToDefaultValues();
   \   000027                ; Setup parameters for call to function zclSampleLight_ResetAttributesToDefaultValues
   \   000027   12....       LCALL     ??zclSampleLight_ResetAttributesToDefaultValues; Banked call to: zclSampleLight_ResetAttributesToDefaultValues
    315            zcl_registerAttrList( SAMPLELIGHT_ENDPOINT, zclSampleLight_NumAttributes, zclSampleLight_Attrs );
   \   00002A                ; Setup parameters for call to function zcl_registerAttrList
   \   00002A   7C..         MOV       R4,#zclSampleLight_Attrs & 0xff
   \   00002C   7D..         MOV       R5,#(zclSampleLight_Attrs >> 8) & 0xff
   \   00002E   90....       MOV       DPTR,#zclSampleLight_NumAttributes
   \   000031   E4           CLR       A
   \   000032   93           MOVC      A,@A+DPTR
   \   000033   FA           MOV       R2,A
   \   000034   7908         MOV       R1,#0x8
   \   000036   12....       LCALL     `??zcl_registerAttrList::?relay`; Banked call to: zcl_registerAttrList
    316          
    317          #ifdef ZCL_LEVEL_CTRL
    318            zclSampleLight_LevelLastLevel = zclSampleLight_LevelCurrentLevel;
   \   000039   90....       MOV       DPTR,#zclSampleLight_LevelCurrentLevel
   \   00003C   E0           MOVX      A,@DPTR
   \   00003D   90....       MOV       DPTR,#zclSampleLight_LevelLastLevel
   \   000040   F0           MOVX      @DPTR,A
    319          #endif
    320          
    321            // Register the Application to receive the unprocessed Foundation command/response messages
    322            zcl_registerForMsg( zclSampleLight_TaskID );
   \   000041                ; Setup parameters for call to function zcl_registerForMsg
   \   000041   90....       MOV       DPTR,#zclSampleLight_TaskID
   \   000044   E0           MOVX      A,@DPTR
   \   000045   F9           MOV       R1,A
   \   000046   12....       LCALL     `??zcl_registerForMsg::?relay`; Banked call to: zcl_registerForMsg
    323          
    324          #ifdef ZCL_DISCOVER
    325            // Register the application's command list
    326            zcl_registerCmdList( SAMPLELIGHT_ENDPOINT, zclCmdsArraySize, zclSampleLight_Cmds );
   \   000049                ; Setup parameters for call to function zcl_registerCmdList
   \   000049   7C..         MOV       R4,#zclSampleLight_Cmds & 0xff
   \   00004B   7D..         MOV       R5,#(zclSampleLight_Cmds >> 8) & 0xff
   \   00004D   90....       MOV       DPTR,#zclCmdsArraySize
   \   000050   E4           CLR       A
   \   000051   93           MOVC      A,@A+DPTR
   \   000052   FA           MOV       R2,A
   \   000053   7908         MOV       R1,#0x8
   \   000055   12....       LCALL     `??zcl_registerCmdList::?relay`; Banked call to: zcl_registerCmdList
    327          #endif
    328          
    329            // Register low voltage NV memory protection application callback
    330            RegisterVoltageWarningCB( zclSampleApp_BatteryWarningCB );
   \   000058                ; Setup parameters for call to function RegisterVoltageWarningCB
   \   000058   7A..         MOV       R2,#`??zclSampleApp_BatteryWarningCB::?relay` & 0xff
   \   00005A   7B..         MOV       R3,#(`??zclSampleApp_BatteryWarningCB::?relay` >> 8) & 0xff
   \   00005C   12....       LCALL     `??RegisterVoltageWarningCB::?relay`; Banked call to: RegisterVoltageWarningCB
    331          
    332            // Register for all key events - This app will handle all key events
    333            RegisterForKeys( zclSampleLight_TaskID );
   \   00005F                ; Setup parameters for call to function RegisterForKeys
   \   00005F   90....       MOV       DPTR,#zclSampleLight_TaskID
   \   000062   E0           MOVX      A,@DPTR
   \   000063   F9           MOV       R1,A
   \   000064   12....       LCALL     `??RegisterForKeys::?relay`; Banked call to: RegisterForKeys
    334            
    335            bdb_RegisterCommissioningStatusCB( zclSampleLight_ProcessCommissioningStatus );
   \   000067                ; Setup parameters for call to function bdb_RegisterCommissioningStatusCB
   \   000067   7A..         MOV       R2,#`??zclSampleLight_ProcessCommissioningStatus::?r` & 0xff
   \   000069   7B..         MOV       R3,#(`??zclSampleLight_ProcessCommissioningStatus::?r` >> 8) & 0xff
   \   00006B   12....       LCALL     `??bdb_RegisterCommissioningStatusCB::?relay`; Banked call to: bdb_RegisterCommissioningStatusCB
    336            
    337            // Register for a test endpoint
    338            afRegister( &sampleLight_TestEp );
   \   00006E                ; Setup parameters for call to function afRegister
   \   00006E   7A..         MOV       R2,#sampleLight_TestEp & 0xff
   \   000070   7B..         MOV       R3,#(sampleLight_TestEp >> 8) & 0xff
   \   000072   12....       LCALL     `??afRegister::?relay`; Banked call to: afRegister
    339          
    340          #ifdef ZCL_DIAGNOSTIC
    341            // Register the application's callback function to read/write attribute data.
    342            // This is only required when the attribute data format is unknown to ZCL.
    343            zcl_registerReadWriteCB( SAMPLELIGHT_ENDPOINT, zclDiagnostic_ReadWriteAttrCB, NULL );
    344          
    345            if ( zclDiagnostic_InitStats() == ZSuccess )
    346            {
    347              // Here the user could start the timer to save Diagnostics to NV
    348            }
    349          #endif
    350            
    351          //GP_UPDATE  
    352          #if (ZG_BUILD_RTR_TYPE)  
    353            gp_RegisterCommissioningModeCB(gp_CommissioningMode);
   \   000075                ; Setup parameters for call to function gp_RegisterCommissioningModeCB
   \   000075   7A..         MOV       R2,#`??gp_CommissioningMode::?relay` & 0xff
   \   000077   7B..         MOV       R3,#(`??gp_CommissioningMode::?relay` >> 8) & 0xff
   \   000079   12....       LCALL     `??gp_RegisterCommissioningModeCB::?relay`; Banked call to: gp_RegisterCommissioningModeCB
    354            gp_RegisterGPChangeChannelReqCB(gp_ChangeChannelReq);
   \   00007C                ; Setup parameters for call to function gp_RegisterGPChangeChannelReqCB
   \   00007C   7A..         MOV       R2,#`??gp_ChangeChannelReq::?relay` & 0xff
   \   00007E   7B..         MOV       R3,#(`??gp_ChangeChannelReq::?relay` >> 8) & 0xff
   \   000080   12....       LCALL     `??gp_RegisterGPChangeChannelReqCB::?relay`; Banked call to: gp_RegisterGPChangeChannelReqCB
    355          #endif
    356            
    357            zdpExternalStateTaskID = zclSampleLight_TaskID;
   \   000083   90....       MOV       DPTR,#zclSampleLight_TaskID
   \   000086   E0           MOVX      A,@DPTR
   \   000087   90....       MOV       DPTR,#zdpExternalStateTaskID
   \   00008A   F0           MOVX      @DPTR,A
   \   00008B   A3           INC       DPTR
   \   00008C   E4           CLR       A
   \   00008D   F0           MOVX      @DPTR,A
    358          
    359            UI_Init(zclSampleLight_TaskID, SAMPLEAPP_LCD_AUTO_UPDATE_EVT, SAMPLEAPP_KEY_AUTO_REPEAT_EVT, &zclSampleLight_IdentifyTime, APP_TITLE, &zclSampleLight_UiUpdateLcd, zclSampleLight_UiStatesMain);
   \   00008E                ; Setup parameters for call to function UI_Init
   \   00008E   75....       MOV       ?V0,#zclSampleLight_UiStatesMain & 0xff
   \   000091   75....       MOV       ?V1,#(zclSampleLight_UiStatesMain >> 8) & 0xff
   \   000094   78..         MOV       R0,#?V0
   \   000096   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000099   75....       MOV       ?V0,#`??zclSampleLight_UiUpdateLcd::?relay` & 0xff
   \   00009C   75....       MOV       ?V1,#(`??zclSampleLight_UiUpdateLcd::?relay` >> 8) & 0xff
   \   00009F   78..         MOV       R0,#?V0
   \   0000A1   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000A4   75....       MOV       ?V0,#`?<Constant "TI Sample Light">` & 0xff
   \   0000A7   75....       MOV       ?V1,#(`?<Constant "TI Sample Light">` >> 8) & 0xff
   \   0000AA   78..         MOV       R0,#?V0
   \   0000AC   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000AF   75....       MOV       ?V0,#zclSampleLight_IdentifyTime & 0xff
   \   0000B2   75....       MOV       ?V1,#(zclSampleLight_IdentifyTime >> 8) & 0xff
   \   0000B5   78..         MOV       R0,#?V0
   \   0000B7   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000BA   7C20         MOV       R4,#0x20
   \   0000BC   7D00         MOV       R5,#0x0
   \   0000BE   7A10         MOV       R2,#0x10
   \   0000C0   7B00         MOV       R3,#0x0
   \   0000C2   90....       MOV       DPTR,#zclSampleLight_TaskID
   \   0000C5   E0           MOVX      A,@DPTR
   \   0000C6   F9           MOV       R1,A
   \   0000C7   12....       LCALL     `??UI_Init::?relay`; Banked call to: UI_Init
   \   0000CA   7408         MOV       A,#0x8
   \   0000CC   12....       LCALL     ?DEALLOC_XSTACK8
    360          
    361            UI_UpdateLcd();
   \   0000CF                ; Setup parameters for call to function UI_UpdateLcd
   \   0000CF   12....       LCALL     `??UI_UpdateLcd::?relay`; Banked call to: UI_UpdateLcd
    362          }
   \   0000D2   7F02         MOV       R7,#0x2
   \   0000D4   02....       LJMP      ?BANKED_LEAVE_XDATA
    363          
    364          /*********************************************************************
    365           * @fn          zclSample_event_loop
    366           *
    367           * @brief       Event Loop Processor for zclGeneral.
    368           *
    369           * @param       none
    370           *
    371           * @return      none
    372           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    373          uint16 zclSampleLight_event_loop( uint8 task_id, uint16 events )
   \                     zclSampleLight_event_loop:
    374          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000   74F4         MOV       A,#-0xc
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV       A,R2
   \   000006   FE           MOV       R6,A
   \   000007   EB           MOV       A,R3
   \   000008   FF           MOV       R7,A
    375            afIncomingMSGPacket_t *MSGpkt;
    376          
    377            (void)task_id;  // Intentionally unreferenced parameter
    378          
    379            if ( events & SYS_EVENT_MSG )
   \   000009   5480         ANL       A,#0x80
   \   00000B   701A         JNZ       ??zclSampleLight_event_loop_0
    380            {
    381              while ( (MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( zclSampleLight_TaskID )) )
    382              {
    383                switch ( MSGpkt->hdr.event )
    384                {
    385                  case ZCL_INCOMING_MSG:
    386                    // Incoming ZCL Foundation command/response messages
    387                    zclSampleLight_ProcessIncomingMsg( (zclIncomingMsg_t *)MSGpkt );
    388                    break;
    389          
    390                  case KEY_CHANGE:
    391                    zclSampleLight_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    392                    break;
    393          
    394                  case ZDO_STATE_CHANGE:
    395                    UI_DeviceStateUpdated((devStates_t)(MSGpkt->hdr.status));
    396                    break;
    397          
    398                  default:
    399                    break;
    400                }
    401          
    402                // Release the memory
    403                osal_msg_deallocate( (uint8 *)MSGpkt );
    404              }
    405          
    406              // return unprocessed events
    407              return (events ^ SYS_EVENT_MSG);
    408            }
    409          
    410          #ifdef ZCL_LEVEL_CTRL
    411            if ( events & SAMPLELIGHT_LEVEL_CTRL_EVT )
   \   00000D   EE           MOV       A,R6
   \   00000E   5402         ANL       A,#0x2
   \   000010   6051         JZ        ??zclSampleLight_event_loop_1
    412            {
    413              zclSampleLight_AdjustLightLevel();
   \   000012                ; Setup parameters for call to function zclSampleLight_AdjustLightLevel
   \   000012   12....       LCALL     `??zclSampleLight_AdjustLightLevel::?relay`; Banked call to: zclSampleLight_AdjustLightLevel
    414              return ( events ^ SAMPLELIGHT_LEVEL_CTRL_EVT );
   \   000015   EE           MOV       A,R6
   \   000016   6402         XRL       A,#0x2
   \   000018   8065         SJMP      ??zclSampleLight_event_loop_2
    415            }
   \                     ??zclSampleLight_event_loop_3:
   \   00001A                ; Setup parameters for call to function UI_DeviceStateUpdated
   \   00001A   A3           INC       DPTR
   \   00001B   E0           MOVX      A,@DPTR
   \   00001C   F9           MOV       R1,A
   \   00001D   12....       LCALL     `??UI_DeviceStateUpdated::?relay`; Banked call to: UI_DeviceStateUpdated
   \                     ??zclSampleLight_event_loop_4:
   \   000020                ; Setup parameters for call to function osal_msg_deallocate
   \   000020   AA..         MOV       R2,?V0
   \   000022   AB..         MOV       R3,?V1
   \   000024   12....       LCALL     `??osal_msg_deallocate::?relay`; Banked call to: osal_msg_deallocate
   \                     ??zclSampleLight_event_loop_0:
   \   000027                ; Setup parameters for call to function osal_msg_receive
   \   000027   90....       MOV       DPTR,#zclSampleLight_TaskID
   \   00002A   E0           MOVX      A,@DPTR
   \   00002B   F9           MOV       R1,A
   \   00002C   12....       LCALL     `??osal_msg_receive::?relay`; Banked call to: osal_msg_receive
   \   00002F   8A..         MOV       ?V0,R2
   \   000031   8B..         MOV       ?V1,R3
   \   000033   EA           MOV       A,R2
   \   000034   45..         ORL       A,?V1
   \   000036   6024         JZ        ??zclSampleLight_event_loop_5
   \   000038   8A82         MOV       DPL,R2
   \   00003A   8B83         MOV       DPH,R3
   \   00003C   E0           MOVX      A,@DPTR
   \   00003D   24CC         ADD       A,#-0x34
   \   00003F   600A         JZ        ??zclSampleLight_event_loop_6
   \   000041   2474         ADD       A,#0x74
   \   000043   600B         JZ        ??zclSampleLight_event_loop_7
   \   000045   24EF         ADD       A,#-0x11
   \   000047   60D1         JZ        ??zclSampleLight_event_loop_3
   \   000049   80D5         SJMP      ??zclSampleLight_event_loop_4
   \                     ??zclSampleLight_event_loop_6:
   \   00004B                ; Setup parameters for call to function zclSampleLight_ProcessIncomingMsg
   \   00004B   12....       LCALL     `??zclSampleLight_ProcessIncomingMsg::?relay`; Banked call to: zclSampleLight_ProcessIncomingMsg
   \   00004E   80D0         SJMP      ??zclSampleLight_event_loop_4
   \                     ??zclSampleLight_event_loop_7:
   \   000050                ; Setup parameters for call to function UI_MainStateMachine
   \   000050   A3           INC       DPTR
   \   000051   A3           INC       DPTR
   \   000052   A3           INC       DPTR
   \   000053   E0           MOVX      A,@DPTR
   \   000054   FA           MOV       R2,A
   \   000055   7B00         MOV       R3,#0x0
   \   000057   12....       LCALL     `??UI_MainStateMachine::?relay`; Banked call to: UI_MainStateMachine
   \   00005A   80C4         SJMP      ??zclSampleLight_event_loop_4
   \                     ??zclSampleLight_event_loop_5:
   \   00005C   EE           MOV       A,R6
   \   00005D   FA           MOV       R2,A
   \   00005E   EF           MOV       A,R7
   \   00005F   6480         XRL       A,#0x80
   \   000061   801E         SJMP      ??zclSampleLight_event_loop_8
    416          #endif
    417          
    418          #if ZG_BUILD_ENDDEVICE_TYPE    
    419            if ( events & SAMPLEAPP_END_DEVICE_REJOIN_EVT )
    420            {
    421              bdb_ZedAttemptRecoverNwk();
    422              return ( events ^ SAMPLEAPP_END_DEVICE_REJOIN_EVT );
    423            }
    424          #endif
    425          
    426            if ( events & SAMPLEAPP_LCD_AUTO_UPDATE_EVT )
   \                     ??zclSampleLight_event_loop_1:
   \   000063   EE           MOV       A,R6
   \   000064   5410         ANL       A,#0x10
   \   000066   6008         JZ        ??zclSampleLight_event_loop_9
    427            {
    428              UI_UpdateLcd();
   \   000068                ; Setup parameters for call to function UI_UpdateLcd
   \   000068   12....       LCALL     `??UI_UpdateLcd::?relay`; Banked call to: UI_UpdateLcd
    429              return ( events ^ SAMPLEAPP_LCD_AUTO_UPDATE_EVT );
   \   00006B   EE           MOV       A,R6
   \   00006C   6410         XRL       A,#0x10
   \   00006E   800F         SJMP      ??zclSampleLight_event_loop_2
    430            }
    431          
    432            if ( events & SAMPLEAPP_KEY_AUTO_REPEAT_EVT )
   \                     ??zclSampleLight_event_loop_9:
   \   000070   EE           MOV       A,R6
   \   000071   5420         ANL       A,#0x20
   \   000073   600F         JZ        ??zclSampleLight_event_loop_10
    433            {
    434              UI_MainStateMachine(UI_KEY_AUTO_PRESSED);
   \   000075                ; Setup parameters for call to function UI_MainStateMachine
   \   000075   7AFF         MOV       R2,#-0x1
   \   000077   7BFF         MOV       R3,#-0x1
   \   000079   12....       LCALL     `??UI_MainStateMachine::?relay`; Banked call to: UI_MainStateMachine
    435              return ( events ^ SAMPLEAPP_KEY_AUTO_REPEAT_EVT );
   \   00007C   EE           MOV       A,R6
   \   00007D   6420         XRL       A,#0x20
   \                     ??zclSampleLight_event_loop_2:
   \   00007F   FA           MOV       R2,A
   \   000080   EF           MOV       A,R7
   \                     ??zclSampleLight_event_loop_8:
   \   000081   FB           MOV       R3,A
   \   000082   8004         SJMP      ??zclSampleLight_event_loop_11
    436            }
    437          
    438            // Discard unknown events
    439            return 0;
   \                     ??zclSampleLight_event_loop_10:
   \   000084   7A00         MOV       R2,#0x0
   \   000086   7B00         MOV       R3,#0x0
   \                     ??zclSampleLight_event_loop_11:
   \   000088   7F04         MOV       R7,#0x4
   \   00008A   02....       LJMP      ?BANKED_LEAVE_XDATA
    440          }
    441          
    442          
    443          /*********************************************************************
    444           * @fn      zclSampleLight_HandleKeys
    445           *
    446           * @brief   Handles all key events for this device.
    447           *
    448           * @param   shift - true if in shift/alt.
    449           * @param   keys - bit field for key events. Valid entries:
    450           *                 HAL_KEY_SW_5
    451           *                 HAL_KEY_SW_4
    452           *                 HAL_KEY_SW_2
    453           *                 HAL_KEY_SW_1
    454           *
    455           * @return  none
    456           */
    457          static void zclSampleLight_HandleKeys( byte shift, byte keys )
    458          {
    459            UI_MainStateMachine(keys);
    460          }
    461          
    462          //GP_UPDATE
    463          #if (ZG_BUILD_RTR_TYPE)
    464          /*********************************************************************
    465           * @fn      gp_CommissioningMode
    466           *
    467           * @brief   Callback that notifies the application that gp Proxy is entering 
    468           *          into commissioning mode
    469           *
    470           * @param   isEntering - 
    471           *
    472           * @return  
    473           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    474          static void gp_CommissioningMode(bool isEntering)
   \                     gp_CommissioningMode:
    475          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    476            if(isEntering)
    477            {
    478              //Led on indicating enter commissioning mode
    479            }
    480            else
    481            {
    482              //Led off indicating enter commissioning mode
    483            }
    484          }
   \   000000   02....       LJMP      ?BRET
    485          
    486          
    487          
    488          //GP_UPDATE
    489          /*********************************************************************
    490           * @fn      gp_ChangeChannelReq
    491           *
    492           * @brief   Callback function to notify the application about a GP commissioning 
    493           * request that will change the current channel for at most 
    494           * gpBirectionalCommissioningChangeChannelTimeout ms
    495           *
    496           * @param   channel - Channel in which the commissioning will take place
    497           *
    498           * @return  TRUE to allow change channel, FALSE to do not allow
    499           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    500          static uint8 gp_ChangeChannelReq(void)
   \                     gp_ChangeChannelReq:
    501          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    502            bool allowChangeChannel = TRUE;
    503            
    504            //Check application state to decide if allow change channel or not
    505            
    506            return allowChangeChannel;
   \   000000   7901         MOV       R1,#0x1
   \   000002   02....       LJMP      ?BRET
    507          }
    508          
    509          #endif
    510          
    511          
    512          /*********************************************************************
    513           * @fn      zclSampleLight_ProcessCommissioningStatus
    514           *
    515           * @brief   Callback in which the status of the commissioning process are reported
    516           *
    517           * @param   bdbCommissioningModeMsg - Context message of the status of a commissioning process
    518           *
    519           * @return  none
    520           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    521          static void zclSampleLight_ProcessCommissioningStatus(bdbCommissioningModeMsg_t *bdbCommissioningModeMsg)
   \                     zclSampleLight_ProcessCommissioningStatus:
    522          {
   \   000000   74F7         MOV       A,#-0x9
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV       A,R2
   \   000006   FE           MOV       R6,A
   \   000007   EB           MOV       A,R3
   \   000008   FF           MOV       R7,A
    523            switch(bdbCommissioningModeMsg->bdbCommissioningMode)
   \   000009   8E82         MOV       DPL,R6
   \   00000B   8F83         MOV       DPH,R7
   \   00000D   A3           INC       DPTR
   \   00000E   E0           MOVX      A,@DPTR
   \   00000F   6402         XRL       A,#0x2
   \   000011   7010         JNZ       ??zclSampleLight_ProcessCommissioningStatus_0
    524            {
    525              case BDB_COMMISSIONING_FORMATION:
    526                if(bdbCommissioningModeMsg->bdbCommissioningStatus == BDB_COMMISSIONING_SUCCESS)
   \   000013   8E82         MOV       DPL,R6
   \   000015   8F83         MOV       DPH,R7
   \   000017   E0           MOVX      A,@DPTR
   \   000018   7009         JNZ       ??zclSampleLight_ProcessCommissioningStatus_0
    527                {
    528                  //After formation, perform nwk steering again plus the remaining commissioning modes that has not been process yet
    529                  bdb_StartCommissioning(BDB_COMMISSIONING_MODE_NWK_STEERING | bdbCommissioningModeMsg->bdbRemainingCommissioningModes);
   \   00001A                ; Setup parameters for call to function bdb_StartCommissioning
   \   00001A   A3           INC       DPTR
   \   00001B   A3           INC       DPTR
   \   00001C   E0           MOVX      A,@DPTR
   \   00001D   4402         ORL       A,#0x2
   \   00001F   F9           MOV       R1,A
   \   000020   12....       LCALL     `??bdb_StartCommissioning::?relay`; Banked call to: bdb_StartCommissioning
    530                }
    531                else
    532                {
    533                  //Want to try other channels?
    534                  //try with bdb_setChannelAttribute
    535                }
    536              break;
    537              case BDB_COMMISSIONING_NWK_STEERING:
    538                if(bdbCommissioningModeMsg->bdbCommissioningStatus == BDB_COMMISSIONING_SUCCESS)
    539                {
    540                  //YOUR JOB:
    541                  //We are on the nwk, what now?
    542                }
    543                else
    544                {
    545                  //See the possible errors for nwk steering procedure
    546                  //No suitable networks found
    547                  //Want to try other channels?
    548                  //try with bdb_setChannelAttribute
    549                }
    550              break;
    551              case BDB_COMMISSIONING_FINDING_BINDING:
    552                if(bdbCommissioningModeMsg->bdbCommissioningStatus == BDB_COMMISSIONING_SUCCESS)
    553                {
    554                  //YOUR JOB:
    555                }
    556                else
    557                {
    558                  //YOUR JOB:
    559                  //retry?, wait for user interaction?
    560                }
    561              break;
    562              case BDB_COMMISSIONING_INITIALIZATION:
    563                //Initialization notification can only be successful. Failure on initialization 
    564                //only happens for ZED and is notified as BDB_COMMISSIONING_PARENT_LOST notification
    565                
    566                //YOUR JOB:
    567                //We are on a network, what now?
    568                
    569              break;
    570          #if ZG_BUILD_ENDDEVICE_TYPE    
    571              case BDB_COMMISSIONING_PARENT_LOST:
    572                if(bdbCommissioningModeMsg->bdbCommissioningStatus == BDB_COMMISSIONING_NETWORK_RESTORED)
    573                {
    574                  //We did recover from losing parent
    575                }
    576                else
    577                {
    578                  //Parent not found, attempt to rejoin again after a fixed delay
    579                  osal_start_timerEx(zclSampleLight_TaskID, SAMPLEAPP_END_DEVICE_REJOIN_EVT, SAMPLEAPP_END_DEVICE_REJOIN_DELAY);
    580                }
    581              break;
    582          #endif 
    583            }
    584            
    585            UI_UpdateComissioningStatus(bdbCommissioningModeMsg);
   \                     ??zclSampleLight_ProcessCommissioningStatus_0:
   \   000023                ; Setup parameters for call to function UI_UpdateComissioningStatus
   \   000023   EE           MOV       A,R6
   \   000024   FA           MOV       R2,A
   \   000025   EF           MOV       A,R7
   \   000026   FB           MOV       R3,A
   \   000027   12....       LCALL     `??UI_UpdateComissioningStatus::?relay`; Banked call to: UI_UpdateComissioningStatus
    586          }
   \   00002A   02....       LJMP      ?Subroutine1 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7F01         MOV       R7,#0x1
   \   000002   02....       LJMP      ?BANKED_LEAVE_XDATA
    587          
    588          /*********************************************************************
    589           * @fn      zclSampleLight_BasicResetCB
    590           *
    591           * @brief   Callback from the ZCL General Cluster Library
    592           *          to set all the Basic Cluster attributes to default values.
    593           *
    594           * @param   none
    595           *
    596           * @return  none
    597           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    598          static void zclSampleLight_BasicResetCB( void )
   \                     zclSampleLight_BasicResetCB:
    599          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    600            //Reset every attribute in all supported cluster to their default value.
    601          
    602            zclSampleLight_ResetAttributesToDefaultValues();
   \   000004                ; Setup parameters for call to function zclSampleLight_ResetAttributesToDefaultValues
   \   000004   12....       LCALL     ??zclSampleLight_ResetAttributesToDefaultValues; Banked call to: zclSampleLight_ResetAttributesToDefaultValues
    603          
    604            zclSampleLight_UpdateLedState();
   \   000007                ; Setup parameters for call to function zclSampleLight_UpdateLedState
   \   000007   12....       LCALL     `??zclSampleLight_UpdateLedState::?relay`; Banked call to: zclSampleLight_UpdateLedState
    605          
    606            // update the display
    607            UI_UpdateLcd( ); 
   \   00000A                ; Setup parameters for call to function UI_UpdateLcd
   \   00000A   12....       LCALL     `??UI_UpdateLcd::?relay`; Banked call to: UI_UpdateLcd
    608          }
   \   00000D   02....       LJMP      ?Subroutine0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   D083         POP       DPH
   \   000002   D082         POP       DPL
   \   000004   02....       LJMP      ?BRET
    609          
    610          /*********************************************************************
    611           * @fn      zclSampleLight_OnOffCB
    612           *
    613           * @brief   Callback from the ZCL General Cluster Library when
    614           *          it received an On/Off Command for this application.
    615           *
    616           * @param   cmd - COMMAND_ON, COMMAND_OFF or COMMAND_TOGGLE
    617           *
    618           * @return  none
    619           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    620          static void zclSampleLight_OnOffCB( uint8 cmd )
   \                     zclSampleLight_OnOffCB:
    621          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000                REQUIRE ?V4
   \   000000                REQUIRE ?V5
   \   000000                REQUIRE ?V6
   \   000000                REQUIRE ?V7
   \   000000   74F0         MOV       A,#-0x10
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
   \   000005   E9           MOV       A,R1
   \   000006   FF           MOV       R7,A
    622            afIncomingMSGPacket_t *pPtr = zcl_getRawAFMsg();
   \   000007                ; Setup parameters for call to function zcl_getRawAFMsg
   \   000007   12....       LCALL     `??zcl_getRawAFMsg::?relay`; Banked call to: zcl_getRawAFMsg
   \   00000A   8A82         MOV       DPL,R2
   \   00000C   8B83         MOV       DPH,R3
    623          
    624            uint8 OnOff;
    625          
    626            zclSampleLight_DstAddr.addr.shortAddr = pPtr->srcAddr.addr.shortAddr;
   \   00000E   A3           INC       DPTR
   \   00000F   A3           INC       DPTR
   \   000010   A3           INC       DPTR
   \   000011   A3           INC       DPTR
   \   000012   A3           INC       DPTR
   \   000013   A3           INC       DPTR
   \   000014   12....       LCALL     ?Subroutine9 & 0xFFFF
   \                     ??CrossCallReturnLabel_19:
   \   000017   90....       MOV       DPTR,#zclSampleLight_DstAddr
   \   00001A   E8           MOV       A,R0
   \   00001B   F0           MOVX      @DPTR,A
   \   00001C   A3           INC       DPTR
   \   00001D   E9           MOV       A,R1
   \   00001E   F0           MOVX      @DPTR,A
    627          
    628          
    629            // Turn on the light
    630            if ( cmd == COMMAND_ON )
   \   00001F   7401         MOV       A,#0x1
   \   000021   6F           XRL       A,R7
   \   000022   602D         JZ        ??zclSampleLight_OnOffCB_0
    631            {
    632              OnOff = LIGHT_ON;
    633            }
    634            // Turn off the light
    635            else if ( cmd == COMMAND_OFF )
   \   000024   EF           MOV       A,R7
   \   000025   6010         JZ        ??zclSampleLight_OnOffCB_1
    636            {
    637              OnOff = LIGHT_OFF;
    638            }
    639            // Toggle the light
    640            else if ( cmd == COMMAND_TOGGLE )
   \   000027   7402         MOV       A,#0x2
   \   000029   6F           XRL       A,R7
   \   00002A   7022         JNZ       ??zclSampleLight_OnOffCB_2
    641            {
    642          #ifdef ZCL_LEVEL_CTRL
    643              if (zclSampleLight_LevelRemainingTime > 0) 
   \   00002C   12....       LCALL     ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_0:
   \   00002F   6013         JZ        ??zclSampleLight_OnOffCB_3
    644              {
    645                if (zclSampleLight_NewLevelUp)
   \   000031   90....       MOV       DPTR,#zclSampleLight_NewLevelUp
   \   000034   E0           MOVX      A,@DPTR
   \   000035   601A         JZ        ??zclSampleLight_OnOffCB_0
   \                     ??zclSampleLight_OnOffCB_1:
   \   000037   90....       MOV       DPTR,#zclSampleLight_LevelChangeCmd
   \   00003A   7402         MOV       A,#0x2
   \   00003C   F0           MOVX      @DPTR,A
   \   00003D   7E01         MOV       R6,#0x1
   \   00003F   90....       MOV       DPTR,#zclSampleLight_LevelOffTransitionTime
   \   000042   802E         SJMP      ??zclSampleLight_OnOffCB_4
    646                {
    647                  OnOff = LIGHT_OFF;
    648                }
    649                else
    650                {
    651                  OnOff = LIGHT_ON;
    652                }
    653              }
    654              else
    655              {
    656                if (zclSampleLight_OnOff == LIGHT_ON)
   \                     ??zclSampleLight_OnOffCB_3:
   \   000044   90....       MOV       DPTR,#zclSampleLight_OnOff
   \   000047   E0           MOVX      A,@DPTR
   \   000048   6401         XRL       A,#0x1
   \   00004A   7005         JNZ       ??zclSampleLight_OnOffCB_0
   \   00004C   80E9         SJMP      ??zclSampleLight_OnOffCB_1
    657                {
    658                  OnOff = LIGHT_OFF;
    659                }
    660                else
    661                {
    662                  OnOff = LIGHT_ON;
    663                }
    664              }
    665          #else
    666              if (zclSampleLight_OnOff == LIGHT_ON)
    667              {
    668                OnOff = LIGHT_OFF;
    669              }
    670              else
    671              {
    672                OnOff = LIGHT_ON;
    673              }
    674          #endif
    675            }
    676          
    677          #ifdef ZCL_LEVEL_CTRL
    678            zclSampleLight_LevelChangeCmd = (OnOff == LIGHT_ON ? LEVEL_CHANGED_BY_ON_CMD : LEVEL_CHANGED_BY_OFF_CMD);
   \                     ??zclSampleLight_OnOffCB_2:
   \   00004E   EA           MOV       A,R2
   \   00004F   60E6         JZ        ??zclSampleLight_OnOffCB_1
   \                     ??zclSampleLight_OnOffCB_0:
   \   000051   90....       MOV       DPTR,#zclSampleLight_LevelChangeCmd
   \   000054   7401         MOV       A,#0x1
   \   000056   F0           MOVX      @DPTR,A
   \   000057   90....       MOV       DPTR,#zclSampleLight_OnOff
   \   00005A   E0           MOVX      A,@DPTR
   \   00005B   7006         JNZ       ??zclSampleLight_OnOffCB_5
   \   00005D   90....       MOV       DPTR,#zclSampleLight_LevelCurrentLevel
   \   000060   7401         MOV       A,#0x1
   \   000062   F0           MOVX      @DPTR,A
   \                     ??zclSampleLight_OnOffCB_5:
   \   000063   90....       MOV       DPTR,#zclSampleLight_LevelOnLevel
   \   000066   E0           MOVX      A,@DPTR
   \   000067   F4           CPL       A
   \   000068   7003         JNZ       ??zclSampleLight_OnOffCB_6
   \   00006A   90....       MOV       DPTR,#zclSampleLight_LevelLastLevel
   \                     ??zclSampleLight_OnOffCB_6:
   \   00006D   E0           MOVX      A,@DPTR
   \   00006E   FE           MOV       R6,A
   \   00006F   90....       MOV       DPTR,#zclSampleLight_LevelOnTransitionTime
   \                     ??zclSampleLight_OnOffCB_4:
   \   000072   12....       LCALL     ?Subroutine9 & 0xFFFF
   \                     ??CrossCallReturnLabel_20:
   \   000075   74FF         MOV       A,#-0x1
   \   000077   68           XRL       A,R0
   \   000078   7003         JNZ       ??zclSampleLight_OnOffCB_7
   \   00007A   74FF         MOV       A,#-0x1
   \   00007C   69           XRL       A,R1
   \                     ??zclSampleLight_OnOffCB_7:
   \   00007D   7006         JNZ       ??CrossCallReturnLabel_21
   \   00007F   90....       MOV       DPTR,#zclSampleLight_LevelOnOffTransitionTime
   \   000082   12....       LCALL     ?Subroutine9 & 0xFFFF
   \                     ??CrossCallReturnLabel_21:
   \   000085   74FF         MOV       A,#-0x1
   \   000087   68           XRL       A,R0
   \   000088   7003         JNZ       ??zclSampleLight_OnOffCB_8
   \   00008A   74FF         MOV       A,#-0x1
   \   00008C   69           XRL       A,R1
   \                     ??zclSampleLight_OnOffCB_8:
   \   00008D   7004         JNZ       ??zclSampleLight_OnOffCB_9
   \   00008F   7801         MOV       R0,#0x1
   \   000091   7900         MOV       R1,#0x0
   \                     ??zclSampleLight_OnOffCB_9:
   \   000093   90....       MOV       DPTR,#zclSampleLight_WithOnOff
   \   000096   7401         MOV       A,#0x1
   \   000098   F0           MOVX      @DPTR,A
   \   000099                ; Setup parameters for call to function zclSampleLight_MoveBasedOnRate
   \   000099   75..18       MOV       ?V0,#0x18
   \   00009C   75..E4       MOV       ?V1,#-0x1c
   \   00009F   75..03       MOV       ?V2,#0x3
   \   0000A2   75..00       MOV       ?V3,#0x0
   \   0000A5   88..         MOV       ?V4,R0
   \   0000A7   89..         MOV       ?V5,R1
   \   0000A9   E4           CLR       A
   \   0000AA   F5..         MOV       ?V6,A
   \   0000AC   F5..         MOV       ?V7,A
   \   0000AE   78..         MOV       R0,#?V0
   \   0000B0   79..         MOV       R1,#?V4
   \   0000B2   12....       LCALL     ?L_DIV_MOD
   \   0000B5   AA..         MOV       R2,?V0
   \   0000B7   AB..         MOV       R3,?V1
   \   0000B9   AC..         MOV       R4,?V2
   \   0000BB   AD..         MOV       R5,?V3
   \   0000BD   EE           MOV       A,R6
   \   0000BE   F9           MOV       R1,A
   \   0000BF   12....       LCALL     `??zclSampleLight_MoveBasedOnRate::?relay`; Banked call to: zclSampleLight_MoveBasedOnRate
    679          
    680            zclSampleLight_DefaultMove(OnOff);
    681          #else
    682            zclSampleLight_OnOff = OnOff;
    683          #endif
    684          
    685            zclSampleLight_UpdateLedState();
   \   0000C2                ; Setup parameters for call to function zclSampleLight_UpdateLedState
   \   0000C2   12....       LCALL     `??zclSampleLight_UpdateLedState::?relay`; Banked call to: zclSampleLight_UpdateLedState
    686            
    687            // update the display
    688            UI_UpdateLcd( );
   \   0000C5                ; Setup parameters for call to function UI_UpdateLcd
   \   0000C5   12....       LCALL     `??UI_UpdateLcd::?relay`; Banked call to: UI_UpdateLcd
    689          }
   \   0000C8   02....       LJMP      ??Subroutine10_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine10_0:
   \   000000   7F08         MOV       R7,#0x8
   \   000002   02....       LJMP      ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   90....       MOV       DPTR,#zclSampleLight_LevelRemainingTime
   \   000003   12....       LCALL     ?Subroutine9 & 0xFFFF
   \                     ??CrossCallReturnLabel_22:
   \   000006   E8           MOV       A,R0
   \   000007   49           ORL       A,R1
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine9:
   \   000000   E0           MOVX      A,@DPTR
   \   000001   F8           MOV       R0,A
   \   000002   A3           INC       DPTR
   \   000003   E0           MOVX      A,@DPTR
   \   000004   F9           MOV       R1,A
   \   000005   22           RET
    690          
    691          #ifdef ZCL_LEVEL_CTRL
    692          /*********************************************************************
    693           * @fn      zclSampleLight_TimeRateHelper
    694           *
    695           * @brief   Calculate time based on rate, and startup level state machine
    696           *
    697           * @param   newLevel - new level for current level
    698           *
    699           * @return  diff (directly), zclSampleLight_CurrentLevel32 and zclSampleLight_NewLevel, zclSampleLight_NewLevelUp
    700           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    701          static uint32 zclSampleLight_TimeRateHelper( uint8 newLevel )
   \                     zclSampleLight_TimeRateHelper:
    702          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000                REQUIRE ?V4
   \   000000                REQUIRE ?V5
   \   000000                REQUIRE ?V6
   \   000000                REQUIRE ?V7
   \   000000   74F0         MOV       A,#-0x10
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
   \   000005   E9           MOV       A,R1
   \   000006   FE           MOV       R6,A
    703            uint32 diff;
    704            uint32 newLevel32;
    705          
    706            // remember current and new level
    707            zclSampleLight_NewLevel = newLevel;
   \   000007   90....       MOV       DPTR,#zclSampleLight_NewLevel
   \   00000A   F0           MOVX      @DPTR,A
    708            zclSampleLight_CurrentLevel32 = (uint32)1000 * zclSampleLight_LevelCurrentLevel;
   \   00000B   90....       MOV       DPTR,#zclSampleLight_LevelCurrentLevel
   \   00000E   12....       LCALL     ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_6:
   \   000011   90....       MOV       DPTR,#__Constant_3e8
   \   000014   78..         MOV       R0,#?V4
   \   000016   12....       LCALL     ?L_MOV_X
   \   000019   78..         MOV       R0,#?V0
   \   00001B   79..         MOV       R1,#?V4
   \   00001D   12....       LCALL     ?L_MUL
   \   000020   90....       MOV       DPTR,#zclSampleLight_CurrentLevel32
   \   000023   78..         MOV       R0,#?V0
   \   000025   12....       LCALL     ?L_MOV_TO_X
    709          
    710            // calculate diff
    711            newLevel32 = (uint32)1000 * newLevel;
   \   000028   8E..         MOV       ?V4,R6
   \   00002A   E4           CLR       A
   \   00002B   F5..         MOV       ?V5,A
   \   00002D   F5..         MOV       ?V6,A
   \   00002F   F5..         MOV       ?V7,A
   \   000031   90....       MOV       DPTR,#__Constant_3e8
   \   000034   78..         MOV       R0,#?V0
   \   000036   12....       LCALL     ?L_MOV_X
   \   000039   78..         MOV       R0,#?V4
   \   00003B   79..         MOV       R1,#?V0
   \   00003D   12....       LCALL     ?L_MUL
    712            if ( zclSampleLight_LevelCurrentLevel > newLevel )
   \   000040   90....       MOV       DPTR,#zclSampleLight_LevelCurrentLevel
   \   000043   E0           MOVX      A,@DPTR
   \   000044   F8           MOV       R0,A
   \   000045   EE           MOV       A,R6
   \   000046   C3           CLR       C
   \   000047   98           SUBB      A,R0
   \   000048   90....       MOV       DPTR,#zclSampleLight_CurrentLevel32
   \   00004B   501E         JNC       ??zclSampleLight_TimeRateHelper_0
    713            {
    714              diff = zclSampleLight_CurrentLevel32 - newLevel32;
   \   00004D   78..         MOV       R0,#?V0
   \   00004F   12....       LCALL     ?L_MOV_X
   \   000052   78..         MOV       R0,#?V0
   \   000054   79..         MOV       R1,#?V4
   \   000056   12....       LCALL     ?L_SUB
   \   000059   85....       MOV       ?V4,?V0
   \   00005C   85....       MOV       ?V5,?V1
   \   00005F   85....       MOV       ?V6,?V2
   \   000062   85....       MOV       ?V7,?V3
    715              zclSampleLight_NewLevelUp = FALSE;  // moving down
   \   000065   90....       MOV       DPTR,#zclSampleLight_NewLevelUp
   \   000068   E4           CLR       A
   \   000069   800A         SJMP      ??zclSampleLight_TimeRateHelper_1
    716            }
    717            else
    718            {
    719              diff = newLevel32 - zclSampleLight_CurrentLevel32;
   \                     ??zclSampleLight_TimeRateHelper_0:
   \   00006B   78..         MOV       R0,#?V4
   \   00006D   12....       LCALL     ?L_SUB_X
    720              zclSampleLight_NewLevelUp = TRUE;   // moving up
   \   000070   90....       MOV       DPTR,#zclSampleLight_NewLevelUp
   \   000073   7401         MOV       A,#0x1
   \                     ??zclSampleLight_TimeRateHelper_1:
   \   000075   F0           MOVX      @DPTR,A
    721            }
    722          
    723            return ( diff );
   \   000076   AA..         MOV       R2,?V4
   \   000078   AB..         MOV       R3,?V5
   \   00007A   AC..         MOV       R4,?V6
   \   00007C   AD..         MOV       R5,?V7
   \   00007E   80..         SJMP      ??Subroutine10_0
    724          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine8:
   \   000000   E0           MOVX      A,@DPTR
   \   000001   F5..         MOV       ?V0,A
   \   000003   E4           CLR       A
   \   000004   F5..         MOV       ?V1,A
   \   000006   F5..         MOV       ?V2,A
   \   000008   F5..         MOV       ?V3,A
   \   00000A   22           RET
    725          
    726          /*********************************************************************
    727           * @fn      zclSampleLight_MoveBasedOnRate
    728           *
    729           * @brief   Calculate time based on rate, and startup level state machine
    730           *
    731           * @param   newLevel - new level for current level
    732           * @param   rate16   - fixed point rate (e.g. 16.123)
    733           *
    734           * @return  none
    735           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   90....       MOV       DPTR,#__Constant_64
   \   000003   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   000006   7A02         MOV       R2,#0x2
   \   000008   7B00         MOV       R3,#0x0
   \   00000A   90....       MOV       DPTR,#zclSampleLight_TaskID
   \   00000D   E0           MOVX      A,@DPTR
   \   00000E   F9           MOV       R1,A
   \   00000F   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   000012   7404         MOV       A,#0x4
   \   000014   12....       LCALL     ?DEALLOC_XSTACK8
   \   000017                REQUIRE ??Subroutine10_0
   \   000017                ; // Fall through to label ??Subroutine10_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    736          static void zclSampleLight_MoveBasedOnRate( uint8 newLevel, uint32 rate )
   \                     zclSampleLight_MoveBasedOnRate:
    737          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000                REQUIRE ?V4
   \   000000                REQUIRE ?V5
   \   000000                REQUIRE ?V6
   \   000000                REQUIRE ?V7
   \   000000   74F0         MOV       A,#-0x10
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV       ?V4,R2
   \   000007   8B..         MOV       ?V5,R3
   \   000009   8C..         MOV       ?V6,R4
   \   00000B   8D..         MOV       ?V7,R5
    738            uint32 diff;
    739          
    740            // determine how much time (in 10ths of seconds) based on the difference and rate
    741            zclSampleLight_Rate32 = rate;
   \   00000D   90....       MOV       DPTR,#zclSampleLight_Rate32
   \   000010   78..         MOV       R0,#?V4
   \   000012   12....       LCALL     ?L_MOV_TO_X
    742            diff = zclSampleLight_TimeRateHelper( newLevel );
    743            zclSampleLight_LevelRemainingTime = diff / rate;
   \   000015                ; Setup parameters for call to function zclSampleLight_TimeRateHelper
   \   000015   12....       LCALL     `??zclSampleLight_TimeRateHelper::?relay`; Banked call to: zclSampleLight_TimeRateHelper
   \   000018   8A..         MOV       ?V0,R2
   \   00001A   8B..         MOV       ?V1,R3
   \   00001C   8C..         MOV       ?V2,R4
   \   00001E   8D..         MOV       ?V3,R5
   \   000020   78..         MOV       R0,#?V0
   \   000022   79..         MOV       R1,#?V4
   \   000024   12....       LCALL     ?UL_DIV_MOD
   \   000027   90....       MOV       DPTR,#zclSampleLight_LevelRemainingTime
   \   00002A   E5..         MOV       A,?V0
   \   00002C   F0           MOVX      @DPTR,A
   \   00002D   A3           INC       DPTR
   \   00002E   E5..         MOV       A,?V1
   \   000030   F0           MOVX      @DPTR,A
    744            if ( !zclSampleLight_LevelRemainingTime )
   \   000031   12....       LCALL     ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   000034   7009         JNZ       ??zclSampleLight_MoveBasedOnRate_0
    745            {
    746              zclSampleLight_LevelRemainingTime = 1;
   \   000036   90....       MOV       DPTR,#zclSampleLight_LevelRemainingTime
   \   000039   7401         MOV       A,#0x1
   \   00003B   F0           MOVX      @DPTR,A
   \   00003C   A3           INC       DPTR
   \   00003D   E4           CLR       A
   \   00003E   F0           MOVX      @DPTR,A
    747            }
    748          
    749            osal_start_timerEx( zclSampleLight_TaskID, SAMPLELIGHT_LEVEL_CTRL_EVT, 100 );
   \                     ??zclSampleLight_MoveBasedOnRate_0:
   \   00003F                ; Setup parameters for call to function osal_start_timerEx
   \   00003F   80..         SJMP      ?Subroutine2
    750          }
    751          
    752          /*********************************************************************
    753           * @fn      zclSampleLight_MoveBasedOnTime
    754           *
    755           * @brief   Calculate rate based on time, and startup level state machine
    756           *
    757           * @param   newLevel  - new level for current level
    758           * @param   time      - in 10ths of seconds
    759           *
    760           * @return  none
    761           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    762          static void zclSampleLight_MoveBasedOnTime( uint8 newLevel, uint16 time )
   \                     zclSampleLight_MoveBasedOnTime:
    763          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V4
   \   000000                REQUIRE ?V5
   \   000000                REQUIRE ?V6
   \   000000                REQUIRE ?V7
   \   000000   74F0         MOV       A,#-0x10
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
   \   000005   89..         MOV       ?V0,R1
   \   000007   EA           MOV       A,R2
   \   000008   FE           MOV       R6,A
   \   000009   EB           MOV       A,R3
   \   00000A   FF           MOV       R7,A
    764            uint16 diff;
    765          
    766            // determine rate (in units) based on difference and time
    767            diff = zclSampleLight_TimeRateHelper( newLevel );
   \   00000B                ; Setup parameters for call to function zclSampleLight_TimeRateHelper
   \   00000B   12....       LCALL     `??zclSampleLight_TimeRateHelper::?relay`; Banked call to: zclSampleLight_TimeRateHelper
   \   00000E   8A..         MOV       ?V4,R2
   \   000010   8B..         MOV       ?V5,R3
   \   000012   A8..         MOV       R0,?V4
   \   000014   A9..         MOV       R1,?V5
    768            zclSampleLight_LevelRemainingTime = zclSampleLight_GetTime( newLevel, time );
   \   000016   EE           MOV       A,R6
   \   000017   FA           MOV       R2,A
   \   000018   EF           MOV       A,R7
   \   000019   FB           MOV       R3,A
   \   00001A   74FF         MOV       A,#-0x1
   \   00001C   6A           XRL       A,R2
   \   00001D   7003         JNZ       ??zclSampleLight_MoveBasedOnTime_0
   \   00001F   74FF         MOV       A,#-0x1
   \   000021   6B           XRL       A,R3
   \                     ??zclSampleLight_MoveBasedOnTime_0:
   \   000022   7030         JNZ       ??zclSampleLight_MoveBasedOnTime_1
   \   000024   90....       MOV       DPTR,#zclSampleLight_LevelCurrentLevel
   \   000027   E0           MOVX      A,@DPTR
   \   000028   FA           MOV       R2,A
   \   000029   E5..         MOV       A,?V0
   \   00002B   C3           CLR       C
   \   00002C   9A           SUBB      A,R2
   \   00002D   5005         JNC       ??zclSampleLight_MoveBasedOnTime_2
   \   00002F   90....       MOV       DPTR,#zclSampleLight_LevelOffTransitionTime
   \   000032   8003         SJMP      ??zclSampleLight_MoveBasedOnTime_3
   \                     ??zclSampleLight_MoveBasedOnTime_2:
   \   000034   90....       MOV       DPTR,#zclSampleLight_LevelOnTransitionTime
   \                     ??zclSampleLight_MoveBasedOnTime_3:
   \   000037   12....       LCALL     ??Subroutine11_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   00003A   74FF         MOV       A,#-0x1
   \   00003C   6A           XRL       A,R2
   \   00003D   7003         JNZ       ??zclSampleLight_MoveBasedOnTime_4
   \   00003F   74FF         MOV       A,#-0x1
   \   000041   6B           XRL       A,R3
   \                     ??zclSampleLight_MoveBasedOnTime_4:
   \   000042   7006         JNZ       ??CrossCallReturnLabel_9
   \   000044   90....       MOV       DPTR,#zclSampleLight_LevelOnOffTransitionTime
   \   000047   12....       LCALL     ??Subroutine11_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_9:
   \   00004A   74FF         MOV       A,#-0x1
   \   00004C   6A           XRL       A,R2
   \   00004D   7003         JNZ       ??zclSampleLight_MoveBasedOnTime_5
   \   00004F   74FF         MOV       A,#-0x1
   \   000051   6B           XRL       A,R3
   \                     ??zclSampleLight_MoveBasedOnTime_5:
   \   000052   6004         JZ        ??zclSampleLight_MoveBasedOnTime_6
   \                     ??zclSampleLight_MoveBasedOnTime_1:
   \   000054   EA           MOV       A,R2
   \   000055   4B           ORL       A,R3
   \   000056   7004         JNZ       ??zclSampleLight_MoveBasedOnTime_7
   \                     ??zclSampleLight_MoveBasedOnTime_6:
   \   000058   7A01         MOV       R2,#0x1
   \   00005A   7B00         MOV       R3,#0x0
   \                     ??zclSampleLight_MoveBasedOnTime_7:
   \   00005C   90....       MOV       DPTR,#zclSampleLight_LevelRemainingTime
   \   00005F   EA           MOV       A,R2
   \   000060   F0           MOVX      @DPTR,A
   \   000061   A3           INC       DPTR
   \   000062   EB           MOV       A,R3
   \   000063   F0           MOVX      @DPTR,A
    769            zclSampleLight_Rate32 = diff / time;
   \   000064   EE           MOV       A,R6
   \   000065   FA           MOV       R2,A
   \   000066   EF           MOV       A,R7
   \   000067   FB           MOV       R3,A
   \   000068   12....       LCALL     ?US_DIV_MOD
   \   00006B   E8           MOV       A,R0
   \   00006C   FC           MOV       R4,A
   \   00006D   E9           MOV       A,R1
   \   00006E   FD           MOV       R5,A
   \   00006F   90....       MOV       DPTR,#zclSampleLight_Rate32
   \   000072   EC           MOV       A,R4
   \   000073   F0           MOVX      @DPTR,A
   \   000074   A3           INC       DPTR
   \   000075   ED           MOV       A,R5
   \   000076   F0           MOVX      @DPTR,A
   \   000077   A3           INC       DPTR
   \   000078   E4           CLR       A
   \   000079   F0           MOVX      @DPTR,A
   \   00007A   A3           INC       DPTR
   \   00007B   F0           MOVX      @DPTR,A
    770          
    771            osal_start_timerEx( zclSampleLight_TaskID, SAMPLELIGHT_LEVEL_CTRL_EVT, 100 );
   \   00007C                ; Setup parameters for call to function osal_start_timerEx
   \   00007C   02....       LJMP      ?Subroutine2 & 0xFFFF
    772          }
    773          
    774          /*********************************************************************
    775           * @fn      zclSampleLight_GetTime
    776           *
    777           * @brief   Determine amount of time that MoveXXX will take to complete.
    778           *
    779           * @param   level = new level to move to
    780           *          time  = 0xffff=default, or 0x0000-n amount of time in tenths of seconds.
    781           *
    782           * @return  none
    783           */
    784          static uint16 zclSampleLight_GetTime( uint8 newLevel, uint16 time )
    785          {
    786            // there is a hiearchy of the amount of time to use for transistioning
    787            // check each one in turn. If none of defaults are set, then use fastest
    788            // time possible.
    789            if ( time == 0xFFFF )
    790            {
    791              // use On or Off Transition Time if set (not 0xffff)
    792              if ( zclSampleLight_LevelCurrentLevel > newLevel )
    793              {
    794                time = zclSampleLight_LevelOffTransitionTime;
    795              }
    796              else
    797              {
    798                time = zclSampleLight_LevelOnTransitionTime;
    799              }
    800          
    801              // else use OnOffTransitionTime if set (not 0xffff)
    802              if ( time == 0xFFFF )
    803              {
    804                time = zclSampleLight_LevelOnOffTransitionTime;
    805              }
    806          
    807              // else as fast as possible
    808              if ( time == 0xFFFF )
    809              {
    810                time = 1;
    811              }
    812            }
    813          
    814            if ( time == 0 )
    815            {
    816              time = 1; // as fast as possible
    817            }
    818          
    819            return ( time );
    820          }
    821          
    822          /*********************************************************************
    823           * @fn      zclSampleLight_DefaultMove
    824           *
    825           * @brief   We were turned on/off. Use default time to move to on or off.
    826           *
    827           * @param   zclSampleLight_OnOff - must be set prior to calling this function.
    828           *
    829           * @return  none
    830           */
    831          static void zclSampleLight_DefaultMove( uint8 OnOff )
    832          {
    833            uint8  newLevel;
    834            uint32 rate;      // fixed point decimal (3 places, eg. 16.345)
    835            uint16 time;
    836          
    837            // if moving to on position, move to on level
    838            if ( OnOff )
    839            {
    840              if (zclSampleLight_OnOff == LIGHT_OFF)
    841              {
    842                zclSampleLight_LevelCurrentLevel = ATTR_LEVEL_MIN_LEVEL;
    843              }
    844              
    845              if ( zclSampleLight_LevelOnLevel == ATTR_LEVEL_ON_LEVEL_NO_EFFECT )
    846              {
    847                // The last Level (before going OFF) should be used)
    848                newLevel = zclSampleLight_LevelLastLevel;
    849              }
    850              else
    851              {
    852                newLevel = zclSampleLight_LevelOnLevel;
    853              }
    854          
    855              time = zclSampleLight_LevelOnTransitionTime;
    856          
    857            }
    858            else
    859            {
    860              newLevel = ATTR_LEVEL_MIN_LEVEL;
    861          
    862              time = zclSampleLight_LevelOffTransitionTime;
    863            }
    864          
    865            // else use OnOffTransitionTime if set (not 0xffff)
    866            if ( time == 0xFFFF )
    867            {
    868              time = zclSampleLight_LevelOnOffTransitionTime;
    869            }
    870          
    871            // else as fast as possible
    872            if ( time == 0xFFFF )
    873            {
    874              time = 1;
    875            }
    876          
    877            // calculate rate based on time (int 10ths) for full transition (1-254)
    878            rate = 255000 / time;    // units per tick, fixed point, 3 decimal places (e.g. 8500 = 8.5 units per tick)
    879          
    880            // start up state machine.
    881            zclSampleLight_WithOnOff = TRUE;
    882            zclSampleLight_MoveBasedOnRate( newLevel, rate );
    883          }
    884          
    885          /*********************************************************************
    886           * @fn      zclSampleLight_AdjustLightLevel
    887           *
    888           * @brief   Called each 10th of a second while state machine running
    889           *
    890           * @param   none
    891           *
    892           * @return  none
    893           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    894          static void zclSampleLight_AdjustLightLevel( void )
   \                     zclSampleLight_AdjustLightLevel:
    895          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000                REQUIRE ?V4
   \   000000                REQUIRE ?V5
   \   000000                REQUIRE ?V6
   \   000000                REQUIRE ?V7
   \   000000   74F0         MOV       A,#-0x10
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
    896            // one tick (10th of a second) less
    897            if ( zclSampleLight_LevelRemainingTime )
   \   000005   12....       LCALL     ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_2:
   \   000008   6012         JZ        ??zclSampleLight_AdjustLightLevel_0
    898            {
    899              --zclSampleLight_LevelRemainingTime;
    900            }
    901          
    902            // no time left, done
    903            if ( zclSampleLight_LevelRemainingTime == 0)
   \   00000A   90....       MOV       DPTR,#zclSampleLight_LevelRemainingTime
   \   00000D   E0           MOVX      A,@DPTR
   \   00000E   24FF         ADD       A,#-0x1
   \   000010   F0           MOVX      @DPTR,A
   \   000011   18           DEC       R0
   \   000012   A3           INC       DPTR
   \   000013   E0           MOVX      A,@DPTR
   \   000014   34FF         ADDC      A,#-0x1
   \   000016   F0           MOVX      @DPTR,A
   \   000017   F9           MOV       R1,A
   \   000018   E8           MOV       A,R0
   \   000019   49           ORL       A,R1
   \   00001A   7006         JNZ       ??zclSampleLight_AdjustLightLevel_1
    904            {
    905              zclSampleLight_LevelCurrentLevel = zclSampleLight_NewLevel;
   \                     ??zclSampleLight_AdjustLightLevel_0:
   \   00001C   90....       MOV       DPTR,#zclSampleLight_NewLevel
   \   00001F   E0           MOVX      A,@DPTR
   \   000020   803C         SJMP      ??zclSampleLight_AdjustLightLevel_2
    906            }
    907          
    908            // still time left, keep increment/decrementing
    909            else
    910            {
    911              if ( zclSampleLight_NewLevelUp )
   \                     ??zclSampleLight_AdjustLightLevel_1:
   \   000022   90....       MOV       DPTR,#zclSampleLight_NewLevelUp
   \   000025   E0           MOVX      A,@DPTR
   \   000026   90....       MOV       DPTR,#zclSampleLight_Rate32
   \   000029   78..         MOV       R0,#?V0
   \   00002B   600D         JZ        ??zclSampleLight_AdjustLightLevel_3
    912              {
    913                zclSampleLight_CurrentLevel32 += zclSampleLight_Rate32;
   \   00002D   12....       LCALL     ?L_MOV_X
   \   000030   90....       MOV       DPTR,#zclSampleLight_CurrentLevel32
   \   000033   78..         MOV       R0,#?V0
   \   000035   12....       LCALL     ?L_ADD_TO_X
   \   000038   800B         SJMP      ??zclSampleLight_AdjustLightLevel_4
    914              }
    915              else
    916              {
    917                zclSampleLight_CurrentLevel32 -= zclSampleLight_Rate32;
   \                     ??zclSampleLight_AdjustLightLevel_3:
   \   00003A   12....       LCALL     ?L_MOV_X
   \   00003D   90....       MOV       DPTR,#zclSampleLight_CurrentLevel32
   \   000040   78..         MOV       R0,#?V0
   \   000042   12....       LCALL     ?L_SUB_FROM_X
    918              }
    919              zclSampleLight_LevelCurrentLevel = (uint8)( zclSampleLight_CurrentLevel32 / 1000 );
   \                     ??zclSampleLight_AdjustLightLevel_4:
   \   000045   90....       MOV       DPTR,#zclSampleLight_CurrentLevel32
   \   000048   78..         MOV       R0,#?V0
   \   00004A   12....       LCALL     ?L_MOV_X
   \   00004D   90....       MOV       DPTR,#__Constant_3e8
   \   000050   78..         MOV       R0,#?V4
   \   000052   12....       LCALL     ?L_MOV_X
   \   000055   78..         MOV       R0,#?V0
   \   000057   79..         MOV       R1,#?V4
   \   000059   12....       LCALL     ?L_DIV_MOD
   \   00005C   E5..         MOV       A,?V0
   \                     ??zclSampleLight_AdjustLightLevel_2:
   \   00005E   90....       MOV       DPTR,#zclSampleLight_LevelCurrentLevel
   \   000061   F0           MOVX      @DPTR,A
    920            }
    921          
    922            if (( zclSampleLight_LevelChangeCmd == LEVEL_CHANGED_BY_LEVEL_CMD ) && ( zclSampleLight_LevelOnLevel == ATTR_LEVEL_ON_LEVEL_NO_EFFECT ))
   \   000062   90....       MOV       DPTR,#zclSampleLight_LevelChangeCmd
   \   000065   E0           MOVX      A,@DPTR
   \   000066   700F         JNZ       ??zclSampleLight_AdjustLightLevel_5
   \   000068   90....       MOV       DPTR,#zclSampleLight_LevelOnLevel
   \   00006B   E0           MOVX      A,@DPTR
   \   00006C   F4           CPL       A
   \   00006D   7008         JNZ       ??zclSampleLight_AdjustLightLevel_5
    923            {
    924              zclSampleLight_LevelLastLevel = zclSampleLight_LevelCurrentLevel;
   \   00006F   90....       MOV       DPTR,#zclSampleLight_LevelCurrentLevel
   \   000072   E0           MOVX      A,@DPTR
   \   000073   90....       MOV       DPTR,#zclSampleLight_LevelLastLevel
   \   000076   F0           MOVX      @DPTR,A
    925            }
    926          
    927            // also affect on/off
    928            if ( zclSampleLight_WithOnOff )
   \                     ??zclSampleLight_AdjustLightLevel_5:
   \   000077   90....       MOV       DPTR,#zclSampleLight_WithOnOff
   \   00007A   E0           MOVX      A,@DPTR
   \   00007B   6037         JZ        ??zclSampleLight_AdjustLightLevel_6
    929            {
    930              if ( zclSampleLight_LevelCurrentLevel > ATTR_LEVEL_MIN_LEVEL )
   \   00007D   90....       MOV       DPTR,#zclSampleLight_LevelCurrentLevel
   \   000080   E0           MOVX      A,@DPTR
   \   000081   C3           CLR       C
   \   000082   9402         SUBB      A,#0x2
   \   000084   4007         JC        ??zclSampleLight_AdjustLightLevel_7
    931              {
    932                zclSampleLight_OnOff = LIGHT_ON;
   \   000086   90....       MOV       DPTR,#zclSampleLight_OnOff
   \   000089   7401         MOV       A,#0x1
   \   00008B   8026         SJMP      ??zclSampleLight_AdjustLightLevel_8
    933              }
    934              else
    935              {
    936                if (zclSampleLight_LevelChangeCmd != LEVEL_CHANGED_BY_ON_CMD)
   \                     ??zclSampleLight_AdjustLightLevel_7:
   \   00008D   90....       MOV       DPTR,#zclSampleLight_LevelChangeCmd
   \   000090   E0           MOVX      A,@DPTR
   \   000091   6401         XRL       A,#0x1
   \   000093   90....       MOV       DPTR,#zclSampleLight_OnOff
   \   000096   600A         JZ        ??zclSampleLight_AdjustLightLevel_9
    937                {
    938                  zclSampleLight_OnOff = LIGHT_OFF;
   \   000098   E4           CLR       A
   \   000099   F0           MOVX      @DPTR,A
    939                }
    940                else
    941                {
    942                  zclSampleLight_OnOff = LIGHT_ON;
    943                }
    944                
    945                if (( zclSampleLight_LevelChangeCmd != LEVEL_CHANGED_BY_LEVEL_CMD ) && ( zclSampleLight_LevelOnLevel == ATTR_LEVEL_ON_LEVEL_NO_EFFECT ))
   \   00009A   90....       MOV       DPTR,#zclSampleLight_LevelChangeCmd
   \   00009D   E0           MOVX      A,@DPTR
   \   00009E   7005         JNZ       ??zclSampleLight_AdjustLightLevel_10
   \   0000A0   8012         SJMP      ??zclSampleLight_AdjustLightLevel_6
   \                     ??zclSampleLight_AdjustLightLevel_9:
   \   0000A2   7401         MOV       A,#0x1
   \   0000A4   F0           MOVX      @DPTR,A
   \                     ??zclSampleLight_AdjustLightLevel_10:
   \   0000A5   90....       MOV       DPTR,#zclSampleLight_LevelOnLevel
   \   0000A8   E0           MOVX      A,@DPTR
   \   0000A9   F4           CPL       A
   \   0000AA   7008         JNZ       ??zclSampleLight_AdjustLightLevel_6
    946                {
    947                  zclSampleLight_LevelCurrentLevel = zclSampleLight_LevelLastLevel;
   \   0000AC   90....       MOV       DPTR,#zclSampleLight_LevelLastLevel
   \   0000AF   E0           MOVX      A,@DPTR
   \   0000B0   90....       MOV       DPTR,#zclSampleLight_LevelCurrentLevel
   \                     ??zclSampleLight_AdjustLightLevel_8:
   \   0000B3   F0           MOVX      @DPTR,A
    948                }
    949              }
    950            }
    951          
    952            zclSampleLight_UpdateLedState();
   \                     ??zclSampleLight_AdjustLightLevel_6:
   \   0000B4                ; Setup parameters for call to function zclSampleLight_UpdateLedState
   \   0000B4   12....       LCALL     `??zclSampleLight_UpdateLedState::?relay`; Banked call to: zclSampleLight_UpdateLedState
    953            
    954            // display light level as we go
    955            UI_UpdateLcd( );
   \   0000B7                ; Setup parameters for call to function UI_UpdateLcd
   \   0000B7   12....       LCALL     `??UI_UpdateLcd::?relay`; Banked call to: UI_UpdateLcd
    956          
    957            // keep ticking away
    958            if ( zclSampleLight_LevelRemainingTime )
   \   0000BA   12....       LCALL     ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_3:
   \   0000BD   6017         JZ        ??zclSampleLight_AdjustLightLevel_11
    959            {
    960              osal_start_timerEx( zclSampleLight_TaskID, SAMPLELIGHT_LEVEL_CTRL_EVT, 100 );
   \   0000BF                ; Setup parameters for call to function osal_start_timerEx
   \   0000BF   90....       MOV       DPTR,#__Constant_64
   \   0000C2   12....       LCALL     ?PUSH_XSTACK8_X_FOUR
   \   0000C5   7A02         MOV       R2,#0x2
   \   0000C7   7B00         MOV       R3,#0x0
   \   0000C9   90....       MOV       DPTR,#zclSampleLight_TaskID
   \   0000CC   E0           MOVX      A,@DPTR
   \   0000CD   F9           MOV       R1,A
   \   0000CE   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   0000D1   7404         MOV       A,#0x4
   \   0000D3   12....       LCALL     ?DEALLOC_XSTACK8
    961            }
    962          }
   \                     ??zclSampleLight_AdjustLightLevel_11:
   \   0000D6   02....       LJMP      ??Subroutine10_0 & 0xFFFF
    963          
    964          /*********************************************************************
    965           * @fn      zclSampleLight_LevelControlMoveToLevelCB
    966           *
    967           * @brief   Callback from the ZCL General Cluster Library when
    968           *          it received a LevelControlMoveToLevel Command for this application.
    969           *
    970           * @param   pCmd - ZigBee command parameters
    971           *
    972           * @return  none
    973           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    974          static void zclSampleLight_LevelControlMoveToLevelCB( zclLCMoveToLevel_t *pCmd )
   \                     zclSampleLight_LevelControlMoveToLevelCB:
    975          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   \   000004   EA           MOV       A,R2
   \   000005   F8           MOV       R0,A
   \   000006   EB           MOV       A,R3
   \   000007   F9           MOV       R1,A
    976            zclSampleLight_LevelChangeCmd = LEVEL_CHANGED_BY_LEVEL_CMD;
   \   000008   90....       MOV       DPTR,#zclSampleLight_LevelChangeCmd
   \   00000B   E4           CLR       A
   \   00000C   F0           MOVX      @DPTR,A
    977          
    978            zclSampleLight_WithOnOff = pCmd->withOnOff;
   \   00000D   8882         MOV       DPL,R0
   \   00000F   8983         MOV       DPH,R1
   \   000011   A3           INC       DPTR
   \   000012   A3           INC       DPTR
   \   000013   A3           INC       DPTR
   \   000014   E0           MOVX      A,@DPTR
   \   000015   90....       MOV       DPTR,#zclSampleLight_WithOnOff
   \   000018   F0           MOVX      @DPTR,A
    979            zclSampleLight_MoveBasedOnTime( pCmd->level, pCmd->transitionTime );
   \   000019                ; Setup parameters for call to function zclSampleLight_MoveBasedOnTime
   \   000019   8882         MOV       DPL,R0
   \   00001B   8983         MOV       DPH,R1
   \   00001D   12....       LCALL     ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_11:
   \   000020   8882         MOV       DPL,R0
   \   000022   8983         MOV       DPH,R1
   \   000024   E0           MOVX      A,@DPTR
   \   000025   F9           MOV       R1,A
   \   000026   12....       LCALL     `??zclSampleLight_MoveBasedOnTime::?relay`; Banked call to: zclSampleLight_MoveBasedOnTime
    980          }
   \   000029   02....       LJMP      ?Subroutine0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   A3           INC       DPTR
   \   000001                REQUIRE ??Subroutine11_0
   \   000001                ; // Fall through to label ??Subroutine11_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine11_0:
   \   000000   E0           MOVX      A,@DPTR
   \   000001   FA           MOV       R2,A
   \   000002   A3           INC       DPTR
   \   000003   E0           MOVX      A,@DPTR
   \   000004   FB           MOV       R3,A
   \   000005   22           RET
    981          
    982          /*********************************************************************
    983           * @fn      zclSampleLight_LevelControlMoveCB
    984           *
    985           * @brief   Callback from the ZCL General Cluster Library when
    986           *          it received a LevelControlMove Command for this application.
    987           *
    988           * @param   pCmd - ZigBee command parameters
    989           *
    990           * @return  none
    991           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    992          static void zclSampleLight_LevelControlMoveCB( zclLCMove_t *pCmd )
   \                     zclSampleLight_LevelControlMoveCB:
    993          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000                REQUIRE ?V4
   \   000000                REQUIRE ?V5
   \   000000                REQUIRE ?V6
   \   000000                REQUIRE ?V7
   \   000000   74F0         MOV       A,#-0x10
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
    994            uint8 newLevel;
    995            uint32 rate;
    996          
    997            // convert rate from units per second to units per tick (10ths of seconds)
    998            // and move at that right up or down
    999            zclSampleLight_WithOnOff = pCmd->withOnOff;
   \   000005   8A82         MOV       DPL,R2
   \   000007   8B83         MOV       DPH,R3
   \   000009   A3           INC       DPTR
   \   00000A   A3           INC       DPTR
   \   00000B   E0           MOVX      A,@DPTR
   \   00000C   90....       MOV       DPTR,#zclSampleLight_WithOnOff
   \   00000F   F0           MOVX      @DPTR,A
   1000          
   1001            if ( pCmd->moveMode == LEVEL_MOVE_UP )
   \   000010   8A82         MOV       DPL,R2
   \   000012   8B83         MOV       DPH,R3
   \   000014   E0           MOVX      A,@DPTR
   \   000015   7004         JNZ       ??zclSampleLight_LevelControlMoveCB_0
   1002            {
   1003              newLevel = ATTR_LEVEL_MAX_LEVEL;  // fully on
   \   000017   7EFE         MOV       R6,#-0x2
   \   000019   8002         SJMP      ??zclSampleLight_LevelControlMoveCB_1
   1004            }
   1005            else
   1006            {
   1007              newLevel = ATTR_LEVEL_MIN_LEVEL; // fully off
   \                     ??zclSampleLight_LevelControlMoveCB_0:
   \   00001B   7E01         MOV       R6,#0x1
   1008            }
   1009          
   1010            zclSampleLight_LevelChangeCmd = LEVEL_CHANGED_BY_LEVEL_CMD;
   \                     ??zclSampleLight_LevelControlMoveCB_1:
   \   00001D   12....       LCALL     ?Subroutine3 & 0xFFFF
   1011          
   1012            rate = (uint32)100 * pCmd->rate;
   1013            zclSampleLight_MoveBasedOnRate( newLevel, rate );
   \                     ??CrossCallReturnLabel_13:
   \   000020   12....       LCALL     ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   000023   90....       MOV       DPTR,#__Constant_64
   \   000026   78..         MOV       R0,#?V4
   \   000028   12....       LCALL     ?L_MOV_X
   \   00002B   78..         MOV       R0,#?V0
   \   00002D   79..         MOV       R1,#?V4
   \   00002F   12....       LCALL     ?L_MUL
   \   000032   AA..         MOV       R2,?V0
   \   000034   AB..         MOV       R3,?V1
   \   000036   AC..         MOV       R4,?V2
   \   000038   AD..         MOV       R5,?V3
   \   00003A   EE           MOV       A,R6
   \   00003B   F9           MOV       R1,A
   \   00003C   12....       LCALL     `??zclSampleLight_MoveBasedOnRate::?relay`; Banked call to: zclSampleLight_MoveBasedOnRate
   1014          }
   \   00003F   02....       LJMP      ??Subroutine10_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   90....       MOV       DPTR,#zclSampleLight_LevelChangeCmd
   \   000003   E4           CLR       A
   \   000004                REQUIRE ??Subroutine12_0
   \   000004                ; // Fall through to label ??Subroutine12_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine12_0:
   \   000000   F0           MOVX      @DPTR,A
   \   000001                ; Setup parameters for call to function zclSampleLight_MoveBasedOnRate
   \   000001                ; Setup parameters for call to function zclSampleLight_MoveBasedOnTime
   \   000001   8A82         MOV       DPL,R2
   \   000003   8B83         MOV       DPH,R3
   \   000005   A3           INC       DPTR
   \   000006   22           RET
   1015          
   1016          /*********************************************************************
   1017           * @fn      zclSampleLight_LevelControlStepCB
   1018           *
   1019           * @brief   Callback from the ZCL General Cluster Library when
   1020           *          it received an On/Off Command for this application.
   1021           *
   1022           * @param   pCmd - ZigBee command parameters
   1023           *
   1024           * @return  none
   1025           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1026          static void zclSampleLight_LevelControlStepCB( zclLCStep_t *pCmd )
   \                     zclSampleLight_LevelControlStepCB:
   1027          {
   \   000000   74F7         MOV       A,#-0x9
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   1028            uint8 newLevel;
   1029          
   1030            // determine new level, but don't exceed boundaries
   1031            if ( pCmd->stepMode == LEVEL_MOVE_UP )
   \   000005   8A82         MOV       DPL,R2
   \   000007   8B83         MOV       DPH,R3
   \   000009   A3           INC       DPTR
   \   00000A   E0           MOVX      A,@DPTR
   \   00000B   FC           MOV       R4,A
   \   00000C   8A82         MOV       DPL,R2
   \   00000E   8B83         MOV       DPH,R3
   \   000010   E0           MOVX      A,@DPTR
   \   000011   90....       MOV       DPTR,#zclSampleLight_LevelCurrentLevel
   \   000014   7017         JNZ       ??zclSampleLight_LevelControlStepCB_0
   1032            {
   1033              if ( (uint16)zclSampleLight_LevelCurrentLevel + pCmd->amount > ATTR_LEVEL_MAX_LEVEL )
   \   000016   E0           MOVX      A,@DPTR
   \   000017   2C           ADD       A,R4
   \   000018   F8           MOV       R0,A
   \   000019   E4           CLR       A
   \   00001A   3400         ADDC      A,#0x0
   \   00001C   F9           MOV       R1,A
   \   00001D   E8           MOV       A,R0
   \   00001E   94FF         SUBB      A,#-0x1
   \   000020   E9           MOV       A,R1
   \   000021   9400         SUBB      A,#0x0
   \   000023   4004         JC        ??zclSampleLight_LevelControlStepCB_1
   1034              {
   1035                newLevel = ATTR_LEVEL_MAX_LEVEL;
   \   000025   79FE         MOV       R1,#-0x2
   \   000027   8013         SJMP      ??zclSampleLight_LevelControlStepCB_2
   1036              }
   1037              else
   1038              {
   1039                newLevel = zclSampleLight_LevelCurrentLevel + pCmd->amount;
   \                     ??zclSampleLight_LevelControlStepCB_1:
   \   000029   E0           MOVX      A,@DPTR
   \   00002A   2C           ADD       A,R4
   \   00002B   800E         SJMP      ??zclSampleLight_LevelControlStepCB_3
   1040              }
   1041            }
   1042            else
   1043            {
   1044              if ( pCmd->amount >= zclSampleLight_LevelCurrentLevel )
   \                     ??zclSampleLight_LevelControlStepCB_0:
   \   00002D   E0           MOVX      A,@DPTR
   \   00002E   F8           MOV       R0,A
   \   00002F   EC           MOV       A,R4
   \   000030   C3           CLR       C
   \   000031   98           SUBB      A,R0
   \   000032   4004         JC        ??zclSampleLight_LevelControlStepCB_4
   1045              {
   1046                newLevel = ATTR_LEVEL_MIN_LEVEL;
   \   000034   7901         MOV       R1,#0x1
   \   000036   8004         SJMP      ??zclSampleLight_LevelControlStepCB_2
   1047              }
   1048              else
   1049              {
   1050                newLevel = zclSampleLight_LevelCurrentLevel - pCmd->amount;
   \                     ??zclSampleLight_LevelControlStepCB_4:
   \   000038   E0           MOVX      A,@DPTR
   \   000039   C3           CLR       C
   \   00003A   9C           SUBB      A,R4
   \                     ??zclSampleLight_LevelControlStepCB_3:
   \   00003B   F9           MOV       R1,A
   1051              }
   1052            }
   1053            
   1054            zclSampleLight_LevelChangeCmd = LEVEL_CHANGED_BY_LEVEL_CMD;
   \                     ??zclSampleLight_LevelControlStepCB_2:
   \   00003C   12....       LCALL     ?Subroutine3 & 0xFFFF
   1055          
   1056            // move to the new level
   1057            zclSampleLight_WithOnOff = pCmd->withOnOff;
   \                     ??CrossCallReturnLabel_14:
   \   00003F   A3           INC       DPTR
   \   000040   A3           INC       DPTR
   \   000041   A3           INC       DPTR
   \   000042   E0           MOVX      A,@DPTR
   \   000043   90....       MOV       DPTR,#zclSampleLight_WithOnOff
   \   000046   12....       LCALL     ??Subroutine12_0 & 0xFFFF
   1058            zclSampleLight_MoveBasedOnTime( newLevel, pCmd->transitionTime );
   \                     ??CrossCallReturnLabel_15:
   \   000049   12....       LCALL     ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_12:
   \   00004C   12....       LCALL     `??zclSampleLight_MoveBasedOnTime::?relay`; Banked call to: zclSampleLight_MoveBasedOnTime
   1059          }
   \   00004F   02....       LJMP      ?Subroutine1 & 0xFFFF
   1060          
   1061          /*********************************************************************
   1062           * @fn      zclSampleLight_LevelControlStopCB
   1063           *
   1064           * @brief   Callback from the ZCL General Cluster Library when
   1065           *          it received an Level Control Stop Command for this application.
   1066           *
   1067           * @param   pCmd - ZigBee command parameters
   1068           *
   1069           * @return  none
   1070           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1071          static void zclSampleLight_LevelControlStopCB( void )
   \                     zclSampleLight_LevelControlStopCB:
   1072          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1073            // stop immediately
   1074            osal_stop_timerEx( zclSampleLight_TaskID, SAMPLELIGHT_LEVEL_CTRL_EVT );
   \   000004                ; Setup parameters for call to function osal_stop_timerEx
   \   000004   7A02         MOV       R2,#0x2
   \   000006   7B00         MOV       R3,#0x0
   \   000008   90....       MOV       DPTR,#zclSampleLight_TaskID
   \   00000B   E0           MOVX      A,@DPTR
   \   00000C   F9           MOV       R1,A
   \   00000D   12....       LCALL     `??osal_stop_timerEx::?relay`; Banked call to: osal_stop_timerEx
   1075            zclSampleLight_LevelRemainingTime = 0;
   \   000010   90....       MOV       DPTR,#zclSampleLight_LevelRemainingTime
   \   000013   E4           CLR       A
   \   000014   F0           MOVX      @DPTR,A
   \   000015   A3           INC       DPTR
   \   000016   F0           MOVX      @DPTR,A
   1076          }
   \   000017   02....       LJMP      ?Subroutine0 & 0xFFFF
   1077          #endif
   1078          
   1079          /*********************************************************************
   1080           * @fn      zclSampleApp_BatteryWarningCB
   1081           *
   1082           * @brief   Called to handle battery-low situation.
   1083           *
   1084           * @param   voltLevel - level of severity
   1085           *
   1086           * @return  none
   1087           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1088          void zclSampleApp_BatteryWarningCB( uint8 voltLevel )
   \                     zclSampleApp_BatteryWarningCB:
   1089          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   1090            if ( voltLevel == VOLT_LEVEL_CAUTIOUS )
   1091            {
   1092              // Send warning message to the gateway and blink LED
   1093            }
   1094            else if ( voltLevel == VOLT_LEVEL_BAD )
   1095            {
   1096              // Shut down the system
   1097            }
   1098          }
   \   000000   02....       LJMP      ?BRET
   1099          
   1100          /******************************************************************************
   1101           *
   1102           *  Functions for processing ZCL Foundation incoming Command/Response messages
   1103           *
   1104           *****************************************************************************/
   1105          
   1106          /*********************************************************************
   1107           * @fn      zclSampleLight_ProcessIncomingMsg
   1108           *
   1109           * @brief   Process ZCL Foundation incoming message
   1110           *
   1111           * @param   pInMsg - pointer to the received message
   1112           *
   1113           * @return  none
   1114           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1115          static void zclSampleLight_ProcessIncomingMsg( zclIncomingMsg_t *pInMsg )
   \                     zclSampleLight_ProcessIncomingMsg:
   1116          {
   \   000000   74F7         MOV       A,#-0x9
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   1117            switch ( pInMsg->zclHdr.commandID )
   \   000005   EA           MOV       A,R2
   \   000006   2417         ADD       A,#0x17
   \   000008   F8           MOV       R0,A
   \   000009   E4           CLR       A
   \   00000A   3B           ADDC      A,R3
   \   00000B   F9           MOV       R1,A
   \   00000C   E8           MOV       A,R0
   \   00000D   FE           MOV       R6,A
   \   00000E   E9           MOV       A,R1
   \   00000F   FF           MOV       R7,A
   \   000010   8A82         MOV       DPL,R2
   \   000012   8B83         MOV       DPH,R3
   \   000014   A3           INC       DPTR
   \   000015   A3           INC       DPTR
   \   000016   A3           INC       DPTR
   \   000017   A3           INC       DPTR
   \   000018   A3           INC       DPTR
   \   000019   A3           INC       DPTR
   \   00001A   A3           INC       DPTR
   \   00001B   E0           MOVX      A,@DPTR
   \   00001C   14           DEC       A
   \   00001D   6016         JZ        ??zclSampleLight_ProcessIncomingMsg_0
   \   00001F   24FD         ADD       A,#-0x3
   \   000021   601F         JZ        ??zclSampleLight_ProcessIncomingMsg_1
   \   000023   24F7         ADD       A,#-0x9
   \   000025   602D         JZ        ??zclSampleLight_ProcessIncomingMsg_2
   \   000027   24FB         ADD       A,#-0x5
   \   000029   6024         JZ        ??zclSampleLight_ProcessIncomingMsg_3
   \   00002B   24FE         ADD       A,#-0x2
   \   00002D   6020         JZ        ??zclSampleLight_ProcessIncomingMsg_3
   \   00002F   24FE         ADD       A,#-0x2
   \   000031   6033         JZ        ??zclSampleLight_ProcessIncomingMsg_4
   \   000033   8043         SJMP      ??zclSampleLight_ProcessIncomingMsg_5
   1118            {
   1119          #ifdef ZCL_READ
   1120              case ZCL_CMD_READ_RSP:
   1121                zclSampleLight_ProcessInReadRspCmd( pInMsg );
   \                     ??zclSampleLight_ProcessIncomingMsg_0:
   \   000035   12....       LCALL     ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   000038   E0           MOVX      A,@DPTR
   \   000039   F9           MOV       R1,A
   \   00003A   E8           MOV       A,R0
   \   00003B   C3           CLR       C
   \   00003C   99           SUBB      A,R1
   \   00003D   5039         JNC       ??zclSampleLight_ProcessIncomingMsg_5
   \   00003F   08           INC       R0
   \   000040   80F6         SJMP      ??CrossCallReturnLabel_4
   1122                break;
   1123          #endif
   1124          #ifdef ZCL_WRITE
   1125              case ZCL_CMD_WRITE_RSP:
   1126                zclSampleLight_ProcessInWriteRspCmd( pInMsg );
   \                     ??zclSampleLight_ProcessIncomingMsg_1:
   \   000042   12....       LCALL     ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   000045   E0           MOVX      A,@DPTR
   \   000046   F9           MOV       R1,A
   \   000047   E8           MOV       A,R0
   \   000048   C3           CLR       C
   \   000049   99           SUBB      A,R1
   \   00004A   502C         JNC       ??zclSampleLight_ProcessIncomingMsg_5
   \   00004C   08           INC       R0
   \   00004D   80F6         SJMP      ??CrossCallReturnLabel_5
   1127                break;
   1128          #endif
   1129              case ZCL_CMD_CONFIG_REPORT:
   1130              case ZCL_CMD_CONFIG_REPORT_RSP:
   1131              case ZCL_CMD_READ_REPORT_CFG:
   1132              case ZCL_CMD_READ_REPORT_CFG_RSP:
   1133              case ZCL_CMD_REPORT:
   1134                //bdb_ProcessIncomingReportingMsg( pInMsg );
   1135                break;
   1136          
   1137              case ZCL_CMD_DEFAULT_RSP:
   1138                zclSampleLight_ProcessInDefaultRspCmd( pInMsg );
   1139                break;
   1140          #ifdef ZCL_DISCOVER
   1141              case ZCL_CMD_DISCOVER_CMDS_RECEIVED_RSP:
   1142                zclSampleLight_ProcessInDiscCmdsRspCmd( pInMsg );
   \                     ??zclSampleLight_ProcessIncomingMsg_3:
   \   00004F                ; Setup parameters for call to function zclSampleLight_ProcessInDiscCmdsRspCmd
   1143                break;
   1144          
   1145              case ZCL_CMD_DISCOVER_CMDS_GEN_RSP:
   1146                zclSampleLight_ProcessInDiscCmdsRspCmd( pInMsg );
   \   00004F                ; Setup parameters for call to function zclSampleLight_ProcessInDiscCmdsRspCmd
   \   00004F   12....       LCALL     `??zclSampleLight_ProcessInDiscCmdsRspCmd::?rela`; Banked call to: zclSampleLight_ProcessInDiscCmdsRspCmd
   1147                break;
   \   000052   8024         SJMP      ??zclSampleLight_ProcessIncomingMsg_5
   1148          
   1149              case ZCL_CMD_DISCOVER_ATTRS_RSP:
   1150                zclSampleLight_ProcessInDiscAttrsRspCmd( pInMsg );
   \                     ??zclSampleLight_ProcessIncomingMsg_2:
   \   000054   12....       LCALL     ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_17:
   \   000057   8882         MOV       DPL,R0
   \   000059   8983         MOV       DPH,R1
   \   00005B   A3           INC       DPTR
   \   00005C   E0           MOVX      A,@DPTR
   \   00005D   FB           MOV       R3,A
   \   00005E   EA           MOV       A,R2
   \   00005F   C3           CLR       C
   \   000060   9B           SUBB      A,R3
   \   000061   5015         JNC       ??zclSampleLight_ProcessIncomingMsg_5
   \   000063   0A           INC       R2
   \   000064   80F1         SJMP      ??CrossCallReturnLabel_17
   1151                break;
   1152          
   1153              case ZCL_CMD_DISCOVER_ATTRS_EXT_RSP:
   1154                zclSampleLight_ProcessInDiscAttrsExtRspCmd( pInMsg );
   \                     ??zclSampleLight_ProcessIncomingMsg_4:
   \   000066   12....       LCALL     ?Subroutine7 & 0xFFFF
   1155                break;
   1156          #endif
   1157              default:
   1158                break;
   1159            }
   \                     ??CrossCallReturnLabel_18:
   \   000069   8001         SJMP      ??zclSampleLight_ProcessIncomingMsg_6
   \                     ??zclSampleLight_ProcessIncomingMsg_7:
   \   00006B   0A           INC       R2
   \                     ??zclSampleLight_ProcessIncomingMsg_6:
   \   00006C   8882         MOV       DPL,R0
   \   00006E   8983         MOV       DPH,R1
   \   000070   A3           INC       DPTR
   \   000071   E0           MOVX      A,@DPTR
   \   000072   FB           MOV       R3,A
   \   000073   EA           MOV       A,R2
   \   000074   C3           CLR       C
   \   000075   9B           SUBB      A,R3
   \   000076   40F3         JC        ??zclSampleLight_ProcessIncomingMsg_7
   1160          
   1161            if ( pInMsg->attrCmd )
   \                     ??zclSampleLight_ProcessIncomingMsg_5:
   \   000078   8E82         MOV       DPL,R6
   \   00007A   8F83         MOV       DPH,R7
   \   00007C   12....       LCALL     ??Subroutine11_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_10:
   \   00007F   EA           MOV       A,R2
   \   000080   4B           ORL       A,R3
   \   000081   6003         JZ        ??zclSampleLight_ProcessIncomingMsg_8
   1162              osal_mem_free( pInMsg->attrCmd );
   \   000083                ; Setup parameters for call to function osal_mem_free
   \   000083   12....       LCALL     `??osal_mem_free::?relay`; Banked call to: osal_mem_free
   1163          }
   \                     ??zclSampleLight_ProcessIncomingMsg_8:
   \   000086                REQUIRE ?Subroutine1
   \   000086                ; // Fall through to label ?Subroutine1

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   8E82         MOV       DPL,R6
   \   000002   8F83         MOV       DPH,R7
   \   000004                REQUIRE ??Subroutine13_0
   \   000004                ; // Fall through to label ??Subroutine13_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine13_0:
   \   000000   12....       LCALL     ?Subroutine9 & 0xFFFF
   \                     ??CrossCallReturnLabel_24:
   \   000003   7A00         MOV       R2,#0x0
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   8E82         MOV       DPL,R6
   \   000002   8F83         MOV       DPH,R7
   \   000004   12....       LCALL     ?Subroutine9 & 0xFFFF
   \                     ??CrossCallReturnLabel_23:
   \   000007   8882         MOV       DPL,R0
   \   000009   8983         MOV       DPH,R1
   \   00000B   7800         MOV       R0,#0x0
   \   00000D   22           RET
   1164          
   1165          #ifdef ZCL_READ
   1166          /*********************************************************************
   1167           * @fn      zclSampleLight_ProcessInReadRspCmd
   1168           *
   1169           * @brief   Process the "Profile" Read Response Command
   1170           *
   1171           * @param   pInMsg - incoming message to process
   1172           *
   1173           * @return  none
   1174           */
   1175          static uint8 zclSampleLight_ProcessInReadRspCmd( zclIncomingMsg_t *pInMsg )
   1176          {
   1177            zclReadRspCmd_t *readRspCmd;
   1178            uint8 i;
   1179          
   1180            readRspCmd = (zclReadRspCmd_t *)pInMsg->attrCmd;
   1181            for (i = 0; i < readRspCmd->numAttr; i++)
   1182            {
   1183              // Notify the originator of the results of the original read attributes
   1184              // attempt and, for each successfull request, the value of the requested
   1185              // attribute
   1186            }
   1187          
   1188            return ( TRUE );
   1189          }
   1190          #endif // ZCL_READ
   1191          
   1192          #ifdef ZCL_WRITE
   1193          /*********************************************************************
   1194           * @fn      zclSampleLight_ProcessInWriteRspCmd
   1195           *
   1196           * @brief   Process the "Profile" Write Response Command
   1197           *
   1198           * @param   pInMsg - incoming message to process
   1199           *
   1200           * @return  none
   1201           */
   1202          static uint8 zclSampleLight_ProcessInWriteRspCmd( zclIncomingMsg_t *pInMsg )
   1203          {
   1204            zclWriteRspCmd_t *writeRspCmd;
   1205            uint8 i;
   1206          
   1207            writeRspCmd = (zclWriteRspCmd_t *)pInMsg->attrCmd;
   1208            for ( i = 0; i < writeRspCmd->numAttr; i++ )
   1209            {
   1210              // Notify the device of the results of the its original write attributes
   1211              // command.
   1212            }
   1213          
   1214            return ( TRUE );
   1215          }
   1216          #endif // ZCL_WRITE
   1217          
   1218          /*********************************************************************
   1219           * @fn      zclSampleLight_ProcessInDefaultRspCmd
   1220           *
   1221           * @brief   Process the "Profile" Default Response Command
   1222           *
   1223           * @param   pInMsg - incoming message to process
   1224           *
   1225           * @return  none
   1226           */
   1227          static uint8 zclSampleLight_ProcessInDefaultRspCmd( zclIncomingMsg_t *pInMsg )
   1228          {
   1229            // zclDefaultRspCmd_t *defaultRspCmd = (zclDefaultRspCmd_t *)pInMsg->attrCmd;
   1230          
   1231            // Device is notified of the Default Response command.
   1232            (void)pInMsg;
   1233          
   1234            return ( TRUE );
   1235          }
   1236          
   1237          #ifdef ZCL_DISCOVER
   1238          /*********************************************************************
   1239           * @fn      zclSampleLight_ProcessInDiscCmdsRspCmd
   1240           *
   1241           * @brief   Process the Discover Commands Response Command
   1242           *
   1243           * @param   pInMsg - incoming message to process
   1244           *
   1245           * @return  none
   1246           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1247          static uint8 zclSampleLight_ProcessInDiscCmdsRspCmd( zclIncomingMsg_t *pInMsg )
   \                     zclSampleLight_ProcessInDiscCmdsRspCmd:
   1248          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1249            zclDiscoverCmdsCmdRsp_t *discoverRspCmd;
   1250            uint8 i;
   1251          
   1252            discoverRspCmd = (zclDiscoverCmdsCmdRsp_t *)pInMsg->attrCmd;
   \   000004   EA           MOV       A,R2
   \   000005   2417         ADD       A,#0x17
   \   000007   F582         MOV       DPL,A
   \   000009   E4           CLR       A
   \   00000A   3B           ADDC      A,R3
   \   00000B   F583         MOV       DPH,A
   \   00000D   12....       LCALL     ??Subroutine13_0 & 0xFFFF
   1253            for ( i = 0; i < discoverRspCmd->numCmd; i++ )
   \                     ??CrossCallReturnLabel_16:
   \   000010   8001         SJMP      ??zclSampleLight_ProcessInDiscCmdsRspCmd_0
   \                     ??zclSampleLight_ProcessInDiscCmdsRspCmd_1:
   \   000012   0A           INC       R2
   \                     ??zclSampleLight_ProcessInDiscCmdsRspCmd_0:
   \   000013   8882         MOV       DPL,R0
   \   000015   8983         MOV       DPH,R1
   \   000017   A3           INC       DPTR
   \   000018   A3           INC       DPTR
   \   000019   E0           MOVX      A,@DPTR
   \   00001A   FB           MOV       R3,A
   \   00001B   EA           MOV       A,R2
   \   00001C   C3           CLR       C
   \   00001D   9B           SUBB      A,R3
   \   00001E   40F2         JC        ??zclSampleLight_ProcessInDiscCmdsRspCmd_1
   1254            {
   1255              // Device is notified of the result of its attribute discovery command.
   1256            }
   1257          
   1258            return ( TRUE );
   \   000020   7901         MOV       R1,#0x1
   \   000022                REQUIRE ?Subroutine0
   \   000022                ; // Fall through to label ?Subroutine0
   1259          }
   1260          
   1261          /*********************************************************************
   1262           * @fn      zclSampleLight_ProcessInDiscAttrsRspCmd
   1263           *
   1264           * @brief   Process the "Profile" Discover Attributes Response Command
   1265           *
   1266           * @param   pInMsg - incoming message to process
   1267           *
   1268           * @return  none
   1269           */
   1270          static uint8 zclSampleLight_ProcessInDiscAttrsRspCmd( zclIncomingMsg_t *pInMsg )
   1271          {
   1272            zclDiscoverAttrsRspCmd_t *discoverRspCmd;
   1273            uint8 i;
   1274          
   1275            discoverRspCmd = (zclDiscoverAttrsRspCmd_t *)pInMsg->attrCmd;
   1276            for ( i = 0; i < discoverRspCmd->numAttr; i++ )
   1277            {
   1278              // Device is notified of the result of its attribute discovery command.
   1279            }
   1280          
   1281            return ( TRUE );
   1282          }
   1283          
   1284          /*********************************************************************
   1285           * @fn      zclSampleLight_ProcessInDiscAttrsExtRspCmd
   1286           *
   1287           * @brief   Process the "Profile" Discover Attributes Extended Response Command
   1288           *
   1289           * @param   pInMsg - incoming message to process
   1290           *
   1291           * @return  none
   1292           */
   1293          static uint8 zclSampleLight_ProcessInDiscAttrsExtRspCmd( zclIncomingMsg_t *pInMsg )
   1294          {
   1295            zclDiscoverAttrsExtRsp_t *discoverRspCmd;
   1296            uint8 i;
   1297          
   1298            discoverRspCmd = (zclDiscoverAttrsExtRsp_t *)pInMsg->attrCmd;
   1299            for ( i = 0; i < discoverRspCmd->numAttr; i++ )
   1300            {
   1301              // Device is notified of the result of its attribute discovery command.
   1302            }
   1303          
   1304            return ( TRUE );
   1305          }
   1306          #endif // ZCL_DISCOVER
   1307          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1308          void zclSampleLight_UiActionToggleLight(uint16 keys)
   \                     zclSampleLight_UiActionToggleLight:
   1309          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1310            zclSampleLight_OnOffCB(COMMAND_TOGGLE);
   \   000004                ; Setup parameters for call to function zclSampleLight_OnOffCB
   \   000004   7902         MOV       R1,#0x2
   \   000006   12....       LCALL     `??zclSampleLight_OnOffCB::?relay`; Banked call to: zclSampleLight_OnOffCB
   1311          }
   \   000009   80..         SJMP      ?Subroutine0
   1312          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1313          void zclSampleLight_UpdateLedState(void)
   \                     zclSampleLight_UpdateLedState:
   1314          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1315            // set the LED1 based on light (on or off)
   1316            if ( zclSampleLight_OnOff == LIGHT_ON )
   \   000004   90....       MOV       DPTR,#zclSampleLight_OnOff
   \   000007   E0           MOVX      A,@DPTR
   \   000008   6401         XRL       A,#0x1
   \   00000A   7004         JNZ       ??zclSampleLight_UpdateLedState_0
   1317            {
   1318              HalLedSet ( UI_LED_APP, HAL_LED_MODE_ON );
   \   00000C                ; Setup parameters for call to function HalLedSet
   \   00000C   7A01         MOV       R2,#0x1
   \   00000E   8002         SJMP      ??zclSampleLight_UpdateLedState_1
   1319            }
   1320            else
   1321            {
   1322              HalLedSet ( UI_LED_APP, HAL_LED_MODE_OFF );
   \                     ??zclSampleLight_UpdateLedState_0:
   \   000010                ; Setup parameters for call to function HalLedSet
   \   000010   7A00         MOV       R2,#0x0
   \                     ??zclSampleLight_UpdateLedState_1:
   \   000012   7901         MOV       R1,#0x1
   \   000014   12....       LCALL     `??HalLedSet::?relay`; Banked call to: HalLedSet
   1323            }
   1324          }
   \   000017   80..         SJMP      ?Subroutine0
   1325          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1326          void zclSampleLight_UiUpdateLcd(uint8 UiState, char * line[3])
   \                     zclSampleLight_UiUpdateLcd:
   1327          {
   \   000000   74F7         MOV       A,#-0x9
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV       A,R2
   \   000006   FE           MOV       R6,A
   \   000007   EB           MOV       A,R3
   \   000008   FF           MOV       R7,A
   1328          #ifdef LCD_SUPPORTED
   1329          #ifdef ZCL_LEVEL_CTRL
   1330            zclHA_uint8toa( zclSampleLight_LevelCurrentLevel, &sLightLevel[9] );
   \   000009                ; Setup parameters for call to function zclHA_uint8toa
   \   000009   7A..         MOV       R2,#(sLightLevel + 9) & 0xff
   \   00000B   7B..         MOV       R3,#((sLightLevel + 9) >> 8) & 0xff
   \   00000D   90....       MOV       DPTR,#zclSampleLight_LevelCurrentLevel
   \   000010   E0           MOVX      A,@DPTR
   \   000011   F9           MOV       R1,A
   \   000012   12....       LCALL     `??zclHA_uint8toa::?relay`; Banked call to: zclHA_uint8toa
   1331            line[0] = (char *)sLightLevel;
   \   000015   8E82         MOV       DPL,R6
   \   000017   8F83         MOV       DPH,R7
   \   000019   74..         MOV       A,#sLightLevel & 0xff
   \   00001B   F0           MOVX      @DPTR,A
   \   00001C   A3           INC       DPTR
   \   00001D   74..         MOV       A,#(sLightLevel >> 8) & 0xff
   \   00001F   F0           MOVX      @DPTR,A
   1332          #endif // ZCL_LEVEL_CTRL
   1333            line[1] = (char *)(zclSampleLight_OnOff ? sLightOn : sLightOff);
   \   000020   90....       MOV       DPTR,#zclSampleLight_OnOff
   \   000023   E0           MOVX      A,@DPTR
   \   000024   6006         JZ        ??zclSampleLight_UiUpdateLcd_0
   \   000026   78..         MOV       R0,#sLightOn & 0xff
   \   000028   79..         MOV       R1,#(sLightOn >> 8) & 0xff
   \   00002A   8004         SJMP      ??zclSampleLight_UiUpdateLcd_1
   \                     ??zclSampleLight_UiUpdateLcd_0:
   \   00002C   78..         MOV       R0,#sLightOff & 0xff
   \   00002E   79..         MOV       R1,#(sLightOff >> 8) & 0xff
   \                     ??zclSampleLight_UiUpdateLcd_1:
   \   000030   8E82         MOV       DPL,R6
   \   000032   8F83         MOV       DPH,R7
   \   000034   A3           INC       DPTR
   \   000035   A3           INC       DPTR
   \   000036   E8           MOV       A,R0
   \   000037   F0           MOVX      @DPTR,A
   \   000038   A3           INC       DPTR
   \   000039   E9           MOV       A,R1
   \   00003A   F0           MOVX      @DPTR,A
   1334            line[2] = "< TOGGLE LIGHT >";
   \   00003B   8E82         MOV       DPL,R6
   \   00003D   8F83         MOV       DPH,R7
   \   00003F   A3           INC       DPTR
   \   000040   A3           INC       DPTR
   \   000041   A3           INC       DPTR
   \   000042   A3           INC       DPTR
   \   000043   74..         MOV       A,#`?<Constant "< TOGGLE LIGHT >">` & 0xff
   \   000045   F0           MOVX      @DPTR,A
   \   000046   A3           INC       DPTR
   \   000047   74..         MOV       A,#(`?<Constant "< TOGGLE LIGHT >">` >> 8) & 0xff
   \   000049   F0           MOVX      @DPTR,A
   1335          #endif
   1336          }
   \   00004A   02....       LJMP      ?Subroutine1 & 0xFFFF

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for sampleLight_TestEp>`:
   \   000000   08           DB 8
   \   000001   00           DB 0
   \   000002   ....         DW zclSampleLight_TaskID
   \   000004   0000         DW 0H
   \   000006   00           DB 0

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for sLightLevel>`:
   \   000000   2020204C     DB "   LEVEL ###    "
   \            4556454C
   \            20232323
   \            20202020
   \            00      

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zclSampleLight_CmdCallbacks>`:
   \   000000   ....         DW `??zclSampleLight_BasicResetCB::?relay`
   \   000002   0000         DW 0H
   \   000004   ....         DW `??zclSampleLight_OnOffCB::?relay`
   \   000006   0000         DW 0H
   \   000008   0000         DW 0H
   \   00000A   0000         DW 0H
   \   00000C   ....         DW `??zclSampleLight_LevelControlMoveToLevelCB::?re`
   \   00000E   ....         DW `??zclSampleLight_LevelControlMoveCB::?relay`
   \   000010   ....         DW `??zclSampleLight_LevelControlStepCB::?relay`
   \   000012   ....         DW `??zclSampleLight_LevelControlStopCB::?relay`
   \   000014   0000         DW 0H
   \   000016   0000         DW 0H
   \   000018   0000         DW 0H
   \   00001A   0000         DW 0H
   \   00001C   0000         DW 0H
   \   00001E   0000         DW 0H

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleLight_Init::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleLight_event_loop::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_event_loop

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??gp_CommissioningMode::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    gp_CommissioningMode

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??gp_ChangeChannelReq::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    gp_ChangeChannelReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleLight_ProcessCommissioningStatus::?r`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_ProcessCommissioningStatus

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleLight_BasicResetCB::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_BasicResetCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleLight_OnOffCB::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_OnOffCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleLight_TimeRateHelper::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_TimeRateHelper

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleLight_MoveBasedOnRate::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_MoveBasedOnRate

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleLight_MoveBasedOnTime::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_MoveBasedOnTime

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleLight_AdjustLightLevel::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_AdjustLightLevel

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleLight_LevelControlMoveToLevelCB::?re`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_LevelControlMoveToLevelCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleLight_LevelControlMoveCB::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_LevelControlMoveCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleLight_LevelControlStepCB::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_LevelControlStepCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleLight_LevelControlStopCB::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_LevelControlStopCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleApp_BatteryWarningCB::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleApp_BatteryWarningCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleLight_ProcessIncomingMsg::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_ProcessIncomingMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleLight_ProcessInDiscCmdsRspCmd::?rela`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_ProcessInDiscCmdsRspCmd

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleLight_UiActionToggleLight::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_UiActionToggleLight

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleLight_UpdateLedState::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_UpdateLedState

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleLight_UiUpdateLcd::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleLight_UiUpdateLcd

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "TI Sample Light">`:
   \   000000   54492053     DB "TI Sample Light"
   \            616D706C
   \            65204C69
   \            67687400

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "< TOGGLE LIGHT >">`:
   \   000000   3C20544F     DB "< TOGGLE LIGHT >"
   \            47474C45
   \            204C4947
   \            4854203E
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3e8:
   \   000000   E8030000     DD 1000

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_64:
   \   000000   64000000     DD 100
   1337          
   1338          /****************************************************************************
   1339          ****************************************************************************/
   1340          
   1341          

   Maximum stack usage in bytes:

   ISTACK XSTACK Function
   ------ ------ --------
      0      0   gp_ChangeChannelReq
      0      0   gp_CommissioningMode
      0      0   zclSampleApp_BatteryWarningCB
      0     32   zclSampleLight_AdjustLightLevel
        0     16   -> UI_UpdateLcd
        0     20   -> osal_start_timerEx
        0     16   -> zclSampleLight_UpdateLedState
      2      0   zclSampleLight_BasicResetCB
        2      0   -> UI_UpdateLcd
        2      0   -> zclSampleLight_ResetAttributesToDefaultValues
        2      0   -> zclSampleLight_UpdateLedState
      0     18   zclSampleLight_Init
        0     10   -> RegisterForKeys
        0     10   -> RegisterVoltageWarningCB
        0     18   -> UI_Init
        0     10   -> UI_UpdateLcd
        0     10   -> afRegister
        0     10   -> bdb_RegisterCommissioningStatusCB
        0     10   -> bdb_RegisterSimpleDescriptor
        0     10   -> gp_RegisterCommissioningModeCB
        0     10   -> gp_RegisterGPChangeChannelReqCB
        0     10   -> zclGeneral_RegisterCmdCallbacks
        0     10   -> zclSampleLight_ResetAttributesToDefaultValues
        0     10   -> zcl_registerAttrList
        0     10   -> zcl_registerCmdList
        0     10   -> zcl_registerForMsg
      0     16   zclSampleLight_LevelControlMoveCB
        0     16   -> zclSampleLight_MoveBasedOnRate
      2      0   zclSampleLight_LevelControlMoveToLevelCB
        2      0   -> zclSampleLight_MoveBasedOnTime
      0      9   zclSampleLight_LevelControlStepCB
        0      9   -> zclSampleLight_MoveBasedOnTime
      2      0   zclSampleLight_LevelControlStopCB
        2      0   -> osal_stop_timerEx
      0     36   zclSampleLight_MoveBasedOnRate
        0     20   -> osal_start_timerEx
        0     16   -> zclSampleLight_TimeRateHelper
      0     29   zclSampleLight_MoveBasedOnTime
        0     20   -> osal_start_timerEx
        0     16   -> zclSampleLight_TimeRateHelper
      0     16   zclSampleLight_OnOffCB
        0     16   -> UI_UpdateLcd
        0     16   -> zclSampleLight_MoveBasedOnRate
        0     16   -> zclSampleLight_UpdateLedState
        0     16   -> zcl_getRawAFMsg
      0      9   zclSampleLight_ProcessCommissioningStatus
        0      9   -> UI_UpdateComissioningStatus
        0      9   -> bdb_StartCommissioning
      2      9   zclSampleLight_ProcessInDiscCmdsRspCmd
      0     21   zclSampleLight_ProcessIncomingMsg
        0      9   -> osal_mem_free
        0      9   -> zclSampleLight_ProcessInDiscCmdsRspCmd
      0     32   zclSampleLight_TimeRateHelper
      2      0   zclSampleLight_UiActionToggleLight
        2      0   -> zclSampleLight_OnOffCB
      0      9   zclSampleLight_UiUpdateLcd
        0      9   -> zclHA_uint8toa
      2     16   zclSampleLight_UpdateLedState
        2      0   -> HalLedSet
      0     12   zclSampleLight_event_loop
        0     12   -> UI_DeviceStateUpdated
        0     12   -> UI_MainStateMachine
        0     12   -> UI_UpdateLcd
        0     12   -> osal_msg_deallocate
        0     12   -> osal_msg_receive
        0     12   -> zclSampleLight_AdjustLightLevel
        0     12   -> zclSampleLight_ProcessIncomingMsg


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
      17  ?<Constant "< TOGGLE LIGHT >">
      16  ?<Constant "TI Sample Light">
      17  ?<Initializer for sLightLevel>
       7  ?<Initializer for sampleLight_TestEp>
      32  ?<Initializer for zclSampleLight_CmdCallbacks>
       5  ??Subroutine10_0
       6  ??Subroutine11_0
       7  ??Subroutine12_0
       6  ??Subroutine13_0
       7  ?Subroutine0
       5  ?Subroutine1
      23  ?Subroutine2
       4  ?Subroutine3
       9  ?Subroutine4
       1  ?Subroutine5
      14  ?Subroutine6
       4  ?Subroutine7
      11  ?Subroutine8
       6  ?Subroutine9
       4  __Constant_3e8
       4  __Constant_64
       5  gp_ChangeChannelReq
       6  gp_ChangeChannelReq::?relay
       3  gp_CommissioningMode
       6  gp_CommissioningMode::?relay
      17  sLightLevel
      17  sLightOff
      17  sLightOn
       7  sampleLight_TestEp
       3  zclSampleApp_BatteryWarningCB
       6  zclSampleApp_BatteryWarningCB::?relay
       1  zclSampleLightSeqNum
     217  zclSampleLight_AdjustLightLevel
       6  zclSampleLight_AdjustLightLevel::?relay
      16  zclSampleLight_BasicResetCB
       6  zclSampleLight_BasicResetCB::?relay
      32  zclSampleLight_CmdCallbacks
       4  zclSampleLight_CurrentLevel32
      12  zclSampleLight_DstAddr
     215  zclSampleLight_Init
       6  zclSampleLight_Init::?relay
       1  zclSampleLight_LevelChangeCmd
      66  zclSampleLight_LevelControlMoveCB
       6  zclSampleLight_LevelControlMoveCB::?relay
      44  zclSampleLight_LevelControlMoveToLevelCB
       6  zclSampleLight_LevelControlMoveToLevelCB::?relay
      82  zclSampleLight_LevelControlStepCB
       6  zclSampleLight_LevelControlStepCB::?relay
      26  zclSampleLight_LevelControlStopCB
       6  zclSampleLight_LevelControlStopCB::?relay
       1  zclSampleLight_LevelLastLevel
      65  zclSampleLight_MoveBasedOnRate
       6  zclSampleLight_MoveBasedOnRate::?relay
     127  zclSampleLight_MoveBasedOnTime
       6  zclSampleLight_MoveBasedOnTime::?relay
       1  zclSampleLight_NewLevel
       1  zclSampleLight_NewLevelUp
     203  zclSampleLight_OnOffCB
       6  zclSampleLight_OnOffCB::?relay
      45  zclSampleLight_ProcessCommissioningStatus
       6  zclSampleLight_ProcessCommissioningStatus::?relay
      34  zclSampleLight_ProcessInDiscCmdsRspCmd
       6  zclSampleLight_ProcessInDiscCmdsRspCmd::?relay
     134  zclSampleLight_ProcessIncomingMsg
       6  zclSampleLight_ProcessIncomingMsg::?relay
       4  zclSampleLight_Rate32
       1  zclSampleLight_TaskID
     128  zclSampleLight_TimeRateHelper
       6  zclSampleLight_TimeRateHelper::?relay
      11  zclSampleLight_UiActionToggleLight
       6  zclSampleLight_UiActionToggleLight::?relay
      12  zclSampleLight_UiStatesMain
      77  zclSampleLight_UiUpdateLcd
       6  zclSampleLight_UiUpdateLcd::?relay
      25  zclSampleLight_UpdateLedState
       6  zclSampleLight_UpdateLedState::?relay
       1  zclSampleLight_WithOnOff
     141  zclSampleLight_event_loop
       6  zclSampleLight_event_loop::?relay

 
 1 775 bytes in segment BANKED_CODE
   126 bytes in segment BANK_RELAYS
    56 bytes in segment XDATA_I
    56 bytes in segment XDATA_ID
    87 bytes in segment XDATA_ROM_C
    27 bytes in segment XDATA_Z
 
   182 bytes of CODE     memory
    79 bytes of CONST    memory (+ 8 bytes shared)
 1 775 bytes of HUGECODE memory
    83 bytes of XDATA    memory

Errors: none
Warnings: none
